<script>document.write(decodeURIComponent(escape(atob("PCFET0NUWVBFIGh0bWw+DQo8aHRtbCBsYW5nPSJlbiI+DQo8aGVhZD4NCiAgICA8bWV0YSBjaGFyc2V0PSJVVEYtOCIgLz4NCiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEuMCIgLz4NCiAgICA8bWV0YSBodHRwLWVxdWl2PSJDYWNoZS1Db250cm9sIg0KICAgICAgICAgIGNvbnRlbnQ9Im5vLWNhY2hlLCBuby1zdG9yZSwgbXVzdC1yZXZhbGlkYXRlIiAvPg0KICAgIDxtZXRhIGh0dHAtZXF1aXY9IlByYWdtYSIgY29udGVudD0ibm8tY2FjaGUiIC8+DQogICAgPG1ldGEgaHR0cC1lcXVpdj0iRXhwaXJlcyIgY29udGVudD0iMCIgLz4NCg0KICAgIDx0aXRsZT5NTVBUIERhdGFiYXNlIC0gdjIwLjM8L3RpdGxlPg0KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvbnBtL2NoYXJ0LmpzIj48L3NjcmlwdD4NCiAgICA8c2NyaXB0IHNyYz0iaHR0cHM6Ly9jZG5qcy5jbG91ZGZsYXJlLmNvbS9hamF4L2xpYnMveGxzeC8wLjE4LjUveGxzeC5mdWxsLm1pbi5qcyI+PC9zY3JpcHQ+DQogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2pzcGRmLzIuNS4xL2pzcGRmLnVtZC5taW4uanMiPjwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgc3JjPSJodHRwczovL2NkbmpzLmNsb3VkZmxhcmUuY29tL2FqYXgvbGlicy9odG1sMmNhbnZhcy8xLjQuMS9odG1sMmNhbnZhcy5taW4uanMiPjwvc2NyaXB0Pg0KDQogICAgPHNjcmlwdCBzcmM9Imh0dHBzOi8vY2RuanMuY2xvdWRmbGFyZS5jb20vYWpheC9saWJzL2pzcGRmLWF1dG90YWJsZS8zLjUuMjUvanNwZGYucGx1Z2luLmF1dG90YWJsZS5taW4uanMiPjwvc2NyaXB0Pg0KDQoNCiAgICA8c3R5bGU+DQoNCg0KICAgICAgICAvKiBOYXZpZ2F0aW9uIGJ1dHRvbnMgZml4ICovDQogICAgICAgIC5uYXYtc2Nyb2xsLWJ0biB7DQogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7DQogICAgICAgICAgICByaWdodDogMjBweDsNCiAgICAgICAgICAgIHdpZHRoOiA1MHB4Ow0KICAgICAgICAgICAgaGVpZ2h0OiA1MHB4Ow0KICAgICAgICAgICAgYmFja2dyb3VuZDogIzMzMyAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgY29sb3I6IHdoaXRlICFpbXBvcnRhbnQ7DQogICAgICAgICAgICBib3JkZXI6IDJweCBzb2xpZCAjZmZmOw0KICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOw0KICAgICAgICAgICAgZm9udC1zaXplOiAyNHB4Ow0KICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOw0KICAgICAgICAgICAgZGlzcGxheTogZmxleCAhaW1wb3J0YW50OyAvKiBGb3JjZXMgdmlzaWJpbGl0eSAqLw0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBhbGlnbi1pdGVtczogY2VudGVyOw0KICAgICAgICAgICAgei1pbmRleDogOTk5OTk7IC8qIEhpZ2hlciB0aGFuIGV2ZXJ5dGhpbmcgZWxzZSAqLw0KICAgICAgICAgICAgYm94LXNoYWRvdzogMCA0cHggMTBweCByZ2JhKDAsMCwwLDAuNSk7DQogICAgICAgICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4yczsNCiAgICAgICAgfQ0KDQogICAgICAgICAgICAubmF2LXNjcm9sbC1idG46YWN0aXZlIHsNCiAgICAgICAgICAgICAgICB0cmFuc2Zvcm06IHNjYWxlKDAuOSk7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgI2J0bkdvVG9wIHsNCiAgICAgICAgICAgIGJvdHRvbTogOTBweDsNCiAgICAgICAgfQ0KDQogICAgICAgICNidG5Hb0JvdHRvbSB7DQogICAgICAgICAgICBib3R0b206IDMwcHg7DQogICAgICAgIH0NCg0KDQogICAgICAgIC8qIC0tLSBOZXcgTWF0Y2ggVGFibGUgU3R5bGVzIC0tLSAqLw0KICAgICAgICAjbWF0Y2hUYWJsZSB7DQogICAgICAgICAgICB0YWJsZS1sYXlvdXQ6IGZpeGVkOw0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOw0KICAgICAgICAgICAgbWFyZ2luLXRvcDogMTBweDsNCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHdoaXRlOw0KICAgICAgICB9DQoNCiAgICAgICAgICAgICNtYXRjaFRhYmxlIHRoLCAjbWF0Y2hUYWJsZSB0ZCB7DQogICAgICAgICAgICAgICAgcGFkZGluZzogOHB4IDRweDsNCiAgICAgICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOw0KICAgICAgICAgICAgICAgIHdvcmQtd3JhcDogYnJlYWstd29yZDsNCiAgICAgICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KICAgICAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44NXJlbTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8qIFNwZWNpZmljIENvbHVtbiBXaWR0aHM6IDEwJSB8IDE1JSB8IDc1JSAqLw0KICAgICAgICAgICAgICAgIC8qIFVwZGF0ZWQgd2lkdGhzOiBDb2wgMTogMTAlLCBDb2wgMjogMTAlLCBDb2wgMzogODAlICovDQogICAgICAgICAgICAgICAgI21hdGNoVGFibGUgdGg6bnRoLWNoaWxkKDEpLCAjbWF0Y2hUYWJsZSB0ZDpudGgtY2hpbGQoMSkgew0KICAgICAgICAgICAgICAgICAgICB3aWR0aDogMTAlICFpbXBvcnRhbnQ7DQogICAgICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAjbWF0Y2hUYWJsZSB0aDpudGgtY2hpbGQoMiksICNtYXRjaFRhYmxlIHRkOm50aC1jaGlsZCgyKSB7DQogICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMCUgIWltcG9ydGFudDsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAjbWF0Y2hUYWJsZSB0aDpudGgtY2hpbGQoMyksICNtYXRjaFRhYmxlIHRkOm50aC1jaGlsZCgzKSB7DQogICAgICAgICAgICAgICAgICAgIHdpZHRoOiA4MCUgIWltcG9ydGFudDsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qIEhlYWRlciBTdHlsaW5nIHdpdGggdHdvLWxpbmUgc3VwcG9ydCAqLw0KICAgICAgICAgICAgI21hdGNoVGFibGUgdGggew0KICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmOGY5ZmE7DQogICAgICAgICAgICAgICAgY29sb3I6ICMzMzM7DQogICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgIC8qIERlYml0L0NyZWRpdCBDb2xvcnMgKi8NCiAgICAgICAgLmFtdC1kZWJpdCB7DQogICAgICAgICAgICBjb2xvcjogI0ZGMDAwMCAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgIH0NCg0KICAgICAgICAuYW10LWNyZWRpdCB7DQogICAgICAgICAgICBjb2xvcjogIzAwNjQwMCAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAvKiBTdHlsZSBmb3IgdGhlIG5ldyBRdWl0IEJ1dHRvbiAqLw0KICAgICAgICAucXVpdC1idG4gew0KICAgICAgICAgICAgYmFja2dyb3VuZDogI2ZmNDQ0NCAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgY29sb3I6IHdoaXRlICFpbXBvcnRhbnQ7DQogICAgICAgICAgICBib3JkZXI6IG5vbmUgIWltcG9ydGFudDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDhweCAxNXB4Ow0KICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNHB4Ow0KICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOw0KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgICAgICBtYXJnaW4tbGVmdDogMTVweDsNCiAgICAgICAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jazsNCiAgICAgICAgICAgIHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7DQogICAgICAgIH0NCg0KICAgICAgICAgICAgLnF1aXQtYnRuOmhvdmVyIHsNCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjY2MwMDAwICFpbXBvcnRhbnQ7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC5xdWl0LWJ0bjpkaXNhYmxlZCB7DQogICAgICAgICAgICAgICAgYmFja2dyb3VuZDogIzk5OSAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgIC5hbm9ueS1tYWluLXJvdyB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRTFCRUU3ICFpbXBvcnRhbnQ7IC8qIFB1cnBsZSBmb3IgY3VycmVudCB5ZWFyIHRhcmdldCAqLw0KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgIH0NCg0KICAgICAgICAubWF0Y2gtcmVzdWx0LXJvdyB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmZmZmOyAvKiBXaGl0ZSBmb3IgaGlzdG9yaWNhbCBtYXRjaGVzICovDQogICAgICAgIH0NCg0KICAgICAgICAuc3BhY2VyLXJvdyB7DQogICAgICAgICAgICBoZWlnaHQ6IDE1cHg7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjZjBmMGYwOw0KICAgICAgICB9DQoNCiAgICAgICAgLmFub255LW1haW4tcm93IHsNCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNFMUJFRTcgIWltcG9ydGFudDsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICB9DQoNCiAgICAgICAgLm1hdGNoLXJlc3VsdC1yb3cgew0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZmZmZjsNCiAgICAgICAgfQ0KDQogICAgICAgIC5idG4tcm93NSB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRTFCRUU3ICFpbXBvcnRhbnQ7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBIaWdobGlnaHQgdGhlIEFub255bW91cyByZWNvcmQgYmVpbmcgbWF0Y2hlZCAqLw0KICAgICAgICAuYW5vbnktbWFpbi1yb3cgew0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2ZmZjljNCAhaW1wb3J0YW50OyAvKiBDaGFuZ2UgdG8gWWVsbG93ICovDQogICAgICAgICAgICA7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgfQ0KICAgICAgICAvKiBTdHlsZSBmb3Igc2VhcmNoIHJlc3VsdCByb3dzICovDQogICAgICAgIC5tYXRjaC1yZXN1bHQtcm93IHsNCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNmOWY5Zjk7DQogICAgICAgIH0NCg0KICAgICAgICAjZGV0YWlsZWRSZXN1bHRzIHRhYmxlIHsNCiAgICAgICAgICAgIHRhYmxlLWxheW91dDogZml4ZWQ7IC8qIEtlZXBzIGNvbHVtbnMgYWxpZ25lZCBhY3Jvc3MgdGFibGVzICovDQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7DQogICAgICAgICAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7IC8qIEZvcmNlcyBsb25nIHRleHQgdG8gYnJlYWsgKi8NCiAgICAgICAgfQ0KDQogICAgICAgIC8qIERlZmluZSBzcGVjaWZpYyB3aWR0aHMgZm9yIGVhY2ggY29sdW1uICovDQogICAgICAgICNkZXRhaWxlZFJlc3VsdHMgdGg6bnRoLWNoaWxkKDEpLCAjZGV0YWlsZWRSZXN1bHRzIHRkOm50aC1jaGlsZCgxKSB7DQogICAgICAgICAgICB3aWR0aDogMTglOw0KICAgICAgICB9DQogICAgICAgIC8qIFJlY2VpcHQgKi8NCiAgICAgICAgI2RldGFpbGVkUmVzdWx0cyB0aDpudGgtY2hpbGQoMiksICNkZXRhaWxlZFJlc3VsdHMgdGQ6bnRoLWNoaWxkKDIpIHsNCiAgICAgICAgICAgIHdpZHRoOiAxOCU7DQogICAgICAgIH0NCiAgICAgICAgLyogRGF0ZSAqLw0KICAgICAgICAjZGV0YWlsZWRSZXN1bHRzIHRoOm50aC1jaGlsZCgzKSwgI2RldGFpbGVkUmVzdWx0cyB0ZDpudGgtY2hpbGQoMykgew0KICAgICAgICAgICAgd2lkdGg6IDIyJTsNCiAgICAgICAgfQ0KICAgICAgICAvKiBBbW91bnQgKi8NCiAgICAgICAgI2RldGFpbGVkUmVzdWx0cyB0aDpudGgtY2hpbGQoNCksICNkZXRhaWxlZFJlc3VsdHMgdGQ6bnRoLWNoaWxkKDQpIHsNCiAgICAgICAgICAgIHdpZHRoOiA0MiU7DQogICAgICAgIH0NCiAgICAgICAgLyogUmVmZXJlbmNlICovDQoNCiAgICAgICAgI2RldGFpbGVkUmVzdWx0cyB0ZCwgI2RldGFpbGVkUmVzdWx0cyB0aCB7DQogICAgICAgICAgICBwYWRkaW5nOiA4cHggNHB4Ow0KICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsgLyogS2VlcHMgdGV4dCBhbGlnbmVkIHRvIHRoZSB0b3AgaWYgYSBuZWlnaGJvciB3cmFwcyAqLw0KICAgICAgICAgICAgd29yZC1icmVhazogYnJlYWstd29yZDsgLyogQWxsb3dzIGJyZWFraW5nIGxvbmcgc3RyaW5ncyBsaWtlIFVQSSBJRHMgKi8NCiAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3JtYWw7IC8qIEZJWEVEOiBBbGxvd3MgdGV4dCB0byBmbG93IHRvIHRoZSBuZXh0IGxpbmUgKi8NCiAgICAgICAgICAgIG92ZXJmbG93OiB2aXNpYmxlOyAvKiBGSVhFRDogTm8gbW9yZSBjdXR0aW5nIG9mZiB0ZXh0ICovDQogICAgICAgIH0NCg0KICAgICAgICAgICAgLyogU3BlY2lmaWMgZml4IGZvciBBbW91bnQgY29sdW1uIHRvIGtlZXAgY3VycmVuY3kgc3ltYm9scyB0b2dldGhlciAqLw0KICAgICAgICAgICAgI2RldGFpbGVkUmVzdWx0cyB0ZDpudGgtY2hpbGQoMykgew0KICAgICAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgOnJvb3Qgew0KICAgICAgICAgICAgLS1wcmltYXJ5LWJsdWU6ICMwMDAwOEI7DQogICAgICAgICAgICAtLWJnLXNhZmZyb246ICNGRkQ1ODA7DQogICAgICAgICAgICAtLXdoaXRlOiAjZmZmZmZmOw0KICAgICAgICAgICAgLS1jYW5jZWwtcmVkOiAjZmYwMDAwOw0KICAgICAgICAgICAgLS1ndy1ncmVlbjogIzAwNjQwMDsNCiAgICAgICAgICAgIC0tcm95YWwtYmx1ZTogIzAwMjM2NjsNCiAgICAgICAgICAgIC0tZ29sZDogI0ZGRDcwMDsNCiAgICAgICAgICAgIC0tZGFyay10ZXh0OiAjMWExYTFhOw0KICAgICAgICAgICAgLS12aWJyYW50LWJsdWU6ICMwMDMzY2M7DQogICAgICAgICAgICAtLWxvYW4tZ3JlZW46ICMwMDY0MDA7DQogICAgICAgICAgICAtLWRlcG9zaXQtcHVycGxlOiAjNEIwMDgyOw0KICAgICAgICAgICAgLS1leGVtcHQtZ3JheTogIzU1NTU1NTsNCiAgICAgICAgfQ0KDQogICAgICAgIGJvZHkgew0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tYmctc2FmZnJvbik7DQogICAgICAgICAgICBmb250LWZhbWlseTogc2Fucy1zZXJpZjsNCiAgICAgICAgICAgIG1hcmdpbjogMCAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgcGFkZGluZzogMDsNCiAgICAgICAgfQ0KDQogICAgICAgICNsb2dpbk92ZXJsYXkgew0KICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOw0KICAgICAgICAgICAgdG9wOiAwOw0KICAgICAgICAgICAgbGVmdDogMDsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgaGVpZ2h0OiAxMDAlOw0KICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tYmctc2FmZnJvbik7DQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICAgICAgICAgIHotaW5kZXg6IDIwMDA7DQogICAgICAgIH0NCg0KICAgICAgICAubG9naW4tYm94IHsNCiAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLXdoaXRlKTsNCiAgICAgICAgICAgIHBhZGRpbmc6IDI1cHg7DQogICAgICAgICAgICBib3JkZXItcmFkaXVzOiAxNXB4Ow0KICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgICAgICAgYm94LXNoYWRvdzogMCAxMHB4IDI1cHggcmdiYSgwLDAsMCwwLjIpOw0KICAgICAgICAgICAgd2lkdGg6IDI4MHB4Ow0KICAgICAgICB9DQoNCiAgICAgICAgICAgIC5sb2dpbi1ib3ggaW1nIHsNCiAgICAgICAgICAgICAgICB3aWR0aDogODBweDsNCiAgICAgICAgICAgICAgICBoZWlnaHQ6IDgwcHg7DQogICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNTAlOw0KICAgICAgICAgICAgICAgIGJvcmRlcjogMnB4IHNvbGlkIHZhcigtLXByaW1hcnktYmx1ZSk7DQogICAgICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTVweDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAjbWFpbkNvbnRlbnQgew0KICAgICAgICAgICAgZGlzcGxheTogbm9uZTsNCiAgICAgICAgfQ0KDQogICAgICAgIC5kYXNoLXRhYmxlIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgbWF4LXdpZHRoOiA2MDBweDsNCiAgICAgICAgICAgIG1hcmdpbjogMCBhdXRvIDVweCBhdXRvOyAvKiBSZWR1Y2VkIGJvdHRvbSBtYXJnaW4gZnJvbSAxNXB4IHRvIDVweCAqLw0KICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7DQogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7IC8qIFNsaWdodGx5IHRpZ2h0ZXIgY29ybmVycyAqLw0KICAgICAgICAgICAgYm9yZGVyLWNvbGxhcHNlOiBzZXBhcmF0ZTsNCiAgICAgICAgICAgIGJvcmRlci1zcGFjaW5nOiAwOw0KICAgICAgICAgICAgb3ZlcmZsb3c6IGhpZGRlbjsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44MHJlbTsgLyogU2xpZ2h0bHkgc21hbGxlciBmb250ICovDQogICAgICAgICAgICBib3gtc2hhZG93OiAwIDRweCAxMnB4IHJnYmEoMCwwLDAsMC4xNSk7DQogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOw0KICAgICAgICB9DQoNCiAgICAgICAgICAgIC5kYXNoLXRhYmxlIHRkIHsNCiAgICAgICAgICAgICAgICBwYWRkaW5nOiA0cHggMTJweDsgLyogUmVkdWNlZCB2ZXJ0aWNhbCBwYWRkaW5nIGZyb20gNnB4IHRvIDRweCAqLw0KICAgICAgICAgICAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjZWVlOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgIC5kYXNoLWxhYmVsIHsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiA4MDA7DQogICAgICAgICAgICBjb2xvcjogdmFyKC0tZGFyay10ZXh0KTsNCiAgICAgICAgICAgIHdpZHRoOiA0MiU7DQogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjFmMWYxOw0KICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsNCiAgICAgICAgICAgIGJvcmRlci1yaWdodDogMnB4IHNvbGlkICNkZGQ7DQogICAgICAgIH0NCg0KICAgICAgICAuZGFzaC12YWwgew0KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IDgwMDsNCiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS12aWJyYW50LWJsdWUpOw0KICAgICAgICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7DQogICAgICAgIH0NCg0KICAgICAgICAuZGFzaC10YWJsZSB0cjpsYXN0LWNoaWxkIHRkIHsNCiAgICAgICAgICAgIGJvcmRlci1ib3R0b206IG5vbmU7DQogICAgICAgIH0NCg0KICAgICAgICAjbG9hZGluZ01zZyB7DQogICAgICAgICAgICBkaXNwbGF5OiBub25lOw0KICAgICAgICAgICAgcG9zaXRpb246IGZpeGVkOw0KICAgICAgICAgICAgdG9wOiA1MCU7DQogICAgICAgICAgICBsZWZ0OiA1MCU7DQogICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZSgtNTAlLCAtNTAlKTsNCiAgICAgICAgICAgIGJhY2tncm91bmQ6IHJnYmEoMCwwLDEzOSwwLjkpOw0KICAgICAgICAgICAgY29sb3I6IHdoaXRlOw0KICAgICAgICAgICAgcGFkZGluZzogMjBweCA0MHB4Ow0KICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMTBweDsNCiAgICAgICAgICAgIHotaW5kZXg6IDMwMDA7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgfQ0KDQogICAgICAgIC5zZWFyY2gtYXJlYSB7DQogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxMHB4Ow0KICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0td2hpdGUpOw0KICAgICAgICAgICAgcGFkZGluZzogMTVweDsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7DQogICAgICAgIH0NCg0KICAgICAgICAuZmlsdGVyLWdyb3VwIHsNCiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEycHg7DQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAgZmxleC13cmFwOiB3cmFwOw0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7DQogICAgICAgICAgICBnYXA6IDhweDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC43NXJlbTsNCiAgICAgICAgfQ0KDQogICAgICAgICAgICAuZmlsdGVyLWdyb3VwIGxhYmVsIHsNCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZjBmMGYwOw0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDVweCAxMHB4Ow0KICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDVweDsNCiAgICAgICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2NjYzsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC5maWx0ZXItZ3JvdXAgbGFiZWw6aGFzKGlucHV0OmNoZWNrZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZDogI2UwZTBmZjsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyLWNvbG9yOiB2YXIoLS1wcmltYXJ5LWJsdWUpOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICBpbnB1dFt0eXBlPSJ0ZXh0Il0sIGlucHV0W3R5cGU9InBhc3N3b3JkIl0gew0KICAgICAgICAgICAgcGFkZGluZzogMTBweDsNCiAgICAgICAgICAgIHdpZHRoOiA4NSU7DQogICAgICAgICAgICBtYXgtd2lkdGg6IDMwMHB4Ow0KICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgdmFyKC0tcHJpbWFyeS1ibHVlKTsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDVweDsNCiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDEwcHg7DQogICAgICAgIH0NCg0KICAgICAgICBidXR0b24gew0KICAgICAgICAgICAgcGFkZGluZzogMTBweCAxNXB4Ow0KICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tcHJpbWFyeS1ibHVlKTsNCiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS13aGl0ZSk7DQogICAgICAgICAgICBib3JkZXI6IG5vbmU7DQogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDVweDsNCiAgICAgICAgICAgIG1hcmdpbjogMnB4Ow0KICAgICAgICB9DQoNCiAgICAgICAgI3V0aWxpdGllc01lbnUgew0KICAgICAgICAgICAgZGlzcGxheTogbm9uZTsNCiAgICAgICAgICAgIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KDMsIDFmcik7DQogICAgICAgICAgICBnYXA6IDhweDsNCiAgICAgICAgICAgIGp1c3RpZnktaXRlbXM6IHN0cmV0Y2g7DQogICAgICAgIH0NCg0KICAgICAgICAudXRpbC1tZW51LWJ0biB7DQogICAgICAgICAgICBjb2xvcjogdmFyKC0tcHJpbWFyeS1ibHVlKSAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOw0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICBmb250LXNpemU6IDAuNzJyZW07DQogICAgICAgICAgICBwYWRkaW5nOiAxMnB4IDJweDsNCiAgICAgICAgICAgIG1hcmdpbjogMDsNCiAgICAgICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7DQogICAgICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgICAgICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICAgICAgICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICM5OTk7DQogICAgICAgIH0NCg0KDQogICAgICAgIC5idG4tcm93MSB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjQUREOEU2ICFpbXBvcnRhbnQ7DQogICAgICAgIH0NCg0KICAgICAgICAuYnRuLXJvdzIgew0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzkwRUU5MCAhaW1wb3J0YW50Ow0KICAgICAgICB9DQoNCiAgICAgICAgLmJ0bi1yb3czIHsNCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICNGRkEwN0EgIWltcG9ydGFudDsNCiAgICAgICAgfQ0KDQogICAgICAgIC5idG4tcm93NCB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGOUM0ICFpbXBvcnRhbnQ7DQogICAgICAgIH0NCiAgICAgICAgLyogWWVsbG93ICovDQogICAgICAgIC5idG4tcm93NSB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRTFCRUU3ICFpbXBvcnRhbnQ7DQogICAgICAgIH0NCiAgICAgICAgLyogUHVycGxlICovDQoNCiAgICAgICAgLmJ0bi13YSB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMjVEMzY2ICFpbXBvcnRhbnQ7DQogICAgICAgICAgICBjb2xvcjogI2ZmZiAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICBtYXgtd2lkdGg6IDY1MHB4Ow0KICAgICAgICAgICAgbWFyZ2luLXRvcDogMTBweDsNCiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IGF1dG87DQogICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IGF1dG87DQogICAgICAgIH0NCg0KICAgICAgICAuYnRuLXJvdGF0ZSB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjNmM3NTdkICFpbXBvcnRhbnQ7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIG1heC13aWR0aDogNjUwcHg7DQogICAgICAgICAgICBtYXJnaW46IDVweCBhdXRvOw0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgIH0NCg0KICAgICAgICBtYXJrIHsNCiAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6IHllbGxvdzsNCiAgICAgICAgICAgIGNvbG9yOiBibGFjazsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICB9DQoNCiAgICAgICAgLmNhbmNlbGxlZC1yb3csIC5jYW5jZWxsZWQtcm93IHRkIHsNCiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS1jYW5jZWwtcmVkKSAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQgIWltcG9ydGFudDsNCiAgICAgICAgfQ0KDQogICAgICAgIC5ndy1yb3cgew0KICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogdmFyKC0tZ3ctZ3JlZW4pICFpbXBvcnRhbnQ7DQogICAgICAgICAgICBjb2xvcjogdmFyKC0td2hpdGUpICFpbXBvcnRhbnQ7DQogICAgICAgIH0NCg0KICAgICAgICAgICAgLmd3LXJvdyAucmNwdC1saW5rIHsNCiAgICAgICAgICAgICAgICBjb2xvcjogIzkwRUU5MCAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgIC5yY3B0LWxpbmsgew0KICAgICAgICAgICAgY29sb3I6IHZhcigtLXByaW1hcnktYmx1ZSk7DQogICAgICAgICAgICB0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsNCiAgICAgICAgICAgIGN1cnNvcjogcG9pbnRlcjsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICB9DQoNCiAgICAgICAgLmxhdGVzdC1hZGRyLWJveCB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZmZmZGU3Ow0KICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgI2ZiYzAyZDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDEycHg7DQogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAxNXB4Ow0KICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICAgICAgICAgICAgZm9udC1zaXplOiAwLjg1cmVtOw0KICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuNDsNCiAgICAgICAgICAgIGNvbG9yOiAjMzMzOw0KICAgICAgICAgICAgdGV4dC1hbGlnbjogbGVmdDsNCiAgICAgICAgfQ0KDQogICAgICAgIC5sYXRlc3QtYWRkci1oZWFkZXIgew0KICAgICAgICAgICAgY29sb3I6IHZhcigtLXByaW1hcnktYmx1ZSk7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMXJlbTsNCiAgICAgICAgICAgIG1hcmdpbi1ib3R0b206IDVweDsNCiAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICB9DQoNCiAgICAgICAgLnBlbmRpbmctY29uc2VudC1saW5lIHsNCiAgICAgICAgICAgIG1hcmdpbi10b3A6IDhweDsNCiAgICAgICAgICAgIGJvcmRlci10b3A6IDFweCBkYXNoZWQgI2NjYzsNCiAgICAgICAgICAgIHBhZGRpbmctdG9wOiA1cHg7DQogICAgICAgICAgICBjb2xvcjogdmFyKC0tY2FuY2VsLXJlZCk7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgfQ0KDQogICAgICAgIC5jb25zZW50LWZ5LWJsdWUgew0KICAgICAgICAgICAgY29sb3I6IHZhcigtLXJveWFsLWJsdWUpOw0KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgIH0NCg0KICAgICAgICAudGFibGUtd3JhcCB7DQogICAgICAgICAgICBvdmVyZmxvdy14OiBhdXRvOw0KICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0td2hpdGUpOw0KICAgICAgICAgICAgbWFyZ2luOiAxMHB4IDA7DQogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1cHg7DQogICAgICAgIH0NCg0KICAgICAgICB0YWJsZSB7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7DQogICAgICAgICAgICBmb250LXNpemU6IDAuNzVyZW07DQogICAgICAgIH0NCg0KICAgICAgICB0aCwgdGQgew0KICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2NjYzsNCiAgICAgICAgICAgIHBhZGRpbmc6IDhweDsNCiAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAgICAgICB2ZXJ0aWNhbC1hbGlnbjogdG9wOw0KICAgICAgICB9DQoNCiAgICAgICAgdGggew0KICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tcHJpbWFyeS1ibHVlKTsNCiAgICAgICAgICAgIGNvbG9yOiAjZmZmOw0KICAgICAgICB9DQoNCiAgICAgICAgLmFtdC1jcmVkaXQgew0KICAgICAgICAgICAgY29sb3I6ICMwMDAwRkY7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIHRleHQtYWxpZ246IHJpZ2h0Ow0KICAgICAgICB9DQoNCiAgICAgICAgLmFtdC1kZWJpdCB7DQogICAgICAgICAgICBjb2xvcjogI0ZGMDAwMDsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7DQogICAgICAgIH0NCg0KICAgICAgICAuYmFuay10aXRsZSB7DQogICAgICAgICAgICBjb2xvcjogdmFyKC0tcHJpbWFyeS1ibHVlKTsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgbWFyZ2luOiAxMHB4IDA7DQogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICBmb250LXNpemU6IDEuMXJlbTsNCiAgICAgICAgfQ0KDQoNCg0KICAgICAgICAvKiBDb250YWluZXIgZm9yIGVhY2ggc2VhcmNoIHJlc3VsdCBjYXJkICovDQogICAgICAgIC5yZWNvcmQgew0KICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7DQogICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjY2NjOw0KICAgICAgICAgICAgcGFkZGluZzogMTVweDsNCiAgICAgICAgICAgIG1hcmdpbjogMTBweCA1cHg7DQogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA4cHg7DQogICAgICAgICAgICBib3gtc2hhZG93OiAwIDJweCA1cHggcmdiYSgwLDAsMCwwLjEpOw0KICAgICAgICAgICAgY3Vyc29yOiBwb2ludGVyOyAvKiBJbmRpY2F0ZXMgaXQgY2FuIGJlIGNsaWNrZWQgKi8NCiAgICAgICAgfQ0KDQogICAgICAgIC5maWVsZC1yb3cgew0KICAgICAgICAgICAgZGlzcGxheTogZmxleDsNCiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDVweCAwOw0KICAgICAgICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICNlZWU7DQogICAgICAgIH0NCg0KICAgICAgICAuZmllbGQtaGVhZGVyIHsNCiAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgY29sb3I6IHZhcigtLXByaW1hcnktYmx1ZSk7DQogICAgICAgICAgICBtaW4td2lkdGg6IDE0MHB4Ow0KICAgICAgICAgICAgZmxleC1zaHJpbms6IDA7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBNb2JpbGUgU3BlY2lmaWM6IEhpZGUgbm9uLWVzc2VudGlhbCBmaWVsZHMgYnkgZGVmYXVsdCAqLw0KICAgICAgICBAbWVkaWEgc2NyZWVuIGFuZCAobWF4LXdpZHRoOiA2MDBweCkgew0KICAgICAgICAgICAgLmZpZWxkLXJvdyB7DQogICAgICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgICAgICAgICBhbGlnbi1pdGVtczogZmxleC1zdGFydDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLyogSGlkZSBhbGwgcm93cyBleGNlcHQgdGhlIGZpcnN0IDMgKFJlY2VpcHQsIERhdGUsIE5hbWUsIEFtb3VudCkgb24gbW9iaWxlICovDQogICAgICAgICAgICAucmVjb3JkLmNvbGxhcHNlZCAuZmllbGQtcm93Om50aC1jaGlsZChuKzUpIHsNCiAgICAgICAgICAgICAgICBkaXNwbGF5OiBub25lOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAvKiBBZGQgYSAiVGFwIHRvIHNlZSBtb3JlIiBpbmRpY2F0b3IgKi8NCiAgICAgICAgICAgIC5yZWNvcmQuY29sbGFwc2VkOjphZnRlciB7DQogICAgICAgICAgICAgICAgY29udGVudDogIuKWvCBUYXAgdG8gc2hvdyBkZXRhaWxzIjsNCiAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jazsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICAgICAgZm9udC1zaXplOiAwLjc1cmVtOw0KICAgICAgICAgICAgICAgIGNvbG9yOiAjODg4Ow0KICAgICAgICAgICAgICAgIG1hcmdpbi10b3A6IDEwcHg7DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC5yZWNvcmQuZXhwYW5kZWQ6OmFmdGVyIHsNCiAgICAgICAgICAgICAgICBjb250ZW50OiAi4payIFRhcCB0byBoaWRlIGRldGFpbHMiOw0KICAgICAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrOw0KICAgICAgICAgICAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDAuNzVyZW07DQogICAgICAgICAgICAgICAgY29sb3I6ICM4ODg7DQogICAgICAgICAgICAgICAgbWFyZ2luLXRvcDogMTBweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLnJlY2VpcHQtdmlld3BvcnQgew0KICAgICAgICAgICAgb3ZlcmZsb3c6IGF1dG87DQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICAgICAgICBwYWRkaW5nOiAwOw0KICAgICAgICAgICAgLXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6IHRvdWNoOw0KICAgICAgICB9DQoNCiAgICAgICAgLnJlY2VpcHQtY29udGFpbmVyIHsNCiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOw0KICAgICAgICAgICAgcGFkZGluZzogMTBweDsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDVweDsNCiAgICAgICAgICAgIHdpZHRoOiA2NTBweDsNCiAgICAgICAgICAgIG1pbi13aWR0aDogNjUwcHg7DQogICAgICAgICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4zcyBlYXNlOw0KICAgICAgICAgICAgdHJhbnNmb3JtLW9yaWdpbjogY2VudGVyOw0KICAgICAgICAgICAgcG9zaXRpb246IHJlbGF0aXZlOw0KICAgICAgICAgICAgei1pbmRleDogMTA7DQogICAgICAgIH0NCg0KICAgICAgICAucmVjZWlwdC1odG1sIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgZm9udC1mYW1pbHk6ICJUaW1lcyBOZXcgUm9tYW4iLCBzZXJpZjsNCiAgICAgICAgICAgIGJvcmRlcjogMnB4IHNvbGlkICMwMDA7DQogICAgICAgICAgICBib3JkZXItY29sbGFwc2U6IGNvbGxhcHNlOw0KICAgICAgICAgICAgY29sb3I6ICMwMDA7DQogICAgICAgICAgICBwb3NpdGlvbjogcmVsYXRpdmU7DQogICAgICAgICAgICB6LWluZGV4OiAyOw0KICAgICAgICB9DQoNCiAgICAgICAgICAgIC5yZWNlaXB0LWh0bWwgdGQgew0KICAgICAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICMwMDA7DQogICAgICAgICAgICAgICAgcGFkZGluZzogNnB4IDEwcHg7DQogICAgICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDFyZW07DQogICAgICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuMjsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAucm90YXRlZCB7DQogICAgICAgICAgICB0cmFuc2Zvcm06IHJvdGF0ZSg5MGRlZykgc2NhbGUoMC43NSk7DQogICAgICAgICAgICBtYXJnaW46IDA7DQogICAgICAgIH0NCg0KICAgICAgICAuc3Mtc3BhY2VyIHsNCiAgICAgICAgICAgIGhlaWdodDogMDsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgdHJhbnNpdGlvbjogaGVpZ2h0IDAuM3MgZWFzZTsNCiAgICAgICAgfQ0KDQogICAgICAgICAgICAuc3Mtc3BhY2VyLmFjdGl2ZSB7DQogICAgICAgICAgICAgICAgaGVpZ2h0OiAyNTBweDsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAud2F0ZXJtYXJrIHsNCiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgICAgICAgICAgIHRvcDogNTAlOw0KICAgICAgICAgICAgbGVmdDogNTAlOw0KICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSkgcm90YXRlKC0zMGRlZyk7DQogICAgICAgICAgICBmb250LXNpemU6IDgwcHg7DQogICAgICAgICAgICBjb2xvcjogcmdiYSgwLCAwLCAxMzksIDAuMik7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIHRleHQtdHJhbnNmb3JtOiB1cHBlcmNhc2U7DQogICAgICAgICAgICBwb2ludGVyLWV2ZW50czogbm9uZTsNCiAgICAgICAgICAgIHotaW5kZXg6IDU7DQogICAgICAgICAgICB3aGl0ZS1zcGFjZTogbm93cmFwOw0KICAgICAgICAgICAgYm9yZGVyOiAxMHB4IHNvbGlkIHJnYmEoMCwgMCwgMTM5LCAwLjIpOw0KICAgICAgICAgICAgcGFkZGluZzogMTBweDsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDE1cHg7DQogICAgICAgIH0NCg0KICAgICAgICAuc3VtLXRhYmxlIHsNCiAgICAgICAgICAgIHdpZHRoOiAxMDAlOw0KICAgICAgICAgICAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44cmVtOw0KICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7DQogICAgICAgICAgICBtYXJnaW4tdG9wOiAxMHB4Ow0KICAgICAgICAgICAgdGFibGUtbGF5b3V0OiBmaXhlZDsNCiAgICAgICAgfQ0KDQogICAgICAgICAgICAuc3VtLXRhYmxlIHRoIHsNCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiAjZDNkM2QzOw0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDhweDsNCiAgICAgICAgICAgICAgICBib3JkZXI6IDFweCBzb2xpZCAjODg4Ow0KICAgICAgICAgICAgICAgIGNvbG9yOiAjMDAwOw0KICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLnN1bS10YWJsZSB0aDpudGgtY2hpbGQoMSksIC5zdW0tdGFibGUgdGQ6bnRoLWNoaWxkKDEpIHsNCiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDQwJTsNCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAuc3VtLXRhYmxlIHRoOm50aC1jaGlsZCgyKSwgLnN1bS10YWJsZSB0ZDpudGgtY2hpbGQoMikgew0KICAgICAgICAgICAgICAgICAgICB3aWR0aDogMjUlOw0KICAgICAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLnN1bS10YWJsZSB0aDpudGgtY2hpbGQoMyksIC5zdW0tdGFibGUgdGQ6bnRoLWNoaWxkKDMpIHsNCiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDM1JTsNCiAgICAgICAgICAgICAgICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgIC5zZWN0aW9uLWhkciB7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIGJhY2tncm91bmQ6ICNmOWY5Zjk7DQogICAgICAgICAgICBjb2xvcjogdmFyKC0tcHJpbWFyeS1ibHVlKTsNCiAgICAgICAgICAgIHRleHQtYWxpZ246IGxlZnQ7DQogICAgICAgIH0NCg0KICAgICAgICAuY2hhcnQtd3JhcHBlciB7DQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsNCiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgfQ0KDQogICAgICAgIC5jaGFydC1jb250YWluZXIgew0KICAgICAgICAgICAgYmFja2dyb3VuZDogd2hpdGU7DQogICAgICAgICAgICBtYXJnaW4tdG9wOiAxNXB4Ow0KICAgICAgICAgICAgcGFkZGluZzogMTVweDsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDEwcHg7DQogICAgICAgICAgICBoZWlnaHQ6IDMyMHB4Ow0KICAgICAgICAgICAgd2lkdGg6IDk1JTsNCiAgICAgICAgICAgIG1heC13aWR0aDogNTAwcHg7DQogICAgICAgIH0NCg0KICAgICAgICAjc2VhcmNoU3VtbWFyeUJhciB7DQogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7DQogICAgICAgICAgICBib3R0b206IDA7DQogICAgICAgICAgICBsZWZ0OiAwOw0KICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1wcmltYXJ5LWJsdWUpOw0KICAgICAgICAgICAgY29sb3I6IHZhcigtLXdoaXRlKTsNCiAgICAgICAgICAgIHBhZGRpbmc6IDE1cHg7DQogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIHotaW5kZXg6IDk5OTsNCiAgICAgICAgfQ0KDQogICAgICAgIC5jYXNoLXN1bS1ib3ggew0KICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tYmctc2FmZnJvbik7DQogICAgICAgICAgICBwYWRkaW5nOiAxMHB4Ow0KICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogNXB4Ow0KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgICAgICAgICAgbWFyZ2luLWJvdHRvbTogMTBweDsNCiAgICAgICAgICAgIGNvbG9yOiB2YXIoLS1wcmltYXJ5LWJsdWUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLmV4ZWMtc3VtbWFyeSB7DQogICAgICAgICAgICB3aWR0aDogMTAwJTsNCiAgICAgICAgICAgIGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7DQogICAgICAgICAgICBtYXJnaW4tYm90dG9tOiAyMHB4Ow0KICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tcHJpbWFyeS1ibHVlKTsNCiAgICAgICAgICAgIGJhY2tncm91bmQ6IHdoaXRlOw0KICAgICAgICB9DQoNCiAgICAgICAgICAgIC5leGVjLXN1bW1hcnkgdGggew0KICAgICAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLXByaW1hcnktYmx1ZSk7DQogICAgICAgICAgICAgICAgY29sb3I6IHdoaXRlOw0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEwcHg7DQogICAgICAgICAgICAgICAgdGV4dC10cmFuc2Zvcm06IHVwcGVyY2FzZTsNCiAgICAgICAgICAgICAgICBmb250LXNpemU6IDAuNzVyZW07DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIC5leGVjLXN1bW1hcnkgdGQgew0KICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEwcHg7DQogICAgICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgICAgICAgICAgYm9yZGVyOiAxcHggc29saWQgI2RkZDsNCiAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICAgICAgZm9udC1zaXplOiAwLjg1cmVtOw0KICAgICAgICAgICAgfQ0KDQogICAgICAgIC5leHAtYmFyIHsNCiAgICAgICAgICAgIGNvbG9yOiB3aGl0ZTsNCiAgICAgICAgICAgIHBhZGRpbmc6IDhweDsNCiAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDRweDsNCiAgICAgICAgICAgIG1hcmdpbjogMTBweCAwOw0KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgICAgICBmb250LXNpemU6IDAuODVyZW07DQogICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICBkaXNwbGF5OiBmbGV4Ow0KICAgICAgICAgICAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOw0KICAgICAgICB9DQoNCiAgICAgICAgLm1haW4tYmFyIHsNCiAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLXByaW1hcnktYmx1ZSk7DQogICAgICAgIH0NCg0KICAgICAgICAuZGVwb3NpdC1iYXIgew0KICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tZGVwb3NpdC1wdXJwbGUpOw0KICAgICAgICB9DQoNCiAgICAgICAgLmxvYW4tYmFyIHsNCiAgICAgICAgICAgIGJhY2tncm91bmQ6IHZhcigtLWxvYW4tZ3JlZW4pOw0KICAgICAgICB9DQoNCiAgICAgICAgLmV4ZW1wdC1iYXIgew0KICAgICAgICAgICAgYmFja2dyb3VuZDogdmFyKC0tZXhlbXB0LWdyYXkpOw0KICAgICAgICB9DQoNCiAgICAgICAgLmFtdCB7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIGNvbG9yOiAjQjIyMjIyOw0KICAgICAgICAgICAgdGV4dC1hbGlnbjogcmlnaHQ7DQogICAgICAgIH0NCg0KICAgICAgICAudmVyc2lvbi1sYWJlbCB7DQogICAgICAgICAgICBjb2xvcjogdmFyKC0tcm95YWwtYmx1ZSk7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC45cmVtOw0KICAgICAgICAgICAgbWFyZ2luLXRvcDogNXB4Ow0KICAgICAgICAgICAgZGlzcGxheTogYmxvY2s7DQogICAgICAgIH0NCg0KICAgICAgICAudG90YWwtaGlnaGxpZ2h0LXJvdyB7DQogICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRjAwICFpbXBvcnRhbnQ7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZCAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgIzAwMCAhaW1wb3J0YW50Ow0KICAgICAgICB9DQoNCiAgICAgICAgICAgIC50b3RhbC1oaWdobGlnaHQtcm93IHRkIHsNCiAgICAgICAgICAgICAgICBjb2xvcjogIzAwMCAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAudG90YWwtaGlnaGxpZ2h0LXJvdyAuYW10IHsNCiAgICAgICAgICAgICAgICBjb2xvcjogI0IyMjIyMiAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgIC5wcm9maXQtdGV4dCB7DQogICAgICAgICAgICBjb2xvcjogdmFyKC0tZ3ctZ3JlZW4pOw0KICAgICAgICAgICAgZm9udC13ZWlnaHQ6IGJvbGQ7DQogICAgICAgICAgICBmb250LXNpemU6IDEuMXJlbTsNCiAgICAgICAgICAgIG1hcmdpbjogMTVweCAwOw0KICAgICAgICB9DQoNCiAgICAgICAgLmxvc3MtdGV4dCB7DQogICAgICAgICAgICBjb2xvcjogdmFyKC0tY2FuY2VsLXJlZCk7DQogICAgICAgICAgICBmb250LXdlaWdodDogYm9sZDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMS4xcmVtOw0KICAgICAgICAgICAgbWFyZ2luOiAxNXB4IDA7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBGbG9hdGluZyBOYXZpZ2F0aW9uIEJ1dHRvbnMgLSBJbXByb3ZlZCBmb3IgTW9iaWxlICovDQogICAgICAgIC5uYXYtc2Nyb2xsLWJ0biB7DQogICAgICAgICAgICBwb3NpdGlvbjogZml4ZWQ7DQogICAgICAgICAgICByaWdodDogMjBweDsgLyogRGVmYXVsdCBmb3IgRGVza3RvcCAqLw0KICAgICAgICAgICAgd2lkdGg6IDUwcHg7DQogICAgICAgICAgICBoZWlnaHQ6IDUwcHg7DQogICAgICAgICAgICBib3JkZXItcmFkaXVzOiA1MCU7DQogICAgICAgICAgICBiYWNrZ3JvdW5kOiB2YXIoLS1wcmltYXJ5LWJsdWUpOw0KICAgICAgICAgICAgY29sb3I6IHdoaXRlOw0KICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgdmFyKC0tZ29sZCk7DQogICAgICAgICAgICBjdXJzb3I6IHBvaW50ZXI7DQogICAgICAgICAgICBmb250LXNpemU6IDI0cHg7DQogICAgICAgICAgICBkaXNwbGF5OiBub25lOyAvKiBIaWRkZW4gYnkgZGVmYXVsdCAqLw0KICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgICAgICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KICAgICAgICAgICAgei1pbmRleDogOTk5OTsgLyogRW5zdXJlIGl0J3MgYWJvdmUgZXZlcnl0aGluZyAqLw0KICAgICAgICAgICAgYm94LXNoYWRvdzogMCA0cHggMTJweCByZ2JhKDAsMCwwLDAuNCk7DQogICAgICAgICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gMC4yczsNCiAgICAgICAgICAgIHRvdWNoLWFjdGlvbjogbWFuaXB1bGF0aW9uOyAvKiBQcmV2ZW50cyB6b29taW5nIG9uIGZhc3QgdGFwcyAqLw0KICAgICAgICB9DQoNCiAgICAgICAgI2J0bkdvQm90dG9tIHsNCiAgICAgICAgICAgIGJvdHRvbTogOTBweDsNCiAgICAgICAgfQ0KDQogICAgICAgICNidG5Hb1RvcCB7DQogICAgICAgICAgICBib3R0b206IDI1cHg7DQogICAgICAgIH0NCg0KICAgICAgICAvKiBNb2JpbGUtU3BlY2lmaWMgQWRqdXN0bWVudHMgKi8NCiAgICAgICAgQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNjAwcHgpIHsNCiAgICAgICAgICAgIC5uYXYtc2Nyb2xsLWJ0biB7DQogICAgICAgICAgICAgICAgcmlnaHQ6IDE1cHg7IC8qIFB1bGwgaW4gc2xpZ2h0bHkgKi8NCiAgICAgICAgICAgICAgICB3aWR0aDogNTVweDsgLyogTWFrZSBzbGlnaHRseSBiaWdnZXIgZm9yIHRodW1icyAqLw0KICAgICAgICAgICAgICAgIGhlaWdodDogNTVweDsNCiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kOiByZ2JhKDAsIDAsIDEzOSwgMC44KTsgLyogU2xpZ2h0IHRyYW5zcGFyZW5jeSBzbyB5b3UgY2FuIHNlZSB0ZXh0IGJlaGluZCBpdCAqLw0KICAgICAgICAgICAgICAgIGJhY2tkcm9wLWZpbHRlcjogYmx1cig0cHgpOyAvKiBNb2Rlcm4gYmx1ciBlZmZlY3QgKi8NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgI2J0bkdvQm90dG9tIHsNCiAgICAgICAgICAgICAgICBib3R0b206IDEwMHB4Ow0KICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAjYnRuR29Ub3Agew0KICAgICAgICAgICAgICAgIGJvdHRvbTogMzBweDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQoNCiAgICAgICAgLyogRk9SQ0UgV1JBUFBJTkcgSU4gQU5PTllNQVRDSCBUQUJMRSAqLw0KICAgICAgICAjZGV0YWlsZWRSZXN1bHRzIHRhYmxlIHsNCiAgICAgICAgICAgIHRhYmxlLWxheW91dDogZml4ZWQgIWltcG9ydGFudDsgLyogQWJzb2x1dGUgbXVzdDogZm9yY2VzIGNvbHVtbnMgdG8gc3RheSBpbiB0aGVpciAlIHdpZHRoICovDQogICAgICAgICAgICB3aWR0aDogMTAwJSAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsNCiAgICAgICAgfQ0KDQogICAgICAgICNkZXRhaWxlZFJlc3VsdHMgdGQsDQogICAgICAgICNkZXRhaWxlZFJlc3VsdHMgdGggew0KICAgICAgICAgICAgLyogVGhlc2UgdGhyZWUgbGluZXMgdG9nZXRoZXIga2lsbCB0aGUgb3ZlcmZsb3cgKi8NCiAgICAgICAgICAgIHdvcmQtYnJlYWs6IGJyZWFrLWFsbCAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgb3ZlcmZsb3ctd3JhcDogYnJlYWstd29yZCAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgd2hpdGUtc3BhY2U6IG5vcm1hbCAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgdmVydGljYWwtYWxpZ246IHRvcDsNCiAgICAgICAgICAgIHBhZGRpbmc6IDVweDsNCiAgICAgICAgICAgIGZvbnQtc2l6ZTogMC44cmVtOyAvKiBTbGlnaHRseSBzbWFsbGVyIGZvbnQgaGVscHMgbW9iaWxlIGZpdCAqLw0KICAgICAgICB9DQoNCiAgICAgICAgICAgIC8qIFNwZWNpZmljIGNvbHVtbiB3aWR0aCBjb250cm9sIHRvIGVuc3VyZSBiYWxhbmNlICovDQogICAgICAgICAgICAjZGV0YWlsZWRSZXN1bHRzIHRoOm50aC1jaGlsZCgxKSwgI2RldGFpbGVkUmVzdWx0cyB0ZDpudGgtY2hpbGQoMSkgew0KICAgICAgICAgICAgICAgIHdpZHRoOiAyMCU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvKiBSZWNlaXB0ICovDQogICAgICAgICAgICAjZGV0YWlsZWRSZXN1bHRzIHRoOm50aC1jaGlsZCgyKSwgI2RldGFpbGVkUmVzdWx0cyB0ZDpudGgtY2hpbGQoMikgew0KICAgICAgICAgICAgICAgIHdpZHRoOiAxNSU7DQogICAgICAgICAgICB9DQogICAgICAgICAgICAvKiBBbW91bnQgKi8NCiAgICAgICAgICAgICNkZXRhaWxlZFJlc3VsdHMgdGg6bnRoLWNoaWxkKDMpLCAjZGV0YWlsZWRSZXN1bHRzIHRkOm50aC1jaGlsZCgzKSB7DQogICAgICAgICAgICAgICAgd2lkdGg6IDMzJTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIC8qIERldGFpbHMgKi8NCiAgICAgICAgICAgICNkZXRhaWxlZFJlc3VsdHMgdGg6bnRoLWNoaWxkKDQpLCAjZGV0YWlsZWRSZXN1bHRzIHRkOm50aC1jaGlsZCg0KSB7DQogICAgICAgICAgICAgICAgd2lkdGg6IDMyJTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgLyogUmVmZXJlbmNlICovDQogICAgPC9zdHlsZT4NCjwvaGVhZD4NCiAgPGJvZHkgb25sb2FkPSJjaGVja0RldmljZUF1dGgoKSI+DQoNCiAgICAgIDxidXR0b24gaWQ9ImJ0bkdvVG9wIiBjbGFzcz0ibmF2LXNjcm9sbC1idG4iIG9uY2xpY2s9IndpbmRvdy5zY3JvbGxUbyh7dG9wOiAwLCBiZWhhdmlvcjogJ3Ntb290aCd9KSI+4payPC9idXR0b24+DQogICAgICA8YnV0dG9uIGlkPSJidG5Hb0JvdHRvbSIgY2xhc3M9Im5hdi1zY3JvbGwtYnRuIiBvbmNsaWNrPSJ3aW5kb3cuc2Nyb2xsVG8oe3RvcDogZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQsIGJlaGF2aW9yOiAnc21vb3RoJ30pIj7ilrw8L2J1dHRvbj4NCg0KICAgICAgPGF1ZGlvIGlkPSJiZ011c2ljIiBsb29wPg0KICAgICAgICAgIDxzb3VyY2Ugc3JjPSJodHRwczovL2RsLmRyb3Bib3h1c2VyY29udGVudC5jb20vc2NsL2ZpLzF3aXJoendhcXV6ejZ1c2hxanVjNC9KYXlhSmF5YS5tcDM/cmxrZXk9dWJmZ21rNHd0dm8wb3RoamxyeG5udDJ2bCZkbD0xIiB0eXBlPSJhdWRpby9tcGVnIj4NCiAgICAgIDwvYXVkaW8+DQoNCiAgICAgIDxkaXYgaWQ9ImxvYWRpbmdNc2ciPlBsZWFzZSB3YWl0IC0gV29ya2luZyBvbiB5b3VyIHJlcXVlc3QuLi48L2Rpdj4NCg0KICAgICAgPGRpdiBpZD0ibG9naW5PdmVybGF5Ij4NCiAgICAgICAgICA8ZGl2IGNsYXNzPSJsb2dpbi1ib3giPg0KICAgICAgICAgICAgICA8aW1nIHNyYz0iaHR0cHM6Ly93d3cuZ2FuZXNhc2FybWEuY29tL1Blcml5YXZhLmpwZyIgYWx0PSJQZXJpeWF2YSIgLz4NCiAgICAgICAgICAgICAgPGgzPk1NUFQgRGF0YWJhc2UgQXV0aG9yaXphdGlvbjwvaDM+DQogICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ2ZXJzaW9uLWxhYmVsIj5WZXJzaW9uOiAyMC4zPC9zcGFuPg0KICAgICAgICAgICAgICA8ZGl2IGlkPSJhdXRoU3RhdHVzIj5DaGVja2luZyBkZXZpY2UuLi48L2Rpdj4NCiAgICAgICAgICA8L2Rpdj4NCiAgICAgIDwvZGl2Pg0KDQogICAgICA8ZGl2IGlkPSJtYWluQ29udGVudCI+DQogICAgICAgICAgPGgyIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsgY29sb3I6dmFyKC0tcHJpbWFyeS1ibHVlKTsgZm9udC1zaXplOiBjbGFtcCgxNnB4LCA1LjJ2dywgMjRweCk7IHdoaXRlLXNwYWNlOiBub3dyYXA7IG92ZXJmbG93OiBoaWRkZW47IHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOyBtYXJnaW46IDA7IHBhZGRpbmc6IDcwcHggMXB4IDVweCAxMXB4OyI+DQogICAgICAgICAgICAgIE15bGFpIE1haGFwZXJpeWF2YSBBbnVzaGFtIFRydXN0DQogICAgICAgICAgPC9oMj4NCg0KICAgICAgICAgIDxkaXYgaWQ9InVzZXJNb25pdG9yIiBjbGFzcz0ic3RhdHVzLWVtcHR5Ij4NCiAgICAgICAgICAgICAgPHNwYW4gaWQ9ImFjdGl2ZVVzZXJMaXN0Ij5Jbml0aWFsaXNpbmcgU3lzdGVtIE1vbml0b3IuLi48L3NwYW4+DQogICAgICAgICAgICAgIDxidXR0b24gaWQ9InF1aXRCdG4iIGNsYXNzPSJxdWl0LWJ0biIgb25jbGljaz0icHJvcGVyUXVpdCgpIiBzdHlsZT0iZGlzcGxheTpub25lOyI+UXVpdCBBcHA8L2J1dHRvbj4NCiAgICAgICAgICA8L2Rpdj4NCg0KDQogICAgICAgICAgPHRhYmxlIGNsYXNzPSJkYXNoLXRhYmxlIiBpZD0iZGFzaGJvYXJkVGFibGUiPg0KICAgICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImRhc2gtbGFiZWwiPkxhc3QgUmVjcHQgTm8uPC90ZD4NCiAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0iZGFzaC12YWwiIGlkPSJkQWJzb2x1dGVMYXN0Ij4uLi48L3RkPg0KICAgICAgICAgICAgICA8L3RyPg0KICAgICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImRhc2gtbGFiZWwiPkxhdGVzdCBSZWNwdCBOby48L3RkPg0KICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkYXNoLXZhbCIgaWQ9ImRMYXN0UmNwdCI+Li4uPC90ZD4NCiAgICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkYXNoLWxhYmVsIj5SZWNlaXB0cyBSZWFkeTwvdGQ+DQogICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImRhc2gtdmFsIiBpZD0iZFJjcHRSZWFkeSI+Li4uPC90ZD4NCiAgICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkYXNoLWxhYmVsIj5CYW5rIFN0bW50IHRpbGw8L3RkPg0KICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkYXNoLXZhbCIgaWQ9ImRCYW5rRGF0ZSI+Li4uPC90ZD4NCiAgICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkYXNoLWxhYmVsIj5DYXNoIHRvIERlcG9zaXQ8L3RkPg0KICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJkYXNoLXZhbCIgaWQ9ImRDYXNoRGVwb3NpdCI+Li4uPC90ZD4NCiAgICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICA8L3RhYmxlPg0KDQogICAgICAgICAgPHN0eWxlPg0KICAgICAgICAgICAgICAgIC8qIFB1c2hpbmcgdGhlIGNvbnRyYXN0IGFuZCBhZGRpbmcgYSBwdWxzZSBmb3IgdGhlICdMaXZlJyBmZWVsICovDQoNCg0KICAgICAgICAgICAgICAgICN1c2VyTW9uaXRvciB7DQogICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBmaXhlZDsNCiAgICAgICAgICAgICAgICAgICAgdG9wOiAwOw0KICAgICAgICAgICAgICAgICAgICBsZWZ0OiAwOw0KICAgICAgICAgICAgICAgICAgICByaWdodDogMDsNCiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDEwMCU7DQogICAgICAgICAgICAgICAgICAgIHotaW5kZXg6IDEwMDAwOw0KICAgICAgICAgICAgICAgICAgICBtYXJnaW46IDAgIWltcG9ydGFudDsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogMCAhaW1wb3J0YW50Ow0KICAgICAgICAgICAgICAgICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7DQogICAgICAgICAgICAgICAgICAgIHBhZGRpbmc6IDEycHg7DQogICAgICAgICAgICAgICAgICAgIG1hcmdpbjogYXV0bzsNCiAgICAgICAgICAgICAgICAgICAgd2lkdGg6IDk1JTsNCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyLXJhZGl1czogOHB4Ow0KICAgICAgICAgICAgICAgICAgICBmb250LWZhbWlseTogJ1NlZ29lIFVJJywgVGFob21hLCBHZW5ldmEsIFZlcmRhbmEsIHNhbnMtc2VyaWY7DQogICAgICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIDRweCA2cHggcmdiYSgwLDAsMCwwLjEpOw0KICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiBhbGwgMC4zcyBlYXNlOw0KICAgICAgICAgICAgICAgICAgICAvKiAtLS0gQUREL1ZFUklGWSBUSEVTRSBCRUxPVyAtLS0gKi8NCg0KICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiBibG9jazsgLyogRW5zdXJlcyBpdCBhY3RzIGFzIGEgZnVsbC13aWR0aCBjb250YWluZXIgKi8NCiAgICAgICAgICAgICAgICAgICAgaGVpZ2h0OiBhdXRvOyAvKiBBTExPV1MgdGhlIGhlaWdodCB0byBncm93IHdpdGggY29udGVudCAqLw0KICAgICAgICAgICAgICAgICAgICBtaW4taGVpZ2h0OiBmaXQtY29udGVudDsgLyogRW5zdXJlcyBpdCBzdGF5cyBhdCBsZWFzdCBhcyBiaWcgYXMgdGhlIHRleHQgKi8NCiAgICAgICAgICAgICAgICAgICAgbGluZS1oZWlnaHQ6IDEuNTsgLyogQWRkcyBicmVhdGhpbmcgcm9vbSBiZXR3ZWVuIHRoZSBsaW5lcyAqLw0KDQogICAgICAgICAgICAgICAgICAgIHdoaXRlLXNwYWNlOiBub3JtYWw7IC8qIFJFTU9WRSAnbm93cmFwJyBpZiBpdCB3YXMgdGhlcmUgZWxzZXdoZXJlICovDQogICAgICAgICAgICAgICAgICAgIG92ZXJmbG93OiB2aXNpYmxlOyAvKiBFbnN1cmVzIHRleHQgaXNuJ3QgY3V0IG9mZiBpZiBpdCBncm93cyAqLw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8qI2FjdGl2ZVVzZXJMaXN0IHsNCiAgICAgICAgICAgICAgICAgIGRpc3BsYXk6IGJsb2NrICFpbXBvcnRhbnQ7DQogICAgICAgICAgICAgICAgICBmb250LXNpemU6IDE0cHggIWltcG9ydGFudDsNCiAgICAgICAgICAgICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOw0KICAgICAgICAgICAgICAgICAgaGVpZ2h0OiAyMHB4ICFpbXBvcnRhbnQ7Ki8gLyogRm9yY2UgTGluZSAxICovDQogICAgICAgICAgICAgICAgLyptYXJnaW46IDAgIWltcG9ydGFudDsNCiAgICAgICAgICAgICAgICAgIGxpbmUtaGVpZ2h0OiAyMHB4ICFpbXBvcnRhbnQ7DQogICAgICAgICAgICAgIH0qLw0KDQogICAgICAgICAgICAgICAgI3F1aXRCdG4gew0KICAgICAgICAgICAgICAgICAgICBtYXJnaW4tdG9wOiAycHggIWltcG9ydGFudDsgLyogRm9yY2UgTGluZSAyICovDQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLnN0YXR1cy1hY3RpdmUgew0KICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMWEyMzdlOyAvKiBEZWVwIE5hdnkgQmx1ZSAqLw0KICAgICAgICAgICAgICAgICAgICBjb2xvcjogI2ZmZmZmZjsgLyogQ3Jpc3AgV2hpdGUgKi8NCiAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiAycHggc29saWQgI2ZmZDYwMDsgLyogQnJpZ2h0IFllbGxvdyBCb3JkZXIgKi8NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAuc3RhdHVzLWVtcHR5IHsNCiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI2Y1ZjVmNTsNCiAgICAgICAgICAgICAgICAgICAgY29sb3I6ICM3NTc1NzU7DQogICAgICAgICAgICAgICAgICAgIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7DQogICAgICAgICAgICAgICAgfQ0KDQoNCiAgICAgICAgICAgICAgICAvKiBVcGRhdGUgdGhpcyBzZWN0aW9uIGluIHlvdXIgZmlsZSAqLw0KDQogICAgICAgICAgICAgICAgLyogTElHSFQgR1JFRU4gUFVMU0UgRk9SIERBUksgQkxVRSBCQVIgKi8NCiAgICAgICAgICAgICAgICAubGl2ZS1kb3Qgew0KICAgICAgICAgICAgICAgICAgICBoZWlnaHQ6IDEwcHg7DQogICAgICAgICAgICAgICAgICAgIHdpZHRoOiAxMHB4Ow0KICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDBGRjAwOyAvKiBWaWJyYW50IEdyZWVuICovDQogICAgICAgICAgICAgICAgICAgIGJvcmRlci1yYWRpdXM6IDUwJTsNCiAgICAgICAgICAgICAgICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrOw0KICAgICAgICAgICAgICAgICAgICBtYXJnaW4tcmlnaHQ6IDhweDsNCiAgICAgICAgICAgICAgICAgICAgYW5pbWF0aW9uOiBwdWxzZSAxLjVzIGluZmluaXRlOw0KICAgICAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgOHB4ICMwMEZGMDA7IC8qIENvbnN0YW50IGdyZWVuIGdsb3cgKi8NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICBAa2V5ZnJhbWVzIHB1bHNlIHsNCiAgICAgICAgICAgICAgICAgICAgMCUgew0KICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMTsNCiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybTogc2NhbGUoMSk7DQogICAgICAgICAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDBGRjAwOyAvKiBQdXJlIEdyZWVuICovDQogICAgICAgICAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgNXB4ICMwMEZGMDA7DQogICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICA1MCUgew0KICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC44Ow0KICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxLjMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogI0NDRkYwMDsgLyogRWxlY3RyaWMgTGltZSBHcmVlbiBmb3IgaGlnaCBjb250cmFzdCAqLw0KICAgICAgICAgICAgICAgICAgICAgICAgYm94LXNoYWRvdzogMCAwIDE4cHggI0NDRkYwMDsgLyogTGFyZ2UgZ2xvd2luZyBwdWxzZSAqLw0KICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgMTAwJSB7DQogICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxKTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMwMEZGMDA7DQogICAgICAgICAgICAgICAgICAgICAgICBib3gtc2hhZG93OiAwIDAgNXB4ICMwMEZGMDA7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAuc3RhdHVzLWFjdGl2ZSB7DQogICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmQtY29sb3I6ICMxYTIzN2U7DQogICAgICAgICAgICAgICAgICAgIGNvbG9yOiAjZmZmZmZmOw0KICAgICAgICAgICAgICAgICAgICBib3JkZXI6IDJweCBzb2xpZCAjMDBGRjAwOyAvKiBDaGFuZ2VkIGZyb20gWWVsbG93IHRvIFZpYnJhbnQgR3JlZW4gKi8NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgPC9zdHlsZT4NCg0KICAgICAgICAgIDxkaXYgY2xhc3M9InNlYXJjaC1hcmVhIj4NCiAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmlsdGVyLWdyb3VwIiBpZD0ieWVhckZpbHRlckdyb3VwIj4NCiAgICAgICAgICAgICAgICAgIDxsYWJlbD4NCiAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0icmFkaW8iDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU9InllYXJGaWx0ZXIiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkPSJmQWxsIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YWx1ZT0iYWxsIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGVja2VkDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uY2hhbmdlPSJjbGVhcldvcmtzcGFjZSgpIiAvPg0KICAgICAgICAgICAgICAgICAgICAgIDxzcGFuPkFsbDwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgICA8bGFiZWw+DQogICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lPSJ5ZWFyRmlsdGVyIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZD0iZjIwMjEiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPSIyMDIxIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNoYW5nZT0iY2xlYXJXb3Jrc3BhY2UoKSIgLz4NCiAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4yMS0yMjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgICA8bGFiZWw+DQogICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lPSJ5ZWFyRmlsdGVyIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZD0iZjIwMjIiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPSIyMDIyIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNoYW5nZT0iY2xlYXJXb3Jrc3BhY2UoKSIgLz4NCiAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4yMi0yMzwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgICA8bGFiZWw+DQogICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lPSJ5ZWFyRmlsdGVyIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZD0iZjIwMjMiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPSIyMDIzIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNoYW5nZT0iY2xlYXJXb3Jrc3BhY2UoKSIgLz4NCiAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4yMy0yNDwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgICA8bGFiZWw+DQogICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lPSJ5ZWFyRmlsdGVyIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZD0iZjIwMjQiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPSIyMDI0Ig0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNoYW5nZT0iY2xlYXJXb3Jrc3BhY2UoKSIgLz4NCiAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4yNC0yNTwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgICA8bGFiZWw+DQogICAgICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InJhZGlvIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lPSJ5ZWFyRmlsdGVyIg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZD0iZjIwMjUiDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlPSIyMDI1Ig0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNoYW5nZT0iY2xlYXJXb3Jrc3BhY2UoKSIgLz4NCiAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj4yNS0yNjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvbGFiZWw+DQogICAgICAgICAgICAgICAgICA8YnV0dG9uIGlkPSJtdXRlQnRuIiBvbmNsaWNrPSJ0b2dnbGVNdXRlKCkiIHN0eWxlPSJtYXJnaW4tbGVmdDogMTVweDsgcGFkZGluZzogNHB4IDEwcHg7IGN1cnNvcjogcG9pbnRlcjsgYm9yZGVyLXJhZGl1czogNHB4OyBib3JkZXI6IDFweCBzb2xpZCAjY2NjOyBiYWNrZ3JvdW5kOiAjZWVlZWVlICFpbXBvcnRhbnQ7IGNvbG9yOiBibGFjayAhaW1wb3J0YW50OyBmb250LWZhbWlseTogaW5oZXJpdDsgZm9udC13ZWlnaHQ6IGJvbGQ7IGZvbnQtc2l6ZTogMTNweDsgZGlzcGxheTogaW5saW5lLWJsb2NrOyB2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOyI+DQogICAgICAgICAgICAgICAgICAgICAg8J+UhyBNdXRlDQogICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCiAgICAgICAgICAgICAgPC9kaXY+DQoNCiAgICAgICAgICAgICAgPGRpdiBpZD0ic2VhcmNoQ29udHJvbHMiPg0KICAgICAgICAgICAgICAgICAgPGlucHV0IHR5cGU9InRleHQiDQogICAgICAgICAgICAgICAgICAgICAgICAgaWQ9InNlYXJjaElucHV0Ig0KICAgICAgICAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPSJTZWFyY2ggKCcsJyBmb3IgQU5ELCAnOycgZm9yIE9SKSIgLz4NCiAgICAgICAgICAgICAgICAgIDxiciAvPg0KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ3cmFwTG9hZGluZyhmZXRjaEFuZFNlYXJjaCkiIHN0eWxlPSJ3aWR0aDo0NSU7Ij4NCiAgICAgICAgICAgICAgICAgICAgICBTZWFyY2gNCiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJzaG93VXRpbGl0aWVzKCkiIHN0eWxlPSJ3aWR0aDo0NSU7Ij4NCiAgICAgICAgICAgICAgICAgICAgICBVdGlsaXR5IE1lbnUNCiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KICAgICAgICAgICAgICA8L2Rpdj4NCg0KICAgICAgICAgICAgICA8ZGl2IGlkPSJ1dGlsaXRpZXNNZW51Ij4NCiAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0id3JhcExvYWRpbmcocnVuU3VtbWFyeSkiIGNsYXNzPSJ1dGlsLW1lbnUtYnRuIGJ0bi1yb3cxIj5TdW1tYXJ5PC9idXR0b24+DQogICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9IndyYXBMb2FkaW5nKHJ1bkFub255bW91cykiIGNsYXNzPSJ1dGlsLW1lbnUtYnRuIGJ0bi1yb3cxIj5Bbm9ueW1vdXM8L2J1dHRvbj4NCiAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0id3JhcExvYWRpbmcocnVuQ2FzaERlcCkiIGNsYXNzPSJ1dGlsLW1lbnUtYnRuIGJ0bi1yb3cxIj5DYXNoIERlcDwvYnV0dG9uPg0KDQogICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9IndyYXBMb2FkaW5nKHJ1blBDb25zZW50KSIgY2xhc3M9InV0aWwtbWVudS1idG4gYnRuLXJvdzIiPlAgQ29uc2VudDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ3cmFwTG9hZGluZyhydW5Eb25vckxpc3QpIiBjbGFzcz0idXRpbC1tZW51LWJ0biBidG4tcm93MiI+RG9ub3IgTGlzdDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ3cmFwTG9hZGluZyhydW5FUmVjZWlwdCkiIGNsYXNzPSJ1dGlsLW1lbnUtYnRuIGJ0bi1yb3cyIj5lUmVjZWlwdDwvYnV0dG9uPg0KDQogICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9IndyYXBMb2FkaW5nKHJ1bkJhbmtTdGF0ZW1lbnQpIiBjbGFzcz0idXRpbC1tZW51LWJ0biBidG4tcm93MyI+QmFuayBTdGF0ZW1lbnRzPC9idXR0b24+DQogICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9IndyYXBMb2FkaW5nKHJ1bkV4cGVuc2VzKSIgY2xhc3M9InV0aWwtbWVudS1idG4gYnRuLXJvdzMiPkV4cGVuc2VzPC9idXR0b24+DQogICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9IndyYXBMb2FkaW5nKHJ1bkFjY291bnRzKSIgY2xhc3M9InV0aWwtbWVudS1idG4gYnRuLXJvdzMiPkFjY291bnRzPC9idXR0b24+DQoNCiAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0id3JhcExvYWRpbmcocnVuRG9uYXRpb24pIiBjbGFzcz0idXRpbC1tZW51LWJ0biBidG4tcm93NCI+RG9uYXRpb24gTGlzdDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJydW5Bbm9ueU1hdGNoKCkiIGNsYXNzPSJ1dGlsLW1lbnUtYnRuIGJ0bi1yb3c0Ij5Bbm9ueSBNYXRjaDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJzaG93RG93bmxvYWRNZW51KCkiIGNsYXNzPSJ1dGlsLW1lbnUtYnRuIGJ0bi1yb3c0IiBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsgYm9yZGVyOiAycHggc29saWQgIzE1NjVjMDsiPkRvd25sb2FkczwvYnV0dG9uPg0KDQogICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9InNob3dEb25vck1hdGNoTGlzdCgpIiBzdHlsZT0iZ3JpZC1jb2x1bW46IDEgLyBzcGFuIDI7IGJhY2tncm91bmQtY29sb3I6ICMyMTk2RjMgIWltcG9ydGFudDsgY29sb3I6IHdoaXRlICFpbXBvcnRhbnQ7IGZvbnQtd2VpZ2h0OiBib2xkOyBib3JkZXI6IDFweCBzb2xpZCAjOTk5OyI+IERvbm9yLUJhbmstRXhwZW5zZS1NYXRjaCBMaXN0IDwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJoaWRlVXRpbGl0aWVzKCkiIGNsYXNzPSJ1dGlsLW1lbnUtYnRuIiBzdHlsZT0iYmFja2dyb3VuZDojNjY2ICFpbXBvcnRhbnQ7IGNvbG9yOiB3aGl0ZSAhaW1wb3J0YW50OyI+QmFjazwvYnV0dG9uPg0KICAgICAgICAgICAgICA8L2Rpdj4NCg0KICAgICAgICAgIDwvZGl2Pg0KDQogICAgICAgICAgPGRpdiBpZD0ibnVtZXJpY1Jlc3VsdHMiPjwvZGl2Pg0KICAgICAgICAgIDxkaXYgaWQ9ImRldGFpbGVkUmVzdWx0cyI+PC9kaXY+DQogICAgICA8L2Rpdj4NCg0KICAgICAgPGRpdiBpZD0ic2VhcmNoU3VtbWFyeUJhciIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPjwvZGl2Pg0KDQogICAgICA8c2NyaXB0Pg0KDQogICAgICAgICAgbGV0IE1haW5Td1VzZXJOYW1lID0gJyc7DQoNCiAgICAgICAgICB2YXIgZ2xvYmFsUGVuZGluZ0NhcHR1cmUgPSBbXTsNCiAgICAgICAgICBsZXQgZ2xvYmFsRGFzaGJvYXJkQ2FzaFRvdGFsID0gMDsNCiAgICAgICAgICBsZXQgZ2xvYmFsRGFzaGJvYXJkQ2FzaFJlY2VpcHRzID0gMDsNCg0KICAgICAgICAgIGxldCBwcmV2aW91c1VzZXJMaXN0ID0gW107DQoNCiAgICAgICAgICBjb25zdCBSRVZFUlNBTFNfVVJMID0gImh0dHBzOi8vZGwuZHJvcGJveHVzZXJjb250ZW50LmNvbS9zY2wvZmkvazZjbHZrZTdoMnF4aGduMDd2bWI1L1JldmVyc2Fscy50eHQ/cmxrZXk9MXk5ZG5yZXZkNm1tbnMwMDNseWR1dzk1bSZkbD0xIjsNCg0KICAgICAgICAgIC8vY29uc3QgREFUQV9VUkwgPSAiaHR0cHM6Ly9kbC5kcm9wYm94dXNlcmNvbnRlbnQuY29tL3NjbC9maS9zOXI3eGZuM2E4azV3eXJzd29oemgvTU1QVDIuS1A/cmxrZXk9OXR6YWVzdHd4cDhudW5lZHJzd3E5bzZqciZyYXc9MSI7DQogICAgICAgICAgY29uc3QgREFUQV9VUkwgPSAiaHR0cHM6Ly9kbC5kcm9wYm94dXNlcmNvbnRlbnQuY29tL3NjbC9maS9qNnUzaG8xNGR4eWRyNXY2aDVoYmkvTU1QVDIuS1A/cmxrZXk9M2VrdXJycTh3a3owOGJzcGl4emdqajV6ciZzdD0zc283Yzk1ZyZkbD0xIjsNCg0KICAgICAgICAgIGNvbnN0IFBBU1NfVVJMID0gImh0dHBzOi8vZGwuZHJvcGJveHVzZXJjb250ZW50LmNvbS9zY2wvZmkveHB6NTg1OW1qMTJ3eG5peDB4YmEyL2Rldm90ZWUudHh0P3Jsa2V5PTV6NnZtZ2Npank3dTlqeXdtZTNvZXhlNjYmcmF3PTEiOw0KICAgICAgICAgIC8vc2FtZSBmb3IgcGFzc3dvcmQNCg0KDQogICAgICAgICAgY29uc3QgQ0FTSF9MSVNUX1VSTCA9ICJodHRwczovL2RsLmRyb3Bib3h1c2VyY29udGVudC5jb20vc2NsL2ZpLzE2b3NyM2VqenFjMGRnZGx6Ym9wOC9DYXNoLUxpc3QudHh0P3Jsa2V5PWwzbnI2d210enVsMTczeGh2cGM1OGJ5bXYmcmF3PTEiOw0KICAgICAgICAgIC8vc2FtZSANCg0KICAgICAgICAgIGNvbnN0IEVYUEVOU0VTX1VSTCA9ICJodHRwczovL2RsLmRyb3Bib3h1c2VyY29udGVudC5jb20vc2NsL2ZpL2E1ZTg4dmp6YjZ3MnFtZWwzeXN5eC9FeHBlbnNlcy54bHN4P3Jsa2V5PWptZDhpMGpzMXNreGwydnlhdnM3cG84eXAmZGw9MSI7DQogICAgICAgICAgLy9zYW1lDQoNCiAgICAgICAgICAvL2NvbnN0IEJBTktfTkVXX1VSTCA9ICJodHRwczovL2RsLmRyb3Bib3h1c2VyY29udGVudC5jb20vc2NsL2ZpL2psM2k1d3FxOGt6MHJldGVlN2p0ai9NTVBUMy5LUD9ybGtleT1ic3NwcXk1eHAwYnJsM2djbzV5b2wxY3lpJmRsPTEiOw0KICAgICAgICAgIGNvbnN0IEJBTktfTkVXX1VSTCA9ICJodHRwczovL2RsLmRyb3Bib3h1c2VyY29udGVudC5jb20vc2NsL2ZpL2xobWEwNXdoNTNiNjZ2bGNxYzk0aS9NTVBUMy5LUD9ybGtleT1sNHQ4dzVqYWgxaGJ5Z3QzbzFqZG5rYm01JnN0PTR1NmJvZmYyJmRsPTEiOw0KDQogICAgICAgICAgDQoNCg0KDQogICAgICAgICAgY29uc3QgVElUTEVTID0gWyJSZWNlaXB0IE5vLiIsICJEYXRlIiwgIk5hbWUiLCAiUGhvbmUiLCAiQWRkcmVzcyIsICJFbWFpbCIsICJQQU4iLCAiU3RhciIsICJHb3RocmFtIiwgIkFtb3VudCIsICJSZWZlcmVuY2UiLCAiTW9kZSIsICJUb3dhcmRzIiwgIkNhbmNlbCIsICJDb21tZW50cyIsICJQaW4gQ29kZSIsICJSZWNlaXB0IFByaW50ZWQiLCAiUHJhc2FkYW0gU2VudCIsICJDb3JwdXMgU2lnbmVkIiwgIkNvdW50cnkiXTsNCiAgICAgICAgICBjb25zdCBDVVRPRkZfREFURSA9IG5ldyBEYXRlKCcyMDI1LTA0LTAxJyk7DQogICAgICAgICAgbGV0IGFjdGl2ZUNoYXJ0cyA9IFtdOw0KDQogICAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09DQogICAgICAgICAgLy8gQ09SRSBBUFBMSUNBVElPTiBGVU5DVElPTlMNCiAgICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIEdsb2JhbCBXcmFwcGVyOiBTaG93cyB0aGUgbG9hZGluZyBtZXNzYWdlIGJlZm9yZSBleGVjdXRpbmcgYSBmdW5jdGlvbg0KICAgICAgICAgICAqIGFuZCBoaWRlcyBpdCBvbmNlIHRoZSBmdW5jdGlvbiBjb21wbGV0ZXMuDQogICAgICAgICAgICovDQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiB3cmFwTG9hZGluZyhmbikgew0KICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ01zZycpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgICBzZXRUaW1lb3V0KGFzeW5jICgpID0+IHsNCiAgICAgICAgICAgICAgICAgIGF3YWl0IGZuKCk7DQogICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ01zZycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgIH0sIDUwKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBBdXRoZW50aWNhdGlvbjogVmFsaWRhdGVzIHRoZSBlbnRlcmVkIHBhc3N3b3JkIGFnYWluc3QgdGhlDQogICAgICAgICAgICogcmVtb3RlIHRleHQgZmlsZSBhbmQgaW5pdGlhbGl6ZXMgdGhlIGRhc2hib2FyZCBvbiBzdWNjZXNzLg0KICAgICAgICAgICAqLw0KDQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBEYXNoYm9hcmQgU2V0dXA6IEZldGNoZXMgbWFzdGVyIGRhdGEgYW5kIGJhbmsgZmlsZXMgdG8gY2FsY3VsYXRlDQogICAgICAgICAgICogdGhlIGhpZ2gtbGV2ZWwgbWV0cmljcyAoTGFzdCBSZWNlaXB0LCBQZW5kaW5nIENvdW50LCBldGMuKSBzaG93biBvbiB0aGUgbWFpbiBzY3JlZW4uDQogICAgICAgICAgICovDQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBpbml0RGFzaGJvYXJkKCkgew0KICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChEQVRBX1VSTCk7DQogICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICAgICAgICBjb25zdCByZWNzID0gdGV4dC5zcGxpdCgnXG4nKTsNCiAgICAgICAgICAgICAgbGV0IHJlYWR5Q291bnQgPSAwLCByZWFkeUFtdCA9IDA7DQogICAgICAgICAgICAgIGxldCBsYXRlc3RSY3B0TnVtID0gIiIsIGxhdGVzdFJjcHREYXRlID0gIiIsIGJhbmtEYXRlID0gIi0tLSI7DQogICAgICAgICAgICAgIGxldCBtYXhEYXRlT2JqID0gbmV3IERhdGUoMCk7DQogICAgICAgICAgICAgIGxldCBsYXN0RW50cnkgPSByZWNzW3JlY3MubGVuZ3RoIC0gMl07DQogICAgICAgICAgICAgIGxldCBsZiA9IGxhc3RFbnRyeS5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICBsZXQgYWJzTGFzdFN0ciA9IChsZi5sZW5ndGggPj0gMikgPyBgJHtsZlswXX0gOiAke2xmWzFdfWAgOiAiLS0tIjsNCg0KICAgICAgICAgICAgICByZWNzLmZvckVhY2gociA9PiB7DQogICAgICAgICAgICAgICAgICBsZXQgZiA9IHIuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICAgIGlmIChmLmxlbmd0aCA8IDIwKSByZXR1cm47DQogICAgICAgICAgICAgICAgICBjb25zdCByTm8gPSBmWzBdLnRyaW0oKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJEYXRlU3RyID0gZlsxXS50cmltKCk7DQogICAgICAgICAgICAgICAgICBjb25zdCByRGF0ZU9iaiA9IHBhcnNlRGF0ZShyRGF0ZVN0cik7DQogICAgICAgICAgICAgICAgICBjb25zdCBpc0MgPSBmWzEzXT8udG9VcHBlckNhc2UoKSA9PT0gIllFUyI7DQogICAgICAgICAgICAgICAgICBjb25zdCBhZGRyUmF3ID0gZls0XT8udHJpbSgpIHx8ICIiOw0KICAgICAgICAgICAgICAgICAgY29uc3QgaXNBbm9uID0gKCFmWzJdIHx8IGZbMl0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygiYW5vbnltb3VzIikpOw0KICAgICAgICAgICAgICAgICAgaWYgKHJEYXRlT2JqID4gbWF4RGF0ZU9iaikgew0KICAgICAgICAgICAgICAgICAgICAgIG1heERhdGVPYmogPSByRGF0ZU9iajsNCiAgICAgICAgICAgICAgICAgICAgICBsYXRlc3RSY3B0TnVtID0gck5vOw0KICAgICAgICAgICAgICAgICAgICAgIGxhdGVzdFJjcHREYXRlID0gckRhdGVTdHI7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBpZiAock5vLnN0YXJ0c1dpdGgoIkNHIikgJiYgckRhdGVPYmogPj0gQ1VUT0ZGX0RBVEUgJiYgIWlzQyAmJiAhaXNBbm9uICYmIGFkZHJSYXcgIT09ICIiKSB7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmNwdFAgPSBmWzE2XT8udHJpbSgpLnRvVXBwZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgcHJhc1MgPSBmWzE3XT8udHJpbSgpLnRvVXBwZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKChyY3B0UCA9PT0gIk5PIiB8fCByY3B0UCA9PT0gIiIpICYmIChwcmFzUyA9PT0gIk5PIiB8fCBwcmFzUyA9PT0gIiIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHJlYWR5Q291bnQrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVhZHlBbXQgKz0gcGFyc2VGbG9hdChmWzldKSB8fCAwOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgYXdhaXQgcnVuQ2FzaERlcCh0cnVlKTsNCg0KICAgICAgICAgICAgICBjb25zdCBiUmVzID0gYXdhaXQgZmV0Y2goQkFOS19ORVdfVVJMKTsNCiAgICAgICAgICAgICAgY29uc3QgYkxpbmVzID0gKGF3YWl0IGJSZXMudGV4dCgpKS5zcGxpdCgnXG4nKTsNCiAgICAgICAgICAgICAgY29uc3QgYkxhc3QgPSBiTGluZXNbYkxpbmVzLmxlbmd0aCAtIDJdPy5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICBpZiAoYkxhc3QpIGJhbmtEYXRlID0gYkxhc3RbMF07DQoNCiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RBYnNvbHV0ZUxhc3QnKS5pbm5lclRleHQgPSBhYnNMYXN0U3RyOw0KICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZExhc3RSY3B0JykuaW5uZXJUZXh0ID0gYCR7bGF0ZXN0UmNwdE51bX0gOiAke2xhdGVzdFJjcHREYXRlfWA7DQogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkUmNwdFJlYWR5JykuaW5uZXJUZXh0ID0gYCR7cmVhZHlDb3VudH0gUmVjZWlwdHMgKFJzLiAke3JlYWR5QW10LnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfSlgOw0KICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZEJhbmtEYXRlJykuaW5uZXJUZXh0ID0gYmFua0RhdGU7DQoNCiAgICAgICAgICAgICAgLy8gU2V0IENhc2ggcm93IGZyb20gdGhlIEdsb2JhbCB2YXJpYWJsZQ0KICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZENhc2hEZXBvc2l0JykuaW5uZXJIVE1MID0gKGdsb2JhbERhc2hib2FyZENhc2hUb3RhbCA+IDApID8NCiAgICAgICAgICAgICAgICAgIGA8c3BhbiBzdHlsZT0iZm9udC1zaXplOiAwLjhlbTsgY29sb3I6ICM2NjY7Ij4oJHtnbG9iYWxEYXNoYm9hcmRDYXNoUmVjZWlwdHN9IFJlY2VpcHRzKTwvc3Bhbj4g4oK5JHtnbG9iYWxEYXNoYm9hcmRDYXNoVG90YWwudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9YCA6ICJOaWwiOw0KDQogICAgICAgICAgICAgIHN5bmNXaXRoSnNvbkJpbigpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIERhdGUgUGFyc2VyOiBDb252ZXJ0cyBzdGFuZGFyZCBERC1NTS1ZWVlZIG9yIEREL01NL1lZWVkgc3RyaW5ncw0KICAgICAgICAgICAqIGludG8gdmFsaWQgSmF2YVNjcmlwdCBEYXRlIG9iamVjdHMgZm9yIGNvbXBhcmlzb25zLg0KICAgICAgICAgICAqLw0KDQogICAgICAgICAgZnVuY3Rpb24gcGFyc2VEYXRlKGRhdGVTdHIpIHsNCiAgICAgICAgICAgICAgaWYgKCFkYXRlU3RyKSByZXR1cm4gbmV3IERhdGUoMCk7DQogICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gZGF0ZVN0ci5zcGxpdCgvWy0vXS8pOw0KICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoICE9PSAzKSByZXR1cm4gbmV3IERhdGUoMCk7DQogICAgICAgICAgICAgIHJldHVybiBuZXcgRGF0ZShwYXJ0c1syXSwgcGFydHNbMV0gLSAxLCBwYXJ0c1swXSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogRlkgQ2FsY3VsYXRvcjogRGV0ZXJtaW5lcyB0aGUgRmluYW5jaWFsIFllYXIgbGFiZWwgKGUuZy4sICIyNC0yNSIpDQogICAgICAgICAgICogYmFzZWQgb24gdGhlIHRyYW5zYWN0aW9uIGRhdGUgcHJvdmlkZWQuDQogICAgICAgICAgICovDQoNCiAgICAgICAgICBmdW5jdGlvbiBnZXRGWShkYXRlU3RyKSB7DQogICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gZGF0ZVN0ci5zcGxpdCgvWy0vXS8pOw0KICAgICAgICAgICAgICBpZiAocGFydHMubGVuZ3RoICE9PSAzKSByZXR1cm4gIiI7DQogICAgICAgICAgICAgIGxldCBtID0gcGFyc2VJbnQocGFydHNbMV0pLCB5ID0gcGFyc2VJbnQocGFydHNbMl0pOw0KICAgICAgICAgICAgICBsZXQgc3RhcnRZZWFyID0gKG0gPCA0KSA/IHkgLSAxIDogeTsNCiAgICAgICAgICAgICAgbGV0IGVuZFllYXIgPSAoc3RhcnRZZWFyICsgMSkudG9TdHJpbmcoKS5zbGljZSgtMik7DQogICAgICAgICAgICAgIHJldHVybiBgJHtzdGFydFllYXIudG9TdHJpbmcoKS5zbGljZSgtMil9LSR7ZW5kWWVhcn1gOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIFJlY2VpcHQgTm9ybWFsaXplcjogU3RyaXBzIGxlYWRpbmcgemVyb3MgYW5kIHN0YW5kYXJkaXplcyByZWNlaXB0DQogICAgICAgICAgICogcHJlZml4IGZvcm1hdHRpbmcgZm9yIGVhc2llciBzZWFyY2hpbmcuDQogICAgICAgICAgICovDQoNCiAgICAgICAgICBmdW5jdGlvbiBub3JtYWxpemVSY3B0KHMpIHsNCiAgICAgICAgICAgICAgaWYgKCFzKSByZXR1cm4gIiI7DQogICAgICAgICAgICAgIHJldHVybiBzLnRvVXBwZXJDYXNlKCkucmVwbGFjZSgvXihbQS1aXSspMCsvLCAnJDEnKS50cmltKCk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogVGV4dCBIaWdobGlnaHRlcjogSW5qZWN0cyA8bWFyaz4gdGFncyBpbnRvIGEgc3RyaW5nIHRvIGhpZ2hsaWdodA0KICAgICAgICAgICAqIHNlYXJjaCB0ZXJtcyBmb3VuZCB3aXRoaW4gdGhlIHJlc3VsdHMuDQogICAgICAgICAgICovDQoNCiAgICAgICAgICBmdW5jdGlvbiBoaWdobGlnaHRUZXh0KHRleHQsIHRlcm1zKSB7DQogICAgICAgICAgICAgIGlmICghdGVybXMgfHwgIXRlcm1zLmxlbmd0aCB8fCAhdGV4dCkgcmV0dXJuIHRleHQgfHwgIiI7DQogICAgICAgICAgICAgIGxldCBoID0gU3RyaW5nKHRleHQpOw0KICAgICAgICAgICAgICB0ZXJtcy5mb3JFYWNoKHQgPT4gew0KICAgICAgICAgICAgICAgICAgY29uc3QgcmVnZXggPSBuZXcgUmVnRXhwKGAoJHt0fSlgLCAnZ2knKTsNCiAgICAgICAgICAgICAgICAgIGggPSBoLnJlcGxhY2UocmVnZXgsICc8bWFyaz4kMTwvbWFyaz4nKTsNCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIHJldHVybiBoOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIFNlYXJjaCBMb2dpYyBFdmFsdWF0b3I6IEhhbmRsZXMgbXVsdGktdGVybSBzZWFyY2hpbmcgdXNpbmcNCiAgICAgICAgICAgKiBjb21tYXMgZm9yICdBTkQnIGxvZ2ljIGFuZCBzZW1pY29sb25zIGZvciAnT1InIGxvZ2ljLg0KICAgICAgICAgICAqLw0KDQogICAgICAgICAgZnVuY3Rpb24gZXZhbHVhdGVMb2dpYyhyb3dTdHIsIHFSYXcpIHsNCiAgICAgICAgICAgICAgbGV0IGxvZ2ljID0gIkFORCI7DQogICAgICAgICAgICAgIGxldCB0ZXJtcyA9IFtdOw0KICAgICAgICAgICAgICBpZiAocVJhdy5pbmNsdWRlcygnOycpKSB7DQogICAgICAgICAgICAgICAgICBsb2dpYyA9ICJPUiI7DQogICAgICAgICAgICAgICAgICB0ZXJtcyA9IHFSYXcudG9Mb3dlckNhc2UoKS5zcGxpdCgnOycpLm1hcCh0ID0+IHQudHJpbSgpKS5maWx0ZXIodCA9PiB0ICE9PSAiIik7DQogICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICB0ZXJtcyA9IHFSYXcudG9Mb3dlckNhc2UoKS5zcGxpdCgnLCcpLm1hcCh0ID0+IHQudHJpbSgpKS5maWx0ZXIodCA9PiB0ICE9PSAiIik7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgaWYgKGxvZ2ljID09PSAiT1IiKSByZXR1cm4geyBtYXRjaGVzOiB0ZXJtcy5zb21lKHQgPT4gcm93U3RyLmluY2x1ZGVzKHQpKSwgdGVybXM6IHRlcm1zIH07DQogICAgICAgICAgICAgIGVsc2UgcmV0dXJuIHsgbWF0Y2hlczogdGVybXMuZXZlcnkodCA9PiByb3dTdHIuaW5jbHVkZXModCkpLCB0ZXJtczogdGVybXMgfTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBVSSBDbGVhbnVwOiBDbGVhcnMgYWxsIGN1cnJlbnQgcmVzdWx0cywgY2hhcnRzLCBhbmQgc3VtbWFyeSBiYXJzDQogICAgICAgICAgICogdG8gcHJlcGFyZSB0aGUgd29ya3NwYWNlIGZvciBhIG5ldyBvcGVyYXRpb24uDQogICAgICAgICAgICovDQoNCiAgICAgICAgICBmdW5jdGlvbiBjbGVhcldvcmtzcGFjZSgpIHsNCiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ251bWVyaWNSZXN1bHRzJykuaW5uZXJIVE1MID0gIiI7DQogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxlZFJlc3VsdHMnKS5pbm5lckhUTUwgPSAiIjsNCiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaFN1bW1hcnlCYXInKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICBhY3RpdmVDaGFydHMuZm9yRWFjaChjID0+IHsgaWYgKGMpIGMuZGVzdHJveSgpOyB9KTsNCiAgICAgICAgICAgICAgYWN0aXZlQ2hhcnRzID0gW107DQoNCiAgICAgICAgICAgICAgLy8gSGlkZSBidXR0b25zIHdoZW4gY2xlYXJpbmcNCiAgICAgICAgICAgICAgdG9nZ2xlU2Nyb2xsQnV0dG9ucyhmYWxzZSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogTWVudSBDb250cm9sbGVyIChTaG93KTogRGlzcGxheXMgdGhlIFV0aWxpdHkgZ3JpZCBhbmQgaGlkZXMgc3RhbmRhcmQgc2VhcmNoIGNvbnRyb2xzLg0KICAgICAgICAgICAqLw0KDQogICAgICAgICAgZnVuY3Rpb24gc2hvd1V0aWxpdGllcygpIHsNCiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaENvbnRyb2xzJykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3V0aWxpdGllc01lbnUnKS5zdHlsZS5kaXNwbGF5ID0gJ2dyaWQnOw0KICAgICAgICAgICAgICBjb25zdCBub3cgPSBuZXcgRGF0ZSgpOw0KICAgICAgICAgICAgICBjb25zdCBjdXJGWSA9IChub3cuZ2V0TW9udGgoKSA8IDMpID8gbm93LmdldEZ1bGxZZWFyKCkgLSAxIDogbm93LmdldEZ1bGxZZWFyKCk7DQogICAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZicgKyBjdXJGWSkpIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdmJyArIGN1ckZZKS5jaGVja2VkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgY2xlYXJXb3Jrc3BhY2UoKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBNZW51IENvbnRyb2xsZXIgKEhpZGUpOiBTd2l0Y2hlcyBiYWNrIHRvIHRoZSBzZWFyY2ggaW5wdXQgYW5kIGhpZGVzIHRoZSBVdGlsaXR5IGdyaWQuDQogICAgICAgICAgICovDQoNCiAgICAgICAgICBmdW5jdGlvbiBoaWRlVXRpbGl0aWVzKCkgew0KICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoQ29udHJvbHMnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3V0aWxpdGllc01lbnUnKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZkFsbCcpLmNoZWNrZWQgPSB0cnVlOw0KICAgICAgICAgICAgICBjbGVhcldvcmtzcGFjZSgpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIE5hdmlnYXRpb24gU2hvcnRjdXQ6IFByb2dyYW1tYXRpY2FsbHkgb3BlbnMgdGhlIFV0aWxpdHkgTWVudQ0KICAgICAgICAgICAqIGFuZCB0cmlnZ2VycyB0aGUgZVJlY2VpcHQgdmlldyBmb3IgYSBzcGVjaWZpYyByZWNlaXB0IG51bWJlci4NCiAgICAgICAgICAgKi8NCg0KICAgICAgICAgIGZ1bmN0aW9uIGp1bXBUb1JlY2VpcHQocmNwdE5vKSB7DQogICAgICAgICAgICAgIHNob3dVdGlsaXRpZXMoKTsNCiAgICAgICAgICAgICAgcnVuRVJlY2VpcHQocmNwdE5vKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBCYW5rIFN0YXRlbWVudCBWaWV3ZXI6IEZpbHRlcnMgYW5kIGRpc3BsYXlzIGJhbmsgdHJhbnNhY3Rpb24gcmVjb3JkcyBmcm9tIHRoZSBNTVBUMyBmaWxlDQogICAgICAgICAgICogYmFzZWQgb24gdGhlIHNlbGVjdGVkIEZpbmFuY2lhbCBZZWFyLiBJdCBoaWdobGlnaHRzIGNyZWRpdHMgaW4gYmx1ZSBhbmQgZGViaXRzIGluIHJlZC4NCiAgICAgICAgICAgKi8NCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJ1bkJhbmtTdGF0ZW1lbnQoKSB7DQogICAgICAgICAgICAgIGNsZWFyV29ya3NwYWNlKCk7DQogICAgICAgICAgICAgIGNvbnN0IHNZZWFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKS52YWx1ZTsNCiAgICAgICAgICAgICAgY29uc3QgZnlMYWJlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InllYXJGaWx0ZXIiXTpjaGVja2VkJykucGFyZW50RWxlbWVudC5pbm5lclRleHQudHJpbSgpOw0KICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChCQU5LX05FV19VUkwpOw0KICAgICAgICAgICAgICBjb25zdCBsaW5lcyA9IChhd2FpdCByZXMudGV4dCgpKS5zcGxpdCgnXG4nKTsNCiAgICAgICAgICAgICAgbGV0IHRDciA9IDAsIHREciA9IDAsIHRyID0gIiI7DQogICAgICAgICAgICAgIGxpbmVzLmZvckVhY2gobGluZSA9PiB7DQogICAgICAgICAgICAgICAgICBsZXQgZiA9IGxpbmUuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICAgIGlmIChmLmxlbmd0aCA8IDUpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGVTdHIgPSBmWzBdLnRyaW0oKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRPYmogPSBwYXJzZURhdGUoZGF0ZVN0cik7DQogICAgICAgICAgICAgICAgICBjb25zdCBkciA9IHBhcnNlRmxvYXQoZlszXSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGNyID0gcGFyc2VGbG9hdChmWzRdKSB8fCAwOw0KICAgICAgICAgICAgICAgICAgbGV0IGluWWVhciA9IChzWWVhciA9PT0gImFsbCIpOw0KICAgICAgICAgICAgICAgICAgaWYgKCFpblllYXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmeVMgPSBwYXJzZUludChzWWVhcik7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgbSA9IGRPYmouZ2V0TW9udGgoKSArIDEsIHkgPSBkT2JqLmdldEZ1bGxZZWFyKCk7DQogICAgICAgICAgICAgICAgICAgICAgaW5ZZWFyID0gKHkgPT09IGZ5UyAmJiBtID49IDQpIHx8ICh5ID09PSBmeVMgKyAxICYmIG0gPD0gMyk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBpZiAoaW5ZZWFyKSB7DQogICAgICAgICAgICAgICAgICAgICAgdENyICs9IGNyOyB0RHIgKz0gZHI7DQogICAgICAgICAgICAgICAgICAgICAgbGV0IGFtdCA9IGNyID4gMCA/IGA8c3BhbiBjbGFzcz0iYW10LWNyZWRpdCI+JHtjci50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3NwYW4+YCA6IGA8c3BhbiBjbGFzcz0iYW10LWRlYml0Ij4ke2RyLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvc3Bhbj5gOw0KICAgICAgICAgICAgICAgICAgICAgIHRyICs9IGA8dHI+PHRkPiR7ZlswXX08L3RkPjx0ZD4ke2ZbMV19PC90ZD48dGQ+JHthbXR9PC90ZD48L3RyPmA7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsZWRSZXN1bHRzJykuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmFuay10aXRsZSI+QmFuayBTdGF0ZW1lbnRzIGZvciBGWSA6ICR7c1llYXIgPT09ICJhbGwiID8gIkFsbCIgOiBmeUxhYmVsfTwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGFibGUtd3JhcCI+PHRhYmxlPjx0cj48dGg+RGF0ZTwvdGg+PHRoPkRldGFpbHM8L3RoPjx0aD5BbW91bnQ8L3RoPjwvdHI+JHt0cn08L3RhYmxlPjwvZGl2PmA7DQogICAgICAgICAgICAgIGNvbnN0IGIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoU3VtbWFyeUJhcicpOw0KICAgICAgICAgICAgICBiLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgICBiLmlubmVySFRNTCA9IGBUb3RhbCBDcjog4oK5JHt0Q3IudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9IHwgVG90YWwgRHI6IOKCuSR7dERyLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfWA7DQogICAgICAgICAgICAgIHRvZ2dsZVNjcm9sbEJ1dHRvbnModHJ1ZSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogRXhwZW5zZSBUcmFja2VyOiBEb3dubG9hZHMgYW5kIHBhcnNlcyB0aGUgRXhwZW5zZXMgRXhjZWwgZmlsZS4gSXQgY2F0ZWdvcml6ZXMNCiAgICAgICAgICAgKiBzcGVuZGluZyBpbnRvIEdlbmVyYWwsIERlcG9zaXRzLCBMb2FucywgYW5kIEV4ZW1wdGVkIGdyb3VwcyBmb3IgdGhlIHNlbGVjdGVkIHBlcmlvZC4NCiAgICAgICAgICAgKi8NCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJ1bkV4cGVuc2VzKCkgew0KICAgICAgICAgICAgICBjbGVhcldvcmtzcGFjZSgpOw0KICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRGWSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InllYXJGaWx0ZXIiXTpjaGVja2VkJykudmFsdWU7DQogICAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChFWFBFTlNFU19VUkwpOw0KICAgICAgICAgICAgICAgICAgY29uc3Qgd2IgPSBYTFNYLnJlYWQobmV3IFVpbnQ4QXJyYXkoYXdhaXQgcmVzLmFycmF5QnVmZmVyKCkpLCB7IHR5cGU6ICdhcnJheScgfSk7DQogICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gWExTWC51dGlscy5zaGVldF90b19qc29uKHdiLlNoZWV0c1t3Yi5TaGVldE5hbWVzWzBdXSwgeyBoZWFkZXI6IDEgfSk7DQogICAgICAgICAgICAgICAgICBsZXQgaHRtbE1hcCA9IHsgbWFpbjogIiIsIGxvYW46ICIiLCBleGVtcHQ6ICIiLCBkZXBvc2l0OiAiIiB9Ow0KICAgICAgICAgICAgICAgICAgbGV0IGNvdW50TWFwID0geyBtYWluOiAwLCBsb2FuOiAwLCBkZXBvc2l0OiAwLCBleGVtcHQ6IDAgfTsNCiAgICAgICAgICAgICAgICAgIGxldCB0b3RhbE1hcCA9IHsgbWFpbjogMCwgbG9hbjogMCwgZGVwb3NpdDogMCwgZXhlbXB0OiAwIH07DQogICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IGRhdGEubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCByb3cgPSBkYXRhW2ldOw0KICAgICAgICAgICAgICAgICAgICAgIGlmICghcm93IHx8IHJvdy5sZW5ndGggPCAyKSBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgZE9iaiA9ICh0eXBlb2Ygcm93WzBdID09PSAnbnVtYmVyJykgPyBYTFNYLnV0aWxzLnNoZWV0X3RvX2RhdGUocm93WzBdKSA6IHBhcnNlRGF0ZShyb3dbMF0pOw0KICAgICAgICAgICAgICAgICAgICAgIGlmIChpc05hTihkT2JqLmdldFRpbWUoKSkpIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICAgIGxldCBtID0gZE9iai5nZXRNb250aCgpICsgMSwgeSA9IGRPYmouZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgcm93RlkgPSAobSA+PSA0KSA/IHkudG9TdHJpbmcoKSA6ICh5IC0gMSkudG9TdHJpbmcoKTsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRGWSAhPT0gImFsbCIgJiYgcm93RlkgIT09IHNlbGVjdGVkRlkpIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICAgIGxldCBhbXQgPSBwYXJzZUZsb2F0KHJvd1szXSkgfHwgMCwgZGVzYyA9IChyb3dbNF0gfHwgcm93WzFdIHx8ICIiKS50b1N0cmluZygpLCBzID0gZGVzYy50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgICAgICAgICAgIGxldCByb3dIdG1sID0gYDx0cj48dGQ+JHtkT2JqLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tR0InKX08L3RkPjx0ZD4ke2Rlc2N9PC90ZD48dGQgY2xhc3M9ImFtdCI+4oK5JHthbXQudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD48L3RyPmA7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKHMuaW5jbHVkZXMoImV4ZW1wdCIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGh0bWxNYXAuZXhlbXB0ICs9IHJvd0h0bWw7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50TWFwLmV4ZW1wdCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbE1hcC5leGVtcHQgKz0gYW10Ow0KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocy5pbmNsdWRlcygiZGVwb3NpdCIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGh0bWxNYXAuZGVwb3NpdCArPSByb3dIdG1sOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb3VudE1hcC5kZXBvc2l0Kys7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsTWFwLmRlcG9zaXQgKz0gYW10Ow0KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAocy5pbmNsdWRlcygibG9hbiIpIHx8IHMuaW5jbHVkZXMoImNsb3N1cmUiKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sTWFwLmxvYW4gKz0gcm93SHRtbDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRNYXAubG9hbisrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbE1hcC5sb2FuICs9IGFtdDsNCiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sTWFwLm1haW4gKz0gcm93SHRtbDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY291bnRNYXAubWFpbisrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB0b3RhbE1hcC5tYWluICs9IGFtdDsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbnVtZXJpY1Jlc3VsdHMnKS5pbm5lckhUTUwgPSBgPHRhYmxlIGNsYXNzPSJleGVjLXN1bW1hcnkiPjx0cj48dGg+SXRlbTwvdGg+PHRoPkNvdW50PC90aD48dGg+VG90YWw8L3RoPjwvdHI+PHRyIHN0eWxlPSJjb2xvcjp2YXIoLS1wcmltYXJ5LWJsdWUpOyI+PHRkPkdlbmVyYWw8L3RkPjx0ZD4ke2NvdW50TWFwLm1haW59PC90ZD48dGQ+4oK5JHt0b3RhbE1hcC5tYWluLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvdGQ+PC90cj48dHIgc3R5bGU9ImNvbG9yOnZhcigtLWRlcG9zaXQtcHVycGxlKTsiPjx0ZD5EZXBvc2l0czwvdGQ+PHRkPiR7Y291bnRNYXAuZGVwb3NpdH08L3RkPjx0ZD7igrkke3RvdGFsTWFwLmRlcG9zaXQudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD48L3RyPjx0ciBzdHlsZT0iY29sb3I6dmFyKC0tbG9hbi1ncmVlbik7Ij48dGQ+TG9hbnM8L3RkPjx0ZD4ke2NvdW50TWFwLmxvYW59PC90ZD48dGQ+4oK5JHt0b3RhbE1hcC5sb2FuLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvdGQ+PC90cj48dHIgc3R5bGU9ImNvbG9yOnZhcigtLWV4ZW1wdC1ncmF5KTsiPjx0ZD5FeGVtcHRlZDwvdGQ+PHRkPiR7Y291bnRNYXAuZXhlbXB0fTwvdGQ+PHRkPuKCuSR7dG90YWxNYXAuZXhlbXB0LnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvdGQ+PC90cj48L3RhYmxlPmA7DQogICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsZWRSZXN1bHRzJykuaW5uZXJIVE1MID0gYDxkaXYgY2xhc3M9ImV4cC1iYXIgbWFpbi1iYXIiPjxzcGFuPkdFTkVSQUw8L3NwYW4+PHNwYW4+4oK5JHt0b3RhbE1hcC5tYWluLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvc3Bhbj48L2Rpdj48ZGl2IGNsYXNzPSJ0YWJsZS13cmFwIj48dGFibGU+JHtodG1sTWFwLm1haW59PC90YWJsZT48L2Rpdj48ZGl2IGNsYXNzPSJleHAtYmFyIGRlcG9zaXQtYmFyIj48c3Bhbj5ERVBPU0lUUzwvc3Bhbj48c3Bhbj7igrkke3RvdGFsTWFwLmRlcG9zaXQudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC9zcGFuPjwvZGl2PjxkaXYgY2xhc3M9InRhYmxlLXdyYXAiPjx0YWJsZT4ke2h0bWxNYXAuZGVwb3NpdH08L3RhYmxlPjwvZGl2PjxkaXYgY2xhc3M9ImV4cC1iYXIgbG9hbi1iYXIiPjxzcGFuPkxPQU5TPC9zcGFuPjxzcGFuPuKCuSR7dG90YWxNYXAubG9hbi50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz0idGFibGUtd3JhcCI+PHRhYmxlPiR7aHRtbE1hcC5sb2FufTwvdGFibGU+PC9kaXY+PGRpdiBjbGFzcz0iZXhwLWJhciBleGVtcHQtYmFyIj48c3Bhbj5FWEVNUFRFRDwvc3Bhbj48c3Bhbj7igrkke3RvdGFsTWFwLmV4ZW1wdC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz0idGFibGUtd3JhcCI+PHRhYmxlPiR7aHRtbE1hcC5leGVtcHR9PC90YWJsZT48L2Rpdj5gOw0KICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICBhbGVydCgiRXJyb3I6ICIgKyBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHRvZ2dsZVNjcm9sbEJ1dHRvbnModHJ1ZSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogQ29uc2VudCBNYW5hZ2VyOiBJZGVudGlmaWVzICJDb3JwdXMiIGRvbmF0aW9ucyB3aGVyZSB0aGUgbWFuZGF0b3J5IGNvbnNlbnQgZm9ybQ0KICAgICAgICAgICAqIGhhcyBub3QgeWV0IGJlZW4gc2lnbmVkIChDb3JwdXMgU2lnbmVkID0gTk8pLiBIZWxwcyBpbiB0cmFja2luZyByZWd1bGF0b3J5IGNvbXBsaWFuY2UuDQogICAgICAgICAgICovDQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBydW5QQ29uc2VudCgpIHsNCiAgICAgICAgICAgICAgbGV0IHEgPSBwcm9tcHQoIlNlYXJjaD8gKEJsYW5rIGZvciBBbGwpIiwgIiIpOw0KICAgICAgICAgICAgICBpZiAocSA9PT0gbnVsbCkgcmV0dXJuOw0KICAgICAgICAgICAgICBsZXQgcVJhdyA9IHEudHJpbSgpLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICAgIGNsZWFyV29ya3NwYWNlKCk7DQogICAgICAgICAgICAgIGNvbnN0IHNZZWFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKS52YWx1ZTsNCiAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goREFUQV9VUkwpOw0KICAgICAgICAgICAgICBjb25zdCByZWNzID0gKGF3YWl0IHJlcy50ZXh0KCkpLnNwbGl0KCdcbicpOw0KICAgICAgICAgICAgICBsZXQgcmVzdWx0cyA9IFtdOw0KICAgICAgICAgICAgICBsZXQgc2MgPSAwLCBzYSA9IDA7DQogICAgICAgICAgICAgIHJlY3MuZm9yRWFjaChyID0+IHsNCiAgICAgICAgICAgICAgICAgIGxldCBmID0gci5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgICAgaWYgKGYubGVuZ3RoIDwgMjApIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRQID0gZlsxXS5zcGxpdCgvWy0vXS8pOw0KICAgICAgICAgICAgICAgICAgY29uc3QgbW0gPSBwYXJzZUludChkUFsxXSksIHl5ID0gcGFyc2VJbnQoZFBbMl0pOw0KICAgICAgICAgICAgICAgICAgY29uc3QgaW5ZZWFyID0gKHNZZWFyID09PSAiYWxsIikgfHwgKCh5eSA9PT0gcGFyc2VJbnQoc1llYXIpICYmIG1tID49IDQpIHx8ICh5eSA9PT0gcGFyc2VJbnQoc1llYXIpICsgMSAmJiBtbSA8PSAzKSk7DQogICAgICAgICAgICAgICAgICBpZiAoIWluWWVhciB8fCBmWzEzXT8udHJpbSgpLnRvVXBwZXJDYXNlKCkgPT09ICJZRVMiIHx8IGZbMTJdPy50cmltKCkudG9VcHBlckNhc2UoKSAhPT0gIkNPUlBVUyIgfHwgKGZbMThdPy50cmltKCkudG9VcHBlckNhc2UoKSA9PT0gIllFUyIpKSByZXR1cm47DQogICAgICAgICAgICAgICAgICBjb25zdCByb3dTdHIgPSByLnRvTG93ZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICBjb25zdCBldmFsID0gKHFSYXcgPT09ICIiKSA/IHsgbWF0Y2hlczogdHJ1ZSwgdGVybXM6IFtdIH0gOiBldmFsdWF0ZUxvZ2ljKHJvd1N0ciwgcVJhdyk7DQogICAgICAgICAgICAgICAgICBpZiAoZXZhbC5tYXRjaGVzKSB7DQogICAgICAgICAgICAgICAgICAgICAgbGV0IGFtdCA9IHBhcnNlRmxvYXQoZls5XSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgICBzYysrOw0KICAgICAgICAgICAgICAgICAgICAgIHNhICs9IGFtdDsNCiAgICAgICAgICAgICAgICAgICAgICByZXN1bHRzLnB1c2goeyByY3B0OiBmWzBdLCBkYXRlOiBmWzFdLCBhbXQ6IGFtdCwgbmFtZTogZlsyXSwgcGhvbmU6IGZbM10gfHwgIi0tLSIsIGFkZHI6IGZbNF0/LnJlcGxhY2UoL34vZywgJywgJyksIHBpbjogZlsxNV0sIGNvdW50cnk6IGZbMTldIH0pOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgcmVzdWx0cy5zb3J0KChhLCBiKSA9PiBiLmFtdCAtIGEuYW10KTsNCiAgICAgICAgICAgICAgbGV0IHRyID0gIiI7DQogICAgICAgICAgICAgIHJlc3VsdHMuZm9yRWFjaChpdGVtID0+IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJjcHRMaW5rID0gYDxzcGFuIGNsYXNzPSJyY3B0LWxpbmsiIG9uY2xpY2s9Imp1bXBUb1JlY2VpcHQoJyR7aXRlbS5yY3B0fScpIj4ke2l0ZW0ucmNwdH08L3NwYW4+YDsNCiAgICAgICAgICAgICAgICAgIGxldCBuYW1lRGlzcGxheSA9ICghaXRlbS5uYW1lIHx8IGl0ZW0ubmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCJhbm9ueW1vdXMiKSkgPyBgPHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLWNhbmNlbC1yZWQpOyBmb250LXdlaWdodDpib2xkOyBmb250LXNpemU6MS4xcmVtOyI+QU5PTllNT1VTPC9zcGFuPmAgOiBpdGVtLm5hbWU7DQogICAgICAgICAgICAgICAgICBjb25zdCBnZW8gPSBgJHtpdGVtLnBpbn0ke2l0ZW0ucGluICYmIGl0ZW0uY291bnRyeSA/ICcgLSAnIDogJyd9JHtpdGVtLmNvdW50cnl9YDsNCiAgICAgICAgICAgICAgICAgIHRyICs9IGA8dHI+PHRkIHdpZHRoPSIzNSUiPjxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7IGNvbG9yOnZhcigtLXByaW1hcnktYmx1ZSk7IGZvbnQtc2l6ZTowLjg1cmVtOyI+JHtyY3B0TGlua308L2Rpdj48ZGl2IHN0eWxlPSJmb250LXNpemU6MC43MnJlbTsgY29sb3I6IzMzMzsgbGluZS1oZWlnaHQ6MS40OyI+JHtpdGVtLmRhdGV9PGJyPjxiPuKCuSR7aXRlbS5hbXQudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC9iPjwvZGl2PjwvdGQ+PHRkPjxkaXYgc3R5bGU9ImZvbnQtd2VpZ2h0OmJvbGQ7IGNvbG9yOnZhcigtLXByaW1hcnktYmx1ZSk7IGZvbnQtc2l6ZTowLjg1cmVtOyI+JHtuYW1lRGlzcGxheX08L2Rpdj48ZGl2IHN0eWxlPSJmb250LXNpemU6MC43MnJlbTsgY29sb3I6IzMzMzsgbGluZS1oZWlnaHQ6MS40OyI+JHtpdGVtLmFkZHJ9ICR7Z2VvID8gJygnICsgZ2VvICsgJyknIDogJyd9PGJyPjxzcGFuIHN0eWxlPSJjb2xvcjp2YXIoLS1wcmltYXJ5LWJsdWUpIj4ke2l0ZW0ucGhvbmV9PC9zcGFuPjwvZGl2PjwvdGQ+PC90cj5gOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbGVkUmVzdWx0cycpLmlubmVySFRNTCA9IHRyID8gYDxkaXYgY2xhc3M9InRhYmxlLXdyYXAiPjx0YWJsZT48dHI+PHRoPlJlY2VpcHQvRGF0ZS9BbXQ8L3RoPjx0aD5Eb25vciBEZXRhaWxzPC90aD48L3RyPiR7dHJ9PC90YWJsZT48L2Rpdj5gIDogIk5vIHJlY29yZHMuIjsNCiAgICAgICAgICAgICAgY29uc3QgYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2hTdW1tYXJ5QmFyJyk7DQogICAgICAgICAgICAgIGIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICAgIGIuaW5uZXJIVE1MID0gYFAtQ29uc2VudDogJHtzY30gfCBUb3RhbDog4oK5JHtzYS50b0xvY2FsZVN0cmluZygnZW4tSU4nKX1gOw0KICAgICAgICAgICAgICB0b2dnbGVTY3JvbGxCdXR0b25zKHRydWUpOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIENhc2ggUmVjb25jaWxpYXRpb246IENvbXBhcmVzIHRoZSBtYW51YWwgQ2FzaC1MaXN0IHRleHQgZmlsZSBhZ2FpbnN0IHRoZQ0KICAgICAgICAgICAqIG1hc3RlciBkYXRhYmFzZSB0byB2ZXJpZnkgdGhhdCBhbGwgcGh5c2ljYWwgY2FzaCByZWNlaXZlZCBoYXMgYmVlbiByZWNvcmRlZC4NCiAgICAgICAgICAgKi8NCg0KDQogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gcnVuQ2FzaERlcChpc0Rhc2ggPSBmYWxzZSkgew0KICAgICAgICAgICAgICBjbGVhcldvcmtzcGFjZSgpOw0KICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgY29uc3QgY2FzaFJlcyA9IGF3YWl0IGZldGNoKENBU0hfTElTVF9VUkwpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgY2FzaFRleHQgPSBhd2FpdCBjYXNoUmVzLnRleHQoKTsNCiAgICAgICAgICAgICAgICAgIGxldCBkZXBvc2l0ZWRTZXQgPSBuZXcgU2V0KCk7DQogICAgICAgICAgICAgICAgICBjYXNoVGV4dC5zcGxpdCgnXG4nKS5mb3JFYWNoKGxpbmUgPT4gew0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gbGluZS5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgICAgICAgIGlmIChwYXJ0cy5sZW5ndGggPCAyKSByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgaWYgKHBhcnNlRGF0ZShwYXJ0c1swXS50cmltKCkpIDwgQ1VUT0ZGX0RBVEUpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCB0eXBlID0gcGFydHNbMV0udHJpbSgpLnRvVXBwZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICAgICAgcGFydHNbcGFydHMubGVuZ3RoIC0gMV0uc3BsaXQoJywnKS5mb3JFYWNoKG4gPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgY24gPSBuLnRyaW0oKTsgaWYgKCFjbikgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gIk0iIHx8IHR5cGUgPT09ICJCIikgZGVwb3NpdGVkU2V0LmFkZCgiTVBTIiArIGNuKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09ICJDIiB8fCB0eXBlID09PSAiQiIpIGRlcG9zaXRlZFNldC5hZGQoIkNHIiArIGNuKTsNCiAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgY29uc3QgZGJSZXMgPSBhd2FpdCBmZXRjaChEQVRBX1VSTCk7DQogICAgICAgICAgICAgICAgICBjb25zdCByZWNzID0gKGF3YWl0IGRiUmVzLnRleHQoKSkuc3BsaXQoJ1xuJyk7DQogICAgICAgICAgICAgICAgICBsZXQgcGVuZGluZ1JlY29yZHMgPSBbXTsNCiAgICAgICAgICAgICAgICAgIGxldCB0b3RhbFBlbmRpbmdBbXQgPSAwOw0KICAgICAgICAgICAgICAgICAgcmVjcy5mb3JFYWNoKHIgPT4gew0KICAgICAgICAgICAgICAgICAgICAgIGxldCBmID0gci5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgICAgICAgIGlmIChmLmxlbmd0aCA8IDEzKSByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgY29uc3Qgbm9ybVJjcHQgPSBub3JtYWxpemVSY3B0KGZbMF0udHJpbSgpKTsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAocGFyc2VEYXRlKGZbMV0pID49IENVVE9GRl9EQVRFICYmIChmWzExXSB8fCAiIikudG9VcHBlckNhc2UoKS50cmltKCkgPT09ICJDQVNIIiAmJiAoZlsxM10gfHwgIiIpLnRvVXBwZXJDYXNlKCkudHJpbSgpICE9PSAiWUVTIiAmJiAhKGZbMTBdIHx8ICIiKS50cmltKCkgJiYgIUFycmF5LmZyb20oZGVwb3NpdGVkU2V0KS5zb21lKGQgPT4gbm9ybWFsaXplUmNwdChkKSA9PT0gbm9ybVJjcHQpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHBlbmRpbmdSZWNvcmRzLnB1c2goeyByY3B0OiBmWzBdLCBkYXRlOiBmWzFdLCBhbXQ6IHBhcnNlRmxvYXQoZls5XSkgfHwgMCB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxQZW5kaW5nQW10ICs9IHBhcnNlRmxvYXQoZls5XSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgd2luZG93Lmdsb2JhbFBlbmRpbmdDYXB0dXJlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShwZW5kaW5nUmVjb3JkcykpOw0KICAgICAgICAgICAgICAgICAgZ2xvYmFsRGFzaGJvYXJkQ2FzaFRvdGFsID0gdG90YWxQZW5kaW5nQW10Ow0KICAgICAgICAgICAgICAgICAgZ2xvYmFsRGFzaGJvYXJkQ2FzaFJlY2VpcHRzID0gcGVuZGluZ1JlY29yZHMubGVuZ3RoOw0KDQogICAgICAgICAgICAgICAgICBpZiAoaXNEYXNoKSB7DQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICBsZXQgaCA9IGA8ZGl2IGNsYXNzPSJjYXNoLXN1bS1ib3giPjxzcGFuPlRvdGFsOiDigrkke3RvdGFsUGVuZGluZ0FtdC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3NwYW4+PHNwYW4+UmVjZWlwdHM6ICR7cGVuZGluZ1JlY29yZHMubGVuZ3RofTwvc3Bhbj48L2Rpdj5gOw0KICAgICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdSZWNvcmRzLmxlbmd0aCA9PT0gMCkgaCArPSAiPHAgc3R5bGU9J3RleHQtYWxpZ246Y2VudGVyOyc+Tm8gcGVuZGluZyBjYXNoIGRlcG9zaXRzLjwvcD4iOw0KICAgICAgICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgaCArPSAiPGRpdiBjbGFzcz0ndGFibGUtd3JhcCc+PHRhYmxlPjx0cj48dGg+UmVjZWlwdDwvdGg+PHRoPkRhdGU8L3RoPjx0aD5BbW91bnQ8L3RoPjwvdHI+IjsNCg0KICAgICAgICAgICAgICAgICAgICAgIGxldCBjbGVhblJlY2VpcHROdW1iZXJzID0gW107IC8vIEZvciBvdXIgbmV3IGJhbmsgbGluZQ0KDQogICAgICAgICAgICAgICAgICAgICAgcGVuZGluZ1JlY29yZHMuc29ydCgoYSwgYikgPT4gcGFyc2VEYXRlKGEuZGF0ZSkgLSBwYXJzZURhdGUoYi5kYXRlKSkuZm9yRWFjaChyZWMgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICBoICs9IGA8dHI+PHRkPjxzcGFuIGNsYXNzPSJyY3B0LWxpbmsiIG9uY2xpY2s9Imp1bXBUb1JlY2VpcHQoJyR7cmVjLnJjcHR9JykiPiR7cmVjLnJjcHR9PC9zcGFuPjwvdGQ+PHRkPiR7cmVjLmRhdGV9PC90ZD48dGQ+4oK5JHtyZWMuYW10LnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvdGQ+PC90cj5gOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIENsZWFuIHJlY2VpcHQgZm9yIGJhbmsgbGluZTogc3RyaXAgcHJlZml4IGFuZCBsZWFkaW5nIHplcm9zDQogICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBudW1Pbmx5ID0gcmVjLnJjcHQucmVwbGFjZSgvW15cZF0vZywgJycpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBjbGVhblJlY2VpcHROdW1iZXJzLnB1c2gocGFyc2VJbnQobnVtT25seSwgMTApKTsNCiAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICBoICs9ICI8L3RhYmxlPjwvZGl2PiI7DQoNCiAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0gU1RBUlQgT0YgTkVXIEJBTksgRk9STUFUIEFERElUSU9OIC0tLQ0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgZCA9IFN0cmluZyhub3cuZ2V0RGF0ZSgpKS5wYWRTdGFydCgyLCAnMCcpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBTdHJpbmcobm93LmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHkgPSBub3cuZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmb3JtYXR0ZWREYXRlID0gYCR7ZH0vJHttfS8ke3l9YDsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiYW5rTGluZSA9IGAke2Zvcm1hdHRlZERhdGV9ICR7dG90YWxQZW5kaW5nQW10fXxDfCR7Y2xlYW5SZWNlaXB0TnVtYmVycy5qb2luKCcsJyl9YDsNCg0KICAgICAgICAgICAgICAgICAgICAgIGggKz0gYA0KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDoyMHB4OyBwYWRkaW5nOjE1cHg7IGJvcmRlcjoycHggZGFzaGVkICM4MDAwMDA7IGJhY2tncm91bmQ6I2ZmZjlmMDsgYm9yZGVyLXJhZGl1czo4cHg7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBzdHlsZT0ibWFyZ2luOjAgMCA4cHggMDsgZm9udC1zaXplOjEycHg7IGZvbnQtd2VpZ2h0OmJvbGQ7IGNvbG9yOiM4MDAwMDA7Ij5CQU5LIERFUE9TSVQgRk9STUFUOjwvcD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OmZsZXg7IGFsaWduLWl0ZW1zOmNlbnRlcjsgZ2FwOjEwcHg7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGNvZGUgaWQ9ImJhbmtMaW5lVGV4dCIgc3R5bGU9ImZsZXgtZ3JvdzoxOyBiYWNrZ3JvdW5kOiNmZmY7IHBhZGRpbmc6OHB4OyBib3JkZXI6MXB4IHNvbGlkICNjY2M7IGZvbnQtZmFtaWx5Om1vbm9zcGFjZTsgZm9udC13ZWlnaHQ6Ym9sZDsgd29yZC1icmVhazpicmVhay1hbGw7Ij4ke2JhbmtMaW5lfTwvY29kZT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJjb3B5QmFua0xpbmUoKSIgc3R5bGU9ImJhY2tncm91bmQ6IzgwMDAwMDsgY29sb3I6d2hpdGU7IGJvcmRlcjpub25lOyBwYWRkaW5nOjhweCAxMnB4OyBib3JkZXItcmFkaXVzOjRweDsgY3Vyc29yOnBvaW50ZXI7IGZvbnQtd2VpZ2h0OmJvbGQ7IHdoaXRlLXNwYWNlOm5vd3JhcDsiPvCfk4sgQ29weTwvYnV0dG9uPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsNCiAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0gRU5EIE9GIE5FVyBCQU5LIEZPUk1BVCBBRERJVElPTiAtLS0NCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxlZFJlc3VsdHMnKS5pbm5lckhUTUwgPSBoOw0KICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICBhbGVydCgiRXJyb3I6ICIgKyBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIHRvZ2dsZVNjcm9sbEJ1dHRvbnModHJ1ZSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gR2xvYmFsIGhlbHBlciBmb3IgdGhlIGNvcHkgYnV0dG9uDQogICAgICAgICAgZnVuY3Rpb24gY29weUJhbmtMaW5lKCkgew0KICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JhbmtMaW5lVGV4dCcpLmlubmVyVGV4dDsNCiAgICAgICAgICAgICAgbmF2aWdhdG9yLmNsaXBib2FyZC53cml0ZVRleHQodGV4dCkudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICBhbGVydCgiQ29waWVkIHRvIGNsaXBib2FyZCEiKTsNCiAgICAgICAgICAgICAgfSkuY2F0Y2goZXJyID0+IHsNCiAgICAgICAgICAgICAgICAgIGFsZXJ0KCJFcnJvciBjb3B5aW5nIHRleHQuIik7DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCg0KDQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBlUmVjZWlwdCBUb29sOiBHZW5lcmF0ZXMgYSBwcmludGFibGUsIHByb2Zlc3Npb25hbCBIVE1MIHJlY2VpcHQgZm9yIGEgc3BlY2lmaWMNCiAgICAgICAgICAgKiByZWNlaXB0IG51bWJlci4gSXQgaW5jbHVkZXMgYSB3YXRlcm1hcmsgYW5kIHRydXN0LXNwZWNpZmljIGxlZ2FsIHdvcmRpbmcuDQogICAgICAgICAgICovDQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBydW5FUmVjZWlwdChwcmVmaWxsZWRJRCA9IG51bGwpIHsNCiAgICAgICAgICAgICAgY2xlYXJXb3Jrc3BhY2UoKTsNCiAgICAgICAgICAgICAgbGV0IHEgPSBwcm9tcHQoIkVudGVyIFJlY2VpcHQgTm86IiwgcHJlZmlsbGVkSUQgfHwgIiIpOw0KICAgICAgICAgICAgICBpZiAoIXEpIHJldHVybjsNCiAgICAgICAgICAgICAgcSA9IHEudHJpbSgpLnRvVXBwZXJDYXNlKCk7DQogICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKERBVEFfVVJMKTsNCiAgICAgICAgICAgICAgY29uc3QgcmVjcyA9IChhd2FpdCByZXMudGV4dCgpKS5zcGxpdCgnXG4nKTsNCiAgICAgICAgICAgICAgbGV0IGZvdW5kID0gcmVjcy5maW5kKHIgPT4gci5zcGxpdCgnfCcpWzBdLnRyaW0oKS50b1VwcGVyQ2FzZSgpID09PSBxKTsNCiAgICAgICAgICAgICAgaWYgKCFmb3VuZCkgew0KICAgICAgICAgICAgICAgICAgYWxlcnQoIk5vdCBpbiBEYXRhYmFzZSIpOw0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGxldCBmID0gZm91bmQuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgY29uc3QgaXNDID0gKGZbMTNdPy50cmltKCkudG9VcHBlckNhc2UoKSA9PT0gIllFUyIpOw0KICAgICAgICAgICAgICBsZXQgd2F0ZXJtYXJrSHRtbCA9IGlzQyA/ICc8ZGl2IGNsYXNzPSJ3YXRlcm1hcmsiPkNBTkNFTExFRDwvZGl2PicgOiAiIjsNCiAgICAgICAgICAgICAgY29uc3QgYmFzZUFkZHIgPSAoZls0XSB8fCAiIikucmVwbGFjZSgvfi9nLCAnPGJyPicpLCBwaW4gPSBmWzE1XSB8fCAiIiwgY291bnRyeSA9IGZbMTldIHx8ICIiOw0KICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5QWRkciA9IGJhc2VBZGRyICsgKChwaW4gfHwgY291bnRyeSkgPyAoIjxicj4iICsgcGluICsgIiAiICsgY291bnRyeSkgOiAiIik7DQogICAgICAgICAgICAgIGxldCBoID0gYDxidXR0b24gY2xhc3M9ImJ0bi1yb3RhdGUiIG9uY2xpY2s9InRvZ2dsZVJvdGF0aW9uKCkiPlJvdGF0ZSAoOTDCsCk8L2J1dHRvbj48ZGl2IGNsYXNzPSJyZWNlaXB0LXZpZXdwb3J0Ij48ZGl2IGlkPSJzcGFjZXJUb3AiIGNsYXNzPSJzcy1zcGFjZXIiPjwvZGl2PjxkaXYgaWQ9InJlY2VpcHRDb250YWluZXIiIGNsYXNzPSJyZWNlaXB0LWNvbnRhaW5lciAke2lzQyA/ICdjYW5jZWxsZWQtcm93JyA6ICcnfSI+JHt3YXRlcm1hcmtIdG1sfTx0YWJsZSBjbGFzcz0icmVjZWlwdC1odG1sIj48dHI+PHRkIHdpZHRoPSIxMzAiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsiPjxpbWcgc3JjPSJodHRwczovL3d3dy5nYW5lc2FzYXJtYS5jb20vUGVyaXlhdmEuanBnIiB3aWR0aD0iMTEwIj48L3RkPjx0ZD48Y2VudGVyPjxiPk1ZTEFJIE1BSEFQRVJJWUFWQSBBTlVTSEFNIFRSVVNUIChSRUdELiksPC9iPjxicj5QaXRjaHVwaWxsYWkgU3RyZWV0LCBNeWxhcG9yZSwgQ2hlbm5haS00Ljxicj5QaDogNjM4MDg5ODIzMSwgODYxMDIxNDEzOC48YnI+PHNwYW4gc3R5bGU9ImZvbnQtc2l6ZToxMXB4OyI+dGhpcnVteWxhaWFudXNoYW1AZ21haWwuY29tPC9zcGFuPjxicj48ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjVweDsgZGlzcGxheTpmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2Vlbjsgd2lkdGg6MTAwJTsiPjxzcGFuPjxiPiR7ZlsxXX08L2I+PC9zcGFuPjxzcGFuPjxiPlJlY2VpcHQ8L2I+PC9zcGFuPjxzcGFuPjxiPiR7ZlswXX08L2I+PC9zcGFuPjwvZGl2PjwvY2VudGVyPjwvdGQ+PC90cj48dHI+PHRkIGNvbHNwYW49IjIiPjxwPlJlY2VpdmVkIFJzLiA8Yj4ke2ZbOV19PC9iPiBmb3IgPGI+JHtmWzEyXX08L2I+IHZpYSA8Yj4ke2ZbMTFdfSAke2ZbMTBdIHx8ICIifTwvYj4gZnJvbTo8L3A+PC90ZD48L3RyPjx0cj48dGQ+PGI+TmFtZTwvYj48L3RkPjx0ZD48Yj5TaHJpLi9TbXQuICR7ZlsyXX08L2I+PC90ZD48L3RyPjx0cj48dGQ+PGI+UEFOPC9iPjwvdGQ+PHRkPiR7Zls2XSB8fCAiIn08L3RkPjwvdHI+PHRyPjx0ZD48Yj5QaG9uZTwvYj48L3RkPjx0ZD4ke2ZbM119PC90ZD48L3RyPjx0cj48dGQ+PGI+QWRkcmVzczwvYj48L3RkPjx0ZD4ke2Rpc3BsYXlBZGRyfTwvdGQ+PC90cj48dHI+PHRkIGNvbHNwYW49IjIiIHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0OyBib3JkZXItdG9wOjJweCBzb2xpZCAjMDAwOyI+Zm9yIDxiPk1ZTEFJIE1BSEFQRVJJWUFWQSBBTlVTSEFNIFRSVVNUPC9iPjxicj48c3BhbiBzdHlsZT0iZm9udC1zaXplOjExcHg7IGZvbnQtd2VpZ2h0OmJvbGQ7Ij5TZWN0aW9uIDEyLUEgcmVnaXN0cmF0aW9uIHZhbGlkIHRpbGwgMzEtMDMtMjAyNjwvc3Bhbj48L3RkPjwvdHI+PC90YWJsZT48L2Rpdj48ZGl2IGlkPSJzcGFjZXJCb3R0b20iIGNsYXNzPSJzcy1zcGFjZXIiPjwvZGl2PjwvZGl2PjxidXR0b24gY2xhc3M9ImJ0bi13YSIgb25jbGljaz0nc2VuZFdoYXRzQXBwKCR7SlNPTi5zdHJpbmdpZnkoZil9KSc+U2VuZCB2aWEgV2hhdHNBcHA8L2J1dHRvbj5gOw0KICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsZWRSZXN1bHRzJykuaW5uZXJIVE1MID0gaDsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBTdGF0aXN0aWNhbCBTdW1tYXJ5OiBHZW5lcmF0ZXMgYSBoaWdoLWxldmVsIG92ZXJ2aWV3IG9mIHRvdGFsIGluY29tZSwNCiAgICAgICAgICAgKiBkb25vciBjb3VudHMsIGFuZCBjYXRlZ29yaWNhbCBicmVha2Rvd25zIChDb3JwdXMgdnMuIEdlbmVyYWwpIHdpdGggdmlzdWFsIGNoYXJ0cy4NCiAgICAgICAgICAgKi8NCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJ1blN1bW1hcnkoKSB7DQogICAgICAgICAgICAgIGNsZWFyV29ya3NwYWNlKCk7DQogICAgICAgICAgICAgIGNvbnN0IHNZZWFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKS52YWx1ZTsNCiAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goREFUQV9VUkwpOw0KICAgICAgICAgICAgICBjb25zdCByZWNzID0gKGF3YWl0IHJlcy50ZXh0KCkpLnNwbGl0KCdcbicpOw0KICAgICAgICAgICAgICBsZXQgcyA9IHsgdEFtdDogMCwgdENudDogMCwgdG93YXJkczoge30sIG1vZGU6IHt9LCB0cmVuZDoge30sIGFub25BOiAwLCBhbm9uQzogMCwgbm9OYW1lQTogMCwgbm9OYW1lQzogMCwgbm9QaG9uZUE6IDAsIG5vUGhvbmVDOiAwLCBub1BhbkE6IDAsIG5vUGFuQzogMCwgcGVuZENvcnBBOiAwLCBwZW5kQ29ycEM6IDAgfTsNCiAgICAgICAgICAgICAgY29uc3QgbW9uID0gWyJBcHIiLCAiTWF5IiwgIkp1biIsICJKdWwiLCAiQXVnIiwgIlNlcCIsICJPY3QiLCAiTm92IiwgIkRlYyIsICJKYW4iLCAiRmViIiwgIk1hciJdOw0KICAgICAgICAgICAgICByZWNzLmZvckVhY2gociA9PiB7DQogICAgICAgICAgICAgICAgICBsZXQgZiA9IHIuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICAgIGlmIChmLmxlbmd0aCA8IDEzIHx8IGZbMTNdPy50cmltKCkudG9VcHBlckNhc2UoKSA9PT0gIllFUyIpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRQID0gZlsxXS5zcGxpdCgvWy0vXS8pOw0KICAgICAgICAgICAgICAgICAgY29uc3QgbSA9IHBhcnNlSW50KGRQWzFdKSwgeSA9IHBhcnNlSW50KGRQWzJdKTsNCiAgICAgICAgICAgICAgICAgIGlmIChzWWVhciAhPT0gImFsbCIgJiYgISgoeSA9PT0gcGFyc2VJbnQoc1llYXIpICYmIG0gPj0gNCkgfHwgKHkgPT09IHBhcnNlSW50KHNZZWFyKSArIDEgJiYgbSA8PSAzKSkpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIGxldCBhbXQgPSBwYXJzZUZsb2F0KGZbOV0pIHx8IDA7DQogICAgICAgICAgICAgICAgICBzLnRBbXQgKz0gYW10Ow0KICAgICAgICAgICAgICAgICAgcy50Q250Kys7DQogICAgICAgICAgICAgICAgICBsZXQgdHcgPSAoZlsxMl0gfHwgIk9USEVSUyIpLnRvVXBwZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICBpZiAoIXMudG93YXJkc1t0d10pIHMudG93YXJkc1t0d10gPSB7IGE6IDAsIGM6IDAgfTsNCiAgICAgICAgICAgICAgICAgIHMudG93YXJkc1t0d10uYSArPSBhbXQ7DQogICAgICAgICAgICAgICAgICBzLnRvd2FyZHNbdHddLmMrKzsNCiAgICAgICAgICAgICAgICAgIGxldCBtZCA9IChmWzExXSB8fCAiVVBJIikudG9VcHBlckNhc2UoKTsNCiAgICAgICAgICAgICAgICAgIGlmICghcy5tb2RlW21kXSkgcy5tb2RlW21kXSA9IHsgYTogMCwgYzogMCB9Ow0KICAgICAgICAgICAgICAgICAgcy5tb2RlW21kXS5hICs9IGFtdDsNCiAgICAgICAgICAgICAgICAgIHMubW9kZVttZF0uYysrOw0KICAgICAgICAgICAgICAgICAgaWYgKCFmWzJdPy50cmltKCkgfHwgZlsyXS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCJhbm9ueW1vdXMiKSkgew0KICAgICAgICAgICAgICAgICAgICAgIHMuYW5vbkMrKzsNCiAgICAgICAgICAgICAgICAgICAgICBzLmFub25BICs9IGFtdDsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmICghZlsyXT8udHJpbSgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgcy5ub05hbWVDKys7DQogICAgICAgICAgICAgICAgICAgICAgcy5ub05hbWVBICs9IGFtdDsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmICghZlszXT8udHJpbSgpKSB7DQogICAgICAgICAgICAgICAgICAgICAgcy5ub1Bob25lQysrOw0KICAgICAgICAgICAgICAgICAgICAgIHMubm9QaG9uZUEgKz0gYW10Ow0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgaWYgKCFmWzZdPy50cmltKCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICBzLm5vUGFuQysrOw0KICAgICAgICAgICAgICAgICAgICAgIHMubm9QYW5BICs9IGFtdDsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGlmIChmWzEyXT8udG9VcHBlckNhc2UoKS5pbmNsdWRlcygiQ09SUFVTIikgJiYgZlsxOF0/LnRvVXBwZXJDYXNlKCkgIT09ICJZRVMiKSB7DQogICAgICAgICAgICAgICAgICAgICAgcy5wZW5kQ29ycEMrKzsNCiAgICAgICAgICAgICAgICAgICAgICBzLnBlbmRDb3JwQSArPSBhbXQ7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBsZXQgbGJsID0gKHNZZWFyID09PSAiYWxsIikgPyB5IDogbW9uWyhtICsgOCkgJSAxMl07DQogICAgICAgICAgICAgICAgICBzLnRyZW5kW2xibF0gPSAocy50cmVuZFtsYmxdIHx8IDApICsgYW10Ow0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgbGV0IGggPSBgPGRpdiBzdHlsZT0iYmFja2dyb3VuZDp3aGl0ZTsgcGFkZGluZzoxMHB4OyBib3JkZXItcmFkaXVzOjEwcHg7Ij48dGFibGUgY2xhc3M9InN1bS10YWJsZSI+PHRoZWFkPjx0cj48dGg+SXRlbTwvdGg+PHRoPkRvbm9yczwvdGg+PHRoPkFtb3VudDwvdGg+PC90cj48L3RoZWFkPjx0ciBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsiPjx0ZD5Ub3RhbDwvdGQ+PHRkPiR7cy50Q250fTwvdGQ+PHRkPiR7cy50QW10LnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvdGQ+PC90cj48dHIgY2xhc3M9InNlY3Rpb24taGRyIj48dGQgY29sc3Bhbj0iMyI+VG93YXJkczwvdGQ+PC90cj5gOw0KICAgICAgICAgICAgICBmb3IgKGxldCB0IGluIHMudG93YXJkcykgaCArPSBgPHRyPjx0ZD4ke3R9PC90ZD48dGQ+JHtzLnRvd2FyZHNbdF0uY308L3RkPjx0ZD4ke3MudG93YXJkc1t0XS5hLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvdGQ+PC90cj5gOw0KICAgICAgICAgICAgICBoICs9IGA8dHIgY2xhc3M9InNlY3Rpb24taGRyIj48dGQgY29sc3Bhbj0iMyI+TW9kZTwvdGQ+PC90cj5gOw0KICAgICAgICAgICAgICBmb3IgKGxldCBtIGluIHMubW9kZSkgaCArPSBgPHRyPjx0ZD4ke219PC90ZD48dGQ+JHtzLm1vZGVbbV0uY308L3RkPjx0ZD4ke3MubW9kZVttXS5hLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvdGQ+PC90cj5gOw0KICAgICAgICAgICAgICBoICs9IGA8dHIgY2xhc3M9InNlY3Rpb24taGRyIj48dGQgY29sc3Bhbj0iMyI+QW5hbHl0aWNzPC90ZD48L3RyPjx0cj48dGQ+QW5vbnltb3VzPC90ZD48dGQ+JHtzLmFub25DfTwvdGQ+PHRkPiR7cy5hbm9uQS50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPjwvdHI+PHRyPjx0ZD5QZW5kaW5nIENvbnNlbnQ8L3RkPjx0ZD4ke3MucGVuZENvcnBDfTwvdGQ+PHRkPiR7cy5wZW5kQ29ycEEudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD48L3RyPjx0cj48dGQ+Tk8gTkFNRTwvdGQ+PHRkPiR7cy5ub05hbWVDfTwvdGQ+PHRkPiR7cy5ub05hbWVBLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvdGQ+PC90cj48dHI+PHRkPk5PIFBIT05FPC90ZD48dGQ+JHtzLm5vUGhvbmVDfTwvdGQ+PHRkPiR7cy5ub1Bob25lQS50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPjwvdHI+PHRyPjx0ZD5OTyBQQU48L3RkPjx0ZD4ke3Mubm9QYW5DfTwvdGQ+PHRkPiR7cy5ub1BhbkEudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD48L3RyPjwvdGFibGU+PGRpdiBjbGFzcz0iY2hhcnQtd3JhcHBlciI+PGRpdiBjbGFzcz0iY2hhcnQtY29udGFpbmVyIj48Y2FudmFzIGlkPSJjMSI+PC9jYW52YXM+PC9kaXY+PGRpdiBjbGFzcz0iY2hhcnQtY29udGFpbmVyIj48Y2FudmFzIGlkPSJjMiI+PC9jYW52YXM+PC9kaXY+PGRpdiBjbGFzcz0iY2hhcnQtY29udGFpbmVyIj48Y2FudmFzIGlkPSJjMyI+PC9jYW52YXM+PC9kaXY+PC9kaXY+PC9kaXY+YDsNCiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbGVkUmVzdWx0cycpLmlubmVySFRNTCA9IGg7DQogICAgICAgICAgICAgIGFjdGl2ZUNoYXJ0cy5wdXNoKG5ldyBDaGFydChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYzEnKSwgeyB0eXBlOiAnYmFyJywgZGF0YTogeyBsYWJlbHM6IE9iamVjdC5rZXlzKHMudHJlbmQpLCBkYXRhc2V0czogW3sgbGFiZWw6ICdUcmVuZCcsIGRhdGE6IE9iamVjdC52YWx1ZXMocy50cmVuZCksIGJhY2tncm91bmRDb2xvcjogJyMwMDAwOEInIH1dIH0gfSkpOw0KICAgICAgICAgICAgICBhY3RpdmVDaGFydHMucHVzaChuZXcgQ2hhcnQoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2MyJyksIHsgdHlwZTogJ3BpZScsIGRhdGE6IHsgbGFiZWxzOiBPYmplY3Qua2V5cyhzLm1vZGUpLCBkYXRhc2V0czogW3sgZGF0YTogT2JqZWN0LnZhbHVlcyhzLm1vZGUpLm1hcCh4ID0+IHguYSksIGJhY2tncm91bmRDb2xvcjogWycjRkY2Mzg0JywgJyMzNkEyRUInLCAnI0ZGQ0U1NicsICcjNEJDMEMwJ10gfV0gfSB9KSk7DQogICAgICAgICAgICAgIGFjdGl2ZUNoYXJ0cy5wdXNoKG5ldyBDaGFydChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYzMnKSwgeyB0eXBlOiAncGllJywgZGF0YTogeyBsYWJlbHM6IE9iamVjdC5rZXlzKHMudG93YXJkcyksIGRhdGFzZXRzOiBbeyBkYXRhOiBPYmplY3QudmFsdWVzKHMudG93YXJkcykubWFwKHggPT4geC5hKSwgYmFja2dyb3VuZENvbG9yOiBbJyM5OTY2RkYnLCAnIzRCQzBDMCcsICcjRkY5RjQwJywgJyNGRjYzODQnLCAnIzM2QTJFQiddIH1dIH0gfSkpOw0KICAgICAgICAgICAgICB0b2dnbGVTY3JvbGxCdXR0b25zKHRydWUpOw0KDQogICAgICAgICAgfQ0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogTWFpbiBTZWFyY2ggRW5naW5lOiBGZXRjaGVzIHRoZSBtYXN0ZXIgZGF0YWJhc2UgYW5kIGFwcGxpZXMgdXNlci1kZWZpbmVkDQogICAgICAgICAgICogZmlsdGVycyAoWWVhciwgU2VhcmNoIFRlcm1zKSB0byBkaXNwbGF5IG1hdGNoaW5nIHJlY29yZHMgaW4gYSBkZXRhaWxlZCBsaXN0IGZvcm1hdC4NCiAgICAgICAgICAgKi8NCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIGZldGNoQW5kU2VhcmNoKCkgew0KICAgICAgICAgICAgICBjb25zdCBxUmF3ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaElucHV0JykudmFsdWUudHJpbSgpOw0KICAgICAgICAgICAgICBpZiAoIXFSYXcpIHJldHVybjsNCiAgICAgICAgICAgICAgY29uc3Qgc1llYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJ5ZWFyRmlsdGVyIl06Y2hlY2tlZCcpLnZhbHVlOw0KICAgICAgICAgICAgICBjb25zdCBpc051bWVyaWNTZWFyY2ggPSAvXlxkKyQvLnRlc3QocVJhdy5yZXBsYWNlKC9cRC9nLCAnJykpOw0KICAgICAgICAgICAgICBjbGVhcldvcmtzcGFjZSgpOw0KICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChEQVRBX1VSTCk7DQogICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICAgICAgICBjb25zdCByZWNzID0gdGV4dC5zcGxpdCgnXG4nKTsNCiAgICAgICAgICAgICAgbGV0IHRyID0gIiIsIGRldCA9ICIiLCBzYyA9IDAsIHNhID0gMCwgbGF0ZXN0UmVjID0gbnVsbCwgbGF0ZXN0RGF0ZSA9IG5ldyBEYXRlKDApLCBwZW5kaW5nQ29uc2VudHMgPSBbXTsNCiAgICAgICAgICAgICAgZm9yIChsZXQgciBvZiByZWNzKSB7DQogICAgICAgICAgICAgICAgICBjb25zdCBldmFsID0gZXZhbHVhdGVMb2dpYyhyLnRvTG93ZXJDYXNlKCksIHFSYXcpOw0KICAgICAgICAgICAgICAgICAgaWYgKGV2YWwubWF0Y2hlcykgew0KICAgICAgICAgICAgICAgICAgICAgIGxldCBmID0gci5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgICAgICAgIGlmIChmLmxlbmd0aCA8IDIwKSBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjZCA9IHBhcnNlRGF0ZShmWzFdKSwgZFAgPSBmWzFdLnNwbGl0KC9bLS9dLyksIG1tID0gcGFyc2VJbnQoZFBbMV0pLCB5eSA9IHBhcnNlSW50KGRQWzJdKTsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoKHNZZWFyID09PSAiYWxsIikgfHwgKCh5eSA9PT0gcGFyc2VJbnQoc1llYXIpICYmIG1tID49IDQpIHx8ICh5eSA9PT0gcGFyc2VJbnQoc1llYXIpICsgMSAmJiBtbSA8PSAzKSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNDID0gKGZbMTNdPy50cmltKCkudG9VcHBlckNhc2UoKSA9PT0gIllFUyIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBzYysrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzQykgc2EgKz0gcGFyc2VGbG9hdChmWzldKSB8fCAwOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzQyAmJiBmWzEyXT8udG9VcHBlckNhc2UoKS5pbmNsdWRlcygiQ09SUFVTIikgJiYgZlsxOF0/LnRvVXBwZXJDYXNlKCkgIT09ICJZRVMiIHx8IGZbMF0uc3RhcnRzV2l0aCgiR1ciKSkgcGVuZGluZ0NvbnNlbnRzLnB1c2goeyBudW06IGZbMF0sIGZ5OiBnZXRGWShmWzFdKSB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTnVtZXJpY1NlYXJjaCAmJiBjZCA+IGxhdGVzdERhdGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhdGVzdERhdGUgPSBjZDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhdGVzdFJlYyA9IGY7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmNwdExpbmsgPSBgPHNwYW4gY2xhc3M9InJjcHQtbGluayIgb25jbGljaz0ianVtcFRvUmVjZWlwdCgnJHtmWzBdfScpIj4ke2hpZ2hsaWdodFRleHQoZlswXSwgZXZhbC50ZXJtcyl9PC9zcGFuPmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpc051bWVyaWNTZWFyY2gpIHRyICs9IGA8dHIgY2xhc3M9IiR7aXNDID8gJ2NhbmNlbGxlZC1yb3cnIDogJyd9Ij48dGQ+JHtyY3B0TGlua308L3RkPjx0ZD4ke2ZbMV19PC90ZD48dGQ+JHtoaWdobGlnaHRUZXh0KGZbMl0sIGV2YWwudGVybXMpfTwvdGQ+PHRkPiR7aGlnaGxpZ2h0VGV4dChmWzEyXSwgZXZhbC50ZXJtcyl9PC90ZD48dGQ+4oK5JHtmWzldfTwvdGQ+PC90cj5gOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZmxkID0gIiI7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgVElUTEVTLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdmFsID0gKGkgPT09IDApID8gcmNwdExpbmsgOiBoaWdobGlnaHRUZXh0KGZbaV0gfHwgIi0tLSIsIGV2YWwudGVybXMpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmxkICs9IGA8ZGl2IGNsYXNzPSJmaWVsZC1yb3ciPjxzcGFuIGNsYXNzPSJmaWVsZC1oZWFkZXIiPiR7VElUTEVTW2ldfTo8L3NwYW4+PHNwYW4gY2xhc3M9ImZpZWxkLXZhbCI+JHt2YWx9PC9zcGFuPjwvZGl2PmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgZGV0ICs9IGA8ZGl2IGNsYXNzPSJyZWNvcmQgJHtpc0MgPyAnY2FuY2VsbGVkLXJvdycgOiAnJ30iPiR7ZmxkfTwvZGl2PmA7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGxldCBhZGRyZXNzQm94SHRtbCA9ICIiOw0KICAgICAgICAgICAgICBpZiAoaXNOdW1lcmljU2VhcmNoICYmIGxhdGVzdFJlYykgew0KICAgICAgICAgICAgICAgICAgbGV0IGNvbnNlbnRMaW5lcyA9IHBlbmRpbmdDb25zZW50cy5tYXAoYyA9PiBgJHtjLm51bX0gPHNwYW4gY2xhc3M9ImNvbnNlbnQtZnktYmx1ZSI+WyR7Yy5meX1dPC9zcGFuPmApLmpvaW4oJywgJyk7DQogICAgICAgICAgICAgICAgICBhZGRyZXNzQm94SHRtbCA9IGA8ZGl2IGNsYXNzPSJsYXRlc3QtYWRkci1ib3giPjxzcGFuIGNsYXNzPSJsYXRlc3QtYWRkci1oZWFkZXIiPkxhdGVzdCBBZGRyZXNzPC9zcGFuPjxiPk5hbWU6PC9iPiAke2xhdGVzdFJlY1syXX08YnI+PGI+QWRkcmVzczo8L2I+ICR7bGF0ZXN0UmVjWzRdLnJlcGxhY2UoL34vZywgJywgJyl9PGJyPjxiPlBpbmNvZGU6PC9iPiAke2xhdGVzdFJlY1sxNV0gfHwgIi0tLSJ9PGJyPjxiPlBob25lOjwvYj4gJHtsYXRlc3RSZWNbM119JHtwZW5kaW5nQ29uc2VudHMubGVuZ3RoID4gMCA/IGA8ZGl2IGNsYXNzPSJwZW5kaW5nLWNvbnNlbnQtbGluZSI+UGVuZGluZyBDb25zZW50IExldHRlcnM6ICR7Y29uc2VudExpbmVzfTwvZGl2PmAgOiAnJ308L2Rpdj5gOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdudW1lcmljUmVzdWx0cycpLmlubmVySFRNTCA9IGFkZHJlc3NCb3hIdG1sICsgKGlzTnVtZXJpY1NlYXJjaCAmJiB0ciA/IGA8ZGl2IGNsYXNzPSJ0YWJsZS13cmFwIj48dGFibGU+PHRyPjx0aD5Oby48L3RoPjx0aD5EYXRlPC90aD48dGg+TmFtZTwvdGg+PHRoPlRvd2FyZHM8L3RoPjx0aD5BbW91bnQ8L3RoPjwvdHI+JHt0cn08L3RhYmxlPjwvZGl2PmAgOiAiIik7DQogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxlZFJlc3VsdHMnKS5pbm5lckhUTUwgPSBkZXQgfHwgIk5vIHJlY29yZHMgZm91bmQuIjsNCiAgICAgICAgICAgICAgY29uc3QgYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2hTdW1tYXJ5QmFyJyk7DQogICAgICAgICAgICAgIHRvZ2dsZVNjcm9sbEJ1dHRvbnModHJ1ZSk7DQogICAgICAgICAgICAgIGIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICAgIGIuaW5uZXJIVE1MID0gYEZvdW5kOiAke3NjfSB8IFRvdGFsOiDigrkke3NhLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfWA7DQogICAgICAgICAgICAgIHRvZ2dsZVNjcm9sbEJ1dHRvbnModHJ1ZSk7DQoNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBBbm9ueW1vdXMgRmlsdGVyOiBJc29sYXRlcyBhbmQgdG90YWxzIGFsbCBkb25hdGlvbnMgbWFya2VkIGFzICdBbm9ueW1vdXMnDQogICAgICAgICAgICogdG8gZW5zdXJlIHRoZXkgYXJlIGhhbmRsZWQgYWNjb3JkaW5nIHRvIHRydXN0IGFjY291bnRpbmcgc3RhbmRhcmRzLg0KICAgICAgICAgICAqLw0KDQoNCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJ1bkFub255bW91cygpIHsNCiAgICAgICAgICAgICAgY2xlYXJXb3Jrc3BhY2UoKTsNCg0KICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZEZZID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKS52YWx1ZTsNCiAgICAgICAgICAgICAgY29uc3QgZnlMYWJlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InllYXJGaWx0ZXIiXTpjaGVja2VkJykucGFyZW50RWxlbWVudC5pbm5lclRleHQudHJpbSgpOw0KICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5VGl0bGUgPSBzZWxlY3RlZEZZID09PSAnYWxsJyA/ICdBbGwgWWVhcnMnIDogZnlMYWJlbDsNCg0KICAgICAgICAgICAgICBjb25zdCBzWWVhciA9IHNlbGVjdGVkRlk7DQogICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKERBVEFfVVJMKTsNCiAgICAgICAgICAgICAgY29uc3QgcmVjcyA9IChhd2FpdCByZXMudGV4dCgpKS5zcGxpdCgnXG4nKTsNCg0KICAgICAgICAgICAgICBsZXQgYW5vbkxpc3QgPSBbXSwgc2MgPSAwLCBzYSA9IDA7DQoNCiAgICAgICAgICAgICAgLy8gMS4gUFJPQ0VTUyBEQVRBDQogICAgICAgICAgICAgIHJlY3MuZm9yRWFjaChyID0+IHsNCiAgICAgICAgICAgICAgICAgIGxldCBmID0gci5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgICAgaWYgKGYubGVuZ3RoIDwgMTMgfHwgKGZbMTNdPy50cmltKCkudG9VcHBlckNhc2UoKSA9PT0gIllFUyIpKSByZXR1cm47DQogICAgICAgICAgICAgICAgICBjb25zdCBkUCA9IGZbMV0uc3BsaXQoL1stL10vKSwgbW0gPSBwYXJzZUludChkUFsxXSksIHl5ID0gcGFyc2VJbnQoZFBbMl0pOw0KDQogICAgICAgICAgICAgICAgICBpZiAoKHNZZWFyID09PSAiYWxsIikgfHwgKCh5eSA9PT0gcGFyc2VJbnQoc1llYXIpICYmIG1tID49IDQpIHx8ICh5eSA9PT0gcGFyc2VJbnQoc1llYXIpICsgMSAmJiBtbSA8PSAzKSkpIHsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWZbMl0udHJpbSgpIHx8IGZbMl0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygiYW5vbnltb3VzIikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFtdCA9IHBhcnNlRmxvYXQoZls5XSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgc2MrKzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgc2EgKz0gYW10Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICBhbm9uTGlzdC5wdXNoKHsgcmNwdDogZlswXSwgZGF0ZTogZlsxXSwgYW10OiBhbXQsIHJlZjogZlsxMF0gfHwgIi0tLSIgfSk7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICBhbm9uTGlzdC5zb3J0KChhLCBiKSA9PiBiLmFtdCAtIGEuYW10KTsNCg0KICAgICAgICAgICAgICBjb25zdCB0YWJsZUhlYWRlciA9IGA8dHI+PHRoPlJlY2VpcHQ8L3RoPjx0aD5EYXRlPC90aD48dGg+QW1vdW50PC90aD48dGg+UmVmPC90aD48L3RyPmA7DQoNCiAgICAgICAgICAgICAgLy8gMi4gR0VORVJBVEUgUk9XUyBGT1IgVEFCTEUgMTogQ0hFUVVFDQogICAgICAgICAgICAgIGxldCB0ckNocSA9ICIiOw0KICAgICAgICAgICAgICBhbm9uTGlzdC5mb3JFYWNoKHJlYyA9PiB7DQogICAgICAgICAgICAgICAgICBpZiAocmVjLnJlZi50b1VwcGVyQ2FzZSgpLmluY2x1ZGVzKCJDSFEiKSkgew0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJjcHRMaW5rID0gYDxzcGFuIGNsYXNzPSJyY3B0LWxpbmsiIG9uY2xpY2s9Imp1bXBUb1JlY2VpcHQoJyR7cmVjLnJjcHR9JykiPiR7cmVjLnJjcHR9PC9zcGFuPmA7DQogICAgICAgICAgICAgICAgICAgICAgdHJDaHEgKz0gYDx0ciBjbGFzcz0iJHtyZWMucmNwdC50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIkdXIikgPyAnZ3ctcm93JyA6ICcnfSI+PHRkPiR7cmNwdExpbmt9PC90ZD48dGQ+JHtyZWMuZGF0ZX08L3RkPjx0ZCBjbGFzcz0iYW10Ij7igrkke3JlYy5hbXQudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD48dGQ+JHtyZWMucmVmfTwvdGQ+PC90cj5gOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAvLyAzLiBHRU5FUkFURSBST1dTIEZPUiBUQUJMRSAyOiBVUEkgKyBQSE9ORQ0KICAgICAgICAgICAgICBsZXQgdHJVUEkgPSAiIjsNCiAgICAgICAgICAgICAgYW5vbkxpc3QuZm9yRWFjaChyZWMgPT4gew0KICAgICAgICAgICAgICAgICAgY29uc3QgcmVmZXJlbmNlID0gcmVjLnJlZi50b1VwcGVyQ2FzZSgpOw0KICAgICAgICAgICAgICAgICAgaWYgKHJlZmVyZW5jZS5pbmNsdWRlcygiVVBJIikgJiYgL1wvXGR7MTB9XC8vLnRlc3QocmVmZXJlbmNlKSkgew0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJjcHRMaW5rID0gYDxzcGFuIGNsYXNzPSJyY3B0LWxpbmsiIG9uY2xpY2s9Imp1bXBUb1JlY2VpcHQoJyR7cmVjLnJjcHR9JykiPiR7cmVjLnJjcHR9PC9zcGFuPmA7DQogICAgICAgICAgICAgICAgICAgICAgdHJVUEkgKz0gYDx0ciBjbGFzcz0iJHtyZWMucmNwdC50b1VwcGVyQ2FzZSgpLnN0YXJ0c1dpdGgoIkdXIikgPyAnZ3ctcm93JyA6ICcnfSI+PHRkPiR7cmNwdExpbmt9PC90ZD48dGQ+JHtyZWMuZGF0ZX08L3RkPjx0ZCBjbGFzcz0iYW10Ij7igrkke3JlYy5hbXQudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD48dGQ+JHtyZWMucmVmfTwvdGQ+PC90cj5gOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAvLyA0LiBHRU5FUkFURSBST1dTIEZPUiBUQUJMRSAzOiBTVEFOREFSRA0KICAgICAgICAgICAgICBsZXQgdHJTdGFuZGFyZCA9ICIiOw0KICAgICAgICAgICAgICBhbm9uTGlzdC5mb3JFYWNoKHJlYyA9PiB7DQogICAgICAgICAgICAgICAgICBjb25zdCByY3B0TGluayA9IGA8c3BhbiBjbGFzcz0icmNwdC1saW5rIiBvbmNsaWNrPSJqdW1wVG9SZWNlaXB0KCcke3JlYy5yY3B0fScpIj4ke3JlYy5yY3B0fTwvc3Bhbj5gOw0KICAgICAgICAgICAgICAgICAgdHJTdGFuZGFyZCArPSBgPHRyIGNsYXNzPSIke3JlYy5yY3B0LnRvVXBwZXJDYXNlKCkuc3RhcnRzV2l0aCgiR1ciKSA/ICdndy1yb3cnIDogJyd9Ij48dGQ+JHtyY3B0TGlua308L3RkPjx0ZD4ke3JlYy5kYXRlfTwvdGQ+PHRkIGNsYXNzPSJhbXQiPuKCuSR7cmVjLmFtdC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPjx0ZD4ke3JlYy5yZWZ9PC90ZD48L3RyPmA7DQogICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgIC8vIDUuIEFTU0VNQkxFIEFMTCBUQUJMRVMNCiAgICAgICAgICAgICAgbGV0IGZpbmFsSHRtbCA9ICIiOw0KDQogICAgICAgICAgICAgIC8vIFRhYmxlIDE6IENoZXF1ZQ0KICAgICAgICAgICAgICBmaW5hbEh0bWwgKz0gYDxkaXYgY2xhc3M9ImJhbmstdGl0bGUiIHN0eWxlPSJtYXJnaW4tdG9wOjMwcHg7Ij5Bbm9ueW1vdXMgQ2hlcXVlIERvbm9yczwvZGl2PmA7DQogICAgICAgICAgICAgIGZpbmFsSHRtbCArPSBgPGRpdiBjbGFzcz0idGFibGUtd3JhcCI+PHRhYmxlPiR7dGFibGVIZWFkZXJ9JHt0ckNocSB8fCAnPHRyPjx0ZCBjb2xzcGFuPSI0IiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7Ij5ObyBDaGVxdWUgcmVjb3JkcyBmb3VuZC48L3RkPjwvdHI+J308L3RhYmxlPjwvZGl2PmA7DQoNCiAgICAgICAgICAgICAgZmluYWxIdG1sICs9IGA8aHIgc3R5bGU9Im1hcmdpbjogNDBweCAwOyBib3JkZXI6IDFweCBzb2xpZCB2YXIoLS1wcmltYXJ5LWJsdWUpOyI+YDsNCg0KICAgICAgICAgICAgICAvLyBUYWJsZSAyOiBVUEkgKyBQaG9uZQ0KICAgICAgICAgICAgICBmaW5hbEh0bWwgKz0gYDxkaXYgY2xhc3M9ImJhbmstdGl0bGUiIHN0eWxlPSJtYXJnaW4tdG9wOjMwcHg7Ij5Bbm9ueW1vdXMgVVBJIERvbm9ycyB3aXRoIFRlbGVwaG9uZSBOdW1iZXJzPC9kaXY+YDsNCiAgICAgICAgICAgICAgZmluYWxIdG1sICs9IGA8ZGl2IGNsYXNzPSJ0YWJsZS13cmFwIj48dGFibGU+JHt0YWJsZUhlYWRlcn0ke3RyVVBJIHx8ICc8dHI+PHRkIGNvbHNwYW49IjQiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsiPk5vIFVQSSBQaG9uZSByZWNvcmRzIGZvdW5kLjwvdGQ+PC90cj4nfTwvdGFibGU+PC9kaXY+YDsNCg0KICAgICAgICAgICAgICBmaW5hbEh0bWwgKz0gYDxociBzdHlsZT0ibWFyZ2luOiA0MHB4IDA7IGJvcmRlcjogMXB4IHNvbGlkIHZhcigtLXByaW1hcnktYmx1ZSk7Ij5gOw0KDQogICAgICAgICAgICAgIC8vIFRhYmxlIDM6IEZ1bGwgTGlzdA0KICAgICAgICAgICAgICBmaW5hbEh0bWwgKz0gYDxkaXYgY2xhc3M9ImJhbmstdGl0bGUiIHN0eWxlPSJtYXJnaW4tdG9wOjMwcHg7Ij5Bbm9ueW1vdXMgRG9ub3JzIGZvciBGaW5hbmNpYWwgWWVhciA6ICR7ZGlzcGxheVRpdGxlfTwvZGl2PmA7DQogICAgICAgICAgICAgIGZpbmFsSHRtbCArPSBgPGRpdiBjbGFzcz0idGFibGUtd3JhcCI+PHRhYmxlPiR7dGFibGVIZWFkZXJ9JHt0clN0YW5kYXJkIHx8ICc8dHI+PHRkIGNvbHNwYW49IjQiIHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsiPk5vIHJlY29yZHMgZm91bmQuPC90ZD48L3RyPid9PC90YWJsZT48L2Rpdj5gOw0KDQogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxlZFJlc3VsdHMnKS5pbm5lckhUTUwgPSBmaW5hbEh0bWw7DQoNCiAgICAgICAgICAgICAgY29uc3QgYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2hTdW1tYXJ5QmFyJyk7DQogICAgICAgICAgICAgIGIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICAgIGIuaW5uZXJIVE1MID0gYEFub255bW91czogJHtzY30gfCBUb3RhbDog4oK5JHtzYS50b0xvY2FsZVN0cmluZygnZW4tSU4nKX1gOw0KICAgICAgICAgICAgICB0b2dnbGVTY3JvbGxCdXR0b25zKHRydWUpOw0KICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIE1haWxpbmcgTGlzdCBHZW5lcmF0b3I6IENvbXBpbGVzIGEgdW5pcXVlIGxpc3Qgb2YgZG9ub3JzIHdpdGggdmFsaWQgYWRkcmVzc2VzDQogICAgICAgICAgICogZm9yIHRoZSBzZWxlY3RlZCB5ZWFyLCBzcGVjaWZpY2FsbHkgZXhjbHVkaW5nIHRob3NlIG1hcmtlZCBhcyAnQW5vbnltb3VzJy4NCiAgICAgICAgICAgKi8NCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJ1bkRvbm9yTGlzdCgpIHsNCiAgICAgICAgICAgICAgbGV0IHEgPSBwcm9tcHQoIlNlYXJjaCBEb25vcj8iLCAiIik7DQogICAgICAgICAgICAgIGlmIChxID09PSBudWxsKSByZXR1cm47DQogICAgICAgICAgICAgIGxldCBxUmF3ID0gcS50cmltKCkudG9Mb3dlckNhc2UoKTsNCiAgICAgICAgICAgICAgY2xlYXJXb3Jrc3BhY2UoKTsNCiAgICAgICAgICAgICAgY29uc3Qgc1llYXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJ5ZWFyRmlsdGVyIl06Y2hlY2tlZCcpLnZhbHVlOw0KICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChEQVRBX1VSTCk7DQogICAgICAgICAgICAgIGNvbnN0IHJlY3MgPSAoYXdhaXQgcmVzLnRleHQoKSkuc3BsaXQoJ1xuJyk7DQogICAgICAgICAgICAgIGxldCBkb25vcnMgPSB7fTsNCiAgICAgICAgICAgICAgcmVjcy5mb3JFYWNoKHIgPT4gew0KICAgICAgICAgICAgICAgICAgbGV0IGYgPSByLnNwbGl0KCd8Jyk7DQogICAgICAgICAgICAgICAgICBpZiAoZi5sZW5ndGggPCAyMCB8fCBmWzEzXT8udG9VcHBlckNhc2UoKSA9PT0gIllFUyIgfHwgZlswXS5zdGFydHNXaXRoKCJHVyIpKSByZXR1cm47DQogICAgICAgICAgICAgICAgICBjb25zdCBwaG9uZSA9IGZbM10/LnRyaW0oKSB8fCAiIjsNCiAgICAgICAgICAgICAgICAgIGlmIChwaG9uZS5zdGFydHNXaXRoKCI5OTk5OSIpIHx8IHBob25lLnN0YXJ0c1dpdGgoIjg4ODg4IikgfHwgIXBob25lKSByZXR1cm47DQogICAgICAgICAgICAgICAgICBjb25zdCBkUCA9IGZbMV0uc3BsaXQoL1stL10vKSwgbW0gPSBwYXJzZUludChkUFsxXSksIHl5ID0gcGFyc2VJbnQoZFBbMl0pOw0KICAgICAgICAgICAgICAgICAgaWYgKHNZZWFyICE9PSAiYWxsIiAmJiAhKCh5eSA9PT0gcGFyc2VJbnQoc1llYXIpICYmIG1tID49IDQpIHx8ICh5eSA9PT0gcGFyc2VJbnQoc1llYXIpICsgMSAmJiBtbSA8PSAzKSkpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIGlmIChxUmF3ICE9PSAiIiAmJiAhci50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHFSYXcpKSByZXR1cm47DQogICAgICAgICAgICAgICAgICBpZiAoIWRvbm9yc1twaG9uZV0pIGRvbm9yc1twaG9uZV0gPSB7IHBoOiBwaG9uZSwgY250OiAwLCBhbXQ6IDAsIGxhdGVzdDogbmV3IERhdGUoMCksIG5hbWU6ICIiLCBhZGRyOiAiIiB9Ow0KICAgICAgICAgICAgICAgICAgZG9ub3JzW3Bob25lXS5jbnQrKzsNCiAgICAgICAgICAgICAgICAgIGRvbm9yc1twaG9uZV0uYW10ICs9IHBhcnNlRmxvYXQoZls5XSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgIGxldCBkT2JqID0gcGFyc2VEYXRlKGZbMV0pOw0KICAgICAgICAgICAgICAgICAgaWYgKGRPYmogPiBkb25vcnNbcGhvbmVdLmxhdGVzdCkgew0KICAgICAgICAgICAgICAgICAgICAgIGRvbm9yc1twaG9uZV0ubGF0ZXN0ID0gZE9iajsNCiAgICAgICAgICAgICAgICAgICAgICBkb25vcnNbcGhvbmVdLm5hbWUgPSBmWzJdOw0KICAgICAgICAgICAgICAgICAgICAgIGRvbm9yc1twaG9uZV0uYWRkciA9IGZbNF0ucmVwbGFjZSgvfi9nLCAnLCAnKTsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgIGNvbnN0IHNvcnRlZCA9IE9iamVjdC52YWx1ZXMoZG9ub3JzKS5zb3J0KChhLCBiKSA9PiBiLmFtdCAtIGEuYW10KTsNCiAgICAgICAgICAgICAgbGV0IHRyID0gIiI7DQogICAgICAgICAgICAgIHNvcnRlZC5mb3JFYWNoKGQgPT4gew0KICAgICAgICAgICAgICAgICAgdHIgKz0gYDx0cj48dGQ+JHtkLnBofTxicj4ke2QuY250fSB0aW1lczxicj48Yj5Scy4gJHtkLmFtdC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L2I+PC90ZD48dGQ+PHNwYW4gc3R5bGU9ImNvbG9yOnZhcigtLXByaW1hcnktYmx1ZSk7IGZvbnQtd2VpZ2h0OmJvbGQ7Ij4ke2QubmFtZX08L3NwYW4+PGJyPiR7ZC5hZGRyfTwvdGQ+PC90cj5gOw0KICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbGVkUmVzdWx0cycpLmlubmVySFRNTCA9IHRyID8gYDxkaXYgY2xhc3M9InRhYmxlLXdyYXAiPjx0YWJsZT48dHI+PHRoPkRvbm9yIFN0YXRzPC90aD48dGg+TGF0ZXN0IERldGFpbHM8L3RoPjwvdHI+JHt0cn08L3RhYmxlPjwvZGl2PmAgOiAiTm8gZG9ub3JzIGZvdW5kLiI7DQogICAgICAgICAgICAgIGNvbnN0IGIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoU3VtbWFyeUJhcicpOw0KICAgICAgICAgICAgICBiLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snOw0KICAgICAgICAgICAgICBiLmlubmVySFRNTCA9IGBVbmlxdWUgRG9ub3JzOiAke3NvcnRlZC5sZW5ndGh9YDsNCiAgICAgICAgICAgICAgdG9nZ2xlU2Nyb2xsQnV0dG9ucyh0cnVlKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBGaW5hbmNpYWwgU3RhdGVtZW50czogUGVyZm9ybXMgYSBjcm9zcy1maWxlIGFuYWx5c2lzIGJldHdlZW4gSW5jb21lIChNTVBUMikNCiAgICAgICAgICAgKiBhbmQgRXhwZW5zZXMgKEV4Y2VsKSB0byBnZW5lcmF0ZSBhIFByb2ZpdCAmIExvc3Mgc3R5bGUgdmlldyBmb3IgdGhlIEZpbmFuY2lhbCBZZWFyLg0KICAgICAgICAgICAqLw0KDQogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gcnVuQWNjb3VudHMoKSB7DQogICAgICAgICAgICAgIGNsZWFyV29ya3NwYWNlKCk7DQogICAgICAgICAgICAgIGNvbnN0IHNZZWFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKS52YWx1ZTsNCiAgICAgICAgICAgICAgY29uc3QgZnlMYWJlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InllYXJGaWx0ZXIiXTpjaGVja2VkJykucGFyZW50RWxlbWVudC5pbm5lclRleHQudHJpbSgpOw0KDQogICAgICAgICAgICAgIC8vIDEuIEZldGNoIERvbmF0aW9uIERhdGENCiAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goREFUQV9VUkwpOw0KICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTsNCiAgICAgICAgICAgICAgY29uc3QgcmVjcyA9IHRleHQuc3BsaXQoJ1xuJyk7DQogICAgICAgICAgICAgIGxldCBjb3JwdXNDb3VudCA9IDAsIGNvcnB1c1RvdGFsID0gMCwgbm9uQ29ycHVzQ291bnQgPSAwLCBub25Db3JwdXNUb3RhbCA9IDA7DQogICAgICAgICAgICAgIGxldCB0b3RhbERvbmF0aW9uQ291bnQgPSAwLCB0b3RhbERvbmF0aW9uQW1vdW50ID0gMDsNCg0KICAgICAgICAgICAgICByZWNzLmZvckVhY2gociA9PiB7DQogICAgICAgICAgICAgICAgICBsZXQgZiA9IHIuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICAgIGlmIChmLmxlbmd0aCA8IDEzIHx8IGZbMTNdPy50cmltKCkudG9VcHBlckNhc2UoKSA9PT0gIllFUyIpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRQID0gZlsxXS5zcGxpdCgvWy0vXS8pOw0KICAgICAgICAgICAgICAgICAgY29uc3QgbW0gPSBwYXJzZUludChkUFsxXSksIHl5ID0gcGFyc2VJbnQoZFBbMl0pOw0KICAgICAgICAgICAgICAgICAgY29uc3QgaW5ZZWFyID0gKHNZZWFyID09PSAiYWxsIikgfHwgKCh5eSA9PT0gcGFyc2VJbnQoc1llYXIpICYmIG1tID49IDQpIHx8ICh5eSA9PT0gcGFyc2VJbnQoc1llYXIpICsgMSAmJiBtbSA8PSAzKSk7DQogICAgICAgICAgICAgICAgICBpZiAoaW5ZZWFyKSB7DQogICAgICAgICAgICAgICAgICAgICAgbGV0IGFtdCA9IHBhcnNlRmxvYXQoZls5XSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgdG93YXJkcyA9IChmWzEyXSB8fCAiIikudHJpbSgpLnRvVXBwZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKHRvd2FyZHMgPT09ICJDT1JQVVMiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvcnB1c0NvdW50Kys7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvcnB1c1RvdGFsICs9IGFtdDsNCiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICBub25Db3JwdXNDb3VudCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBub25Db3JwdXNUb3RhbCArPSBhbXQ7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIHRvdGFsRG9uYXRpb25Db3VudCsrOw0KICAgICAgICAgICAgICAgICAgICAgIHRvdGFsRG9uYXRpb25BbW91bnQgKz0gYW10Ow0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAvLyAyLiBGZXRjaCBJbnRlcmVzdCBEYXRhDQogICAgICAgICAgICAgIGNvbnN0IGJhbmtSZXMgPSBhd2FpdCBmZXRjaChCQU5LX05FV19VUkwpOw0KICAgICAgICAgICAgICBjb25zdCBiYW5rTGluZXMgPSAoYXdhaXQgYmFua1Jlcy50ZXh0KCkpLnNwbGl0KCdcbicpOw0KICAgICAgICAgICAgICBsZXQgaW50ZXJlc3RDb3VudCA9IDAsIGludGVyZXN0VG90YWwgPSAwOw0KDQogICAgICAgICAgICAgIGJhbmtMaW5lcy5mb3JFYWNoKGxpbmUgPT4gew0KICAgICAgICAgICAgICAgICAgbGV0IGYgPSBsaW5lLnNwbGl0KCd8Jyk7DQogICAgICAgICAgICAgICAgICBpZiAoZi5sZW5ndGggPCA1KSByZXR1cm47DQogICAgICAgICAgICAgICAgICBjb25zdCBkZXNjID0gKGZbMV0gfHwgIiIpLnRvVXBwZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICBjb25zdCBjciA9IHBhcnNlRmxvYXQoZls0XSkgfHwgMDsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRPYmogPSBwYXJzZURhdGUoZlswXSk7DQoNCiAgICAgICAgICAgICAgICAgIGxldCBpblllYXIgPSAoc1llYXIgPT09ICJhbGwiKTsNCiAgICAgICAgICAgICAgICAgIGlmICghaW5ZZWFyKSB7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgZnlTID0gcGFyc2VJbnQoc1llYXIpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBkT2JqLmdldE1vbnRoKCkgKyAxLCB5ID0gZE9iai5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgICAgICAgICAgICAgIGluWWVhciA9ICh5ID09PSBmeVMgJiYgbSA+PSA0KSB8fCAoeSA9PT0gZnlTICsgMSAmJiBtIDw9IDMpOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgaWYgKGluWWVhciAmJiAoZGVzYy5pbmNsdWRlcygiSU5URVJFU1QiKSB8fCBkZXNjLmluY2x1ZGVzKCJJTlQgVFJGIEZSTSIpKSAmJiBjciA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICBpbnRlcmVzdENvdW50Kys7DQogICAgICAgICAgICAgICAgICAgICAgaW50ZXJlc3RUb3RhbCArPSBjcjsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgY29uc3QgY29tYmluZWRJbmNvbWVDb3VudCA9IHRvdGFsRG9uYXRpb25Db3VudCArIGludGVyZXN0Q291bnQ7DQogICAgICAgICAgICAgIGNvbnN0IGNvbWJpbmVkSW5jb21lVG90YWwgPSB0b3RhbERvbmF0aW9uQW1vdW50ICsgaW50ZXJlc3RUb3RhbDsNCg0KICAgICAgICAgICAgICAvLyBTdGFydCBCdWlsZGluZyBIVE1MDQogICAgICAgICAgICAgIGxldCBoID0gYDxkaXYgc3R5bGU9ImJhY2tncm91bmQ6d2hpdGU7IHBhZGRpbmc6MTVweDsgYm9yZGVyLXJhZGl1czoxMHB4OyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgyIHN0eWxlPSJjb2xvcjp2YXIoLS1wcmltYXJ5LWJsdWUpOyBtYXJnaW4tdG9wOjA7Ij5BY2NvdW50cyBmb3IgdGhlIEZpbmFuY2lhbCBZZWFyIDogJHtmeUxhYmVsfTwvaDI+DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgc3R5bGU9ImNvbG9yOnZhcigtLWRhcmstdGV4dCk7IG1hcmdpbi1ib3R0b206NXB4OyI+SW5jb21lIGR1cmluZyBGaW5hbmNpYWwgWWVhciA6ICR7ZnlMYWJlbH08L2gzPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBzdHlsZT0iY29sb3I6dmFyKC0tdmlicmFudC1ibHVlKTsgbWFyZ2luLWJvdHRvbToxMHB4OyI+SW5jb21lIGJ5IERvbmF0aW9ucyA6PC9oND4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9InN1bS10YWJsZSIgc3R5bGU9Im1hcmdpbi1ib3R0b206MjBweDsiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQ+PHRyPjx0aD5JdGVtPC90aD48dGg+RG9ub3JzPC90aD48dGg+QW1vdW50PC90aD48L3RyPjwvdGhlYWQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0Ym9keT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0cj48dGQ+Q29ycHVzIERvbmF0aW9uczwvdGQ+PHRkPiR7Y29ycHVzQ291bnR9PC90ZD48dGQgY2xhc3M9ImFtdCI+4oK5JHtjb3JwdXNUb3RhbC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPjwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHI+PHRkPk5vbiBDb3JwdXMgRG9uYXRpb25zPC90ZD48dGQ+JHtub25Db3JwdXNDb3VudH08L3RkPjx0ZCBjbGFzcz0iYW10Ij7igrkke25vbkNvcnB1c1RvdGFsLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvdGQ+PC90cj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz0idG90YWwtaGlnaGxpZ2h0LXJvdyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkPlRvdGFsIERvbmF0aW9uczwvdGQ+PHRkPiR7dG90YWxEb25hdGlvbkNvdW50fTwvdGQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJhbXQiPuKCuSR7dG90YWxEb25hdGlvbkFtb3VudC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RhYmxlPg0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGg0IHN0eWxlPSJjb2xvcjp2YXIoLS12aWJyYW50LWJsdWUpOyBtYXJnaW4tYm90dG9tOjEwcHg7Ij5JbmNvbWUgYnkgSW50ZXJlc3QgOjwvaDQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPSJzdW0tdGFibGUiIHN0eWxlPSJtYXJnaW4tYm90dG9tOjIwcHg7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoZWFkPjx0cj48dGg+SXRlbTwvdGg+PHRoPkNvdW50PC90aD48dGg+QW1vdW50PC90aD48L3RyPjwvdGhlYWQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0Ym9keT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ciBjbGFzcz0idG90YWwtaGlnaGxpZ2h0LXJvdyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkPlRvdGFsIEludGVyZXN0IEVhcm5lZDwvdGQ+PHRkPiR7aW50ZXJlc3RDb3VudH08L3RkPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBjbGFzcz0iYW10Ij7igrkke2ludGVyZXN0VG90YWwudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90YWJsZT4NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBzdHlsZT0iY29sb3I6dmFyKC0tdmlicmFudC1ibHVlKTsgbWFyZ2luLWJvdHRvbToxMHB4OyI+VG90YWwgSW5jb21lIDo8L2g0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0YWJsZSBjbGFzcz0ic3VtLXRhYmxlIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoZWFkPjx0cj48dGg+SXRlbXM8L3RoPjx0aD5Db3VudDwvdGg+PHRoPkFtb3VudDwvdGg+PC90cj48L3RoZWFkPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGJvZHk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHI+PHRkPkJ5IERvbmF0aW9uczwvdGQ+PHRkPiR7dG90YWxEb25hdGlvbkNvdW50fTwvdGQ+PHRkIGNsYXNzPSJhbXQiPuKCuSR7dG90YWxEb25hdGlvbkFtb3VudC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPjwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHI+PHRkPkJ5IEludGVyZXN0PC90ZD48dGQ+JHtpbnRlcmVzdENvdW50fTwvdGQ+PHRkIGNsYXNzPSJhbXQiPuKCuSR7aW50ZXJlc3RUb3RhbC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPjwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHIgY2xhc3M9InRvdGFsLWhpZ2hsaWdodC1yb3ciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD5Ub3RhbCBJbmNvbWU8L3RkPjx0ZD4ke2NvbWJpbmVkSW5jb21lQ291bnR9PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImFtdCI+4oK5JHtjb21iaW5lZEluY29tZVRvdGFsLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvdGQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3Rib2R5Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGFibGU+YDsNCg0KICAgICAgICAgICAgICAvLyBWYXJpYWJsZXMgZm9yIEFuYWx5c2lzDQogICAgICAgICAgICAgIGNvbnN0IHRvdGFsQWxsb3dlZFNwZW5kID0gbm9uQ29ycHVzVG90YWwgKyBpbnRlcmVzdFRvdGFsOw0KICAgICAgICAgICAgICBjb25zdCB0b3RhbEFsbG93ZWRDb3VudCA9IG5vbkNvcnB1c0NvdW50ICsgaW50ZXJlc3RDb3VudDsNCg0KICAgICAgICAgICAgICAvLyAzLiBGZXRjaCBFeHBlbnNlIERhdGEgKEFuYWx5c2lzICYgQmFsYW5jZSBTaGVldCkNCiAgICAgICAgICAgICAgaWYgKHNZZWFyICE9PSAiYWxsIiAmJiBwYXJzZUludChzWWVhcikgPj0gMjAyNCkgew0KICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleHBSZXMgPSBhd2FpdCBmZXRjaChFWFBFTlNFU19VUkwpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHdiID0gWExTWC5yZWFkKG5ldyBVaW50OEFycmF5KGF3YWl0IGV4cFJlcy5hcnJheUJ1ZmZlcigpKSwgeyB0eXBlOiAnYXJyYXknIH0pOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBYTFNYLnV0aWxzLnNoZWV0X3RvX2pzb24od2IuU2hlZXRzW3diLlNoZWV0TmFtZXNbMF1dLCB7IGhlYWRlcjogMSB9KTsNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgZ2VuQ291bnQgPSAwLCBnZW5Ub3RhbCA9IDA7DQogICAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBkYXRhLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJvdyA9IGRhdGFbaV07DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcm93IHx8IHJvdy5sZW5ndGggPCAyKSBjb250aW51ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGRPYmogPSAodHlwZW9mIHJvd1swXSA9PT0gJ251bWJlcicpID8gWExTWC51dGlscy5zaGVldF90b19kYXRlKHJvd1swXSkgOiBwYXJzZURhdGUocm93WzBdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzTmFOKGRPYmouZ2V0VGltZSgpKSkgY29udGludWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtID0gZE9iai5nZXRNb250aCgpICsgMSwgeSA9IGRPYmouZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHJvd0ZZID0gKG0gPj0gNCkgPyB5LnRvU3RyaW5nKCkgOiAoeSAtIDEpLnRvU3RyaW5nKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyb3dGWSAhPT0gc1llYXIpIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgYW10ID0gcGFyc2VGbG9hdChyb3dbM10pIHx8IDAsIGRlc2MgPSAocm93WzRdIHx8IHJvd1sxXSB8fCAiIikudG9TdHJpbmcoKS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWRlc2MuaW5jbHVkZXMoImV4ZW1wdCIpICYmICFkZXNjLmluY2x1ZGVzKCJkZXBvc2l0IikgJiYgIWRlc2MuaW5jbHVkZXMoImxvYW4iKSAmJiAhZGVzYy5pbmNsdWRlcygiY2xvc3VyZSIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBnZW5Db3VudCsrOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZ2VuVG90YWwgKz0gYW10Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgaCArPSBgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGgzIHN0eWxlPSJjb2xvcjp2YXIoLS1kYXJrLXRleHQpOyBtYXJnaW4tdG9wOjMwcHg7IG1hcmdpbi1ib3R0b206NXB4OyI+RXhwZW5zZXMgZm9yIHRoZSBGaW5hbmNpYWwgWWVhciA6ICR7ZnlMYWJlbH08L2gzPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoNCBzdHlsZT0iY29sb3I6dmFyKC0tdmlicmFudC1ibHVlKTsgbWFyZ2luLWJvdHRvbToxMHB4OyI+R2VuZXJhbCBFeHBlbnNlcyA6PC9oND4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9InN1bS10YWJsZSI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aGVhZD48dHI+PHRoPkl0ZW1zPC90aD48dGg+Q291bnQ8L3RoPjx0aD5BbW91bnQ8L3RoPjwvdHI+PC90aGVhZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRib2R5Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPSJ0b3RhbC1oaWdobGlnaHQtcm93Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+VG90YWwgRXhwZW5zZXM8L3RkPjx0ZD4ke2dlbkNvdW50fTwvdGQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJhbXQiPuKCuSR7Z2VuVG90YWwudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90YWJsZT5gOw0KDQogICAgICAgICAgICAgICAgICAgICAgLy8gQmFsYW5jZSBTaGVldCBTZWN0aW9uDQogICAgICAgICAgICAgICAgICAgICAgbGV0IGJhbGFuY2UgPSBjb21iaW5lZEluY29tZVRvdGFsIC0gZ2VuVG90YWw7DQogICAgICAgICAgICAgICAgICAgICAgbGV0IGJhbGFuY2VUZXh0ID0gKGJhbGFuY2UgPj0gMCkgPw0KICAgICAgICAgICAgICAgICAgICAgICAgICBgPGRpdiBjbGFzcz0icHJvZml0LXRleHQiPlRydXN0IGluIFByb2ZpdCBmb3IgRmluYW5jaWFsIFllYXIgOiAke2Z5TGFiZWx9PC9kaXY+YCA6DQogICAgICAgICAgICAgICAgICAgICAgICAgIGA8ZGl2IGNsYXNzPSJsb3NzLXRleHQiPlRydXN0IGluIExvc3MgZm9yIEZpbmFuY2lhbCBZZWFyIDogJHtmeUxhYmVsfTwvZGl2PmA7DQoNCiAgICAgICAgICAgICAgICAgICAgICBoICs9IGANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgc3R5bGU9ImNvbG9yOnZhcigtLWRhcmstdGV4dCk7IG1hcmdpbi10b3A6MzBweDsgbWFyZ2luLWJvdHRvbTo1cHg7Ij5CYWxhbmNlIFNoZWV0IGZvciBGaW5hbmNpYWwgWWVhciA6ICR7ZnlMYWJlbH08L2gzPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0YWJsZSBjbGFzcz0ic3VtLXRhYmxlIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoZWFkPjx0cj48dGg+SXRlbXM8L3RoPjx0aD5Db3VudDwvdGg+PHRoPkFtb3VudDwvdGg+PC90cj48L3RoZWFkPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGJvZHk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHI+PHRkPkluY29tZTwvdGQ+PHRkPiR7Y29tYmluZWRJbmNvbWVDb3VudH08L3RkPjx0ZCBjbGFzcz0iYW10Ij7igrkke2NvbWJpbmVkSW5jb21lVG90YWwudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD48L3RyPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyPjx0ZD5FeHBlbnNlczwvdGQ+PHRkPiR7Z2VuQ291bnR9PC90ZD48dGQgY2xhc3M9ImFtdCI+4oK5JHtnZW5Ub3RhbC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPjwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHIgY2xhc3M9InRvdGFsLWhpZ2hsaWdodC1yb3ciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD5CYWxhbmNlIFNoZWV0PC90ZD48dGQ+PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImFtdCI+4oK5JHtiYWxhbmNlLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTwvdGQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RyPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3Rib2R5Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGFibGU+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtiYWxhbmNlVGV4dH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aHIgc3R5bGU9ImJvcmRlcjogMDsgYm9yZGVyLXRvcDogMnB4IHNvbGlkICNjY2M7IG1hcmdpbjogMjBweCAwOyI+YDsNCg0KICAgICAgICAgICAgICAgICAgICAgIC8vIEFOQUxZU0lTIFNFQ1RJT04NCiAgICAgICAgICAgICAgICAgICAgICBoICs9IGANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aDMgc3R5bGU9ImNvbG9yOnZhcigtLWRhcmstdGV4dCk7IG1hcmdpbi10b3A6MzBweDsgbWFyZ2luLWJvdHRvbTo1cHg7Ij5BbmFseXNpczwvaDM+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGg0IHN0eWxlPSJjb2xvcjp2YXIoLS12aWJyYW50LWJsdWUpOyBtYXJnaW4tYm90dG9tOjEwcHg7Ij5UcnVzdCBhbGxvd2VkIHRvIFNwZW5kIGR1cmluZyB0aGUgRmluYW5jaWFsIFllYXIgOiAke2Z5TGFiZWx9PC9oND4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGFibGUgY2xhc3M9InN1bS10YWJsZSIgc3R5bGU9Im1hcmdpbi1ib3R0b206MjBweDsiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQ+PHRyPjx0aD5JdGVtPC90aD48dGg+Q291bnQ8L3RoPjx0aD5BbW91bnQ8L3RoPjwvdHI+PC90aGVhZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRib2R5Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyPjx0ZD5Ob24gQ29ycHVzIERvbmF0aW9uczwvdGQ+PHRkPiR7bm9uQ29ycHVzQ291bnR9PC90ZD48dGQgY2xhc3M9ImFtdCI+4oK5JHtub25Db3JwdXNUb3RhbC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPjwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHI+PHRkPkluY29tZSBieSBJbnRlcmVzdDwvdGQ+PHRkPiR7aW50ZXJlc3RDb3VudH08L3RkPjx0ZCBjbGFzcz0iYW10Ij7igrkke2ludGVyZXN0VG90YWwudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD48L3RyPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPSJ0b3RhbC1oaWdobGlnaHQtcm93Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+VG90YWwgRXhwZW5zZXMgQWxsb3dlZDwvdGQ+PHRkPiR7dG90YWxBbGxvd2VkQ291bnR9PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImFtdCI+4oK5JHt0b3RhbEFsbG93ZWRTcGVuZC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90Ym9keT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RhYmxlPg0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGg0IHN0eWxlPSJjb2xvcjp2YXIoLS12aWJyYW50LWJsdWUpOyBtYXJnaW4tYm90dG9tOjEwcHg7Ij5HZW5lcmFsIEV4cGVuc2VzIDo8L2g0Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0YWJsZSBjbGFzcz0ic3VtLXRhYmxlIiBzdHlsZT0ibWFyZ2luLWJvdHRvbToyMHB4OyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aGVhZD48dHI+PHRoPkl0ZW1zPC90aD48dGg+Q291bnQ8L3RoPjx0aD5BbW91bnQ8L3RoPjwvdHI+PC90aGVhZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRib2R5Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyIGNsYXNzPSJ0b3RhbC1oaWdobGlnaHQtcm93Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+VG90YWwgRXhwZW5zZXM8L3RkPjx0ZD4ke2dlbkNvdW50fTwvdGQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkIGNsYXNzPSJhbXQiPuKCuSR7Z2VuVG90YWwudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90YWJsZT4NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxoMyBzdHlsZT0iY29sb3I6dmFyKC0tZGFyay10ZXh0KTsgbWFyZ2luLXRvcDozMHB4OyBtYXJnaW4tYm90dG9tOjVweDsiPkJhbGFuY2UgU2hlZXQgZm9yIEZpbmFuY2lhbCBZZWFyIDogJHtmeUxhYmVsfTwvaDM+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRhYmxlIGNsYXNzPSJzdW0tdGFibGUiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGhlYWQ+PHRyPjx0aD5JdGVtPC90aD48dGg+Q291bnQ8L3RoPjx0aD5BbW91bnQ8L3RoPjwvdHI+PC90aGVhZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRib2R5Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyPjx0ZD5BbGxvd2VkIEluY29tZSB0byBTcGVuZDwvdGQ+PHRkPiR7dG90YWxBbGxvd2VkQ291bnR9PC90ZD48dGQgY2xhc3M9ImFtdCI+4oK5JHt0b3RhbEFsbG93ZWRTcGVuZC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPjwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHI+PHRkPkFjdHVhbCBFeHBlbnNlczwvdGQ+PHRkPiR7Z2VuQ291bnR9PC90ZD48dGQgY2xhc3M9ImFtdCI+4oK5JHtnZW5Ub3RhbC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPjwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dHIgY2xhc3M9InRvdGFsLWhpZ2hsaWdodC1yb3ciPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZD5CYWxhbmNlIFNoZWV0PC90ZD48dGQ+PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgY2xhc3M9ImFtdCI+4oK5JHsodG90YWxBbGxvd2VkU3BlbmQgLSBnZW5Ub3RhbCkudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvdGJvZHk+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90YWJsZT5gOw0KDQogICAgICAgICAgICAgICAgICAgICAgLy8gRklOQUwgQ09NTUVOVFMgU0VDVElPTg0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpbmFsQmFsYW5jZSA9IHRvdGFsQWxsb3dlZFNwZW5kIC0gZ2VuVG90YWw7DQogICAgICAgICAgICAgICAgICAgICAgaCArPSBgPGgzIHN0eWxlPSJjb2xvcjp2YXIoLS1kYXJrLXRleHQpOyBtYXJnaW4tdG9wOjMwcHg7IG1hcmdpbi1ib3R0b206MTBweDsiPkZpbmFsIENvbW1lbnRzPC9oMz5gOw0KDQogICAgICAgICAgICAgICAgICAgICAgaWYgKGZpbmFsQmFsYW5jZSA+PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGggKz0gYDxkaXYgc3R5bGU9ImNvbG9yOiAjMDA2NDAwOyBmb250LXdlaWdodDogYm9sZDsgZm9udC1zaXplOiAxLjFlbTsgbWFyZ2luLWJvdHRvbTogMjBweDsiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRydXN0IGlzIHdpdGhpbiBpdHMgc3BlbmRpbmcgbGltaXRzLiBUaGVyZSBpcyBhIHN1cnBsdXMgb2YgOiDigrkke2ZpbmFsQmFsYW5jZS50b0xvY2FsZVN0cmluZygnZW4tSU4nKX0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsNCiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWZpY2l0QW10ID0gTWF0aC5hYnMoZmluYWxCYWxhbmNlKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaCArPSBgPGRpdiBzdHlsZT0iY29sb3I6ICNmZjAwMDA7IGZvbnQtd2VpZ2h0OiBib2xkOyBmb250LXNpemU6IDEuMWVtOyBtYXJnaW4tYm90dG9tOiAyMHB4OyBsaW5lLWhlaWdodDogMS41OyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVHJ1c3QgYWNjb3VudCBpcyBpbiBkZWZpY2l0LiBXZSBuZWVkIHRvIG1vdmUgUnMuICR7ZGVmaWNpdEFtdC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGcm9tIENPUlBVUyBhY2NvdW50IHRvIEV4cGVuc2UgQWNjb3VudC4gUmVxdWlyZWQgUmVzb2x1dGlvbiBkb2N1bWVudCBhdXRob3JpemluZw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvIHVzZSBjb3JwdXMgYW1vdW50cyBiZSBwcmVwYXJlZCBmcm9tIHRoZSBUcnVzdGVlcyBmb3IgUmVjb3Jkcy4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+YDsNCiAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICBoICs9IGA8aHIgc3R5bGU9ImJvcmRlcjogMDsgYm9yZGVyLXRvcDogM3B4IGRvdWJsZSB2YXIoLS1wcmltYXJ5LWJsdWUpOyBtYXJnaW46IDMwcHggMDsiPmA7DQoNCiAgICAgICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiRXhwZW5zZSBmZXRjaCBlcnJvciIsIGUpOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgaCArPSBgPC9kaXY+YDsNCg0KICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsZWRSZXN1bHRzJykuaW5uZXJIVE1MID0gaDsNCiAgICAgICAgICAgICAgY29uc3QgYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWFyY2hTdW1tYXJ5QmFyJyk7DQogICAgICAgICAgICAgIGIuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICAgIGIuaW5uZXJIVE1MID0gYEFjY291bnRzIEZZICR7ZnlMYWJlbH0gfCBUb3RhbCBJbmNvbWU6IOKCuSR7Y29tYmluZWRJbmNvbWVUb3RhbC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX1gOw0KICAgICAgICAgICAgICB0b2dnbGVTY3JvbGxCdXR0b25zKHRydWUpOw0KDQogICAgICAgICAgfQ0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogV2hhdHNBcHAgSW50ZWdyYXRvcjogRm9ybWF0cyBhIHJlY2VpcHQgc3VtbWFyeSBpbnRvIGEgc3RydWN0dXJlZCBtZXNzYWdlDQogICAgICAgICAgICogYW5kIG9wZW5zIHRoZSBXaGF0c0FwcCBBUEkgdG8gc2VuZCBpdCBkaXJlY3RseSB0byB0aGUgZG9ub3IncyBwaG9uZSBudW1iZXIuDQogICAgICAgICAgICovDQoNCiAgICAgICAgICBmdW5jdGlvbiBzZW5kV2hhdHNBcHAoZikgew0KICAgICAgICAgICAgICBsZXQgcGggPSBmWzNdLnJlcGxhY2UoL1xEL2csICcnKTsNCiAgICAgICAgICAgICAgaWYgKHBoLmxlbmd0aCA9PT0gMTApIHBoID0gJzkxJyArIHBoOw0KICAgICAgICAgICAgICBjb25zdCBsaW5lID0gIj09PT09PT09PT09PT09PT09PT09PT0iOw0KICAgICAgICAgICAgICBsZXQgbSA9IGAqTVlMQUkgTUFIQVBFUklZQVZBIEFOVVNIQU0gVFJVU1QqXG4ke2xpbmV9XG4qUmVjZWlwdCBObzoqICR7ZlswXX1cbipEYXRlOiogJHtmWzFdfVxuUmVjZWl2ZWQgd2l0aCB0aGFua3MgUnMuICoke2ZbOV19KlxuZm9yICoke2ZbMTJdfSogZnJvbSAqU2hyaS4vU210LiAke2ZbMl19KlxuJHtsaW5lfVxuX1RydXN0IHJlZ2lzdHJhdGlvbiB2YWxpZCB0aWxsIDMxLTAzLTIwMjZfYDsNCiAgICAgICAgICAgICAgd2luZG93Lm9wZW4oYGh0dHBzOi8vd2EubWUvJHtwaH0/dGV4dD0ke2VuY29kZVVSSUNvbXBvbmVudChtKX1gLCAnX2JsYW5rJyk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgZnVuY3Rpb24gdG9nZ2xlUm90YXRpb24oKSB7DQogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWNlaXB0Q29udGFpbmVyJykuY2xhc3NMaXN0LnRvZ2dsZSgncm90YXRlZCcpOw0KICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3BhY2VyVG9wJykuY2xhc3NMaXN0LnRvZ2dsZSgnYWN0aXZlJyk7DQogICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzcGFjZXJCb3R0b20nKS5jbGFzc0xpc3QudG9nZ2xlKCdhY3RpdmUnKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyBHbG9iYWwgdmFyaWFibGUgdG8gaG9sZCBkYXRhIHNhZmVseSBmb3IgZG93bmxvYWQNCiAgICAgICAgICBsZXQgY3VycmVudERvbmF0aW9uRGF0YSA9ICIiOw0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogRG9uYXRpb24gTGlzdCBWaWV3ZXI6IEZpbHRlcnMgdGhlIG1hc3RlciBkYXRhYmFzZSBieSBGaW5hbmNpYWwgWWVhciBhbmQNCiAgICAgICAgICAgKiBkaXNwbGF5cyBhIGRldGFpbGVkIDMtY29sdW1uIHRhYmxlIHdpdGggYSByb2J1c3QgZG93bmxvYWQgb3B0aW9uLg0KICAgICAgICAgICAqLw0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJ1bkRvbmF0aW9uKCkgew0KICAgICAgICAgICAgICBjbGVhcldvcmtzcGFjZSgpOw0KICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZEZZID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKS52YWx1ZTsNCiAgICAgICAgICAgICAgY29uc3QgZnlMYWJlbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InllYXJGaWx0ZXIiXTpjaGVja2VkJykucGFyZW50RWxlbWVudC5pbm5lclRleHQudHJpbSgpOw0KDQogICAgICAgICAgICAgIC8vIExvZ2ljIHRvIGVuc3VyZSBzdWZmaXggaXMgIjI1LTI2IiBmb3JtYXQNCiAgICAgICAgICAgICAgbGV0IHRhcmdldEZZID0gc2VsZWN0ZWRGWTsNCiAgICAgICAgICAgICAgaWYgKHNlbGVjdGVkRlkgIT09ICJhbGwiKSB7DQogICAgICAgICAgICAgICAgICBjb25zdCBzaG9ydFllYXIgPSBzZWxlY3RlZEZZLnNsaWNlKC0yKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IG5leHRZZWFyID0gKHBhcnNlSW50KHNob3J0WWVhcikgKyAxKS50b1N0cmluZygpLnBhZFN0YXJ0KDIsICcwJyk7DQogICAgICAgICAgICAgICAgICB0YXJnZXRGWSA9IGAke3Nob3J0WWVhcn0tJHtuZXh0WWVhcn1gOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goREFUQV9VUkwpOw0KICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzLnRleHQoKTsNCiAgICAgICAgICAgICAgY29uc3QgcmVjcyA9IHRleHQuc3BsaXQoJ1xuJyk7DQoNCiAgICAgICAgICAgICAgbGV0IHRvdGFsQ291bnQgPSAwOw0KICAgICAgICAgICAgICBsZXQgdG90YWxBbW91bnQgPSAwOw0KICAgICAgICAgICAgICBsZXQgdGFibGVSb3dzID0gIiI7DQoNCiAgICAgICAgICAgICAgLy8gUmVzZXQgYW5kIHN0YXJ0IGJ1aWxkaW5nIHRleHQgY29udGVudCBmb3IgZG93bmxvYWQNCiAgICAgICAgICAgICAgY3VycmVudERvbmF0aW9uRGF0YSA9IGBET05BVElPTiBMSVNUIEZPUiBGWTogJHtmeUxhYmVsfVxuYDsNCiAgICAgICAgICAgICAgY3VycmVudERvbmF0aW9uRGF0YSArPSBgR2VuZXJhdGVkIG9uOiAke25ldyBEYXRlKCkudG9Mb2NhbGVTdHJpbmcoKX1cbmA7DQogICAgICAgICAgICAgIGN1cnJlbnREb25hdGlvbkRhdGEgKz0gYC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG5cbmA7DQoNCiAgICAgICAgICAgICAgcmVjcy5mb3JFYWNoKHIgPT4gew0KICAgICAgICAgICAgICAgICAgbGV0IGYgPSByLnNwbGl0KCd8Jyk7DQogICAgICAgICAgICAgICAgICBpZiAoZi5sZW5ndGggPCAyMCkgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgICBjb25zdCByY3B0Tm8gPSBmWzBdLnRyaW0oKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGVTdHIgPSBmWzFdLnRyaW0oKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ2FuY2VsbGVkID0gZlsxM10/LnRvVXBwZXJDYXNlKCkgPT09ICJZRVMiOw0KICAgICAgICAgICAgICAgICAgY29uc3QgYW1vdW50ID0gcGFyc2VGbG9hdChmWzldKSB8fCAwOw0KDQogICAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRGWSAhPT0gImFsbCIgJiYgZ2V0RlkoZGF0ZVN0cikgIT09IHRhcmdldEZZKSByZXR1cm47DQogICAgICAgICAgICAgICAgICBpZiAoaXNDYW5jZWxsZWQpIHJldHVybjsNCg0KICAgICAgICAgICAgICAgICAgdG90YWxDb3VudCsrOw0KICAgICAgICAgICAgICAgICAgdG90YWxBbW91bnQgKz0gYW1vdW50Ow0KDQogICAgICAgICAgICAgICAgICBjb25zdCBuYW1lID0gZlsyXSB8fCAiQW5vbnltb3VzIjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGFkZHIgPSAoZls0XSB8fCAiIikucmVwbGFjZSgvfi9nLCAnLCAnKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHBpbiA9IGZbMTVdIHx8ICIiOw0KICAgICAgICAgICAgICAgICAgY29uc3QgY291bnRyeSA9IGZbMTldIHx8ICIiOw0KICAgICAgICAgICAgICAgICAgY29uc3QgcGhvbmUgPSBmWzNdIHx8ICItLS0iOw0KICAgICAgICAgICAgICAgICAgY29uc3QgcGFuID0gZls2XSB8fCAiLS0tIjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHRvd2FyZHMgPSBmWzEyXSB8fCAiIjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGdlb0luZm8gPSBbYWRkciwgcGluLCBjb3VudHJ5XS5maWx0ZXIoeCA9PiB4LnRyaW0oKSAhPT0gIiIpLmpvaW4oIiAtICIpOw0KDQogICAgICAgICAgICAgICAgICAvLyBCdWlsZCBQbGFpbiBUZXh0IEVudHJ5DQogICAgICAgICAgICAgICAgICBjdXJyZW50RG9uYXRpb25EYXRhICs9IGBSZWNlaXB0OiAke3JjcHROb30gfCBEYXRlOiAke2RhdGVTdHJ9XG5gOw0KICAgICAgICAgICAgICAgICAgY3VycmVudERvbmF0aW9uRGF0YSArPSBgQW1vdW50OiBScy4gJHthbW91bnR9IHwgVG93YXJkczogJHt0b3dhcmRzfVxuYDsNCiAgICAgICAgICAgICAgICAgIGN1cnJlbnREb25hdGlvbkRhdGEgKz0gYERvbm9yOiAke25hbWV9XG5gOw0KICAgICAgICAgICAgICAgICAgY3VycmVudERvbmF0aW9uRGF0YSArPSBgQWRkcmVzczogJHtnZW9JbmZvfVxuYDsNCiAgICAgICAgICAgICAgICAgIGN1cnJlbnREb25hdGlvbkRhdGEgKz0gYFBob25lOiAke3Bob25lfSB8IFBBTjogJHtwYW59XG5gOw0KICAgICAgICAgICAgICAgICAgY3VycmVudERvbmF0aW9uRGF0YSArPSBgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmA7DQoNCiAgICAgICAgICAgICAgICAgIC8vIEJ1aWxkIEhUTUwgVGFibGUgUm93DQogICAgICAgICAgICAgICAgICB0YWJsZVJvd3MgKz0gYA0KICAgICAgICAgICAgICAgICAgICAgICAgPHRyPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT0id2hpdGUtc3BhY2U6bm93cmFwOyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJyY3B0LWxpbmsiIG9uY2xpY2s9Imp1bXBUb1JlY2VpcHQoJyR7cmNwdE5vfScpIj4ke3JjcHROb308L3NwYW4+PGJyPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c21hbGw+JHtkYXRlU3RyfTwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9InRleHQtYWxpZ246cmlnaHQ7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGI+4oK5JHthbW91bnQudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC9iPjxicj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNtYWxsIHN0eWxlPSJjb2xvcjp2YXIoLS1wcmltYXJ5LWJsdWUpOyI+JHt0b3dhcmRzfTwvc21hbGw+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxiPiR7bmFtZX08L2I+PGJyPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c21hbGw+JHtnZW9JbmZvfTwvc21hbGw+PGJyPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c21hbGwgc3R5bGU9ImNvbG9yOiM1NTU7Ij5bUGhvbmU6ICR7cGhvbmV9XSBbUEFOOiAke3Bhbn1dPC9zbWFsbD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgICAgICAgICAgICAgPC90cj5gOw0KICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICBjdXJyZW50RG9uYXRpb25EYXRhICs9IGBcblRPVEFMIFRSQU5TQUNUSU9OUzogJHt0b3RhbENvdW50fVxuYDsNCiAgICAgICAgICAgICAgY3VycmVudERvbmF0aW9uRGF0YSArPSBgVE9UQUwgQU1PVU5UOiBScy4gJHt0b3RhbEFtb3VudC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX1cbmA7DQoNCiAgICAgICAgICAgICAgY29uc3QgbWFpblRpdGxlID0gYDxoMyBjbGFzcz0iYmFuay10aXRsZSI+TGlzdCBvZiBEb25hdGlvbnMgZm9yIEZpbmFuY2lhbCBZZWFyIDogJHtmeUxhYmVsfTwvaDM+YDsNCg0KICAgICAgICAgICAgICAvLyBEb3dubG9hZCBCdXR0b24gLSBub3cgc2ltcGxpZmllZCB0byBhdm9pZCBzY3JpcHQgZXJyb3JzDQogICAgICAgICAgICAgIGNvbnN0IGRvd25sb2FkQnRuID0gYA0KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsgbWFyZ2luLXRvcDoyMHB4OyBwYWRkaW5nLWJvdHRvbTo2MHB4OyI+DQogICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9ImRvd25sb2FkRmlsZSgnJHt0YXJnZXRGWX0nKSINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6dmFyKC0tZ3ctZ3JlZW4pOyBjb2xvcjp3aGl0ZTsgcGFkZGluZzoxNXB4IDMwcHg7IGZvbnQtc2l6ZToxcmVtOyBib3JkZXItcmFkaXVzOjhweDsgY3Vyc29yOnBvaW50ZXI7IGJvcmRlcjpub25lOyBmb250LXdlaWdodDpib2xkOyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgRG93bmxvYWQgRG9uYXRpb25zXyR7dGFyZ2V0Rll9LnR4dA0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7DQoNCiAgICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RldGFpbGVkUmVzdWx0cycpLmlubmVySFRNTCA9IGANCiAgICAgICAgICAgICAgICAgICAgJHttYWluVGl0bGV9DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRhYmxlLXdyYXAiPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHRhYmxlPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aGVhZD48dHI+PHRoPlJObyAmIERhdGU8L3RoPjx0aD5BbW91bnQgJiBUb3dhcmRzPC90aD48dGg+RG9ub3IgRGV0YWlsczwvdGg+PC90cj48L3RoZWFkPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0Ym9keT4ke3RhYmxlUm93cyB8fCAnPHRyPjx0ZCBjb2xzcGFuPSIzIiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7Ij5ObyByZWNvcmRzIGZvdW5kLjwvdGQ+PC90cj4nfTwvdGJvZHk+DQogICAgICAgICAgICAgICAgICAgICAgICA8L3RhYmxlPg0KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgJHt0b3RhbENvdW50ID4gMCA/IGRvd25sb2FkQnRuIDogIiJ9YDsNCg0KICAgICAgICAgICAgICBjb25zdCBiID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NlYXJjaFN1bW1hcnlCYXInKTsNCiAgICAgICAgICAgICAgYi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgICAgICAgYi5pbm5lckhUTUwgPSBgVG90YWwgJHt0b3RhbENvdW50fSBUcmFuc2FjdGlvbnMgOiDigrkke3RvdGFsQW1vdW50LnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfWA7DQogICAgICAgICAgICAgIHRvZ2dsZVNjcm9sbEJ1dHRvbnModHJ1ZSk7DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogUm9idXN0IERvd25sb2FkIEhlbHBlcg0KICAgICAgICAgICAqIFVzZXMgdGhlIGdsb2JhbCBjdXJyZW50RG9uYXRpb25EYXRhIHZhcmlhYmxlDQogICAgICAgICAgICovDQogICAgICAgICAgZnVuY3Rpb24gZG93bmxvYWRGaWxlKGZ5U3VmZml4KSB7DQogICAgICAgICAgICAgIGlmICghY3VycmVudERvbmF0aW9uRGF0YSkgew0KICAgICAgICAgICAgICAgICAgYWxlcnQoIk5vIGRhdGEgYXZhaWxhYmxlIHRvIGRvd25sb2FkLiIpOw0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7DQogICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbY3VycmVudERvbmF0aW9uRGF0YV0sIHsgdHlwZTogJ3RleHQvcGxhaW4nIH0pOw0KICAgICAgICAgICAgICBlbGVtZW50LmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOw0KICAgICAgICAgICAgICBlbGVtZW50LmRvd25sb2FkID0gYERvbmF0aW9uc18ke2Z5U3VmZml4fS50eHRgOw0KICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGVsZW1lbnQpOw0KICAgICAgICAgICAgICBlbGVtZW50LmNsaWNrKCk7DQogICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoZWxlbWVudCk7DQogICAgICAgICAgfQ0KDQoNCiAgICAgICAgICBjb25zdCBBUFBST1ZFRF9VUkwgPSAiaHR0cHM6Ly9kbC5kcm9wYm94dXNlcmNvbnRlbnQuY29tL3NjbC9maS9uemlsemJrZjhsMnRseDIxcHliODQvQXBwcm92ZWQudHh0P3Jsa2V5PW9remZ2bXptcGZiOWt1aHo3NGRiZTBhZHMmZGw9MSI7DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBORVc6IERldmljZSBBdXRob3JpemF0aW9uIENoZWNrDQogICAgICAgICAgICogUmVwbGFjZXMgdGhlIG1hbnVhbCBwYXNzd29yZCBsb2dpbg0KICAgICAgICAgICAqLw0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIGNoZWNrRGV2aWNlQXV0aCgpIHsNCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IG15SUQgPSBnZW5lcmF0ZUZpbmdlcnByaW50KCk7DQogICAgICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChBUFBST1ZFRF9VUkwpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIFNwbGl0IGJ5IGxpbmVzLCB0cmltIHNwYWNlcywgYW5kIHJlbW92ZSBlbXB0eSBsaW5lcw0KICAgICAgICAgICAgICAgICAgY29uc3QgYXBwcm92ZWRJRHMgPSB0ZXh0LnNwbGl0KC9ccj9cbi8pLm1hcChpZCA9PiBpZC50cmltKCkpLmZpbHRlcihpZCA9PiBpZCAhPT0gIiIpOw0KDQogICAgICAgICAgICAgICAgICBpZiAoYXBwcm92ZWRJRHMuaW5jbHVkZXMobXlJRCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAvLyBTVUNDRVNTOiBIaWRlIGxvZ2luIHNjcmVlbiBhbmQgbG9hZCBkYXNoYm9hcmQNCiAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9naW5PdmVybGF5Jykuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbkNvbnRlbnQnKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgICAgICAgICAgICAgICB3cmFwTG9hZGluZyhpbml0RGFzaGJvYXJkKTsNCiAgICAgICAgICAgICAgICAgICAgICAvLyBTVFJBVEVHWTogQ2FsbCB0aGUgbmV3IGlkZW50aXR5IGZ1bmN0aW9uIGF0IHRoZSBlbmQNCiAgICAgICAgICAgICAgICAgICAgICBnZXRVc2VySWRlbnRpdHkobXlJRCk7DQoNCiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgLy8gRkFJTDogRGlzcGxheSB0aGUgRGV2aWNlIElEIGZvciByZWdpc3RyYXRpb24NCiAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXV0aFN0YXR1cycpLmlubmVySFRNTCA9IGANCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJtYXJnaW4tdG9wOjIwcHg7IGJvcmRlci10b3A6MXB4IHNvbGlkICNlZWU7IHBhZGRpbmctdG9wOjEwcHg7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGIgc3R5bGU9ImNvbG9yOnZhcigtLWNhbmNlbC1yZWQpOyI+REVWSUNFIE5PVCBBVVRIT1JJWkVEPC9iPjxicj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNtYWxsPllvdXIgRGV2aWNlIElEIGlzOjwvc21hbGw+PGJyPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJmb250LWZhbWlseTptb25vc3BhY2U7IGJhY2tncm91bmQ6I2Y0ZjRmNDsgcGFkZGluZzo4cHg7IG1hcmdpbjoxMHB4IDA7IGJvcmRlcjoxcHggZGFzaGVkICM5OTk7IHdvcmQtYnJlYWs6YnJlYWstYWxsOyBmb250LXNpemU6MC45cmVtOyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke215SUR9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBzdHlsZT0iZm9udC1zaXplOjAuNzVyZW07Ij5Db3B5IHRoaXMgSUQgYW5kIHNlbmQgaXQgdG8gdGhlIGFkbWluIHRvIGVuYWJsZSBhY2Nlc3MuPC9wPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhdXRoU3RhdHVzJykuaW5uZXJIVE1MID0gIkNvbm5lY3Rpb24gRXJyb3IuIFBsZWFzZSBjaGVjayBpbnRlcm5ldC4iOw0KICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcigiQXV0aCBlcnJvcjoiLCBlKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICAgICAqIE5FVzogR2VuZXJhdGVzIGEgdW5pcXVlIElEIGZvciB0aGlzIHNwZWNpZmljIGRldmljZS9icm93c2VyDQogICAgICAgICAgICovDQogICAgICAgICAgZnVuY3Rpb24gZ2VuZXJhdGVGaW5nZXJwcmludCgpIHsNCiAgICAgICAgICAgICAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7DQogICAgICAgICAgICAgIGNvbnN0IGdsID0gY2FudmFzLmdldENvbnRleHQoJ3dlYmdsJyk7DQogICAgICAgICAgICAgIGNvbnN0IGRlYnVnSW5mbyA9IGdsID8gZ2wuZ2V0RXh0ZW5zaW9uKCdXRUJHTF9kZWJ1Z19yZW5kZXJlcl9pbmZvJykgOiBudWxsOw0KICAgICAgICAgICAgICBjb25zdCByZW5kZXJlciA9IGRlYnVnSW5mbyA/IGdsLmdldFBhcmFtZXRlcihkZWJ1Z0luZm8uVU5NQVNLRURfUkVOREVSRVJfV0VCR0wpIDogInN0YW5kYXJkLWJyb3dzZXIiOw0KDQogICAgICAgICAgICAgIC8vIENvbWJpbmUgaGFyZHdhcmUgc3BlY3MgdG8gY3JlYXRlIGEgdW5pcXVlIHN0cmluZw0KICAgICAgICAgICAgICBjb25zdCByYXdJZCA9IGAke3JlbmRlcmVyfS0ke3NjcmVlbi53aWR0aH14JHtzY3JlZW4uaGVpZ2h0fS0ke25ldyBEYXRlKCkuZ2V0VGltZXpvbmVPZmZzZXQoKX1gOw0KDQogICAgICAgICAgICAgIC8vIENvbnZlcnQgc3RyaW5nIHRvIGEgbnVtZXJpYyBoYXNoDQogICAgICAgICAgICAgIGxldCBoYXNoID0gMDsNCiAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByYXdJZC5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgaGFzaCA9ICgoaGFzaCA8PCA1KSAtIGhhc2gpICsgcmF3SWQuY2hhckNvZGVBdChpKTsNCiAgICAgICAgICAgICAgICAgIGhhc2ggfD0gMDsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICByZXR1cm4gIk1NUFQtREVWLSIgKyBNYXRoLmFicyhoYXNoKTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvKioNCiAgICAgICAgICAgKiBVSSBIZWxwZXI6IFNob3dzIG9yIGhpZGVzIHRoZSBmbG9hdGluZyBzY3JvbGwgYnV0dG9ucyBiYXNlZCBvbiBjb250ZW50IHByZXNlbmNlLg0KICAgICAgICAgICAqLw0KICAgICAgICAgIGZ1bmN0aW9uIHRvZ2dsZVNjcm9sbEJ1dHRvbnMoc2hvdykgew0KICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5U3R5bGUgPSBzaG93ID8gJ2ZsZXgnIDogJ25vbmUnOw0KICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuR29Ub3AnKS5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheVN0eWxlOw0KICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnRuR29Cb3R0b20nKS5zdHlsZS5kaXNwbGF5ID0gZGlzcGxheVN0eWxlOw0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8qKg0KICAgICAgICogUlIgTGFiZWxzOiBQcmVwYXJlZCBmb3IgZ2VuZXJhdGluZyBhZGRyZXNzIGxhYmVscyBmb3IgZG9ub3JzLg0KICAgICAgICogTG9naWMgdG8gYmUgaW1wbGVtZW50ZWQgaW4gdGhlIG5leHQgc3RlcC4NCiAgICAgICAqLw0KDQogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVSUkxhYmVscygpIHsNCiAgICAgICAgICAgICAgY29uc3QgeyBqc1BERiB9ID0gd2luZG93LmpzcGRmOw0KICAgICAgICAgICAgICBjb25zdCBkb2MgPSBuZXcganNQREYoJ3AnLCAnbW0nLCAnYTQnKTsNCg0KICAgICAgICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaChEQVRBX1VSTCk7DQogICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICAgICAgICBjb25zdCByZWNzID0gdGV4dC5zcGxpdCgnXG4nKTsNCg0KICAgICAgICAgICAgICBjb25zdCB2YWxpZFJlY3MgPSByZWNzLmZpbHRlcihyID0+IHsNCiAgICAgICAgICAgICAgICAgIGxldCBmID0gci5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgICAgaWYgKGYubGVuZ3RoIDwgMjApIHJldHVybiBmYWxzZTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ2FuY2VsbGVkID0gZlsxM10/LnRyaW0oKS50b1VwcGVyQ2FzZSgpID09PSAiWUVTIjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQW5vbiA9ICghZlsyXSB8fCBmWzJdLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoImFub255bW91cyIpKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJjcHRQcmludGVkID0gZlsxNl0/LnRyaW0oKS50b1VwcGVyQ2FzZSgpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgcHJhc2FkYW1TZW50ID0gZlsxN10/LnRyaW0oKS50b1VwcGVyQ2FzZSgpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgaXNSZWFkeSA9IChyY3B0UHJpbnRlZCA9PT0gIk5PIiB8fCByY3B0UHJpbnRlZCA9PT0gIiIpICYmDQogICAgICAgICAgICAgICAgICAgICAgKHByYXNhZGFtU2VudCA9PT0gIk5PIiB8fCBwcmFzYWRhbVNlbnQgPT09ICIiKTsNCg0KICAgICAgICAgICAgICAgICAgcmV0dXJuIGZbMF0uc3RhcnRzV2l0aCgiQ0ciKSAmJiBwYXJzZURhdGUoZlsxXSkgPj0gQ1VUT0ZGX0RBVEUgJiYNCiAgICAgICAgICAgICAgICAgICAgICAhaXNDYW5jZWxsZWQgJiYgIWlzQW5vbiAmJiBmWzRdLnRyaW0oKSAhPT0gIiIgJiYgaXNSZWFkeTsNCiAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgaWYgKHZhbGlkUmVjcy5sZW5ndGggPT09IDApIHsNCiAgICAgICAgICAgICAgICAgIGFsZXJ0KCJObyByZWNlaXB0cyBhcmUgY3VycmVudGx5IG1hcmtlZCBhcyAnUkVBRFknLiIpOw0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgY29uc3QgbWFyZ2luID0gMTAsIGxhYmVsVyA9IDk1LCBsYWJlbEggPSA3MCwgY29scyA9IDIsIHJvd3MgPSA0Ow0KICAgICAgICAgICAgICBsZXQgY3VycmVudEl0ZW0gPSAwOw0KDQogICAgICAgICAgICAgIHZhbGlkUmVjcy5mb3JFYWNoKChyKSA9PiB7DQogICAgICAgICAgICAgICAgICBpZiAoY3VycmVudEl0ZW0gPiAwICYmIGN1cnJlbnRJdGVtICUgKGNvbHMgKiByb3dzKSA9PT0gMCkgZG9jLmFkZFBhZ2UoKTsNCg0KICAgICAgICAgICAgICAgICAgbGV0IGYgPSByLnNwbGl0KCd8Jyk7DQogICAgICAgICAgICAgICAgICBjb25zdCByZWNlaXB0ID0gZlswXTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRvbm9yTmFtZSA9ICJTaHJpLi9TbXQuICIgKyBmWzJdLnRyaW0oKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHBob25lID0gZlszXSB8fCAiIjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHBpbkNvZGUgPSBmWzE1XT8udHJpbSgpIHx8ICIiOw0KDQogICAgICAgICAgICAgICAgICAvLyBUcmVhdCB+IGFzIHNwYWNlIGZvciBuYXR1cmFsIGZsb3cNCiAgICAgICAgICAgICAgICAgIGxldCBmdWxsQWRkciA9IGZbNF0ucmVwbGFjZSgvfi9nLCAnICcpLnRyaW0oKTsNCg0KICAgICAgICAgICAgICAgICAgY29uc3QgcGFnZUlkeCA9IGN1cnJlbnRJdGVtICUgKGNvbHMgKiByb3dzKSwgY29sID0gcGFnZUlkeCAlIGNvbHMsIHJvdyA9IE1hdGguZmxvb3IocGFnZUlkeCAvIGNvbHMpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgeCA9IG1hcmdpbiArIChjb2wgKiBsYWJlbFcpLCB5ID0gbWFyZ2luICsgKHJvdyAqIGxhYmVsSCk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIERhcmsgQm9yZGVyDQogICAgICAgICAgICAgICAgICBkb2Muc2V0RHJhd0NvbG9yKDApOw0KICAgICAgICAgICAgICAgICAgZG9jLnNldExpbmVXaWR0aCgwLjQpOw0KICAgICAgICAgICAgICAgICAgZG9jLnJlY3QoeCwgeSwgbGFiZWxXLCBsYWJlbEgpOw0KDQogICAgICAgICAgICAgICAgICAvLyAxLiBSZWYgSGVhZGVyDQogICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udFNpemUoOSk7DQogICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgIm5vcm1hbCIpOw0KICAgICAgICAgICAgICAgICAgZG9jLnRleHQoIlRPOiIsIHggKyA1LCB5ICsgOCk7DQogICAgICAgICAgICAgICAgICBkb2MudGV4dCgiUmVmOiAiICsgcmVjZWlwdCwgeCArIGxhYmVsVyAtIDMwLCB5ICsgOCk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIDIuIE5hbWUgLSBCb2xkIGFuZCBXcmFwcGVkDQogICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udFNpemUoMTMpOw0KICAgICAgICAgICAgICAgICAgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJib2xkIik7DQogICAgICAgICAgICAgICAgICBjb25zdCB3cmFwcGVkTmFtZSA9IGRvYy5zcGxpdFRleHRUb1NpemUoZG9ub3JOYW1lLCA4NSk7DQogICAgICAgICAgICAgICAgICBkb2MudGV4dCh3cmFwcGVkTmFtZSwgeCArIDUsIHkgKyAxNyk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIFNwYWNpbmc6IEVuZCBvZiBuYW1lICsgNW1tIGdhcCBmb3IgdmlzdWFsIGNsYXJpdHkNCiAgICAgICAgICAgICAgICAgIGxldCBhZGRyWSA9IHkgKyAxNyArICh3cmFwcGVkTmFtZS5sZW5ndGggKiA1LjUpICsgMjsNCg0KICAgICAgICAgICAgICAgICAgLy8gMy4gQWRkcmVzcyBMb2dpYw0KICAgICAgICAgICAgICAgICAgZG9jLnNldEZvbnQoImhlbHZldGljYSIsICJub3JtYWwiKTsNCiAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxMSk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIFNlcGFyYXRlIENpdHkgKExhc3QgV29yZCkNCiAgICAgICAgICAgICAgICAgIGxldCB3b3JkcyA9IGZ1bGxBZGRyLnNwbGl0KC9ccysvKTsNCiAgICAgICAgICAgICAgICAgIGxldCBjaXR5ID0gd29yZHMubGVuZ3RoID4gMCA/IHdvcmRzLnBvcCgpLnJlcGxhY2UoL1ssOl0kLywgIiIpIDogIiI7DQogICAgICAgICAgICAgICAgICBsZXQgYWRkcldpdGhvdXRDaXR5ID0gd29yZHMuam9pbigiICIpOw0KDQogICAgICAgICAgICAgICAgICAvLyBIeWJyaWQgV3JhcHBpbmcgQXBwcm9hY2gNCiAgICAgICAgICAgICAgICAgIC8vIEZpcnN0IHRyeSBzcGxpdHRpbmcgYnkgZXhpc3RpbmcgcHVuY3R1YXRpb24NCiAgICAgICAgICAgICAgICAgIGxldCBzZWdtZW50cyA9IGFkZHJXaXRob3V0Q2l0eS5zcGxpdCgvWyw6XS8pLm1hcChzID0+IHMudHJpbSgpKS5maWx0ZXIocyA9PiBzICE9PSAiIik7DQogICAgICAgICAgICAgICAgICBsZXQgY3VycmVudExpbmUgPSAiIjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IG1heFdpZHRoID0gODU7DQoNCiAgICAgICAgICAgICAgICAgIHNlZ21lbnRzLmZvckVhY2goKHNlZ21lbnQsIGlkeCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoaXMgc2VnbWVudCBpdHNlbGYgaXMgdG9vIGxvbmcgZm9yIGEgYmxhbmsgbGluZQ0KICAgICAgICAgICAgICAgICAgICAgIGlmIChkb2MuZ2V0VGV4dFdpZHRoKHNlZ21lbnQpID4gbWF4V2lkdGgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gRk9SQ0UgVEVYVCBGTE9XIGZvciB0aGlzIHNlZ21lbnQgKFNwbGl0IGJ5IHNwYWNlKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgc3ViV29yZHMgPSBzZWdtZW50LnNwbGl0KC9ccysvKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViV29yZHMuZm9yRWFjaChzdyA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdGVzdExpbmUgPSBjdXJyZW50TGluZSA9PT0gIiIgPyBzdyA6IGN1cnJlbnRMaW5lICsgIiAiICsgc3c7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZG9jLmdldFRleHRXaWR0aCh0ZXN0TGluZSkgPCBtYXhXaWR0aCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRMaW5lID0gdGVzdExpbmU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy50ZXh0KGN1cnJlbnRMaW5lLCB4ICsgNSwgYWRkclkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkZHJZICs9IDUuNTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZSA9IHN3Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBTdGFuZGFyZCBwYWNraW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0ZXN0TGluZSA9IGN1cnJlbnRMaW5lID09PSAiIiA/IHNlZ21lbnQgOiBjdXJyZW50TGluZSArICIsICIgKyBzZWdtZW50Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZG9jLmdldFRleHRXaWR0aCh0ZXN0TGluZSkgPCBtYXhXaWR0aCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudExpbmUgPSB0ZXN0TGluZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFByaW50IGN1cnJlbnQgbGluZSBhbmQgc3RhcnQgbmV3IGxpbmUgd2l0aCB0aGlzIHNlZ21lbnQNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvYy50ZXh0KGN1cnJlbnRMaW5lICsgKGN1cnJlbnRMaW5lLmVuZHNXaXRoKCIsIikgPyAiIiA6ICIsIiksIHggKyA1LCBhZGRyWSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyWSArPSA1LjU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50TGluZSA9IHNlZ21lbnQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgLy8gUHJpbnQgZmluYWwgYWRkcmVzcyBib2R5IGxpbmUNCiAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50TGluZSkgew0KICAgICAgICAgICAgICAgICAgICAgIGRvYy50ZXh0KGN1cnJlbnRMaW5lLCB4ICsgNSwgYWRkclkpOw0KICAgICAgICAgICAgICAgICAgICAgIGFkZHJZICs9IDUuNTsNCiAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgLy8gQ2l0eSAtIFBpbmNvZGUNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGNpdHlQaW4gPSBjaXR5ICsgKHBpbkNvZGUgPyAiIC0gIiArIHBpbkNvZGUgOiAiIik7DQogICAgICAgICAgICAgICAgICBkb2MudGV4dChjaXR5UGluLCB4ICsgNSwgYWRkclkpOw0KICAgICAgICAgICAgICAgICAgYWRkclkgKz0gNzsNCg0KICAgICAgICAgICAgICAgICAgLy8gNC4gVGVsZXBob25lIChCb2xkKQ0KICAgICAgICAgICAgICAgICAgaWYgKHBob25lICYmIHBob25lLnRyaW0oKSAhPT0gIiIpIHsNCiAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udCgiaGVsdmV0aWNhIiwgImJvbGQiKTsNCiAgICAgICAgICAgICAgICAgICAgICAvLyBFbnN1cmUgcGhvbmUgZG9lc24ndCBkcm9wIG9mZiB0aGUgbGFiZWwNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgZmluYWxQaG9uZVkgPSBNYXRoLm1pbihhZGRyWSwgeSArIGxhYmVsSCAtIDYpOw0KICAgICAgICAgICAgICAgICAgICAgIGRvYy50ZXh0KCJUZWxlcGhvbmUgOiAiICsgcGhvbmUsIHggKyA1LCBmaW5hbFBob25lWSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICBjdXJyZW50SXRlbSsrOw0KICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICBjb25zdCB0b2RheSA9IG5ldyBEYXRlKCkudG9Mb2NhbGVEYXRlU3RyaW5nKCdlbi1HQicpLnJlcGxhY2UoL1wvL2csICctJyk7DQogICAgICAgICAgICAgIGRvYy5zYXZlKGBMYWJlbHMgLSAke3RvZGF5fS5wZGZgKTsNCiAgICAgICAgICB9DQoNCg0KICAgICAgICAgIC8vIDEuIEluaXRpYWxpemUgQXVkaW8gYW5kIGhhbmRsZSBCcm93c2VyIEF1dG9wbGF5IFBvbGljeQ0KICAgICAgICAgIGZ1bmN0aW9uIGluaXRBdWRpbygpIHsNCiAgICAgICAgICAgICAgY29uc3QgYXVkaW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmdNdXNpYycpOw0KICAgICAgICAgICAgICBhdWRpby52b2x1bWUgPSAwLjM7IC8vIFNldCB2b2x1bWUgdG8gMzAlIHNvIGl0J3Mgbm90IHRvbyBsb3VkDQoNCiAgICAgICAgICAgICAgLy8gTW9kZXJuIGJyb3dzZXJzIGJsb2NrIGF1ZGlvIHVudGlsIHRoZSB1c2VyIGNsaWNrcyBzb21ldGhpbmcNCiAgICAgICAgICAgICAgY29uc3QgcGxheUF0dGVtcHQgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgICBhdWRpby5wbGF5KCkudGhlbigoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgLy8gT25jZSBwbGF5aW5nIHN0YXJ0cywgcmVtb3ZlIHRoZSAiZmlyc3QtY2xpY2siIGxpc3RlbmVycw0KICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgcGxheUF0dGVtcHQpOw0KICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBwbGF5QXR0ZW1wdCk7DQogICAgICAgICAgICAgICAgICB9KS5jYXRjaChlID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiQXVkaW8gd2FpdGluZyBmb3IgdXNlciBpbnRlcmFjdGlvbi4iKTsNCiAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICB9Ow0KDQogICAgICAgICAgICAgIC8vIFRyaWdnZXIgcGxheSBvbiB0aGUgdmVyeSBmaXJzdCBjbGljayBvciBrZXlwcmVzcyB0aGUgdXNlciBtYWtlcw0KICAgICAgICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHBsYXlBdHRlbXB0KTsNCiAgICAgICAgICAgICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIHBsYXlBdHRlbXB0KTsNCiAgICAgICAgICB9DQoNCiAgICAgICAgICAvLyAyLiBUaGUgTXV0ZS9Vbm11dGUgVG9nZ2xlIGZ1bmN0aW9uDQogICAgICAgICAgZnVuY3Rpb24gdG9nZ2xlTXV0ZSgpIHsNCiAgICAgICAgICAgICAgY29uc3QgYXVkaW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmdNdXNpYycpOw0KICAgICAgICAgICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbXV0ZUJ0bicpOw0KDQogICAgICAgICAgICAgIGlmIChhdWRpby5tdXRlZCkgew0KICAgICAgICAgICAgICAgICAgYXVkaW8ubXV0ZWQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgIGJ0bi5pbm5lckhUTUwgPSAi8J+UhyBNdXRlIjsNCiAgICAgICAgICAgICAgICAgIGJ0bi5zdHlsZS5zZXRQcm9wZXJ0eSgnYmFja2dyb3VuZCcsICcjZWVlZWVlJywgJ2ltcG9ydGFudCcpOw0KICAgICAgICAgICAgICAgICAgYnRuLnN0eWxlLnNldFByb3BlcnR5KCdjb2xvcicsICdibGFjaycsICdpbXBvcnRhbnQnKTsNCiAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgIGF1ZGlvLm11dGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgIGJ0bi5pbm5lckhUTUwgPSAi8J+UiiBVbm11dGUiOw0KICAgICAgICAgICAgICAgICAgLy8gQ2hhbmdlcyB0byBhIHNvZnQgcmVkIGJhY2tncm91bmQgd2l0aCBkYXJrIHJlZCB0ZXh0IHdoZW4gbXV0ZWQNCiAgICAgICAgICAgICAgICAgIGJ0bi5zdHlsZS5zZXRQcm9wZXJ0eSgnYmFja2dyb3VuZCcsICcjZmZkYWRhJywgJ2ltcG9ydGFudCcpOw0KICAgICAgICAgICAgICAgICAgYnRuLnN0eWxlLnNldFByb3BlcnR5KCdjb2xvcicsICcjODgwMDAwJywgJ2ltcG9ydGFudCcpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gMy4gTWFrZSBzdXJlIHRvIGNhbGwgaW5pdEF1ZGlvIHdoZW4gdGhlIHBhZ2UgbG9hZHMNCiAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIGluaXRBdWRpbyk7DQoNCg0KICAgICAgICAgIC8qKg0KKiBBbm9ueSBNYXRjaDogUGxhY2Vob2xkZXIgZm9yIGZ1dHVyZSBsb2dpYyB0byBtYXRjaA0KKiBhbm9ueW1vdXMgZG9uYXRpb25zIHdpdGggc3BlY2lmaWMgZG9ub3IgcmVjb3Jkcy4NCiovDQoNCg0KICAgICAgICAgIC8vIEhlbHBlciB0byBjbGVhbiB0aGUgcmVmZXJlbmNlIHN0cmluZyBvZiBiYW5raW5nIG5vaXNlDQogICAgICAgICAgZnVuY3Rpb24gc2FuaXRpemVSZWYoc3RyKSB7DQogICAgICAgICAgICAgIGlmICghc3RyKSByZXR1cm4gIiI7DQogICAgICAgICAgICAgIGxldCBjbGVhbiA9IHN0ci50b1VwcGVyQ2FzZSgpOw0KDQogICAgICAgICAgICAgIC8vIDEuIFJlbW92ZSBTdGFuZGFyZCBCYW5raW5nIFByZWZpeGVzDQogICAgICAgICAgICAgIGNvbnN0IG5vaXNlID0gWw0KICAgICAgICAgICAgICAgICAgIkJZIE9OTCBVUEkvIiwgIkJZIE5FRlQgVFJGIiwgIkJZIE9OTCBUUkYvIiwgIkJZIE9OTCBJTVBTLyIsDQogICAgICAgICAgICAgICAgICAiQlkgT05MIENSLyIsICJCWSBPTkwgTUIvIiwgIkJZIE9OTCBDQy8iLCAiQlkgT05MIERDLyIsDQogICAgICAgICAgICAgICAgICAiQlkgVFJBTlNGRVItIiwgIkJZIFRSQU5TRkVSLyIsICJCWSBDQVNIIiwgIjo6MDAwMzIiLCAiOjowMDAwMSINCiAgICAgICAgICAgICAgXTsNCiAgICAgICAgICAgICAgbm9pc2UuZm9yRWFjaChwID0+IHsgY2xlYW4gPSBjbGVhbi5zcGxpdChwKS5qb2luKCIiKTsgfSk7DQoNCiAgICAgICAgICAgICAgLy8gMi4gUmVtb3ZlIE51bWJlcnMgKElEcywgSUZTQyBjb2RlcywgRGF0ZXMpIHRvIGZvY3VzIG9uIG5hbWVzL3RleHQNCiAgICAgICAgICAgICAgLy8gV2UgcmVwbGFjZSBkaWdpdHMgd2l0aCBhIHNwYWNlIHNvIHdlIGRvbid0IGFjY2lkZW50YWxseSBqb2luIHR3byB3b3Jkcw0KICAgICAgICAgICAgICBjbGVhbiA9IGNsZWFuLnJlcGxhY2UoL1swLTldL2csICIgIik7DQoNCiAgICAgICAgICAgICAgLy8gMy4gUmVtb3ZlIFNwZWNpYWwgQ2hhcmFjdGVycyBhbmQgZXh0cmEgc3BhY2VzDQogICAgICAgICAgICAgIGNsZWFuID0gY2xlYW4ucmVwbGFjZSgvW15BLVogXS9nLCAiICIpOw0KDQogICAgICAgICAgICAgIC8vIDQuIFJldHVybiBjb25kZW5zZWQgdXBwZXJjYXNlIHN0cmluZyAoZS5nLiwgIk1ZVEhJTElJQ0lDTVlKSU5KVSIpDQogICAgICAgICAgICAgIHJldHVybiBjbGVhbi5yZXBsYWNlKC9ccysvZywgIiIpLnRyaW0oKTsNCiAgICAgICAgICB9DQoNCg0KICAgICAgICAgIC8qKg0KKiBTQU5JVElaQVRJT04gRU5HSU5FDQoqIFJlbW92ZXMgYmFuayBwcmVmaXhlcywgdHJhbnNhY3Rpb24gSURzLCBhbmQgc3RhbmRhcmQgc3VmZml4ZXMuDQoqLw0KICAgICAgICAgIGZ1bmN0aW9uIHNhbml0aXplUmVmKHN0cikgew0KICAgICAgICAgICAgICBpZiAoIXN0ciB8fCB0eXBlb2Ygc3RyICE9PSAnc3RyaW5nJykgcmV0dXJuICIiOw0KICAgICAgICAgICAgICBsZXQgY2xlYW4gPSBzdHIudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICAgICAgICAvLyAxLiBMaXN0IG9mIHBocmFzZXMgdG8gaWdub3JlIChGaW5lLXR1bmUgdGhpcyBsaXN0IGFzIG5lZWRlZCkNCiAgICAgICAgICAgICAgY29uc3Qgbm9pc2UgPSBbDQogICAgICAgICAgICAgICAgICAiQlkgT05MIFVQSS8iLCAiQlkgTkVGVCBUUkYiLCAiQlkgT05MIFRSRi8iLCAiQlkgT05MIElNUFMvIiwNCiAgICAgICAgICAgICAgICAgICJCWSBPTkwgQ1IvIiwgIkJZIE9OTCBNQi8iLCAiQlkgT05MIENDLyIsICJCWSBPTkwgREMvIiwNCiAgICAgICAgICAgICAgICAgICJCWSBUUkFOU0ZFUi0iLCAiQlkgVFJBTlNGRVIvIiwgIkJZIENBU0giLCAiOjowMDAzMiIsICI6OjAwMDAxIiwNCiAgICAgICAgICAgICAgICAgICJUUkFOU0ZFUiBGUk9NIiwgIkNIIFNCSU4iLCAiRkRSTC8iLCAiSUNJQy8iDQogICAgICAgICAgICAgIF07DQogICAgICAgICAgICAgIG5vaXNlLmZvckVhY2gocCA9PiB7IGNsZWFuID0gY2xlYW4uc3BsaXQocCkuam9pbigiIik7IH0pOw0KDQogICAgICAgICAgICAgIC8vIDIuIFJlbW92ZSBhbGwgbnVtYmVycyAocmVtb3ZlcyBVUEkgSURzLCBJRlNDIGNvZGVzLCBhbmQgZGF0ZXMpDQogICAgICAgICAgICAgIGNsZWFuID0gY2xlYW4ucmVwbGFjZSgvWzAtOV0vZywgIiIpOw0KDQogICAgICAgICAgICAgIC8vIDMuIFJlbW92ZSBub24tYWxwaGEgY2hhcmFjdGVycyAoc2xhc2hlcywgY29sb25zLCBkb3RzKQ0KICAgICAgICAgICAgICBjbGVhbiA9IGNsZWFuLnJlcGxhY2UoL1teQS1aXS9nLCAiIik7DQoNCiAgICAgICAgICAgICAgcmV0dXJuIGNsZWFuLnRyaW0oKTsNCiAgICAgICAgICB9DQoNCg0KICAgICAgICAgIC8qKg0KKiBTQU5JVElaQVRJT04gRU5HSU5FDQoqIFJlbW92ZXMgYmFuayBwcmVmaXhlcywgdHJhbnNhY3Rpb24gSURzLCBhbmQgc3RhbmRhcmQgc3VmZml4ZXMuDQoqLw0KICAgICAgICAgIGZ1bmN0aW9uIHNhbml0aXplUmVmKHN0cikgew0KICAgICAgICAgICAgICBpZiAoIXN0ciB8fCB0eXBlb2Ygc3RyICE9PSAnc3RyaW5nJykgcmV0dXJuICIiOw0KICAgICAgICAgICAgICBsZXQgY2xlYW4gPSBzdHIudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICAgICAgICAvLyAxLiBMaXN0IG9mIHBocmFzZXMgdG8gaWdub3JlIChGaW5lLXR1bmUgdGhpcyBsaXN0IGFzIG5lZWRlZCkNCiAgICAgICAgICAgICAgY29uc3Qgbm9pc2UgPSBbDQogICAgICAgICAgICAgICAgICAiQlkgT05MIFVQSS8iLCAiQlkgTkVGVCBUUkYiLCAiQlkgT05MIFRSRi8iLCAiQlkgT05MIElNUFMvIiwNCiAgICAgICAgICAgICAgICAgICJCWSBPTkwgQ1IvIiwgIkJZIE9OTCBNQi8iLCAiQlkgT05MIENDLyIsICJCWSBPTkwgREMvIiwNCiAgICAgICAgICAgICAgICAgICJCWSBUUkFOU0ZFUi0iLCAiQlkgVFJBTlNGRVIvIiwgIkJZIENBU0giLCAiOjowMDAzMiIsICI6OjAwMDAxIiwNCiAgICAgICAgICAgICAgICAgICJUUkFOU0ZFUiBGUk9NIiwgIkNIIFNCSU4iLCAiRkRSTC8iLCAiSUNJQy8iDQogICAgICAgICAgICAgIF07DQogICAgICAgICAgICAgIG5vaXNlLmZvckVhY2gocCA9PiB7IGNsZWFuID0gY2xlYW4uc3BsaXQocCkuam9pbigiIik7IH0pOw0KDQogICAgICAgICAgICAgIC8vIDIuIFJlbW92ZSBhbGwgbnVtYmVycyAocmVtb3ZlcyBVUEkgSURzLCBJRlNDIGNvZGVzLCBhbmQgZGF0ZXMpDQogICAgICAgICAgICAgIGNsZWFuID0gY2xlYW4ucmVwbGFjZSgvWzAtOV0vZywgIiIpOw0KDQogICAgICAgICAgICAgIC8vIDMuIFJlbW92ZSBub24tYWxwaGEgY2hhcmFjdGVycyAoc2xhc2hlcywgY29sb25zLCBkb3RzKQ0KICAgICAgICAgICAgICBjbGVhbiA9IGNsZWFuLnJlcGxhY2UoL1teQS1aXS9nLCAiIik7DQoNCiAgICAgICAgICAgICAgcmV0dXJuIGNsZWFuLnRyaW0oKTsNCiAgICAgICAgICB9DQoNCg0KICAgICAgICAgIGZ1bmN0aW9uIGRvd25sb2FkQW5vbnlNYXRjaCgpIHsNCiAgICAgICAgICAgICAgY29uc3QgdGFibGVCb2R5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hdGNoVGFibGVCb2R5Jyk7DQogICAgICAgICAgICAgIGlmICghdGFibGVCb2R5IHx8IHRhYmxlQm9keS5yb3dzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgYWxlcnQoIk5vIHJlc3VsdHMgdG8gZG93bmxvYWQuIik7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICBsZXQgdGV4dENvbnRlbnQgPSAiQU5PTllNT1VTIE1BVENIIFJFU1VMVFNcbiI7DQogICAgICAgICAgICAgIHRleHRDb250ZW50ICs9ICJHZW5lcmF0ZWQgb246ICIgKyBuZXcgRGF0ZSgpLnRvTG9jYWxlU3RyaW5nKCkgKyAiXG4iOw0KICAgICAgICAgICAgICB0ZXh0Q29udGVudCArPSAiPSIucmVwZWF0KDgwKSArICJcblxuIjsNCg0KICAgICAgICAgICAgICBjb25zdCByb3dzID0gdGFibGVCb2R5LnF1ZXJ5U2VsZWN0b3JBbGwoJ3RyJyk7DQoNCiAgICAgICAgICAgICAgcm93cy5mb3JFYWNoKHJvdyA9PiB7DQogICAgICAgICAgICAgICAgICAvLyBTa2lwIHRoZSBncmF5IHNwYWNlciByb3dzDQogICAgICAgICAgICAgICAgICBpZiAocm93LmNsYXNzTGlzdC5jb250YWlucygnc3BhY2VyLXJvdycpIHx8IHJvdy5zdHlsZS5oZWlnaHQgPT09ICIxNXB4Iikgew0KICAgICAgICAgICAgICAgICAgICAgIHRleHRDb250ZW50ICs9ICItIi5yZXBlYXQoODApICsgIlxuXG4iOyAvLyBEaXZpZGVyIGFmdGVyIGV2ZXJ5IHNldA0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgY29uc3QgY29scyA9IHJvdy5xdWVyeVNlbGVjdG9yQWxsKCd0ZCcpOw0KICAgICAgICAgICAgICAgICAgaWYgKGNvbHMubGVuZ3RoIDwgNCkgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgICBjb25zdCByZWNlaXB0ID0gY29sc1swXS5pbm5lclRleHQucmVwbGFjZSgvXG4vZywgIiB8ICIpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgYW1vdW50ID0gY29sc1sxXS5pbm5lclRleHQ7DQogICAgICAgICAgICAgICAgICBjb25zdCBkb25vciA9IGNvbHNbMl0uaW5uZXJUZXh0LnJlcGxhY2UoL1xuL2csICIgIik7DQogICAgICAgICAgICAgICAgICBjb25zdCByZWYgPSBjb2xzWzNdLmlubmVyVGV4dDsNCg0KICAgICAgICAgICAgICAgICAgaWYgKHJvdy5jbGFzc0xpc3QuY29udGFpbnMoJ2Fub255LW1haW4tcm93JykpIHsNCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0Q29udGVudCArPSBgW1RBUkdFVF0gUmVjZWlwdDogJHtyZWNlaXB0fSB8IEFtdDogJHthbW91bnR9XG5gOw0KICAgICAgICAgICAgICAgICAgICAgIHRleHRDb250ZW50ICs9IGAgICAgICAgICBSZWY6ICR7cmVmfVxuYDsNCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0Q29udGVudCArPSAiTWF0Y2hlcyBGb3VuZDpcbiI7DQogICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgIHRleHRDb250ZW50ICs9IGAgICA+PiBNYXRjaDogJHtyZWNlaXB0fSB8IEFtdDogJHthbW91bnR9XG5gOw0KICAgICAgICAgICAgICAgICAgICAgIHRleHRDb250ZW50ICs9IGAgICAgICBEb25vcjogJHtkb25vcn1cbmA7DQogICAgICAgICAgICAgICAgICAgICAgdGV4dENvbnRlbnQgKz0gYCAgICAgIFJlZjogICAke3JlZn1cblxuYDsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgLy8gQ3JlYXRlIHRoZSBkb3dubG9hZCBsaW5rDQogICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbdGV4dENvbnRlbnRdLCB7IHR5cGU6ICd0ZXh0L3BsYWluJyB9KTsNCiAgICAgICAgICAgICAgY29uc3QgdXJsID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTsNCiAgICAgICAgICAgICAgY29uc3QgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsNCiAgICAgICAgICAgICAgYS5ocmVmID0gdXJsOw0KICAgICAgICAgICAgICBhLmRvd25sb2FkID0gJ0Fub255TWF0Y2gudHh0JzsNCiAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhKTsNCiAgICAgICAgICAgICAgYS5jbGljaygpOw0KICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGEpOw0KICAgICAgICAgICAgICBVUkwucmV2b2tlT2JqZWN0VVJMKHVybCk7DQogICAgICAgICAgfQ0KDQoNCg0KDQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBydW5Bbm9ueU1hdGNoKCkgew0KICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nRGl2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdNc2cnKTsNCiAgICAgICAgICAgICAgaWYgKGxvYWRpbmdEaXYpIHsNCiAgICAgICAgICAgICAgICAgIGxvYWRpbmdEaXYuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQogICAgICAgICAgICAgICAgICBsb2FkaW5nRGl2LmlubmVySFRNTCA9ICJJbml0aWFsaXppbmcgTWF0Y2ggZm9yIFNlbGVjdGVkIFllYXIuLi4iOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgLy8gR2V0IHRoZSBzZWxlY3RlZCB5ZWFyIGZyb20geW91ciBkYXNoYm9hcmQgcmFkaW8gYnV0dG9ucw0KICAgICAgICAgICAgICBjb25zdCBzWWVhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InllYXJGaWx0ZXIiXTpjaGVja2VkJykudmFsdWU7DQoNCiAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDEwMCkpOw0KDQogICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICBjbGVhcldvcmtzcGFjZSgpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0c0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxlZFJlc3VsdHMnKTsNCg0KICAgICAgICAgICAgICAgICAgcmVzdWx0c0Rpdi5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICAgICAgICA8aDMgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyOyBwYWRkaW5nOjEwcHg7Ij5Bbm9ueW1vdXMgSWRlbnRpdHkgTWF0Y2ggKEZZICR7c1llYXJ9KTwvaDM+DQogICAgICAgICAgICAgICAgICA8dGFibGUgaWQ9Im1hdGNoVGFibGUiIGJvcmRlcj0iMSIgc3R5bGU9IndpZHRoOjEwMCU7IGJvcmRlci1jb2xsYXBzZTpjb2xsYXBzZTsiPg0KICAgICAgICAgICAgICAgICAgICAgIDx0aGVhZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgPHRyIHN0eWxlPSJiYWNrZ3JvdW5kOiNmMmYyZjI7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0aCBzdHlsZT0id2lkdGg6MjAlIj5SZWNlaXB0IC8gRGF0ZTwvdGg+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGggc3R5bGU9IndpZHRoOjAlIj48L3RoPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIHN0eWxlPSJ3aWR0aDozMCUiPkRvbm9yIERldGFpbHM8L3RoPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRoIHN0eWxlPSJ3aWR0aDo1MCUiPk9yaWdpbmFsIFJlZmVyZW5jZTwvdGg+DQogICAgICAgICAgICAgICAgICAgICAgICAgIDwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgPC90aGVhZD4NCiAgICAgICAgICAgICAgICAgICAgICA8dGJvZHkgaWQ9Im1hdGNoVGFibGVCb2R5Ij48L3Rib2R5Pg0KICAgICAgICAgICAgICAgICAgPC90YWJsZT5gOw0KDQogICAgICAgICAgICAgICAgICBjb25zdCB0YWJsZUJvZHkgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWF0Y2hUYWJsZUJvZHknKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKERBVEFfVVJMKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgYWxsUmVjb3JkcyA9IHRleHQuc3BsaXQoJ1xuJykuZmlsdGVyKHIgPT4gci5sZW5ndGggPiAyMCk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIDEuIElkZW50aWZ5IFRhcmdldCBBbm9ueW1vdXMgUmVjb3JkcyBPTkxZIGZvciB0aGUgc2VsZWN0ZWQgRmluYW5jaWFsIFllYXINCiAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldHMgPSBhbGxSZWNvcmRzLmZpbHRlcihyID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgZiA9IHIuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCByTm8gPSAoZlswXSB8fCAiIikudG9VcHBlckNhc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCByRGF0ZSA9IHBhcnNlRGF0ZShmWzFdKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0NhbmNlbGxlZCA9IGZbMTNdPy50cmltKCkudG9VcHBlckNhc2UoKSA9PT0gIllFUyI7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNBbm9uID0gKCFmWzJdIHx8IGZbMl0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcygiYW5vbnltb3VzIikpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzR1cgPSByTm8uc3RhcnRzV2l0aCgiR1ciKTsNCg0KICAgICAgICAgICAgICAgICAgICAgIC8vIEFwcGx5IEZpbmFuY2lhbCBZZWFyIExvZ2ljIChNYXRjaGluZyB5b3VyIHJ1bkFub255bW91cyBsb2dpYykNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgaW5ZZWFyID0gKHNZZWFyID09PSAiYWxsIik7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKCFpblllYXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZnlTID0gcGFyc2VJbnQoc1llYXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gckRhdGUuZ2V0TW9udGgoKSArIDEsIHkgPSByRGF0ZS5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpblllYXIgPSAoeSA9PT0gZnlTICYmIG0gPj0gNCkgfHwgKHkgPT09IGZ5UyArIDEgJiYgbSA8PSAzKTsNCiAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaW5ZZWFyICYmIGlzQW5vbiAmJiAhaXNDYW5jZWxsZWQgJiYgIWlzR1c7DQogICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgaWYgKHRhcmdldHMubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgcmVzdWx0c0Rpdi5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0ncGFkZGluZzoyMHB4OyB0ZXh0LWFsaWduOmNlbnRlcjsnPk5vIGFub255bW91cyByZWNvcmRzIGZvdW5kIGZvciBGWSAke3NZZWFyfS48L2Rpdj5gOw0KICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nRGl2KSBsb2FkaW5nRGl2LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICBjb25zdCBtYXRjaExlbmd0aCA9IDE1Ow0KICAgICAgICAgICAgICAgICAgbGV0IGNsdXN0ZXJzRm91bmQgPSAwOw0KDQogICAgICAgICAgICAgICAgICAvLyAyLiBMb29wIHRocm91Z2ggdGhlIFllYXItU3BlY2lmaWMgVGFyZ2V0cw0KICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRpbmdEaXYpIGxvYWRpbmdEaXYuaW5uZXJIVE1MID0gYFNjYW5uaW5nIFJlY29yZCAke2kgKyAxfSBvZiAke3RhcmdldHMubGVuZ3RofS4uLmA7DQogICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDEpKTsNCg0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSB0YXJnZXRzW2ldLnNwbGl0KCd8Jyk7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgbVJlZkNsZWFuID0gc2FuaXRpemVSZWYobVsxMF0pOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1JRCA9IG1bMF07DQoNCiAgICAgICAgICAgICAgICAgICAgICBpZiAobVJlZkNsZWFuLmxlbmd0aCA8IG1hdGNoTGVuZ3RoKSBjb250aW51ZTsNCg0KICAgICAgICAgICAgICAgICAgICAgIGxldCBtYXRjaGVzSHRtbCA9ICIiOw0KICAgICAgICAgICAgICAgICAgICAgIGxldCBtYXRjaENvdW50ID0gMDsNCg0KICAgICAgICAgICAgICAgICAgICAgIC8vIDMuIFNlYXJjaCBHTE9CQUwgZGF0YWJhc2UgZm9yIG1hdGNoZXMgKE5vIHllYXIgcmVzdHJpY3Rpb24gaGVyZSkNCiAgICAgICAgICAgICAgICAgICAgICBhbGxSZWNvcmRzLmZvckVhY2goZGJSb3cgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkID0gZGJSb3cuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZE5vID0gKGRbMF0gfHwgIiIpLnRvVXBwZXJDYXNlKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRbMF0gPT09IG1JRCB8fCBkTm8uc3RhcnRzV2l0aCgiR1ciKSkgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ2FuZGlkYXRlQW5vbiA9ICghZFsyXSB8fCBkWzJdLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoImFub255bW91cyIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ2FuZGlkYXRlQW5vbikgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ2FuY2VsbGVkID0gZFsxM10/LnRvVXBwZXJDYXNlKCkgPT09ICJZRVMiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0Nhc2ggPSAoZFsxMV0gfHwgIiIpLnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoIkNBU0giKSB8fCAoZFs4XSB8fCAiIikudG9VcHBlckNhc2UoKS5pbmNsdWRlcygiQ0FTSCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNDYW5jZWxsZWQgfHwgaXNDYXNoKSByZXR1cm47DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZFJlZkNsZWFuID0gc2FuaXRpemVSZWYoZFsxMF0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZFJlZkNsZWFuLmxlbmd0aCA8IG1hdGNoTGVuZ3RoKSByZXR1cm47DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kT3ZlcmxhcCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZFJlZkNsZWFuLmluY2x1ZGVzKG1SZWZDbGVhbikgfHwgbVJlZkNsZWFuLmluY2x1ZGVzKGRSZWZDbGVhbikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kT3ZlcmxhcCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8PSBtUmVmQ2xlYW4ubGVuZ3RoIC0gbWF0Y2hMZW5ndGg7IHgrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkUmVmQ2xlYW4uaW5jbHVkZXMobVJlZkNsZWFuLnN1YnN0cmluZyh4LCB4ICsgbWF0Y2hMZW5ndGgpKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZE92ZXJsYXAgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmRPdmVybGFwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaENvdW50Kys7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoaXN0QW10ID0gcGFyc2VGbG9hdChkWzldIHx8IDApLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlc0h0bWwgKz0gYA0KDQo8dHIgY2xhc3M9Im1hdGNoLXJlc3VsdC1yb3ciPg0KICAgICAgICAgICAgICA8dGQ+JHtkWzBdfTxicj4ke2RbMV19PGJyPnvigrkke3BhcnNlRmxvYXQoZFs5XSB8fCAwKS50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPg0KICAgICAgICAgICAgICA8dGQ+PC90ZD4NCiAgICAgICAgICAgICAgPHRkPjxiPiR7ZFsyXX08L2I+PGJyPjxzbWFsbD4ke2RbNF19PGJyPlBJTjogJHtkWzE1XX0gfCAke2RbMTldfTxicj5UZWw6ICR7ZFszXX08L3NtYWxsPjwvdGQ+DQogICAgICAgICAgICAgIDx0ZCBzdHlsZT0id29yZC1icmVhazpicmVhay1hbGw7IGZvbnQtc2l6ZTowLjc1cmVtOyI+DQogICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJjb2xvcjpwdXJwbGU7IGZvbnQtd2VpZ2h0OmJvbGQ7IGJvcmRlci1ib3R0b206MXB4IHNvbGlkICNkZGQ7IG1hcmdpbi1ib3R0b206NHB4OyI+VDogJHttWzEwXX08L2Rpdj4NCiAgICAgICAgICAgICAgICAgIDxkaXY+TTogJHtkWzEwXX08L2Rpdj4NCiAgICAgICAgICAgICAgPC90ZD4NCiAgICAgICAgICA8L3RyPmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaENvdW50ID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICBjbHVzdGVyc0ZvdW5kKys7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRhcmdldEFtdCA9IHBhcnNlRmxvYXQobVs5XSB8fCAwKS50b0xvY2FsZVN0cmluZygnZW4tSU4nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaGVhZGVyID0gYA0KICAgICAgICAgICAgICAgICAgICAgICAgICA8dHIgY2xhc3M9ImFub255LW1haW4tcm93IiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogI0UxQkVFNyAhaW1wb3J0YW50OyBmb250LXdlaWdodDogYm9sZDsiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHRkPiR7bVswXX08YnI+JHttWzFdfTxicj574oK5JHt0YXJnZXRBbXR9fTwvdGQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQ+PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT0iY29sb3I6cHVycGxlOyB0ZXh0LWFsaWduOmNlbnRlcjsiPjxiPlsgQU5PTllNT1VTIFRBUkdFVCBdPC9iPjwvdGQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9IndvcmQtYnJlYWs6YnJlYWstYWxsOyBmb250LXNpemU6MC43NXJlbTsiPiR7bVsxMF19PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgPC90cj5gOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZUJvZHkuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBoZWFkZXIgKyBtYXRjaGVzSHRtbCArIGA8dHIgc3R5bGU9ImhlaWdodDoxNXB4OyBiYWNrZ3JvdW5kOiNmMGYwZjA7Ij48dGQgY29sc3Bhbj0iNCI+PC90ZD48L3RyPmApOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgLy8gNC4gU3VtbWFyeSBCYXIgd2l0aCBEb3dubG9hZCBCdXR0b24NCiAgICAgICAgICAgICAgICAgIGNvbnN0IGIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoU3VtbWFyeUJhcicpOw0KICAgICAgICAgICAgICAgICAgYi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgICAgICAgICAgIGIuaW5uZXJIVE1MID0gYA0KICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogY2VudGVyOyB3aWR0aDogMTAwJTsgcGFkZGluZzogNXB4OyI+DQogICAgICAgICAgICAgICAgICAgICAgPHNwYW4+RlkgJHtzWWVhcn06IEZvdW5kICR7Y2x1c3RlcnNGb3VuZH0gZG9ub3JzIGZvciAke3RhcmdldHMubGVuZ3RofSBhbm9ueW1vdXMgcmVjb3Jkcy48L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJkb3dubG9hZEFub255TWF0Y2goKSIgY2xhc3M9InV0aWwtbWVudS1idG4iDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT0iYmFja2dyb3VuZDogIzI4YTc0NSAhaW1wb3J0YW50OyBjb2xvcjogd2hpdGUgIWltcG9ydGFudDsgd2lkdGg6IGF1dG87IHBhZGRpbmc6IDVweCAxNXB4OyI+DQogICAgICAgICAgICAgICAgICAgICAgICAgIERvd25sb2FkIExpc3QgKC50eHQpDQogICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICA8L2Rpdj5gOw0KICAgICAgICAgICAgICAgICAgbG9hZGluZ0Rpdi5pbm5lckhUTUwgPSAiUGxlYXNlIHdhaXQgLSBXb3JraW5nIG9uIHlvdXIgcmVxdWVzdCI7DQogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpOw0KICAgICAgICAgICAgICAgICAgYWxlcnQoIkxvZ2ljIGVycm9yOiAiICsgZXJyLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgICAgICAgaWYgKGxvYWRpbmdEaXYpIGxvYWRpbmdEaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgICAgICAgIHRvZ2dsZVNjcm9sbEJ1dHRvbnModHJ1ZSk7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCg0KDQogICAgICAgICAgZnVuY3Rpb24gcmVuZGVyTWF0Y2hSb3coZCkgew0KICAgICAgICAgICAgICBjb25zdCBhbXQgPSAocGFyc2VGbG9hdChkWzldKSB8fCAwKS50b0xvY2FsZVN0cmluZygnZW4tSU4nKTsNCiAgICAgICAgICAgICAgcmV0dXJuIGANCiAgICAgICAgICAgICAgPHRyIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmZmZmOyI+DQogICAgICAgICAgICAgICAgICA8dGQ+JHtkWzBdfTxicj4ke2RbMV19PC90ZD4NCiAgICAgICAgICAgICAgICAgIDx0ZD7igrkke2FtdH08L3RkPg0KICAgICAgICAgICAgICAgICAgPHRkPjxiPiR7ZFsyXX08L2I+PGJyPjxzbWFsbD4ke2RbNF19PGJyPlBJTjogJHtkWzE1XX0gfCAke2RbMTldfTxicj5UZWw6ICR7ZFszXX08L3NtYWxsPjwvdGQ+DQogICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9IndvcmQtYnJlYWs6YnJlYWstYWxsOyBmb250LXNpemU6MC43NXJlbTsiPiR7ZFsxMF19PC90ZD4NCiAgICAgICAgICAgICAgPC90cj5gOw0KICAgICAgICAgIH0NCg0KDQoNCiAgICAgICAgICAvLyBIZWxwZXIgdG8gcmVuZGVyIHRoZSBkb25vciByb3cNCiAgICAgICAgICBmdW5jdGlvbiByZW5kZXJNYXRjaFJvdyhkKSB7DQogICAgICAgICAgICAgIHJldHVybiBgDQogICAgICAgICAgICAgIDx0ciBjbGFzcz0ibWF0Y2gtcmVzdWx0LXJvdyI+DQogICAgICAgICAgICAgICAgICA8dGQ+JHtkWzBdfTxicj4ke2RbMV19PC90ZD4NCiAgICAgICAgICAgICAgICAgIDx0ZD4ke2RbNV19PC90ZD4NCiAgICAgICAgICAgICAgICAgIDx0ZD48Yj4ke2RbMl19PC9iPjxicj48c21hbGw+JHtkWzRdfTxicj5QSU46ICR7ZFsxNV19IHwgJHtkWzE0XX08YnI+VGVsOiAke2RbM119PC9zbWFsbD48L3RkPg0KICAgICAgICAgICAgICAgICAgPHRkIHN0eWxlPSJ3b3JkLWJyZWFrOmJyZWFrLWFsbDsgZm9udC1zaXplOjAuNzVyZW07Ij4ke2RbMTBdfTwvdGQ+DQogICAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgICB9DQoNCg0KDQoNCiAgICAgICAgICAvLyBIZWxwZXIgZnVuY3Rpb24gdG8ga2VlcCBjb2RlIGNsZWFuDQogICAgICAgICAgZnVuY3Rpb24gcmVuZGVyTWF0Y2hSb3coZCkgew0KICAgICAgICAgICAgICBjb25zdCBkb25vckRldGFpbHMgPSBgPGI+JHtkWzJdfTwvYj48YnI+JHtkWzRdfTxicj5QSU46ICR7ZFsxNV19IHwgJHtkWzE0XX08YnI+VGVsOiAke2RbM119YDsNCiAgICAgICAgICAgICAgcmV0dXJuIGA8dHIgY2xhc3M9Im1hdGNoLXJlc3VsdC1yb3ciPg0KICAgICAgICAgICAgICAgICAgICAgIDx0ZD4ke2RbMF19PGJyPiR7ZFsxXX08L3RkPg0KICAgICAgICAgICAgICAgICAgICAgIDx0ZD4ke2RbNV19PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICA8dGQ+JHtkb25vckRldGFpbHN9PC90ZD4NCiAgICAgICAgICAgICAgICAgICAgICA8dGQ+JHtkWzEwXX08L3RkPg0KICAgICAgICAgICAgICAgICAgIDwvdHI+YDsNCiAgICAgICAgICB9DQoNCg0KDQogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gdXBkYXRlVXNlclN0YXR1cygpIHsNCiAgICAgICAgICAgICAgY29uc3QgbW9uaXRvckRpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VyTW9uaXRvcicpOw0KICAgICAgICAgICAgICBjb25zdCB1c2VyRmlsZVVybCA9ICJodHRwczovL2RsLmRyb3Bib3h1c2VyY29udGVudC5jb20vc2NsL2ZpL2c3MjNpcThwamtyam1kNmUzdXY2cC9Vc2Vycy50eHQ/cmxrZXk9NDNkdGtkNzZrcGQwOXdrYjhyandydzFvYyZzdD1iMmd1bWQxYSZkbD0xJm5vY2FjaGU9IiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpOw0KDQogICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKHVzZXJGaWxlVXJsKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXNwb25zZS50ZXh0KCk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIFBhcnNlIHVzZXIgbmFtZXMgZnJvbSB0aGUgcGlwZS1kZWxpbWl0ZWQgZmlsZQ0KICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFVzZXJzID0gdGV4dC5zcGxpdCgvXHI/XG4vKQ0KICAgICAgICAgICAgICAgICAgICAgIC5tYXAobGluZSA9PiBsaW5lLnRyaW0oKSkNCiAgICAgICAgICAgICAgICAgICAgICAuZmlsdGVyKGxpbmUgPT4gbGluZS5pbmNsdWRlcygnfCcpKQ0KICAgICAgICAgICAgICAgICAgICAgIC5tYXAobGluZSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHBhcnRzID0gbGluZS5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gcGFydHNbMV0gPyBwYXJ0c1sxXS50cmltKCkgOiAiIjsNCiAgICAgICAgICAgICAgICAgICAgICB9KQ0KICAgICAgICAgICAgICAgICAgICAgIC5maWx0ZXIodSA9PiB1Lmxlbmd0aCA+IDApOw0KDQogICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFVzZXJzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgIG1vbml0b3JEaXYuY2xhc3NOYW1lID0gInN0YXR1cy1lbXB0eSI7DQogICAgICAgICAgICAgICAgICAgICAgbW9uaXRvckRpdi5pbm5lckhUTUwgPSBgPGRpdiBzdHlsZT0iY29sb3I6Izc1NzU3NTsiPk5vIG9uZSB1c2luZyB0aGUgTWFpbiBTb2Z0d2FyZSBOb3c8L2Rpdj5gOw0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICBtb25pdG9yRGl2LmNsYXNzTmFtZSA9ICJzdGF0dXMtYWN0aXZlIjsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkaXNwbGF5TGlzdCA9IGN1cnJlbnRVc2Vycy5qb2luKCIgfCAiKTsNCiAgICAgICAgICAgICAgICAgICAgICAvLyBMaW5lIDE6IE1haW4gU29mdHdhcmUgVXNlcnMNCiAgICAgICAgICAgICAgICAgICAgICBtb25pdG9yRGl2LmlubmVySFRNTCA9IGA8ZGl2IHN0eWxlPSJwYWRkaW5nLWJvdHRvbToycHg7Ij48c3BhbiBjbGFzcz0ibGl2ZS1kb3QiPjwvc3Bhbj4gPHNwYW4gc3R5bGU9ImNvbG9yOiNmZmQ2MDA7Ij5NYWluIFNvZnR3YXJlIFVzZXI6PC9zcGFuPiBbICR7ZGlzcGxheUxpc3R9IF08L2Rpdj5gOw0KICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAvLyBMaW5lIDI6IEFwcCB1c2VycyAoQ2FsY3VsYXRlZCBmcm9tIHlvdXIgZ2xvYmFsIHZhcmlhYmxlKQ0KICAgICAgICAgICAgICAgICAgY29uc3QgYXBwVXNlckxhYmVsID0gKHR5cGVvZiBnbG9iYWxBcHBVc2VySWRlbnRpdHkgIT09ICd1bmRlZmluZWQnICYmIGdsb2JhbEFwcFVzZXJJZGVudGl0eSkgPyBnbG9iYWxBcHBVc2VySWRlbnRpdHkgOiAiQWN0aXZlIjsNCiAgICAgICAgICAgICAgICAgIG1vbml0b3JEaXYuaW5uZXJIVE1MICs9IGA8ZGl2PjxzcGFuIGNsYXNzPSJsaXZlLWRvdCI+PC9zcGFuPkFwcCB1c2VycyA6IDxzcGFuIGlkPSJhY3RpdmVVc2VyTGlzdCI+JHthcHBVc2VyTGFiZWx9PC9zcGFuPjwvZGl2PmA7DQoNCiAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBwcmV2aW91c1VzZXJMaXN0IGZvciB0aGUgbG9naW4gbm90aWZpY2F0aW9uIGxvZ2ljIGVsc2V3aGVyZSBpbiB5b3VyIHNjcmlwdA0KICAgICAgICAgICAgICAgICAgcHJldmlvdXNVc2VyTGlzdCA9IGN1cnJlbnRVc2VyczsNCg0KICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIk1vbml0b3IgU3luYyBFcnJvcjoiLCBlcnIpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQoNCg0KDQoNCiAgICAgICAgICAvLyBDYWxsIHRoZSBmdW5jdGlvbiBvbiBsb2FkDQogICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCB1cGRhdGVVc2VyU3RhdHVzKTsNCiAgICAgICAgICAvLyBPcHRpb25hbDogUmVmcmVzaCBldmVyeSA2MCBzZWNvbmRzDQogICAgICAgICAgc2V0SW50ZXJ2YWwodXBkYXRlVXNlclN0YXR1cywgNjAwMDApOw0KDQoNCiAgICAgICAgICAvLyBORVc6IEdsb2JhbCB2YXJpYWJsZSBmb3IgdGhlIElkZW50aXR5IE5hbWUNCiAgICAgICAgICBsZXQgYXBwVXNlcklkZW50aXR5ID0gIlVzZXIiOw0KDQogICAgICAgICAgLyoqDQogICAgICAgICAgICogTkVXIEZVTkNUSU9OOiBSZWFkcyBBcHByb3ZlZDIudHh0LCBtYXRjaGVzIHRoZSBJRCwNCiAgICAgICAgICAgKiBhbmQgZXh0cmFjdHMgdGhlIG5hbWUgcGFydCBhZnRlciB0aGUgInwiIHNlcGFyYXRvci4NCiAgICAgICAgICAgKi8NCg0KDQoNCg0KDQoNCiAgICAgICAgICAvLyAtLS0gQ09ORklHVVJBVElPTiAtLS0NCiAgICAgICAgICBjb25zdCBCSU5fSUQgPSAiNjk2MzVkOGZkMGVhODgxZjQwNjNhNzJlIjsNCiAgICAgICAgICBjb25zdCBNQVNURVJfS0VZID0gIiQyYSQxMCRjQnNVQ2IzU3JwR01JZkoyNmIyOC4uY3FUd1JUNWpGQXNYSnN3ak4vVy9DQTNrUVh1dU4xdSI7DQogICAgICAgICAgdmFyIGdsb2JhbEFwcFVzZXJJZGVudGl0eSA9ICIiOw0KDQogICAgICAgICAgLy8gLS0tIDEuIFRIRSBDTE9VRCBTWU5DIExPR0lDIChIYW5kbGVzIFNlbGYtQ2xlYW5pbmcpIC0tLQ0KDQoNCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIHN5bmNXaXRoSnNvbkJpbigpIHsNCiAgICAgICAgICAgICAgaWYgKCFnbG9iYWxBcHBVc2VySWRlbnRpdHkpIHJldHVybjsNCg0KICAgICAgICAgICAgICBjb25zdCBCSU5fSUQgPSAiNjk2MzVkOGZkMGVhODgxZjQwNjNhNzJlIjsNCiAgICAgICAgICAgICAgY29uc3QgTUFTVEVSX0tFWSA9ICIkMmEkMTAkY0JzVUNiM1NycEdNSWZKMjZiMjguLmNxVHdSVDVqRkFzWEpzd2pOL1cvQ0Eza1FYdXVOMXUiOw0KDQogICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAvLyBXZSBhZGQgP25vY2FjaGU9Li4uIHRvIGZvcmNlIHRoZSBicm93c2VyIHRvIGdldCB0aGUgcmVhbCBkYXRhIGZyb20gdGhlIGJpbg0KICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgaHR0cHM6Ly9hcGkuanNvbmJpbi5pby92My9iLyR7QklOX0lEfS9sYXRlc3Q/bm9jYWNoZT0ke0RhdGUubm93KCl9YCwgew0KICAgICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgIlgtTWFzdGVyLUtleSI6IE1BU1RFUl9LRVkgfQ0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuanNvbigpOw0KICAgICAgICAgICAgICAgICAgbGV0IHJhd05hbWVzID0gZGF0YS5yZWNvcmQudXNlcnMgfHwgIiI7DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IG5vdyA9IE1hdGguZmxvb3IoRGF0ZS5ub3coKSAvIDEwMDApOw0KICAgICAgICAgICAgICAgICAgY29uc3QgZXhwaXJ5TGltaXQgPSAxMjA7IC8vIDIgbWludXRlcw0KDQogICAgICAgICAgICAgICAgICBsZXQgYWxsRW50cmllcyA9IHJhd05hbWVzID8gcmF3TmFtZXMuc3BsaXQoJywnKSA6IFtdOw0KICAgICAgICAgICAgICAgICAgbGV0IHZhbGlkRW50cmllcyA9IFtdOw0KICAgICAgICAgICAgICAgICAgbGV0IGRpc3BsYXlOYW1lcyA9IFtdOw0KDQogICAgICAgICAgICAgICAgICBhbGxFbnRyaWVzLmZvckVhY2goZW50cnkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IFtuYW1lLCB0aW1lc3RhbXBdID0gZW50cnkuc3BsaXQoJzonKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbnRyeVRpbWUgPSBwYXJzZUludCh0aW1lc3RhbXApOw0KDQogICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdXNlciBpcyBhY3RpdmUgd2l0aGluIDIgbWlucywga2VlcCB0aGVtDQogICAgICAgICAgICAgICAgICAgICAgaWYgKG5hbWUgPT09IGdsb2JhbEFwcFVzZXJJZGVudGl0eSB8fCAobm93IC0gZW50cnlUaW1lKSA8IGV4cGlyeUxpbWl0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghZGlzcGxheU5hbWVzLmluY2x1ZGVzKG5hbWUpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBmaW5hbFRpbWUgPSAobmFtZSA9PT0gZ2xvYmFsQXBwVXNlcklkZW50aXR5KSA/IG5vdyA6IGVudHJ5VGltZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhbGlkRW50cmllcy5wdXNoKGAke25hbWV9OiR7ZmluYWxUaW1lfWApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWVzLnB1c2gobmFtZSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgaWYgKCFkaXNwbGF5TmFtZXMuaW5jbHVkZXMoZ2xvYmFsQXBwVXNlcklkZW50aXR5KSkgew0KICAgICAgICAgICAgICAgICAgICAgIHZhbGlkRW50cmllcy5wdXNoKGAke2dsb2JhbEFwcFVzZXJJZGVudGl0eX06JHtub3d9YCk7DQogICAgICAgICAgICAgICAgICAgICAgZGlzcGxheU5hbWVzLnB1c2goZ2xvYmFsQXBwVXNlcklkZW50aXR5KTsNCiAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgY29uc3QgdXBkYXRlZFN0cmluZyA9IHZhbGlkRW50cmllcy5qb2luKCcsJyk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIFdyaXRlIGJhY2sgdGhlIGNsZWFuZWQgbGlzdA0KICAgICAgICAgICAgICAgICAgYXdhaXQgZmV0Y2goYGh0dHBzOi8vYXBpLmpzb25iaW4uaW8vdjMvYi8ke0JJTl9JRH1gLCB7DQogICAgICAgICAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJywNCiAgICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsDQogICAgICAgICAgICAgICAgICAgICAgICAgICJYLU1hc3Rlci1LZXkiOiBNQVNURVJfS0VZDQogICAgICAgICAgICAgICAgICAgICAgfSwNCiAgICAgICAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHVzZXJzOiB1cGRhdGVkU3RyaW5nIH0pDQogICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgLy8gVXBkYXRlIFVJIGJhcg0KICAgICAgICAgICAgICAgICAgY29uc3QgbGlzdFNwYW4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWN0aXZlVXNlckxpc3QnKTsNCiAgICAgICAgICAgICAgICAgIGxpc3RTcGFuLmlubmVyVGV4dCA9IGRpc3BsYXlOYW1lcy5qb2luKCcgfCAnKTsNCg0KICAgICAgICAgICAgICAgICAgY29uc3QgbW9uaXRvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1c2VyTW9uaXRvcicpOw0KICAgICAgICAgICAgICAgICAgbW9uaXRvci5jbGFzc05hbWUgPSAnc3RhdHVzLWFjdGl2ZSc7DQogICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVpdEJ0bicpLnN0eWxlLmRpc3BsYXkgPSAnaW5saW5lLWJsb2NrJzsNCg0KICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiU3luYyBFcnJvcjoiLCBlKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KDQoNCg0KICAgICAgICAgIC8vIC0tLSAyLiBJREVOVElUWSBDSEVDSyAtLS0NCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBnZXRVc2VySWRlbnRpdHkobXlJRCkgew0KICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goImh0dHBzOi8vZGwuZHJvcGJveHVzZXJjb250ZW50LmNvbS9zY2wvZmkvMHowd2lzMDJjYTFtcmNudXRxdWMwL0FwcHJvdmVkMi50eHQ/cmxrZXk9c2tsM3V6eDUwajhuMDJ1aW1zbWF2MnRodCZkbD0xIik7DQogICAgICAgICAgICAgICAgICBjb25zdCBsaW5lcyA9IChhd2FpdCByZXMudGV4dCgpKS5zcGxpdCgvXHI/XG4vKTsNCg0KICAgICAgICAgICAgICAgICAgZm9yIChsZXQgbGluZSBvZiBsaW5lcykgew0KICAgICAgICAgICAgICAgICAgICAgIGlmIChsaW5lLmluY2x1ZGVzKG15SUQpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGdsb2JhbEFwcFVzZXJJZGVudGl0eSA9IGxpbmUuc3BsaXQoJ3wnKVsxXS50cmltKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IFVJIHRvIGFjdGl2ZSBhbmQgc2hvdyBxdWl0IGJ1dHRvbg0KICAgICAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndXNlck1vbml0b3InKS5jbGFzc05hbWUgPSAic3RhdHVzLWFjdGl2ZSI7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl0QnRuJykuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUtYmxvY2siOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEluaXRpYWwgc3luYyBhbmQgc3RhcnQgbG9vcA0KICAgICAgICAgICAgICAgICAgICAgICAgICAvL3N5bmNXaXRoSnNvbkJpbigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBzZXRJbnRlcnZhbChzeW5jV2l0aEpzb25CaW4sIDQ1MDAwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsgY29uc29sZS5lcnJvcigiSWRlbnRpdHkgbG9va3VwIGZhaWxlZC4iKTsgfQ0KICAgICAgICAgIH0NCg0KICAgICAgICAgIC8vIC0tLSAzLiBUSEUgQ09OVFJPTExFRCBRVUlUIChGb3JlZ3JvdW5kIERlbGV0aW9uKSAtLS0NCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBwcm9wZXJRdWl0KCkgew0KICAgICAgICAgICAgICBpZiAoIWdsb2JhbEFwcFVzZXJJZGVudGl0eSkgcmV0dXJuOw0KDQogICAgICAgICAgICAgIGNvbnN0IGJ0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWl0QnRuJyk7DQogICAgICAgICAgICAgIGJ0bi5pbm5lclRleHQgPSAiQ2xvc2luZy4uLiI7DQogICAgICAgICAgICAgIGJ0bi5kaXNhYmxlZCA9IHRydWU7DQoNCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgIC8vIFdlIHNlbmQgYSAiUVVJVF9SRVEiIGJlYWNvbiBmaXJzdCBhcyBhIGJhY2t1cCwgdGhlbiB0cnkgYSBmdWxsIHdpcGUNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGNsZWFudXBEYXRhID0gSlNPTi5zdHJpbmdpZnkoeyB1c2VyczogIlFVSVRfUkVRIiB9KTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbY2xlYW51cERhdGFdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyB9KTsNCiAgICAgICAgICAgICAgICAgIG5hdmlnYXRvci5zZW5kQmVhY29uKGBodHRwczovL2FwaS5qc29uYmluLmlvL3YzL2IvJHtCSU5fSUR9YCwgYmxvYik7DQoNCiAgICAgICAgICAgICAgICAgIC8vIEV4cGxpY2l0bHkgY2xlYXIgdGhlIGlkZW50aXR5IGxvY2FsbHkgc28gdGhlIHNhZmV0eSBwcm9tcHQgZG9lc24ndCB0cmlnZ2VyDQogICAgICAgICAgICAgICAgICBnbG9iYWxBcHBVc2VySWRlbnRpdHkgPSAiIjsNCiAgICAgICAgICAgICAgICAgIHdpbmRvdy5vbmJlZm9yZXVubG9hZCA9IG51bGw7DQoNCiAgICAgICAgICAgICAgICAgIGFsZXJ0KCJTZXNzaW9uIEVuZGVkLiBJdCBpcyBub3cgc2FmZSB0byBjbG9zZSB0aGlzIHRhYi4iKTsNCiAgICAgICAgICAgICAgICAgIHdpbmRvdy5jbG9zZSgpOw0KICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICBhbGVydCgiRXhpdCBlcnJvci4gWW91IGNhbiBjbG9zZSB0aGUgdGFiIG1hbnVhbGx5LiIpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQogICAgICAgICAgLy8gLS0tIDQuIFNBRkVUWSBQUk9NUFQgLS0tDQogICAgICAgICAgd2luZG93Lm9uYmVmb3JldW5sb2FkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICBpZiAoZ2xvYmFsQXBwVXNlcklkZW50aXR5KSB7DQogICAgICAgICAgICAgICAgICByZXR1cm4gIlBsZWFzZSB1c2UgdGhlIFJFRCBRVUlUIEJVVFRPTiB0byBsb2cgb3V0IGNvcnJlY3RseS4iOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgfTsNCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJlZnJlc2hHbG9iYWxMaXN0KCkgew0KICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgLy8gUmVhZCB0aGUgc2hhcmVkIE1BU1RFUiBrZXkNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGdldFVSTCA9IGBodHRwczovL2tleXZhbHVlLmltbWFudWFsLndvcmtlcnMuZGV2L2dldC9NQVNURVJfVVNFUl9MSVNUP25vY2FjaGU9YCArIERhdGUubm93KCk7DQogICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGdldFVSTCk7DQogICAgICAgICAgICAgICAgICBjb25zdCByYXdEYXRhID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpOw0KDQogICAgICAgICAgICAgICAgICBpZiAocmF3RGF0YSAmJiAhcmF3RGF0YS5pbmNsdWRlcygiS2V5IG5vdCBmb3VuZCIpICYmIHJhd0RhdGEudHJpbSgpICE9PSAiIikgew0KICAgICAgICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgc2VydmVyIGNvbW1hcyB0byB5b3VyIHByZWZlcnJlZCBwaXBlIHNlcGFyYXRvcg0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNsZWFuTGlzdCA9IHJhd0RhdGEuc3BsaXQoJywnKS5qb2luKCcgfCAnKTsNCiAgICAgICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYWN0aXZlVXNlckxpc3QnKS5pbm5lclRleHQgPSBjbGVhbkxpc3Q7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCJSZWFkIGZhaWxlZCAoQ09SUyBvciBOZXR3b3JrKSIpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQoNCg0KICAgICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgIGlmIChnbG9iYWxBcHBVc2VySWRlbnRpdHkpIHsNCiAgICAgICAgICAgICAgICAgIHZhciB1bmlxdWVTaGFyZWRLZXkgPSAiR0xPQkFMX1NIQVJFRF9MSVNUX1YxIjsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGxvZ291dFVSTCA9IGBodHRwczovL2tleXZhbHVlLmltbWFudWFsLndvcmtlcnMuZGV2L3JlbW92ZV9mcm9tX3N0cmluZy8ke3VuaXF1ZVNoYXJlZEtleX0vJHtlbmNvZGVVUklDb21wb25lbnQoZ2xvYmFsQXBwVXNlcklkZW50aXR5KX1gOw0KICAgICAgICAgICAgICAgICAgbmF2aWdhdG9yLnNlbmRCZWFjb24obG9nb3V0VVJMKTsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgIH0pOw0KDQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBydW5EZXRhaWxlZE1hdGNoUmVwb3J0KCkgew0KICAgICAgICAgICAgICAvLyAxLiBUSEUgQlJJREdFOiBDb252ZXJ0IHJhZGlvIHZhbHVlIChlLmcuLCAyMDI1KSB0byB5b3VyIGVuZ2luZSdzIGZvcm1hdCAoZS5nLiwgMjUtMjYpDQogICAgICAgICAgICAgIGNvbnN0IHJhZGlvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKTsNCiAgICAgICAgICAgICAgaWYgKCFyYWRpbyB8fCByYWRpby52YWx1ZSA9PT0gImFsbCIpIHsNCiAgICAgICAgICAgICAgICAgIGFsZXJ0KCJQbGVhc2Ugc2VsZWN0IGEgc3BlY2lmaWMgRmluYW5jaWFsIFllYXIgZmlyc3QuIik7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICBjb25zdCBzZWxlY3RlZFZhbCA9IHJhZGlvLnZhbHVlLnRvU3RyaW5nKCk7DQogICAgICAgICAgICAgIGNvbnN0IHlyMkRpZ2l0ID0gc2VsZWN0ZWRWYWwuc2xpY2UoLTIpOw0KICAgICAgICAgICAgICBjb25zdCBuZXh0WXIyRGlnaXQgPSAocGFyc2VJbnQoeXIyRGlnaXQpICsgMSkudG9TdHJpbmcoKTsNCiAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0RlkgPSBgJHt5cjJEaWdpdH0tJHtuZXh0WXIyRGlnaXR9YDsNCiAgICAgICAgICAgICAgY29uc3QgZnVsbEZZU3RyaW5nID0gYCR7c2VsZWN0ZWRWYWx9LSR7cGFyc2VJbnQoc2VsZWN0ZWRWYWwpICsgMX1gOw0KDQogICAgICAgICAgICAgIGNvbnN0IGxvYWRpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ01zZycpOw0KICAgICAgICAgICAgICBpZiAobG9hZGluZykgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCg0KICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgY29uc3QgW2JhbmtSZXMsIGRhdGFSZXMsIGV4cFJlcywgcmV2UmVzLCBjYXNoUmVzXSA9IGF3YWl0IFByb21pc2UuYWxsKFsNCiAgICAgICAgICAgICAgICAgICAgICBmZXRjaChCQU5LX05FV19VUkwpLnRoZW4ocmVzID0+IHJlcy50ZXh0KCkpLA0KICAgICAgICAgICAgICAgICAgICAgIGZldGNoKERBVEFfVVJMKS50aGVuKHJlcyA9PiByZXMudGV4dCgpKSwNCiAgICAgICAgICAgICAgICAgICAgICBmZXRjaChFWFBFTlNFU19VUkwpLnRoZW4ocmVzID0+IHJlcy5hcnJheUJ1ZmZlcigpKSwNCiAgICAgICAgICAgICAgICAgICAgICBmZXRjaChSRVZFUlNBTFNfVVJMKS50aGVuKHJlcyA9PiByZXMudGV4dCgpKSwNCiAgICAgICAgICAgICAgICAgICAgICBmZXRjaChDQVNIX0xJU1RfVVJMKS50aGVuKHJlcyA9PiByZXMudGV4dCgpKQ0KICAgICAgICAgICAgICAgICAgXSk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIC0tLSBFVkVSWVRISU5HIEJFTE9XIElTIEZST00gWU9VUiB2MTkuMCBCQVNFIC0tLQ0KICAgICAgICAgICAgICAgICAgY29uc3QgYmFua0xpbmVzID0gYmFua1Jlcy5zcGxpdCgnXG4nKS5maWx0ZXIobCA9PiBsLnRyaW0oKS5zcGxpdCgnfCcpLmxlbmd0aCA+PSA1KTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRiID0gZGF0YVJlcy5zcGxpdCgnXG4nKS5tYXAociA9PiByLnNwbGl0KCd8JykpLmZpbHRlcihmID0+IGYubGVuZ3RoID49IDE1ICYmIGZbMTNdPy50b1VwcGVyQ2FzZSgpICE9PSAiWUVTIik7DQogICAgICAgICAgICAgICAgICBjb25zdCByZXZlcnNhbHMgPSByZXZSZXMuc3BsaXQoJ1xuJykubWFwKGxpbmUgPT4gbGluZS5zcGxpdCgnfCcpKS5maWx0ZXIoZiA9PiBmLmxlbmd0aCA+PSA3KTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGNhc2hMaW5lcyA9IGNhc2hSZXMuc3BsaXQoJ1xuJykuZmlsdGVyKGwgPT4gbC5pbmNsdWRlcygnfCcpKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKG5ldyBVaW50OEFycmF5KGV4cFJlcyksIHsgdHlwZTogJ2FycmF5JyB9KTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGV4cFJvd3MgPSBYTFNYLnV0aWxzLnNoZWV0X3RvX2pzb24od29ya2Jvb2suU2hlZXRzW3dvcmtib29rLlNoZWV0TmFtZXNbMF1dLCB7IGhlYWRlcjogMSB9KTsNCg0KICAgICAgICAgICAgICAgICAgY29uc3QgY3JlZGl0RXhlbXB0S2V5d29yZHMgPSBbIkNSRURJVCBJTlRFUkVTVCIsICJDTE9TVVJFIE9GIEZEIiwgIlBBUlQgV0lUSERSQVdMIiwgIkZEICIsICJGRDoiLCAiQlkgSU5UIFRSQU5TRkVSIiwgIkhBTkRMSU5HUkVWIiwgIlVQSU1JIENSIEFESiIsICJMT0FOIiwgIlJFVFVSTiIsICJSRVZFUlNBTCJdOw0KDQogICAgICAgICAgICAgICAgICBsZXQgcmVwb3J0ID0gYE1NUFQgVFJBTlNBQ1RJT05BTCBNQVRDSCBSRVBPUlQgJHtmdWxsRllTdHJpbmd9XG5gOw0KICAgICAgICAgICAgICAgICAgcmVwb3J0ICs9ICI9Ii5yZXBlYXQoMjE1KSArICJcbiI7DQogICAgICAgICAgICAgICAgICByZXBvcnQgKz0gYCR7IkRBVEUiLnBhZEVuZCgxMil9IHwgJHsiUkVDRUlQVCIucGFkRW5kKDEyKX0gfCAkeyJBTU9VTlQiLnBhZFN0YXJ0KDE0KX0gfCAkeyJUWVBFIi5wYWRFbmQoMTIpfSB8ICR7IkRFVEFJTFMiLnBhZEVuZCg4MCl9IHwgQkFOSyBSRUZFUkVOQ0VcbmA7DQogICAgICAgICAgICAgICAgICByZXBvcnQgKz0gIi0iLnJlcGVhdCgyMTUpICsgIlxuIjsNCg0KICAgICAgICAgICAgICAgICAgYmFua0xpbmVzLmZvckVhY2gobGluZSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IGxpbmUuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiRGF0ZVJhdyA9IGJbMF0udHJpbSgpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJSZWZSYXcgPSAoYlsxXSB8fCAiIikudHJpbSgpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJBbXQgPSBwYXJzZUZsb2F0KGJbNF0gfHwgYlszXSB8fCAwKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0NyZWRpdCA9IGJbNF0gIT09ICIiICYmIGJbNF0gIT09ICIwIjsNCg0KICAgICAgICAgICAgICAgICAgICAgIGlmIChnZXRGWShiRGF0ZVJhdykgIT09IHRhcmdldEZZKSByZXR1cm47DQoNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiRGF0ZVN0ZCA9IGJEYXRlUmF3LnJlcGxhY2UoL1tcL1wuXS9nLCAnLScpOw0KICAgICAgICAgICAgICAgICAgICAgIGxldCBwcm9jZXNzZWQgPSBmYWxzZTsNCg0KICAgICAgICAgICAgICAgICAgICAgIGlmIChpc0NyZWRpdCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0gVU5UT1VDSEVEIHYxOS4wIENSRURJVCBMT0dJQyAtLS0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmV2TWF0Y2ggPSByZXZlcnNhbHMuZmluZChyID0+IHJbMF0udHJpbSgpLnJlcGxhY2UoL1tcL1wuXS9nLCAnLScpID09PSBiRGF0ZVN0ZCAmJiByWzFdLnRyaW0oKS50b1VwcGVyQ2FzZSgpID09PSBiUmVmUmF3LnRvVXBwZXJDYXNlKCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0V4ZW1wdCA9IGNyZWRpdEV4ZW1wdEtleXdvcmRzLnNvbWUoayA9PiBiUmVmUmF3LnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoaykpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXZNYXRjaCB8fCBpc0V4ZW1wdCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZHRsID0gcmV2TWF0Y2ggPyBgUkVWRVJTQUw6ICR7cmV2TWF0Y2hbNl19YCA6IGBCQU5LIEVYRU1QVDogJHtiUmVmUmF3fWA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQgKz0gYCR7YkRhdGVSYXcucGFkRW5kKDEyKX0gfCAkeyIiLnBhZEVuZCgxMil9IHwgJHtiQW10LnRvTG9jYWxlU3RyaW5nKCdlbi1JTicsIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyIH0pLnBhZFN0YXJ0KDE0KX0gfCAkeyJDIEV4ZW1wdCIucGFkRW5kKDEyKX0gfCAke2R0bC5wYWRFbmQoODApfSB8ICR7YlJlZlJhd31cbmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbWF0Y2hlZERvbm9ycyA9IGRiLmZpbHRlcihkID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZFJlZiA9IChkWzEwXSB8fCAiIikudHJpbSgpLnRvVXBwZXJDYXNlKCkuc3BsaXQoJygnKVswXS5zcGxpdCgnWycpWzBdLnRyaW0oKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZFsxXS50cmltKCkucmVwbGFjZSgvW1wvXC5dL2csICctJykgPT09IGJEYXRlU3RkICYmIGRSZWYgIT09ICIiICYmIGJSZWZSYXcudG9VcHBlckNhc2UoKS5pbmNsdWRlcyhkUmVmKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAobWF0Y2hlZERvbm9ycy5sZW5ndGggPiAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZERvbm9ycy5mb3JFYWNoKChtKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHR5cGVTdHIgPSBtYXRjaGVkRG9ub3JzLmxlbmd0aCA+IDEgPyAiTSBEb25vcnMiIDogIkRvbm9yIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmNwdE5vID0gbVswXS50cmltKCkuc3Vic3RyaW5nKDAsIDEyKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgbURldGFpbHMgPSBgJHttWzJdfSwgJHttWzE5XX0sICR7bVsxNV19LCAke21bMTJdfSwgJHttWzExXX1gOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtQW10ID0gcGFyc2VGbG9hdChtWzldKS50b0xvY2FsZVN0cmluZygnZW4tSU4nLCB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVmVG9TaG93ID0gbWF0Y2hlZERvbm9ycy5sZW5ndGggPT09IDEgPyBiUmVmUmF3IDogIiI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlcG9ydCArPSBgJHtiRGF0ZVJhdy5wYWRFbmQoMTIpfSB8ICR7cmNwdE5vLnBhZEVuZCgxMil9IHwgJHttQW10LnBhZFN0YXJ0KDE0KX0gfCAke3R5cGVTdHIucGFkRW5kKDEyKX0gfCAke21EZXRhaWxzLnN1YnN0cmluZygwLCA3OSkucGFkRW5kKDgwKX0gfCAke3JlZlRvU2hvd31cbmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoZWREb25vcnMubGVuZ3RoID4gMSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQgKz0gYCR7IiIucGFkRW5kKDEyKX0gfCAkeyIiLnBhZEVuZCgxMil9IHwgJHsiLS0tLS0tLS0tLS0tIi5wYWRTdGFydCgxNCl9IHwgJHsiIi5wYWRFbmQoMTIpfSB8ICR7KCIoQmFuayBUb3RhbCBNYXRjaDog4oK5IiArIGJBbXQudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJykgKyAiKSIpLnBhZEVuZCg4MCl9IHwgJHtiUmVmUmF3fVxuYDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc2VkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICghcHJvY2Vzc2VkICYmIGJSZWZSYXcudG9VcHBlckNhc2UoKS5pbmNsdWRlcygiQ0FTSCIpKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2FzaE1hdGNoID0gY2FzaExpbmVzLmZpbmQoY2wgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBoZWFkID0gY2wuc3BsaXQoJ3wnKVswXS50cmltKCkuc3BsaXQoL1xzKy8pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaGVhZFswXSA9PT0gYkRhdGVSYXcgJiYgTWF0aC5hYnMocGFyc2VGbG9hdChoZWFkW2hlYWQubGVuZ3RoIC0gMV0pIC0gYkFtdCkgPCAxOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYXNoTWF0Y2gpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcCA9IGNhc2hNYXRjaC5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwcmVmaXggPSBwWzFdLnRyaW0oKSA9PT0gJ00nID8gIk1QUyIgOiAiQ0ciOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBySWRzID0gcFsyXS5zcGxpdCgnLCcpLm1hcChpZCA9PiBwcmVmaXggKyBpZC50cmltKCkucGFkU3RhcnQocFsxXS50cmltKCkgPT09ICdNJyA/IDcgOiA2LCAnMCcpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcklkcy5mb3JFYWNoKGlkID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSBkYi5maW5kKGQgPT4gZFswXS50cmltKCkgPT09IGlkKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0ICs9IGAke2JEYXRlUmF3LnBhZEVuZCgxMil9IHwgJHtpZC5zdWJzdHJpbmcoMCwgMTIpLnBhZEVuZCgxMil9IHwgJHtwYXJzZUZsb2F0KG1bOV0pLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicsIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyIH0pLnBhZFN0YXJ0KDE0KX0gfCAkeyJNIERvbm9yIi5wYWRFbmQoMTIpfSB8ICR7KGAke21bMl19LCAke21bMTldfWApLnN1YnN0cmluZygwLCA3OSkucGFkRW5kKDgwKX0gfCBcbmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQgKz0gYCR7IiIucGFkRW5kKDEyKX0gfCAkeyIiLnBhZEVuZCgxMil9IHwgJHsiLS0tLS0tLS0tLS0tIi5wYWRTdGFydCgxNCl9IHwgJHsiIi5wYWRFbmQoMTIpfSB8ICR7KCIoQ2FzaCBEZXBvc2l0IFRvdGFsOiDigrkiICsgYkFtdC50b0xvY2FsZVN0cmluZygnZW4tSU4nKSArICIpIikucGFkRW5kKDgwKX0gfCAke2JSZWZSYXd9XG5gOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLSBERUJJVCBMT0dJQyAtLS0NCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhwTWF0Y2ggPSBleHBSb3dzLmZpbmQoKHIsIGkpID0+IGkgPiAwICYmIHJbM10gJiYgTWF0aC5hYnMocGFyc2VGbG9hdChyWzNdKSAtIGJBbXQpIDwgMC4wMSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleHBNYXRjaCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhjZWxEZXRhaWwgPSAoZXhwTWF0Y2hbNF0gfHwgIiIpLnRvU3RyaW5nKCkudG9VcHBlckNhc2UoKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQURERUQgTE9HSUM6IENoZWNrIGZvciBib3RoICJFWEVNUFQiIChvcmlnaW5hbCkgYW5kICJGUkVTSCBERVBPU0lUIiAobmV3KQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGUgPSAiRXhwZW5zZSI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZXhjZWxEZXRhaWwuaW5jbHVkZXMoIkVYRU1QVCIpIHx8IGV4Y2VsRGV0YWlsLmluY2x1ZGVzKCJGUkVTSCBERVBPU0lUIikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlID0gIkQgRXhlbXB0IjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0ICs9IGAke2JEYXRlUmF3LnBhZEVuZCgxMil9IHwgJHsiIi5wYWRFbmQoMTIpfSB8ICR7YkFtdC50b0xvY2FsZVN0cmluZygnZW4tSU4nLCB7IG1pbmltdW1GcmFjdGlvbkRpZ2l0czogMiB9KS5wYWRTdGFydCgxNCl9IHwgJHt0eXBlLnBhZEVuZCgxMil9IHwgJHsoZXhwTWF0Y2hbNF0gfHwgYlJlZlJhdykudG9TdHJpbmcoKS5zdWJzdHJpbmcoMCwgNzkpLnBhZEVuZCg4MCl9IHwgJHtiUmVmUmF3fVxuYDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByb2Nlc3NlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXByb2Nlc3NlZCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnQgKz0gYCR7YkRhdGVSYXcucGFkRW5kKDEyKX0gfCAkeyIiLnBhZEVuZCgxMil9IHwgJHtiQW10LnRvTG9jYWxlU3RyaW5nKCdlbi1JTicsIHsgbWluaW11bUZyYWN0aW9uRGlnaXRzOiAyIH0pLnBhZFN0YXJ0KDE0KX0gfCAkeyJQZW5kaW5nIi5wYWRFbmQoMTIpfSB8ICR7IiIucGFkRW5kKDgwKX0gfCAke2JSZWZSYXd9XG5gOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW3JlcG9ydF0sIHsgdHlwZTogJ3RleHQvcGxhaW4nIH0pOw0KICAgICAgICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsNCiAgICAgICAgICAgICAgICAgIGxpbmsuaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7DQogICAgICAgICAgICAgICAgICBsaW5rLmRvd25sb2FkID0gYE1NUFQgVFJBTlNBQ1RJT05BTCBNQVRDSCBSRVBPUlQgJHtmdWxsRllTdHJpbmd9LnR4dGA7DQogICAgICAgICAgICAgICAgICBsaW5rLmNsaWNrKCk7DQoNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgYWxlcnQoIkVycm9yOiAiICsgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nKSBsb2FkaW5nLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCg0KDQoNCg0KICAgICAgICAgIC8vIEVuc3VyZSB0aGVzZSBhcmUgYXQgdGhlIHRvcCBvZiB5b3VyIHNjcmlwdCB3aXRoIG90aGVyIFVSTHMNCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIGdlbmVyYXRlTWF0Y2hSZXBvcnRGcm9tTWVudSgpIHsNCiAgICAgICAgICAgICAgY29uc3QgeWVhclJhZGlvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKTsNCiAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRGWSA9IHllYXJSYWRpbyA/IHllYXJSYWRpby52YWx1ZSA6ICJhbGwiOw0KDQogICAgICAgICAgICAgIGlmIChzZWxlY3RlZEZZID09PSAiYWxsIikgew0KICAgICAgICAgICAgICAgICAgYWxlcnQoIlBsZWFzZSBzZWxlY3QgYSBzcGVjaWZpYyBGaW5hbmNpYWwgWWVhciAoZS5nLiwgMjMtMjQpIGZyb20gdGhlIHRvcCBmaWx0ZXJzIGZpcnN0LiIpOw0KICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgLy8gV3JhcCBpbiB5b3VyIHByb2plY3QncyBzdGFuZGFyZCBsb2FkaW5nIHNwaW5uZXINCiAgICAgICAgICAgICAgd3JhcExvYWRpbmcoYXN5bmMgKCkgPT4gew0KICAgICAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBydW5EZXRhaWxlZE1hdGNoUmVwb3J0KHNlbGVjdGVkRlkpOw0KICAgICAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7DQogICAgICAgICAgICAgICAgICAgICAgYWxlcnQoIlJlcG9ydCBFcnJvcjogIiArIGUubWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgIH0pOw0KICAgICAgICAgIH0NCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gZG93bmxvYWREb25hdGlvbkxpc3REaXJlY3QoKSB7DQogICAgICAgICAgICAgIGNvbnN0IGxvYWRpbmcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ01zZycpOw0KICAgICAgICAgICAgICBpZiAobG9hZGluZykgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCg0KICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgY29uc3QgcmFkaW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJ5ZWFyRmlsdGVyIl06Y2hlY2tlZCcpOw0KICAgICAgICAgICAgICAgICAgaWYgKCFyYWRpbyB8fCByYWRpby52YWx1ZSA9PT0gImFsbCIpIHsNCiAgICAgICAgICAgICAgICAgICAgICBhbGVydCgiUGxlYXNlIHNlbGVjdCBhIHNwZWNpZmljIEZpbmFuY2lhbCBZZWFyIGZpcnN0LiIpOw0KICAgICAgICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nKSBsb2FkaW5nLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRZZWFyID0gcmFkaW8udmFsdWU7DQogICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRGWSA9IGAke3NlbGVjdGVkWWVhci5zbGljZSgtMil9LSR7KHBhcnNlSW50KHNlbGVjdGVkWWVhci5zbGljZSgtMikpICsgMSl9YDsNCg0KICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goREFUQV9VUkwpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7DQogICAgICAgICAgICAgICAgICBjb25zdCByb3dzID0gdGV4dC5zcGxpdCgnXG4nKS5tYXAociA9PiByLnNwbGl0KCd8JykpOw0KDQogICAgICAgICAgICAgICAgICBjb25zdCB0aXRsZXMgPSBbIlJlY2VpcHQgTm8uIiwgIkRhdGUiLCAiTmFtZSIsICJQaG9uZSIsICJBZGRyZXNzIiwgIkVtYWlsIiwgIlBBTiIsICJTdGFyIiwgIkdvdGhyYW0iLCAiQW1vdW50IiwgIlJlZmVyZW5jZSIsICJNb2RlIiwgIlRvd2FyZHMiLCAiQ2FuY2VsIiwgIkNvbW1lbnRzIiwgIlBpbiBDb2RlIiwgIlJlY2VpcHQgUHJpbnRlZCIsICJQcmFzYWRhbSBTZW50IiwgIkNvcnB1cyBTaWduZWQiLCAiQ291bnRyeSJdOw0KDQogICAgICAgICAgICAgICAgICBjb25zdCBleGNlbERhdGEgPSBbdGl0bGVzXTsNCg0KICAgICAgICAgICAgICAgICAgcm93cy5mb3JFYWNoKGYgPT4gew0KICAgICAgICAgICAgICAgICAgICAgIGlmIChmLmxlbmd0aCA8IDE1KSByZXR1cm47DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNDYW5jZWxsZWQgPSBmWzEzXSAmJiBmWzEzXS50cmltKCkudG9VcHBlckNhc2UoKSA9PT0gIllFUyI7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ2FuY2VsbGVkKSByZXR1cm47DQoNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCByRGF0ZSA9IGZbMV0/LnRyaW0oKTsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0RlkockRhdGUpID09PSB0YXJnZXRGWSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlbERhdGEucHVzaChmLnNsaWNlKDAsIDIwKSk7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgIGlmIChleGNlbERhdGEubGVuZ3RoIDw9IDEpIHsNCiAgICAgICAgICAgICAgICAgICAgICBhbGVydCgiTm8gYWN0aXZlIHJlY29yZHMgZm91bmQuIik7DQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICBjb25zdCB3YiA9IFhMU1gudXRpbHMuYm9va19uZXcoKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHdzID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQoZXhjZWxEYXRhKTsNCg0KICAgICAgICAgICAgICAgICAgLy8gLS0tIE5FVyBBVVRPLVdJRFRIIExPR0lDIFNUQVJUIC0tLQ0KICAgICAgICAgICAgICAgICAgY29uc3QgY29sV2lkdGhzID0gdGl0bGVzLm1hcCgodGl0bGUsIGluZGV4KSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgLy8gRmluZCB0aGUgbG9uZ2VzdCBzdHJpbmcgaW4gdGhpcyBzcGVjaWZpYyBjb2x1bW4NCiAgICAgICAgICAgICAgICAgICAgICBsZXQgbWF4TGVuZ3RoID0gdGl0bGUubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgIGV4Y2VsRGF0YS5mb3JFYWNoKHJvdyA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNlbGxWYWx1ZSA9IHJvd1tpbmRleF0gPyByb3dbaW5kZXhdLnRvU3RyaW5nKCkgOiAiIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNlbGxWYWx1ZS5sZW5ndGggPiBtYXhMZW5ndGgpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1heExlbmd0aCA9IGNlbGxWYWx1ZS5sZW5ndGg7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAvLyBSZXR1cm4gd2lkdGggb2JqZWN0IChwYWRkaW5nIHdpdGggKzIgZm9yIGNvbWZvcnQpDQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHsgd2NoOiBtYXhMZW5ndGggKyAyIH07DQogICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgIHdzWychY29scyddID0gY29sV2lkdGhzOw0KICAgICAgICAgICAgICAgICAgLy8gLS0tIE5FVyBBVVRPLVdJRFRIIExPR0lDIEVORCAtLS0NCg0KICAgICAgICAgICAgICAgICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3Yiwgd3MsICJEb25hdGlvbnMiKTsNCiAgICAgICAgICAgICAgICAgIFhMU1gud3JpdGVGaWxlKHdiLCBgTU1QVF9Eb25hdGlvbl9MaXN0X0ZZXyR7dGFyZ2V0Rll9Lnhsc3hgKTsNCg0KICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICBhbGVydCgiRXJyb3I6ICIgKyBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgICAgICAgaWYgKGxvYWRpbmcpIGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KDQogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gZG93bmxvYWRBbm9ueW1vdXNMaXN0RGlyZWN0KCkgew0KICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdNc2cnKTsNCiAgICAgICAgICAgICAgaWYgKGxvYWRpbmcpIGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQoNCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJhZGlvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKTsNCiAgICAgICAgICAgICAgICAgIGlmICghcmFkaW8gfHwgcmFkaW8udmFsdWUgPT09ICJhbGwiKSB7DQogICAgICAgICAgICAgICAgICAgICAgYWxlcnQoIlBsZWFzZSBzZWxlY3QgYSBzcGVjaWZpYyBGaW5hbmNpYWwgWWVhciBmaXJzdC4iKTsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAobG9hZGluZykgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkWWVhciA9IHJhZGlvLnZhbHVlOw0KICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0RlkgPSBgJHtzZWxlY3RlZFllYXIuc2xpY2UoLTIpfS0keyhwYXJzZUludChzZWxlY3RlZFllYXIuc2xpY2UoLTIpKSArIDEpfWA7DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKERBVEFfVVJMKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICAgICAgICAgICAgY29uc3Qgcm93cyA9IHRleHQuc3BsaXQoJ1xuJykubWFwKHIgPT4gci5zcGxpdCgnfCcpKTsNCg0KICAgICAgICAgICAgICAgICAgY29uc3QgdGl0bGVzID0gWyJSZWNlaXB0IE5vLiIsICJEYXRlIiwgIk5hbWUiLCAiUGhvbmUiLCAiQWRkcmVzcyIsICJFbWFpbCIsICJQQU4iLCAiU3RhciIsICJHb3RocmFtIiwgIkFtb3VudCIsICJSZWZlcmVuY2UiLCAiTW9kZSIsICJUb3dhcmRzIiwgIkNhbmNlbCIsICJDb21tZW50cyIsICJQaW4gQ29kZSIsICJSZWNlaXB0IFByaW50ZWQiLCAiUHJhc2FkYW0gU2VudCIsICJDb3JwdXMgU2lnbmVkIiwgIkNvdW50cnkiXTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGV4Y2VsRGF0YSA9IFt0aXRsZXNdOw0KDQogICAgICAgICAgICAgICAgICByb3dzLmZvckVhY2goZiA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKGYubGVuZ3RoIDwgMTUpIHJldHVybjsNCg0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJEYXRlID0gZlsxXT8udHJpbSgpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ2FuY2VsbGVkID0gZlsxM10gJiYgZlsxM10udHJpbSgpLnRvVXBwZXJDYXNlKCkgPT09ICJZRVMiOw0KDQogICAgICAgICAgICAgICAgICAgICAgLy8gUHJvYmVkIExvZ2ljIGZyb20gdjE5LjE6DQogICAgICAgICAgICAgICAgICAgICAgLy8gQW5vbnltaXR5IGlzIGRlZmluZWQgYXM6IE5hbWUgaXMgbWlzc2luZy9lbXB0eSBPUiBuYW1lIGNvbnRhaW5zICdhbm9ueW1vdXMnDQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgZG9ub3JOYW1lID0gKGZbMl0gfHwgIiIpLnRyaW0oKS50b0xvd2VyQ2FzZSgpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQW5vbnltb3VzID0gKGRvbm9yTmFtZSA9PT0gIiIgfHwgZG9ub3JOYW1lLmluY2x1ZGVzKCJhbm9ueW1vdXMiKSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0RlkockRhdGUpID09PSB0YXJnZXRGWSAmJiAhaXNDYW5jZWxsZWQgJiYgaXNBbm9ueW1vdXMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZWxEYXRhLnB1c2goZi5zbGljZSgwLCAyMCkpOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICBpZiAoZXhjZWxEYXRhLmxlbmd0aCA8PSAxKSB7DQogICAgICAgICAgICAgICAgICAgICAgYWxlcnQoYE5vIHJlY29yZHMgbWF0Y2hpbmcgQW5vbnltb3VzIGNyaXRlcmlhIGZvdW5kIGZvciBGWSAke3RhcmdldEZZfS5gKTsNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgIC8vIEV4cG9ydCB3aXRoIEF1dG8tV2lkdGgNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHdiID0gWExTWC51dGlscy5ib29rX25ldygpOw0KICAgICAgICAgICAgICAgICAgY29uc3Qgd3MgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldChleGNlbERhdGEpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgY29sV2lkdGhzID0gdGl0bGVzLm1hcCgodGl0bGUsIGluZGV4KSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgbGV0IG1heExlbmd0aCA9IHRpdGxlLmxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgICBleGNlbERhdGEuZm9yRWFjaChyb3cgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsVmFsdWUgPSByb3dbaW5kZXhdID8gcm93W2luZGV4XS50b1N0cmluZygpIDogIiI7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjZWxsVmFsdWUubGVuZ3RoID4gbWF4TGVuZ3RoKSBtYXhMZW5ndGggPSBjZWxsVmFsdWUubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHdjaDogbWF4TGVuZ3RoICsgMiB9Ow0KICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICB3c1snIWNvbHMnXSA9IGNvbFdpZHRoczsNCg0KICAgICAgICAgICAgICAgICAgWExTWC51dGlscy5ib29rX2FwcGVuZF9zaGVldCh3Yiwgd3MsICJBbm9ueW1vdXMgTGlzdCIpOw0KICAgICAgICAgICAgICAgICAgWExTWC53cml0ZUZpbGUod2IsIGBNTVBUX0Fub255bW91c19MaXN0X0ZZXyR7dGFyZ2V0Rll9Lnhsc3hgKTsNCg0KICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7DQogICAgICAgICAgICAgICAgICBhbGVydCgiRXJyb3I6ICIgKyBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgICAgICAgaWYgKGxvYWRpbmcpIGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KDQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBkb3dubG9hZFBlbmRpbmdDb25zZW50RGlyZWN0KCkgew0KICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdNc2cnKTsNCiAgICAgICAgICAgICAgaWYgKGxvYWRpbmcpIGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQoNCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJhZGlvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKTsNCiAgICAgICAgICAgICAgICAgIGlmICghcmFkaW8gfHwgcmFkaW8udmFsdWUgPT09ICJhbGwiKSB7DQogICAgICAgICAgICAgICAgICAgICAgYWxlcnQoIlBsZWFzZSBzZWxlY3QgYSBzcGVjaWZpYyBGaW5hbmNpYWwgWWVhciBmaXJzdC4iKTsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAobG9hZGluZykgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkWWVhciA9IHJhZGlvLnZhbHVlOw0KICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0RlkgPSBgJHtzZWxlY3RlZFllYXIuc2xpY2UoLTIpfS0keyhwYXJzZUludChzZWxlY3RlZFllYXIuc2xpY2UoLTIpKSArIDEpfWA7DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKERBVEFfVVJMKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICAgICAgICAgICAgY29uc3Qgcm93cyA9IHRleHQuc3BsaXQoJ1xuJykubWFwKHIgPT4gci5zcGxpdCgnfCcpKTsNCg0KICAgICAgICAgICAgICAgICAgY29uc3QgdGl0bGVzID0gWyJSZWNlaXB0IE5vLiIsICJEYXRlIiwgIk5hbWUiLCAiUGhvbmUiLCAiQWRkcmVzcyIsICJFbWFpbCIsICJQQU4iLCAiU3RhciIsICJHb3RocmFtIiwgIkFtb3VudCIsICJSZWZlcmVuY2UiLCAiTW9kZSIsICJUb3dhcmRzIiwgIkNhbmNlbCIsICJDb21tZW50cyIsICJQaW4gQ29kZSIsICJSZWNlaXB0IFByaW50ZWQiLCAiUHJhc2FkYW0gU2VudCIsICJDb3JwdXMgU2lnbmVkIiwgIkNvdW50cnkiXTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGV4Y2VsRGF0YSA9IFt0aXRsZXNdOw0KDQogICAgICAgICAgICAgICAgICByb3dzLmZvckVhY2goZiA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKGYubGVuZ3RoIDwgMTkpIHJldHVybjsNCg0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJEYXRlID0gZlsxXT8udHJpbSgpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ2FuY2VsbGVkID0gZlsxM10gJiYgZlsxM10udHJpbSgpLnRvVXBwZXJDYXNlKCkgPT09ICJZRVMiOw0KDQogICAgICAgICAgICAgICAgICAgICAgLy8gTG9naWM6IFRvd2FyZHMgbXVzdCBiZSBDT1JQVVMgKEluZGV4IDEyKQ0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHRvd2FyZHMgPSAoZlsxMl0gfHwgIiIpLnRyaW0oKS50b1VwcGVyQ2FzZSgpOw0KDQogICAgICAgICAgICAgICAgICAgICAgLy8gTG9naWM6IENvcnB1cyBTaWduZWQgbXVzdCBiZSBOTyBvciBFbXB0eSAoSW5kZXggMTgpDQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29ycHVzU2lnbmVkID0gKGZbMThdIHx8ICIiKS50cmltKCkudG9VcHBlckNhc2UoKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc1BlbmRpbmcgPSAoY29ycHVzU2lnbmVkID09PSAiTk8iIHx8IGNvcnB1c1NpZ25lZCA9PT0gIiIpOw0KDQogICAgICAgICAgICAgICAgICAgICAgaWYgKGdldEZZKHJEYXRlKSA9PT0gdGFyZ2V0RlkgJiYgIWlzQ2FuY2VsbGVkICYmIHRvd2FyZHMgPT09ICJDT1JQVVMiICYmIGlzUGVuZGluZykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlbERhdGEucHVzaChmLnNsaWNlKDAsIDIwKSk7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgIGlmIChleGNlbERhdGEubGVuZ3RoIDw9IDEpIHsNCiAgICAgICAgICAgICAgICAgICAgICBhbGVydChgTm8gUGVuZGluZyBDb25zZW50IHJlY29yZHMgKFRvd2FyZHM6IENPUlBVUywgU2lnbmVkOiBOTykgZm91bmQgZm9yIEZZICR7dGFyZ2V0Rll9LmApOw0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgY29uc3Qgd2IgPSBYTFNYLnV0aWxzLmJvb2tfbmV3KCk7DQogICAgICAgICAgICAgICAgICBjb25zdCB3cyA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KGV4Y2VsRGF0YSk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIEF1dG8td2lkdGggbG9naWMNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbFdpZHRocyA9IHRpdGxlcy5tYXAoKHRpdGxlLCBpbmRleCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgIGxldCBtYXhMZW5ndGggPSB0aXRsZS5sZW5ndGg7DQogICAgICAgICAgICAgICAgICAgICAgZXhjZWxEYXRhLmZvckVhY2gocm93ID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VsbFZhbHVlID0gcm93W2luZGV4XSA/IHJvd1tpbmRleF0udG9TdHJpbmcoKSA6ICIiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2VsbFZhbHVlLmxlbmd0aCA+IG1heExlbmd0aCkgbWF4TGVuZ3RoID0gY2VsbFZhbHVlLmxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyB3Y2g6IG1heExlbmd0aCArIDIgfTsNCiAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgd3NbJyFjb2xzJ10gPSBjb2xXaWR0aHM7DQoNCiAgICAgICAgICAgICAgICAgIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod2IsIHdzLCAiUGVuZGluZyBDb25zZW50cyIpOw0KICAgICAgICAgICAgICAgICAgWExTWC53cml0ZUZpbGUod2IsIGBNTVBUX1BlbmRpbmdfQ29uc2VudF9GWV8ke3RhcmdldEZZfS54bHN4YCk7DQoNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgYWxlcnQoIkVycm9yOiAiICsgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nKSBsb2FkaW5nLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIGRvd25sb2FkVW5pcXVlRG9ub3JMaXN0RGlyZWN0KCkgew0KICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdNc2cnKTsNCiAgICAgICAgICAgICAgaWYgKGxvYWRpbmcpIGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQoNCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJhZGlvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQWxsWWVhcnMgPSAoIXJhZGlvIHx8IHJhZGlvLnZhbHVlID09PSAiYWxsIik7DQoNCiAgICAgICAgICAgICAgICAgIGxldCB0YXJnZXRGWSA9ICJBbGxfWWVhcnMiOw0KICAgICAgICAgICAgICAgICAgaWYgKCFpc0FsbFllYXJzKSB7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRZZWFyID0gcmFkaW8udmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0RlkgPSBgJHtzZWxlY3RlZFllYXIuc2xpY2UoLTIpfS0keyhwYXJzZUludChzZWxlY3RlZFllYXIuc2xpY2UoLTIpKSArIDEpfWA7DQogICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKERBVEFfVVJMKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICAgICAgICAgICAgY29uc3Qgcm93cyA9IHRleHQuc3BsaXQoJ1xuJykubWFwKHIgPT4gci5zcGxpdCgnfCcpKTsNCg0KICAgICAgICAgICAgICAgICAgY29uc3QgZG9ub3JNYXAgPSBuZXcgTWFwKCk7DQoNCiAgICAgICAgICAgICAgICAgIHJvd3MuZm9yRWFjaChmID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoZi5sZW5ndGggPCAxNSkgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgckRhdGUgPSBmWzFdPy50cmltKCk7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNDYW5jZWxsZWQgPSBmWzEzXSAmJiBmWzEzXS50cmltKCkudG9VcHBlckNhc2UoKSA9PT0gIllFUyI7DQoNCiAgICAgICAgICAgICAgICAgICAgICAvLyBTS0lQIGNhbmNlbGxlZCBhbHdheXMNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNDYW5jZWxsZWQpIHJldHVybjsNCg0KICAgICAgICAgICAgICAgICAgICAgIC8vIFlFQVIgRklMVEVSOiBPbmx5IGFwcGx5IGlmIGEgc3BlY2lmaWMgeWVhciBpcyBjaG9zZW4NCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzQWxsWWVhcnMgJiYgZ2V0RlkockRhdGUpICE9PSB0YXJnZXRGWSkgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgICAgICAgbGV0IHBob25lID0gKGZbM10gfHwgIk4vQSIpLnRyaW0oKTsNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgbmFtZSA9IChmWzJdIHx8ICJBbm9ueW1vdXMiKS50cmltKCk7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgYW10ID0gcGFyc2VGbG9hdChmWzldKSB8fCAwOw0KDQogICAgICAgICAgICAgICAgICAgICAgLy8gQW5vbnltb3VzIGxvZ2ljICg5OTk5OSAvIDg4ODg4KQ0KICAgICAgICAgICAgICAgICAgICAgIGlmIChwaG9uZS5zdGFydHNXaXRoKCI5OTk5OSIpIHx8IHBob25lLnN0YXJ0c1dpdGgoIjg4ODg4IikgfHwgbmFtZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCJhbm9ueW1vdXMiKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICBwaG9uZSA9ICJBTk9OWU1PVVNfR1JPVVAiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBuYW1lID0gIkFub255bW91cyAvIEdlbmVyYWwgRG9ub3IiOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgIGlmICghZG9ub3JNYXAuaGFzKHBob25lKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICBkb25vck1hcC5zZXQocGhvbmUsIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWU6IG5hbWUsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaG9uZTogKHBob25lID09PSAiQU5PTllNT1VTX0dST1VQIiA/ICJNdWx0aXBsZSIgOiBwaG9uZSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZGRyZXNzOiAocGhvbmUgPT09ICJBTk9OWU1PVVNfR1JPVVAiID8gIk4vQSIgOiAoZls0XSB8fCAiIikpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IChwaG9uZSA9PT0gIkFOT05ZTU9VU19HUk9VUCIgPyAiTi9BIiA6IChmWzVdIHx8ICIiKSksDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwaW5jb2RlOiAocGhvbmUgPT09ICJBTk9OWU1PVVNfR1JPVVAiID8gIiIgOiAoZlsxNV0gfHwgIiIpKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50cnk6IChwaG9uZSA9PT0gIkFOT05ZTU9VU19HUk9VUCIgPyAiIiA6IChmWzE5XSB8fCAiIikpLA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWxBbW91bnQ6IDAsDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkb25hdGlvbkNvdW50OiAwDQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRvbm9yID0gZG9ub3JNYXAuZ2V0KHBob25lKTsNCiAgICAgICAgICAgICAgICAgICAgICBkb25vci50b3RhbEFtb3VudCArPSBhbXQ7DQogICAgICAgICAgICAgICAgICAgICAgZG9ub3IuZG9uYXRpb25Db3VudCArPSAxOw0KICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIFNvcnQgYnkgVG90YWwgQW1vdW50IChEZXNjZW5kaW5nKQ0KICAgICAgICAgICAgICAgICAgY29uc3Qgc29ydGVkRG9ub3JzID0gQXJyYXkuZnJvbShkb25vck1hcC52YWx1ZXMoKSkuc29ydCgoYSwgYikgPT4gYi50b3RhbEFtb3VudCAtIGEudG90YWxBbW91bnQpOw0KDQogICAgICAgICAgICAgICAgICBpZiAoc29ydGVkRG9ub3JzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCJObyByZWNvcmRzIGZvdW5kLiIpOw0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgY29uc3QgdGl0bGVzID0gWyJSYW5rIiwgIk5hbWUiLCAiUGhvbmUgTnVtYmVyIiwgIlRvdGFsIEFtb3VudCBEb25hdGVkIiwgIk5vLiBvZiBEb25hdGlvbnMiLCAiQWRkcmVzcyIsICJQaW5jb2RlIiwgIkVtYWlsIiwgIkNvdW50cnkiXTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGV4Y2VsRGF0YSA9IFt0aXRsZXNdOw0KDQogICAgICAgICAgICAgICAgICBzb3J0ZWREb25vcnMuZm9yRWFjaCgoZCwgaW5kZXgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICBleGNlbERhdGEucHVzaChbaW5kZXggKyAxLCBkLm5hbWUsIGQucGhvbmUsIGQudG90YWxBbW91bnQsIGQuZG9uYXRpb25Db3VudCwgZC5hZGRyZXNzLCBkLnBpbmNvZGUsIGQuZW1haWwsIGQuY291bnRyeV0pOw0KICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHdiID0gWExTWC51dGlscy5ib29rX25ldygpOw0KICAgICAgICAgICAgICAgICAgY29uc3Qgd3MgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldChleGNlbERhdGEpOw0KDQogICAgICAgICAgICAgICAgICAvLyBBdXRvLXdpZHRoDQogICAgICAgICAgICAgICAgICB3c1snIWNvbHMnXSA9IHRpdGxlcy5tYXAoKHRpdGxlLCBpbmRleCkgPT4gew0KICAgICAgICAgICAgICAgICAgICAgIGxldCBtYXhMZW5ndGggPSB0aXRsZS5sZW5ndGg7DQogICAgICAgICAgICAgICAgICAgICAgZXhjZWxEYXRhLmZvckVhY2gocm93ID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY2VsbFZhbHVlID0gcm93W2luZGV4XSA/IHJvd1tpbmRleF0udG9TdHJpbmcoKSA6ICIiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2VsbFZhbHVlLmxlbmd0aCA+IG1heExlbmd0aCkgbWF4TGVuZ3RoID0gY2VsbFZhbHVlLmxlbmd0aDsNCiAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyB3Y2g6IG1heExlbmd0aCArIDIgfTsNCiAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdiLCB3cywgIlVuaXF1ZSBEb25vcnMiKTsNCiAgICAgICAgICAgICAgICAgIFhMU1gud3JpdGVGaWxlKHdiLCBgTU1QVF9VbmlxdWVfRG9ub3JfTGlzdF8ke3RhcmdldEZZfS54bHN4YCk7DQoNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgYWxlcnQoIkVycm9yOiAiICsgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nKSBsb2FkaW5nLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCg0KDQoNCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIGRvd25sb2FkUGVuZGluZ0Nhc2hEaXJlY3QoKSB7DQogICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB3aW5kb3cuZ2xvYmFsUGVuZGluZ0NhcHR1cmU7DQoNCiAgICAgICAgICAgICAgaWYgKCFkYXRhIHx8IGRhdGEubGVuZ3RoID09PSAwKSB7DQogICAgICAgICAgICAgICAgICBhbGVydCgiTm8gZGF0YSBjYXB0dXJlZC4gUGxlYXNlIGxvYWQgdGhlIFBlbmRpbmcgQ2FzaCBkYXNoYm9hcmQgZmlyc3QuIik7DQogICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgY29uc3QgcGVuZGluZ1JjcHROb3MgPSBuZXcgU2V0KGRhdGEubWFwKGl0ZW0gPT4gaXRlbS5yY3B0LnRyaW0oKS50b1VwcGVyQ2FzZSgpKSk7DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goREFUQV9VUkwpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlc3BvbnNlLnRleHQoKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRiUm93cyA9IHRleHQuc3BsaXQoJ1xuJykubWFwKHIgPT4gci5zcGxpdCgnfCcpKS5maWx0ZXIoZiA9PiBmLmxlbmd0aCA+PSAxNSk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIFlvdXIgMjAgREIgSGVhZGVycw0KICAgICAgICAgICAgICAgICAgY29uc3QgZnVsbEhlYWRlcnMgPSBbDQogICAgICAgICAgICAgICAgICAgICAgIlJlY2VpcHQgTm8uIiwgIkRhdGUiLCAiTmFtZSIsICJBZGRyZXNzIiwgIlBob25lIiwNCiAgICAgICAgICAgICAgICAgICAgICAiRW1haWwiLCAiUEFOL0lEIiwgIk9jY2FzaW9uIiwgIkFtb3VudCBXb3JkcyIsICJBbW91bnQiLA0KICAgICAgICAgICAgICAgICAgICAgICJSZWZlcmVuY2UiLCAiTW9kZSIsICJUb3dhcmRzIiwgIkNhbmNlbGxlZCIsICJVc2VyIiwNCiAgICAgICAgICAgICAgICAgICAgICAiVGltZSIsICJGMTciLCAiRjE4IiwgIkYxOSIsICJGMjAiDQogICAgICAgICAgICAgICAgICBdOw0KDQogICAgICAgICAgICAgICAgICBjb25zdCBleGNlbFJvd3MgPSBbZnVsbEhlYWRlcnNdOw0KDQogICAgICAgICAgICAgICAgICBkYlJvd3MuZm9yRWFjaChmID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50UmNwdCA9IGZbMF0udHJpbSgpLnRvVXBwZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKHBlbmRpbmdSY3B0Tm9zLmhhcyhjdXJyZW50UmNwdCkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZXhjZWxSb3dzLnB1c2goZik7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIENyZWF0ZSBXb3JrYm9vayBhbmQgV29ya3NoZWV0DQogICAgICAgICAgICAgICAgICBjb25zdCB3YiA9IFhMU1gudXRpbHMuYm9va19uZXcoKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHdzID0gWExTWC51dGlscy5hb2FfdG9fc2hlZXQoZXhjZWxSb3dzKTsNCg0KICAgICAgICAgICAgICAgICAgLy8gLS0tIEFVVE8gQ09MVU1OIFdJRFRIIExPR0lDIC0tLQ0KICAgICAgICAgICAgICAgICAgY29uc3QgY29sV2lkdGhzID0gZnVsbEhlYWRlcnMubWFwKChoZWFkZXIsIGluZGV4KSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgLy8gRmluZCB0aGUgbG9uZ2VzdCBzdHJpbmcgaW4gdGhpcyBzcGVjaWZpYyBjb2x1bW4NCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXhDb2x1bW5MZW5ndGggPSBleGNlbFJvd3MucmVkdWNlKChtYXgsIHJvdykgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjZWxsVmFsdWUgPSByb3dbaW5kZXhdID8gcm93W2luZGV4XS50b1N0cmluZygpIDogIiI7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heChtYXgsIGNlbGxWYWx1ZS5sZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICAgIH0sIGhlYWRlci5sZW5ndGgpOw0KDQogICAgICAgICAgICAgICAgICAgICAgLy8gUmV0dXJuIHdpZHRoIHdpdGggYSBsaXR0bGUgZXh0cmEgcGFkZGluZw0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHdjaDogbWF4Q29sdW1uTGVuZ3RoICsgMiB9Ow0KICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgIHdzWychY29scyddID0gY29sV2lkdGhzOw0KICAgICAgICAgICAgICAgICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQogICAgICAgICAgICAgICAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KHdiLCB3cywgIlBlbmRpbmdfQ2FzaF9GdWxsIik7DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHlyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKT8udmFsdWUgfHwgIlJlcG9ydCI7DQogICAgICAgICAgICAgICAgICBYTFNYLndyaXRlRmlsZSh3YiwgYE1NUFRfUGVuZGluZ19DYXNoX0Z1bGxfJHt5cn0ueGxzeGApOw0KDQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgIGFsZXJ0KCJFeHBvcnQgRXJyb3I6ICIgKyBlLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQoNCg0KDQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBydW5CYW5rU3RhdGVtZW50RGlyZWN0KCkgew0KICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdNc2cnKTsNCiAgICAgICAgICAgICAgaWYgKGxvYWRpbmcpIGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQoNCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgIC8vIDEuIEdldCB0aGUgdGFyZ2V0IHllYXIgZnJvbSB0aGUgcmFkaW8gYnV0dG9ucw0KICAgICAgICAgICAgICAgICAgY29uc3QgcmFkaW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJ5ZWFyRmlsdGVyIl06Y2hlY2tlZCcpOw0KICAgICAgICAgICAgICAgICAgaWYgKCFyYWRpbykgew0KICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCJQbGVhc2Ugc2VsZWN0IGEgWWVhciBmaXJzdC4iKTsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAobG9hZGluZykgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRZZWFyID0gcmFkaW8udmFsdWU7IC8vIGUuZy4sICIyMDI1Ig0KICAgICAgICAgICAgICAgICAgY29uc3QgbmV4dFllYXJTaG9ydCA9IChwYXJzZUludChzZWxlY3RlZFllYXIuc2xpY2UoLTIpKSArIDEpLnRvU3RyaW5nKCk7DQogICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRGWSA9IGAke3NlbGVjdGVkWWVhci5zbGljZSgtMil9LSR7bmV4dFllYXJTaG9ydH1gOw0KDQogICAgICAgICAgICAgICAgICAvLyAyLiBGZXRjaCB0aGUgYmFuayBmaWxlDQogICAgICAgICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKEJBTktfTkVXX1VSTCk7DQogICAgICAgICAgICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcG9uc2UudGV4dCgpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgbGluZXMgPSB0ZXh0LnNwbGl0KCdcbicpLmZpbHRlcihsaW5lID0+IGxpbmUudHJpbSgpICE9PSAiIik7DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGhlYWRlcnMgPSBbIkRhdGUiLCAiUmVmZXJlbmNlIiwgIkNocSBOby4iLCAiRGViaXQiLCAiQ3JlZGl0IiwgIkJhbGFuY2UiXTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGV4Y2VsRGF0YSA9IFtoZWFkZXJzXTsNCg0KICAgICAgICAgICAgICAgICAgLy8gMy4gRmlsdGVyIGFuZCBNYXANCiAgICAgICAgICAgICAgICAgIGxpbmVzLmZvckVhY2gobGluZSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgY29scyA9IGxpbmUuc3BsaXQoJ3wnKS5tYXAoYyA9PiBjLnRyaW0oKSk7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKGNvbHMubGVuZ3RoID49IDYpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm93RGF0ZSA9IGNvbHNbMF07IC8vIEZvcm1hdDogREQtTU0tWVlZWQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE9ubHkgaW5jbHVkZSBpZiBkYXRlIGJlbG9uZ3MgdG8gc2VsZWN0ZWQgRlkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGdldEZZKHJvd0RhdGUpID09PSB0YXJnZXRGWSkgew0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBDbGVhbiB1cCBBbW91bnRzOiBJZiBlbXB0eSBvciAwLCBsZWF2ZSBhcyBlbXB0eSBzdHJpbmcgIiINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRlYml0ID0gKGNvbHNbM10gJiYgcGFyc2VGbG9hdChjb2xzWzNdKSAhPT0gMCkgPyBwYXJzZUZsb2F0KGNvbHNbM10pIDogIiI7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjcmVkaXQgPSAoY29sc1s0XSAmJiBwYXJzZUZsb2F0KGNvbHNbNF0pICE9PSAwKSA/IHBhcnNlRmxvYXQoY29sc1s0XSkgOiAiIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhbGFuY2UgPSAoY29sc1s1XSAhPT0gIiIpID8gcGFyc2VGbG9hdChjb2xzWzVdKSA6ICIiOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBleGNlbERhdGEucHVzaChbDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93RGF0ZSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xzWzFdLCAvLyBSZWZlcmVuY2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xzWzJdLCAvLyBDaHEgTm8uDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGViaXQsICAgLy8gRW1wdHkgaWYgbm8gdmFsdWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjcmVkaXQsICAvLyBFbXB0eSBpZiBubyB2YWx1ZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJhbGFuY2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgIGlmIChleGNlbERhdGEubGVuZ3RoID09PSAxKSB7DQogICAgICAgICAgICAgICAgICAgICAgYWxlcnQoYE5vIGJhbmsgcmVjb3JkcyBmb3VuZCBmb3IgRlkgJHt0YXJnZXRGWX1gKTsNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgIC8vIDQuIENyZWF0ZSBFeGNlbA0KICAgICAgICAgICAgICAgICAgY29uc3Qgd2IgPSBYTFNYLnV0aWxzLmJvb2tfbmV3KCk7DQogICAgICAgICAgICAgICAgICBjb25zdCB3cyA9IFhMU1gudXRpbHMuYW9hX3RvX3NoZWV0KGV4Y2VsRGF0YSk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIDUuIEF1dG8tRml0IENvbHVtbiBXaWR0aHMNCiAgICAgICAgICAgICAgICAgIHdzWychY29scyddID0gaGVhZGVycy5tYXAoKGhlYWRlciwgaW5kZXgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXhMZW4gPSBleGNlbERhdGEucmVkdWNlKChtYXgsIHJvdykgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB2YWwgPSAocm93W2luZGV4XSAhPT0gdW5kZWZpbmVkICYmIHJvd1tpbmRleF0gIT09IG51bGwpID8gcm93W2luZGV4XS50b1N0cmluZygpIDogIiI7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBNYXRoLm1heChtYXgsIHZhbC5sZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICAgIH0sIGhlYWRlci5sZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB7IHdjaDogbWF4TGVuICsgMiB9Ow0KICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgIFhMU1gudXRpbHMuYm9va19hcHBlbmRfc2hlZXQod2IsIHdzLCAiQmFuayBTdGF0ZW1lbnQiKTsNCiAgICAgICAgICAgICAgICAgIFhMU1gud3JpdGVGaWxlKHdiLCBgTU1QVF9CYW5rX1N0YXRlbWVudF8ke3RhcmdldEZZfS54bHN4YCk7DQoNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZSkgew0KICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlKTsNCiAgICAgICAgICAgICAgICAgIGFsZXJ0KCJFcnJvcjogIiArIGUubWVzc2FnZSk7DQogICAgICAgICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICAgICAgICBpZiAobG9hZGluZykgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICB9DQogICAgICAgICAgfQ0KDQoNCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJ1bkV4cGVuc2VzRXhwb3J0KCkgew0KICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdNc2cnKTsNCiAgICAgICAgICAgICAgaWYgKGxvYWRpbmcpIGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7DQoNCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgIC8vIDEuIEZpbmFuY2lhbCBZZWFyIEZpbHRlcg0KICAgICAgICAgICAgICAgICAgY29uc3QgcmFkaW8gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJ5ZWFyRmlsdGVyIl06Y2hlY2tlZCcpOw0KICAgICAgICAgICAgICAgICAgaWYgKCFyYWRpbykgew0KICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCJQbGVhc2Ugc2VsZWN0IGEgWWVhciBmaXJzdC4iKTsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAobG9hZGluZykgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkWWVhciA9IHJhZGlvLnZhbHVlOw0KICAgICAgICAgICAgICAgICAgY29uc3QgdGFyZ2V0RlkgPSBgJHtzZWxlY3RlZFllYXIuc2xpY2UoLTIpfS0keyhwYXJzZUludChzZWxlY3RlZFllYXIuc2xpY2UoLTIpKSArIDEpfWA7DQoNCiAgICAgICAgICAgICAgICAgIC8vIDIuIEZldGNoIHRoZSBFeHBlbnNlIEV4Y2VsIEZpbGUNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goRVhQRU5TRVNfVVJMKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGFycmF5QnVmZmVyID0gYXdhaXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTsNCg0KICAgICAgICAgICAgICAgICAgLy8gMy4gUmVhZCB0aGUgV29ya2Jvb2sNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHdvcmtib29rID0gWExTWC5yZWFkKGFycmF5QnVmZmVyLCB7IHR5cGU6ICdhcnJheScsIGNlbGxEYXRlczogdHJ1ZSB9KTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGZpcnN0U2hlZXQgPSB3b3JrYm9vay5TaGVldHNbd29ya2Jvb2suU2hlZXROYW1lc1swXV07DQoNCiAgICAgICAgICAgICAgICAgIC8vIENvbnZlcnQgdG8gQXJyYXkgb2YgQXJyYXlzIChoZWFkZXI6IDEga2VlcHMgaXQgYXMgcm93cykNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGFsbFJvd3MgPSBYTFNYLnV0aWxzLnNoZWV0X3RvX2pzb24oZmlyc3RTaGVldCwgeyBoZWFkZXI6IDEgfSk7DQoNCiAgICAgICAgICAgICAgICAgIGlmIChhbGxSb3dzLmxlbmd0aCA8IDEpIHsNCiAgICAgICAgICAgICAgICAgICAgICBhbGVydCgiRXhwZW5zZSBmaWxlIGlzIGVtcHR5LiIpOw0KICAgICAgICAgICAgICAgICAgICAgIHJldHVybjsNCiAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgY29uc3QgaGVhZGVycyA9IGFsbFJvd3NbMF07DQogICAgICAgICAgICAgICAgICBjb25zdCBleHBvcnREYXRhID0gW2hlYWRlcnNdOw0KDQogICAgICAgICAgICAgICAgICAvLyA0LiBGaWx0ZXJpbmcgTG9vcA0KICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPCBhbGxSb3dzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm93ID0gYWxsUm93c1tpXTsNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgZGF0ZVZhbCA9IHJvd1swXTsgLy8gQXNzdW1pbmcgRGF0ZSBpcyBjb2x1bW4gMQ0KDQogICAgICAgICAgICAgICAgICAgICAgaWYgKGRhdGVWYWwpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNoZWNrRGF0ZSA9ICIiOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIEhhbmRsZSBpZiBFeGNlbCBnaXZlcyBhIERhdGUgT2JqZWN0IG9yIGEgU3RyaW5nDQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkYXRlVmFsIGluc3RhbmNlb2YgRGF0ZSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZGQgPSBTdHJpbmcoZGF0ZVZhbC5nZXREYXRlKCkpLnBhZFN0YXJ0KDIsICcwJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtbSA9IFN0cmluZyhkYXRlVmFsLmdldE1vbnRoKCkgKyAxKS5wYWRTdGFydCgyLCAnMCcpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgeXl5eSA9IGRhdGVWYWwuZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrRGF0ZSA9IGAke2RkfS0ke21tfS0ke3l5eXl9YDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrRGF0ZSA9IGRhdGVWYWwudG9TdHJpbmcoKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1hdGNoIGFnYWluc3QgeW91ciBZZWFyIEZpbHRlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZ2V0RlkoY2hlY2tEYXRlKSA9PT0gdGFyZ2V0RlkpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cG9ydERhdGEucHVzaChyb3cpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICBpZiAoZXhwb3J0RGF0YS5sZW5ndGggPT09IDEpIHsNCiAgICAgICAgICAgICAgICAgICAgICBhbGVydChgTm8gZXhwZW5zZXMgZm91bmQgZm9yIEZZICR7dGFyZ2V0Rll9YCk7DQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAvLyA1LiBDcmVhdGUgT3V0cHV0IEZpbGUNCiAgICAgICAgICAgICAgICAgIGNvbnN0IG5ld1diID0gWExTWC51dGlscy5ib29rX25ldygpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgbmV3V3MgPSBYTFNYLnV0aWxzLmFvYV90b19zaGVldChleHBvcnREYXRhKTsNCg0KICAgICAgICAgICAgICAgICAgLy8gLS0tIEFVVE8gQ09MVU1OIFdJRFRIIC0tLQ0KICAgICAgICAgICAgICAgICAgbmV3V3NbJyFjb2xzJ10gPSBoZWFkZXJzLm1hcCgoaCwgaW5kZXgpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtYXhMZW4gPSBleHBvcnREYXRhLnJlZHVjZSgobWF4LCByb3cpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgdmFsID0gcm93W2luZGV4XSA/IHJvd1tpbmRleF0udG9TdHJpbmcoKSA6ICIiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gTWF0aC5tYXgobWF4LCB2YWwubGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgICB9LCBoID8gaC50b1N0cmluZygpLmxlbmd0aCA6IDEwKTsNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4geyB3Y2g6IG1heExlbiArIDIgfTsNCiAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICBYTFNYLnV0aWxzLmJvb2tfYXBwZW5kX3NoZWV0KG5ld1diLCBuZXdXcywgIkV4cGVuc2VzIik7DQogICAgICAgICAgICAgICAgICBYTFNYLndyaXRlRmlsZShuZXdXYiwgYE1NUFRfRXhwZW5zZXNfJHt0YXJnZXRGWX0ueGxzeGApOw0KDQogICAgICAgICAgICAgIH0gY2F0Y2ggKGUpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoIkV4cGVuc2UgRXJyb3I6IiwgZSk7DQogICAgICAgICAgICAgICAgICBhbGVydCgiQ291bGQgbm90IHByb2Nlc3MgRXhwZW5zZSBmaWxlOiAiICsgZS5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgfSBmaW5hbGx5IHsNCiAgICAgICAgICAgICAgICAgIGlmIChsb2FkaW5nKSBsb2FkaW5nLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQoNCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJ1bkFub255TWF0Y2hEaXJlY3QoKSB7DQogICAgICAgICAgICAgIGNvbnN0IGxvYWRpbmdEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ01zZycpOw0KICAgICAgICAgICAgICBpZiAobG9hZGluZ0Rpdikgew0KICAgICAgICAgICAgICAgICAgbG9hZGluZ0Rpdi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgICAgICAgICAgIGxvYWRpbmdEaXYuaW5uZXJIVE1MID0gIkluaXRpYWxpemluZyBEZWVwIE1hdGNoIGZvciBTZWxlY3RlZCBZZWFyLi4uIjsNCiAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgIGNvbnN0IHNZZWFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKS52YWx1ZTsNCiAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDEwMCkpOw0KDQogICAgICAgICAgICAgIHRyeSB7DQogICAgICAgICAgICAgICAgICAvLyAtLS0gVUkgQ0xFQVJJTkcgQ09NTUVOVEVEIE9VVCAtLS0NCiAgICAgICAgICAgICAgICAgIC8vIGNsZWFyV29ya3NwYWNlKCk7DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKERBVEFfVVJMKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXMudGV4dCgpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgYWxsUmVjb3JkcyA9IHRleHQuc3BsaXQoJ1xuJykuZmlsdGVyKHIgPT4gci5sZW5ndGggPiAyMCk7DQoNCiAgICAgICAgICAgICAgICAgIC8vIDEuIEVYQUNUIFllYXIgTG9naWMgZnJvbSB5b3VyIG9yaWdpbmFsDQogICAgICAgICAgICAgICAgICBjb25zdCB0YXJnZXRzID0gYWxsUmVjb3Jkcy5maWx0ZXIociA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgbGV0IGYgPSByLnNwbGl0KCd8Jyk7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3Qgck5vID0gKGZbMF0gfHwgIiIpLnRvVXBwZXJDYXNlKCk7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgckRhdGUgPSBwYXJzZURhdGUoZlsxXSk7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNDYW5jZWxsZWQgPSBmWzEzXT8udHJpbSgpLnRvVXBwZXJDYXNlKCkgPT09ICJZRVMiOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQW5vbiA9ICghZlsyXSB8fCBmWzJdLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoImFub255bW91cyIpKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0dXID0gck5vLnN0YXJ0c1dpdGgoIkdXIik7DQoNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgaW5ZZWFyID0gKHNZZWFyID09PSAiYWxsIik7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKCFpblllYXIpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZnlTID0gcGFyc2VJbnQoc1llYXIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gckRhdGUuZ2V0TW9udGgoKSArIDEsIHkgPSByRGF0ZS5nZXRGdWxsWWVhcigpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpblllYXIgPSAoeSA9PT0gZnlTICYmIG0gPj0gNCkgfHwgKHkgPT09IGZ5UyArIDEgJiYgbSA8PSAzKTsNCiAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGluWWVhciAmJiBpc0Fub24gJiYgIWlzQ2FuY2VsbGVkICYmICFpc0dXOw0KICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgIGlmICh0YXJnZXRzLmxlbmd0aCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KGBObyBhbm9ueW1vdXMgcmVjb3JkcyBmb3VuZCBmb3IgRlkgJHtzWWVhcn0uYCk7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRpbmdEaXYpIGxvYWRpbmdEaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IG1hdGNoTGVuZ3RoID0gMTU7DQogICAgICAgICAgICAgICAgICBsZXQgcmVwb3J0VGV4dCA9IGBNTVBUIEFOT05ZTU9VUyBNQVRDSElORyBSRVBPUlQgLSBGWSAke3NZZWFyfVxuYDsNCiAgICAgICAgICAgICAgICAgIHJlcG9ydFRleHQgKz0gYD09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5gOw0KDQogICAgICAgICAgICAgICAgICAvLyAyLiBMb29wIHRocm91Z2ggWWVhci1TcGVjaWZpYyBUYXJnZXRzIChEZWVwIE1hdGNoaW5nKQ0KICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0YXJnZXRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKGxvYWRpbmdEaXYpIGxvYWRpbmdEaXYuaW5uZXJIVE1MID0gYFNjYW5uaW5nIFJlY29yZCAke2kgKyAxfSBvZiAke3RhcmdldHMubGVuZ3RofS4uLmA7DQogICAgICAgICAgICAgICAgICAgICAgYXdhaXQgbmV3IFByb21pc2UociA9PiBzZXRUaW1lb3V0KHIsIDEpKTsgLy8gUHJldmVudHMgYnJvd3NlciBoYW5nDQoNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtID0gdGFyZ2V0c1tpXS5zcGxpdCgnfCcpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1SZWZDbGVhbiA9IHNhbml0aXplUmVmKG1bMTBdKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtSUQgPSBtWzBdOw0KDQogICAgICAgICAgICAgICAgICAgICAgaWYgKG1SZWZDbGVhbi5sZW5ndGggPCBtYXRjaExlbmd0aCkgY29udGludWU7DQoNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgdGFyZ2V0SGVhZGVyQWRkZWQgPSBmYWxzZTsNCg0KICAgICAgICAgICAgICAgICAgICAgIC8vIDMuIFNlYXJjaCBHTE9CQUwgZGF0YWJhc2UgZm9yIG1hdGNoZXMNCiAgICAgICAgICAgICAgICAgICAgICBhbGxSZWNvcmRzLmZvckVhY2goZGJSb3cgPT4gew0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkID0gZGJSb3cuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZE5vID0gKGRbMF0gfHwgIiIpLnRvVXBwZXJDYXNlKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGRbMF0gPT09IG1JRCB8fCBkTm8uc3RhcnRzV2l0aCgiR1ciKSkgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ2FuZGlkYXRlQW5vbiA9ICghZFsyXSB8fCBkWzJdLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoImFub255bW91cyIpKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ2FuZGlkYXRlQW5vbikgcmV0dXJuOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGlzQ2FuY2VsbGVkID0gZFsxM10/LnRvVXBwZXJDYXNlKCkgPT09ICJZRVMiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0Nhc2ggPSAoZFsxMV0gfHwgIiIpLnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoIkNBU0giKSB8fCAoZFs4XSB8fCAiIikudG9VcHBlckNhc2UoKS5pbmNsdWRlcygiQ0FTSCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNDYW5jZWxsZWQgfHwgaXNDYXNoKSByZXR1cm47DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZFJlZkNsZWFuID0gc2FuaXRpemVSZWYoZFsxMF0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZFJlZkNsZWFuLmxlbmd0aCA8IG1hdGNoTGVuZ3RoKSByZXR1cm47DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kT3ZlcmxhcCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZFJlZkNsZWFuLmluY2x1ZGVzKG1SZWZDbGVhbikgfHwgbVJlZkNsZWFuLmluY2x1ZGVzKGRSZWZDbGVhbikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kT3ZlcmxhcCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCB4ID0gMDsgeCA8PSBtUmVmQ2xlYW4ubGVuZ3RoIC0gbWF0Y2hMZW5ndGg7IHgrKykgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChkUmVmQ2xlYW4uaW5jbHVkZXMobVJlZkNsZWFuLnN1YnN0cmluZyh4LCB4ICsgbWF0Y2hMZW5ndGgpKSkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3VuZE92ZXJsYXAgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhazsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoZm91bmRPdmVybGFwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRhcmdldEhlYWRlckFkZGVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0VGV4dCArPSBgXG5UQVJHRVQ6ICR7bVswXX0gfCAke21bMV19IHwgQW10OiAke21bOV19IHwgUmVmOiAke21bMTBdfVxuYDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXBvcnRUZXh0ICs9IGAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0SGVhZGVyQWRkZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwb3J0VGV4dCArPSBgICAgPj4gTUFUQ0g6ICR7ZFswXX0gfCAke2RbMl19IHwgVGVsOiAke2RbM119IHwgUmVmOiAke2RbMTBdfVxuYDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAvLyA0LiBUcmlnZ2VyIEF1dG8tRG93bmxvYWQgKFJlcGxhY2luZyB0aGUgTWFudWFsIERvd25sb2FkIEJ1dHRvbikNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGJsb2IgPSBuZXcgQmxvYihbcmVwb3J0VGV4dF0sIHsgdHlwZTogJ3RleHQvcGxhaW4nIH0pOw0KICAgICAgICAgICAgICAgICAgY29uc3QgbGluayA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsNCiAgICAgICAgICAgICAgICAgIGxpbmsuaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7DQogICAgICAgICAgICAgICAgICBsaW5rLmRvd25sb2FkID0gYEFub255bW91c19NYXRjaF9SZXBvcnRfJHtzWWVhcn0udHh0YDsNCiAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGluayk7DQogICAgICAgICAgICAgICAgICBsaW5rLmNsaWNrKCk7DQogICAgICAgICAgICAgICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmspOw0KDQogICAgICAgICAgICAgIH0gY2F0Y2ggKGVycikgew0KICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihlcnIpOw0KICAgICAgICAgICAgICAgICAgYWxlcnQoIkxvZ2ljIGVycm9yOiAiICsgZXJyLm1lc3NhZ2UpOw0KICAgICAgICAgICAgICB9IGZpbmFsbHkgew0KICAgICAgICAgICAgICAgICAgaWYgKGxvYWRpbmdEaXYpIGxvYWRpbmdEaXYuc3R5bGUuZGlzcGxheSA9ICdub25lJzsNCiAgICAgICAgICAgICAgfQ0KICAgICAgICAgIH0NCg0KDQoNCg0KDQoNCg0KICAgICAgICAgIGFzeW5jIGZ1bmN0aW9uIHJ1blNvZnRjb3BpZXNEaXJlY3QoKSB7DQogICAgICAgICAgICAgIGNsZWFyV29ya3NwYWNlKCk7DQogICAgICAgICAgICAgIGNvbnN0IHBNc2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZ01zZycpOw0KICAgICAgICAgICAgICBjb25zdCBzWWVhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InllYXJGaWx0ZXIiXTpjaGVja2VkJykudmFsdWU7DQogICAgICAgICAgICAgIGNvbnN0IEZZX0RJU1BMQVkgPSBzWWVhciA9PT0gImFsbCIgPyAiQWxsIFllYXJzIiA6IGAke3NZZWFyfS0ke3BhcnNlSW50KHNZZWFyKSArIDF9YDsNCg0KICAgICAgICAgICAgICB0cnkgew0KICAgICAgICAgICAgICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IGZldGNoKERBVEFfVVJMKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXNwLnRleHQoKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZHMgPSB0ZXh0LnNwbGl0KCdcbicpOw0KDQogICAgICAgICAgICAgICAgICBjb25zdCB7IGpzUERGIH0gPSB3aW5kb3cuanNwZGY7DQogICAgICAgICAgICAgICAgICBsZXQgdmFsaWRSZWNvcmRzID0gW107DQoNCiAgICAgICAgICAgICAgICAgIC8vIDEuIEZpbHRlciB2YWxpZCByZWNvcmRzIGJhc2VkIG9uIEZZIHNlbGVjdGlvbg0KICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCByZWNvcmRzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgICAgbGV0IGYgPSByZWNvcmRzW2ldLnNwbGl0KCd8Jyk7DQogICAgICAgICAgICAgICAgICAgICAgaWYgKGYubGVuZ3RoIDwgMTMpIGNvbnRpbnVlOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJEYXRlU3RyID0gZlsxXS50cmltKCk7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgckRhdGVPYmogPSBwYXJzZURhdGUockRhdGVTdHIpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG0gPSByRGF0ZU9iai5nZXRNb250aCgpICsgMTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCB5ID0gckRhdGVPYmouZ2V0RnVsbFllYXIoKTsNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgcmVjb3JkRlkgPSAobSA8IDQpID8gKHkgLSAxKS50b1N0cmluZygpIDogeS50b1N0cmluZygpOw0KICAgICAgICAgICAgICAgICAgICAgIGlmIChzWWVhciA9PT0gImFsbCIgfHwgc1llYXIgPT09IHJlY29yZEZZKSB2YWxpZFJlY29yZHMucHVzaChmKTsNCiAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgY29uc3QgdG90YWxUb1Byb2Nlc3MgPSB2YWxpZFJlY29yZHMubGVuZ3RoOw0KICAgICAgICAgICAgICAgICAgaWYgKHRvdGFsVG9Qcm9jZXNzID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgYWxlcnQoIk5vIHJlY2VpcHRzIGZvdW5kIGZvciB0aGUgc2VsZWN0ZWQgcGVyaW9kLiIpOw0KICAgICAgICAgICAgICAgICAgICAgIGhpZGVMb2FkaW5nKCk7DQogICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAvLyAyLiBDSFVOSyBMT0dJQyAoMTAwMCBSZWNlaXB0cyBwZXIgZmlsZSkNCiAgICAgICAgICAgICAgICAgIGNvbnN0IENIVU5LX1NJWkUgPSAxMDAwOw0KICAgICAgICAgICAgICAgICAgbGV0IHBhcnROdW1iZXIgPSAxOw0KDQogICAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRvdGFsVG9Qcm9jZXNzOyBpICs9IENIVU5LX1NJWkUpIHsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBwZGYgPSBuZXcganNQREYoJ3AnLCAncHQnLCAnYTQnKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBjdXJyZW50QmF0Y2ggPSB2YWxpZFJlY29yZHMuc2xpY2UoaSwgaSArIENIVU5LX1NJWkUpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJhdGNoUGFnZUNvdW50ID0gTWF0aC5jZWlsKGN1cnJlbnRCYXRjaC5sZW5ndGggLyAyKTsNCg0KICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqIDwgY3VycmVudEJhdGNoLmxlbmd0aDsgaisrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBmID0gY3VycmVudEJhdGNoW2pdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZ2xvYmFsQ291bnQgPSBpICsgaiArIDE7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUHJvZ3Jlc3MgZGlzcGxheTogIlBhcnQgMSAtIFByb2Nlc3NpbmcgNTA1ICg1MDUvMjUwMCkiDQogICAgICAgICAgICAgICAgICAgICAgICAgIHBNc2cuaW5uZXJUZXh0ID0gYFBsZWFzZSBXYWl0IDogUGFydCAke3BhcnROdW1iZXJ9IC0gUHJvY2Vzc2luZyAke2ZbMF19ICgke2dsb2JhbENvdW50fS8ke3RvdGFsVG9Qcm9jZXNzfSlgOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGltZ0RhdGEgPSBhd2FpdCByZW5kZXJPcmlnaW5hbFJlY2VpcHRUb0ltYWdlKGYpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGhhbGZQYWdlID0gNDIxOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNlaXB0SGVpZ2h0ID0gMzM1Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB5T2Zmc2V0ID0gKGhhbGZQYWdlIC0gcmVjZWlwdEhlaWdodCkgLyAyOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDIgcmVjZWlwdHMgcGVyIHBhZ2UgbG9naWMNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGogJSAyID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoaiA+IDApIHBkZi5hZGRQYWdlKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFBERiBIZWFkZXINCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZi5zZXRGb250U2l6ZSgxMCk7IHBkZi5zZXRGb250KCJoZWx2ZXRpY2EiLCAiYm9sZCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRmLnRleHQoYFJlY2VpcHRzIEdlbmVyYXRlZCBpbiB0aGUgRmluYW5jaWFsIFllYXIgOiAke0ZZX0RJU1BMQVl9IChQYXJ0ICR7cGFydE51bWJlcn0pYCwgNDAsIDMwKTsNCg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUERGIEZvb3Rlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRmLnNldEZvbnRTaXplKDkpOyBwZGYuc2V0Rm9udCgiaGVsdmV0aWNhIiwgIm5vcm1hbCIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgY3VycmVudFBhZ2UgPSBNYXRoLmNlaWwoKGogKyAxKSAvIDIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRmLnRleHQoYFBhZ2UgJHtjdXJyZW50UGFnZX0gb2YgJHtiYXRjaFBhZ2VDb3VudH1gLCA1MDAsIDgyMCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIE1pZC1wYWdlIGN1dHRpbmcgZ3VpZGUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBkZi5zZXREcmF3Q29sb3IoMjAwKTsgcGRmLnNldExpbmVEYXNoUGF0dGVybihbNSwgNV0sIDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRmLmxpbmUoMCwgaGFsZlBhZ2UsIDU5NSwgaGFsZlBhZ2UpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwZGYuYWRkSW1hZ2UoaW1nRGF0YSwgJ0pQRUcnLCA1MCwgeU9mZnNldCArIDIwLCA0OTUsIDApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGRmLmFkZEltYWdlKGltZ0RhdGEsICdKUEVHJywgNTAsIGhhbGZQYWdlICsgeU9mZnNldCwgNDk1LCAwKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgICAgICAgIC8vIFNhdmUgdGhlIGZpbGUgZm9yIHRoaXMgYmF0Y2gNCiAgICAgICAgICAgICAgICAgICAgICBwZGYuc2F2ZShgTU1QVCBSZWNlaXB0cyAke0ZZX0RJU1BMQVl9IFBhcnQgJHtwYXJ0TnVtYmVyfS5wZGZgKTsNCiAgICAgICAgICAgICAgICAgICAgICBwYXJ0TnVtYmVyKys7DQogICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7DQogICAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKGVycik7DQogICAgICAgICAgICAgICAgICBhbGVydCgiQ3JpdGljYWwgRXJyb3I6ICIgKyBlcnIubWVzc2FnZSk7DQogICAgICAgICAgICAgIH0gZmluYWxseSB7DQogICAgICAgICAgICAgICAgICBoaWRlTG9hZGluZygpOw0KICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgaGlkZUxvYWRpbmcoKTsgYWxlcnQoIkFsbCBwYXJ0cyBkb3dubG9hZGVkIHN1Y2Nlc3NmdWxseSEiKTsNCg0KICAgICAgICAgIH0NCg0KDQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiByZW5kZXJPcmlnaW5hbFJlY2VpcHRUb0ltYWdlKGYpIHsNCiAgICAgICAgICAgICAgY29uc3QgaXNDYW5jZWxsZWQgPSBmWzEzXT8udG9Mb3dlckNhc2UoKS50cmltKCkgPT09ICd5ZXMnOw0KICAgICAgICAgICAgICBjb25zdCB0ZW1wRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7DQogICAgICAgICAgICAgIHRlbXBEaXYuc3R5bGUgPSAid2lkdGg6IDQ4MHB0OyBwYWRkaW5nOiAxMHB4IDIwcHg7IGJhY2tncm91bmQ6ICNmZmY7IGJvcmRlcjogMnB4IHNvbGlkICMwMDA7IGZvbnQtZmFtaWx5OiAnVGltZXMgTmV3IFJvbWFuJywgc2VyaWY7IGNvbG9yOiAjMDAwOyBwb3NpdGlvbjogYWJzb2x1dGU7IGxlZnQ6IC05OTk5cHg7IjsNCg0KICAgICAgICAgICAgICAvLyBTdHJ1Y3R1cmU6IEFkZHJlc3MoNCksIENvdW50cnkoMTkpLCBQaW4gQ29kZSgxNSkNCiAgICAgICAgICAgICAgY29uc3QgYWRkciA9IGZbNF0gPyBmWzRdLnRyaW0oKSA6ICIiOw0KICAgICAgICAgICAgICBjb25zdCBjb3VudHJ5ID0gZlsxOV0gPyBmWzE5XS50cmltKCkgOiAiIjsNCiAgICAgICAgICAgICAgY29uc3QgcGluID0gZlsxNV0gPyBmWzE1XS50cmltKCkgOiAiIjsNCg0KICAgICAgICAgICAgICBsZXQgZnVsbEFkZHJlc3MgPSBhZGRyOw0KICAgICAgICAgICAgICBpZiAoY291bnRyeSkgZnVsbEFkZHJlc3MgKz0gIiwgIiArIGNvdW50cnk7DQogICAgICAgICAgICAgIGlmIChwaW4pIGZ1bGxBZGRyZXNzICs9ICIsICIgKyBwaW47DQoNCiAgICAgICAgICAgICAgdGVtcERpdi5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICAgIDxkaXYgc3R5bGU9InBvc2l0aW9uOiByZWxhdGl2ZTsiPg0KICAgICAgICAgICAgICAgICAgJHtpc0NhbmNlbGxlZCA/ICc8ZGl2IHN0eWxlPSJwb3NpdGlvbjphYnNvbHV0ZTsgdG9wOjUwJTsgbGVmdDo1MCU7IHRyYW5zZm9ybTp0cmFuc2xhdGUoLTUwJSwtNTAlKSByb3RhdGUoLTQ1ZGVnKTsgZm9udC1zaXplOjcwcHQ7IGNvbG9yOnJnYmEoMjE3LDgzLDc5LDAuMTUpOyBmb250LXdlaWdodDpib2xkOyBib3JkZXI6OHB0IHNvbGlkIHJnYmEoMjE3LDgzLDc5LDAuMTUpOyBwYWRkaW5nOjEwcHggMzBweDsgei1pbmRleDoxMDA7IHdoaXRlLXNwYWNlOm5vd3JhcDsiPkNBTkNFTExFRDwvZGl2PicgOiAnJ30NCiAgICAgICAgICAgICAgICAgIDx0YWJsZSBzdHlsZT0id2lkdGg6IDEwMCU7IGJvcmRlci1jb2xsYXBzZTogY29sbGFwc2U7Ij4NCiAgICAgICAgICAgICAgICAgICAgICA8dHI+DQogICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT0id2lkdGg6IDc1cHQ7IHZlcnRpY2FsLWFsaWduOiB0b3A7Ij48aW1nIHNyYz0iaHR0cHM6Ly9kbC5kcm9wYm94dXNlcmNvbnRlbnQuY29tL3NjbC9maS9idXAzbnMzYjR4N2ZneG82NDdmeWQvUGVyaXlhdmEuanBnP3Jsa2V5PWYzazhnYzFod2xqdWV5eXY0YzczNmlnaXImZGw9MSIgc3R5bGU9IndpZHRoOjEwMCUiIGNyb3Nzb3JpZ2luPSJhbm9ueW1vdXMiPjwvdGQ+DQogICAgICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT0idGV4dC1hbGlnbjogY2VudGVyOyB2ZXJ0aWNhbC1hbGlnbjogdG9wOyBwYWRkaW5nLWxlZnQ6IDVwdDsiPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOiAxM3B0OyBmb250LXdlaWdodDogYm9sZDsiPk1ZTEFJIE1BSEFQRVJJWUFWQSBBTlVTSEFNIFRSVVNUIChSRUdELik8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTogOC41cHQ7IGxpbmUtaGVpZ2h0OiAxLjI7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBOZXcgTm8uIDQsIE9sZCBOby4gMjMsIFBpdGNodXBpbGxhaSBTdHJlZXQsIE15bGFwb3JlLCBDaGVubmFpLTYwMCAwMDQuPGJyPg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFBob25lOiA2MzgwODk4MjMxLCA4NjEwMjE0MTM4Ljxicj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICDwn5OnIHRoaXJ1bXlsYWlhbnVzaGFtQGdtYWlsLmNvbSDwn4yQIHd3dy5teWxhaW1haGFwZXJpeWF2YXRlbXBsZS5jb208YnI+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAg4pOVIHd3dy5mYWNlYm9vay5jb20vdGhpcnVteWxhaS5hbnVzaGFtIDogV2hhdHNBcHA6IDYzODA4OTgyMzENCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgICAgICA8L3RkPg0KICAgICAgICAgICAgICAgICAgICAgIDwvdHI+DQogICAgICAgICAgICAgICAgICA8L3RhYmxlPg0KICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDogNXB0OyBkaXNwbGF5OiBmbGV4OyBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47IGZvbnQtd2VpZ2h0OiBib2xkOyBib3JkZXItdG9wOiAycHggc29saWQgIzAwMDsgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICMwMDA7IHBhZGRpbmc6IDJwdCAwOyBmb250LXNpemU6IDkuNXB0OyI+DQogICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9IndpZHRoOjEzMHB0Ij5EYXRlOiAke2ZbMV19PC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJ0ZXh0LWRlY29yYXRpb246IHVuZGVybGluZTsiPlJFQ0VJUFQ8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9IndpZHRoOjEzMHB0OyB0ZXh0LWFsaWduOnJpZ2h0Ij5ObzogJHtmWzBdfTwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0ibWFyZ2luLXRvcDogOHB0OyBmb250LXNpemU6IDEwLjVwdDsgdGV4dC1hbGlnbjoganVzdGlmeTsgbGluZS1oZWlnaHQ6IDEuMzsiPg0KICAgICAgICAgICAgICAgICAgICAgIFJlY2VpdmVkIHdpdGggdGhhbmtzIFJzLiA8Yj4ke2ZbOV19PC9iPiAoPGI+UnVwZWVzICR7dG9Xb3JkcyhmWzldKX0gb25seTwvYj4pIGZvciA8Yj4ke2ZbMTJdfTwvYj4gdmlhICR7ZlsxMV19IDxiPiR7ZlsxMF19PC9iPiBmcm9tOg0KICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJib3JkZXItdG9wOiAxcHggc29saWQgIzAwMDsgbWFyZ2luOiA0cHQgMDsiPjwvZGl2Pg0KICAgICAgICAgICAgICAgICAgPHRhYmxlIHN0eWxlPSJ3aWR0aDogMTAwJTsgYm9yZGVyLWNvbGxhcHNlOiBjb2xsYXBzZTsiPg0KICAgICAgICAgICAgICAgICAgICAgIDx0cj48dGQgc3R5bGU9IndpZHRoOiA4NXB0OyBmb250LXNpemU6IDkuNXB0OyBwYWRkaW5nOiAxLjVwdCAwOyI+TmFtZTwvdGQ+PHRkIHN0eWxlPSJmb250LXNpemU6IDkuNXB0OyBmb250LXdlaWdodDogYm9sZDsiPlNocmkuL1NtdC4gJHtmWzJdfTwvdGQ+PC90cj4NCiAgICAgICAgICAgICAgICAgICAgICA8dHI+PHRkIHN0eWxlPSJmb250LXNpemU6IDkuNXB0OyBwYWRkaW5nOiAxLjVwdCAwOyI+UEFOPC90ZD48dGQgc3R5bGU9ImZvbnQtc2l6ZTogOS41cHQ7IGZvbnQtd2VpZ2h0OiBib2xkOyI+JHtmWzZdIHx8ICdOL0EnfTwvdGQ+PC90cj4NCiAgICAgICAgICAgICAgICAgICAgICA8dHI+PHRkIHN0eWxlPSJmb250LXNpemU6IDkuNXB0OyBwYWRkaW5nOiAxLjVwdCAwOyI+UGhvbmU8L3RkPjx0ZCBzdHlsZT0iZm9udC1zaXplOiA5LjVwdDsgZm9udC13ZWlnaHQ6IGJvbGQ7Ij4ke2ZbM10gfHwgJ04vQSd9PC90ZD48L3RyPg0KICAgICAgICAgICAgICAgICAgICAgIDx0cj48dGQgc3R5bGU9ImZvbnQtc2l6ZTogOS41cHQ7IHBhZGRpbmc6IDEuNXB0IDA7Ij5FbWFpbDwvdGQ+PHRkIHN0eWxlPSJmb250LXNpemU6IDkuNXB0OyBmb250LXdlaWdodDogYm9sZDsiPiR7Zls1XSB8fCAnTi9BJ308L3RkPjwvdHI+DQogICAgICAgICAgICAgICAgICAgICAgPHRyPjx0ZCBzdHlsZT0iZm9udC1zaXplOiA5LjVwdDsgcGFkZGluZzogMS41cHQgMDsgdmVydGljYWwtYWxpZ246IHRvcDsiPkFkZHJlc3M8L3RkPjx0ZCBzdHlsZT0iZm9udC1zaXplOiA5LjVwdDsgZm9udC13ZWlnaHQ6IGJvbGQ7Ij4ke2Z1bGxBZGRyZXNzfTwvdGQ+PC90cj4NCiAgICAgICAgICAgICAgICAgIDwvdGFibGU+DQogICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJib3JkZXItdG9wOiAxcHggc29saWQgIzAwMDsgbWFyZ2luOiA0cHQgMDsiPjwvZGl2Pg0KICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuOyBhbGlnbi1pdGVtczogZmxleC1lbmQ7IG1hcmdpbi10b3A6IDVwdDsiPg0KICAgICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTogN3B0OyBmb250LXN0eWxlOiBpdGFsaWM7IHdpZHRoOiA1MCU7Ij4qQ29tcHV0ZXIgR2VuZXJhdGVkIFJlY2VpcHQtTm8gc2lnbmF0dXJlIFJlcXVpcmVkPC9kaXY+DQogICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjogcmlnaHQ7IHdpZHRoOiA1MCU7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOiA5LjVwdDsgZm9udC13ZWlnaHQ6IGJvbGQ7Ij5mb3IgTVlMQUkgTUFIQVBFUklZQVZBIEFOVVNIQU0gVFJVU1Q8L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBzdHlsZT0iZm9udC1zaXplOiA4cHQ7IGZvbnQtd2VpZ2h0OiBib2xkOyBtYXJnaW4tdG9wOiAycHQ7Ij5TZWMgMTItQSBWYWxpZCB0aWxsIDMxLTAzLTIwMjYgfCBQQU4gQUFFVE01MTQ1SjwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgPC9kaXY+DQogICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgIGA7DQoNCiAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0ZW1wRGl2KTsNCiAgICAgICAgICAgICAgY29uc3QgY2FudmFzID0gYXdhaXQgaHRtbDJjYW52YXModGVtcERpdiwgeyB1c2VDT1JTOiB0cnVlLCBzY2FsZTogMiB9KTsNCiAgICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0ZW1wRGl2KTsNCiAgICAgICAgICAgICAgcmV0dXJuIGNhbnZhcy50b0RhdGFVUkwoJ2ltYWdlL2pwZWcnLCAxLjApOw0KICAgICAgICAgIH0NCg0KDQoNCg0KDQoNCiAgICAgICAgICAvKioNCiogTmV3IERvd25sb2FkIE1lbnUgRnVuY3Rpb246IENsZWFycyB3b3Jrc3BhY2UgYW5kIHByb3ZpZGVzIGNvbnNvbGlkYXRlZA0KKiBkb3dubG9hZCBidXR0b25zIHRoYXQgYXV0by1hZGp1c3QgdG8gc2NyZWVuIHdpZHRoLg0KKi8NCg0KICAgICAgICAgIGZ1bmN0aW9uIHNob3dEb3dubG9hZE1lbnUoKSB7DQogICAgICAgICAgICAgIGNsZWFyV29ya3NwYWNlKCk7DQogICAgICAgICAgICAgIGNvbnN0IHJlc3VsdHNEaXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsZWRSZXN1bHRzJyk7DQoNCiAgICAgICAgICAgICAgLy8gRWFjaCBidXR0b24gaGFzIGEgdW5pcXVlIGJhY2tncm91bmQgYW5kIGhpZ2gtY29udHJhc3QgdGV4dCBjb2xvcg0KICAgICAgICAgICAgICBjb25zdCBodG1sID0gYA0KICAgICAgICAgICAgICA8ZGl2IGlkPSJkb3dubG9hZENlbnRlclRvcCIgc3R5bGU9InBhZGRpbmc6IDE1cHg7IGRpc3BsYXk6IGZsZXg7IGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47IGdhcDogMTBweDsgYWxpZ24taXRlbXM6IGNlbnRlcjsgbWF4LXdpZHRoOiA4MDBweDsgbWFyZ2luOiAwIGF1dG87Ij4NCiAgICAgICAgICAgICAgICAgIDxoMyBzdHlsZT0iY29sb3I6IHZhcigtLXByaW1hcnktYmx1ZSk7IG1hcmdpbi1ib3R0b206IDVweDsiPk1NUFQgRG93bmxvYWQgQ2VudGVyPC9oMz4NCg0KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ3cmFwTG9hZGluZyhydW5Tb2Z0Y29waWVzRGlyZWN0KSINCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9IndpZHRoOiAxMDAlOyBoZWlnaHQ6IDUwcHg7IGJhY2tncm91bmQ6ICMyRTdEMzI7IGNvbG9yOiAjRkZGRkZGOyBib3JkZXI6IDFweCBzb2xpZCAjMUI1RTIwOyBmb250LXdlaWdodDogYm9sZDsgYm9yZGVyLXJhZGl1czogNXB4OyBjdXJzb3I6IHBvaW50ZXI7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAxLiBTb2Z0Y29waWVzIG9mIFJlY2VpcHRzIChQREYpDQogICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCg0KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJnZW5lcmF0ZVJSTGFiZWxzKCkiDQogICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJ3aWR0aDogMTAwJTsgaGVpZ2h0OiA1MHB4OyBiYWNrZ3JvdW5kOiAjRkZGOUM0OyBjb2xvcjogIzAwMDAwMDsgYm9yZGVyOiAxcHggc29saWQgI0ZCQzAyRDsgZm9udC13ZWlnaHQ6IGJvbGQ7IGJvcmRlci1yYWRpdXM6IDVweDsgY3Vyc29yOiBwb2ludGVyOyI+DQogICAgICAgICAgICAgICAgICAgICAgMi4gTGFiZWxzIGZvciBSZWFkeSBSZWNlaXB0cyAoUERGKQ0KICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQoNCiAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0iZG93bmxvYWREb25hdGlvbkxpc3REaXJlY3QoKSINCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9IndpZHRoOiAxMDAlOyBoZWlnaHQ6IDUwcHg7IGJhY2tncm91bmQ6ICNFM0YyRkQ7IGNvbG9yOiAjMEQ0N0ExOyBib3JkZXI6IDFweCBzb2xpZCAjMjE5NkYzOyBmb250LXdlaWdodDogYm9sZDsgYm9yZGVyLXJhZGl1czogNXB4OyBjdXJzb3I6IHBvaW50ZXI7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAzLiBEb25hdGlvbiBMaXN0IChFeGNlbCkNCiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KDQogICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9ImRvd25sb2FkVW5pcXVlRG9ub3JMaXN0RGlyZWN0KCkiDQogICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJ3aWR0aDogMTAwJTsgaGVpZ2h0OiA1MHB4OyBiYWNrZ3JvdW5kOiAjRThGNUU5OyBjb2xvcjogIzFCNUUyMDsgYm9yZGVyOiAxcHggc29saWQgIzRDQUY1MDsgZm9udC13ZWlnaHQ6IGJvbGQ7IGJvcmRlci1yYWRpdXM6IDVweDsgY3Vyc29yOiBwb2ludGVyOyI+DQogICAgICAgICAgICAgICAgICAgICAgNC4gVW5pcXVlIERvbm9yIExpc3QgKFRvcCBEb25vcnMgRXhjZWwpDQogICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCg0KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJkb3dubG9hZFBlbmRpbmdDYXNoRGlyZWN0KCkiDQogICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJ3aWR0aDogMTAwJTsgaGVpZ2h0OiA1MHB4OyBiYWNrZ3JvdW5kOiAjRUZFQkU5OyBjb2xvcjogIzRFMzQyRTsgYm9yZGVyOiAxcHggc29saWQgIzhENkU2MzsgZm9udC13ZWlnaHQ6IGJvbGQ7IGJvcmRlci1yYWRpdXM6IDVweDsgY3Vyc29yOiBwb2ludGVyOyI+DQogICAgICAgICAgICAgICAgICAgICAgNS4gUGVuZGluZyBDYXNoIERlcG9zaXRzIChFeGNlbCkNCiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KDQogICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9ImRvd25sb2FkUGVuZGluZ0NvbnNlbnREaXJlY3QoKSINCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9IndpZHRoOiAxMDAlOyBoZWlnaHQ6IDUwcHg7IGJhY2tncm91bmQ6ICNGQkU5RTc7IGNvbG9yOiAjQkYzNjBDOyBib3JkZXI6IDFweCBzb2xpZCAjRkY1NzIyOyBmb250LXdlaWdodDogYm9sZDsgYm9yZGVyLXJhZGl1czogNXB4OyBjdXJzb3I6IHBvaW50ZXI7Ij4NCiAgICAgICAgICAgICAgICAgICAgICA2LiBQZW5kaW5nIENvbnNlbnQgTGV0dGVycyAoQ29ycHVzIEV4Y2VsKQ0KICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQoNCiAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0iZG93bmxvYWRBbm9ueW1vdXNMaXN0RGlyZWN0KCkiDQogICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJ3aWR0aDogMTAwJTsgaGVpZ2h0OiA1MHB4OyBiYWNrZ3JvdW5kOiAjRjNFNUY1OyBjb2xvcjogIzRBMTQ4QzsgYm9yZGVyOiAxcHggc29saWQgIzlDMjdCMDsgZm9udC13ZWlnaHQ6IGJvbGQ7IGJvcmRlci1yYWRpdXM6IDVweDsgY3Vyc29yOiBwb2ludGVyOyI+DQogICAgICAgICAgICAgICAgICAgICAgNy4gQW5vbnltb3VzIExpc3QgKEV4Y2VsKQ0KICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQoNCiAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0icnVuQW5vbnlNYXRjaERpcmVjdCgpIg0KICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT0id2lkdGg6IDEwMCU7IGhlaWdodDogNTBweDsgYmFja2dyb3VuZDogIzRBMTQ4QzsgY29sb3I6ICNGRkZGRkY7IGJvcmRlcjogMXB4IHNvbGlkICMzMTFCOTI7IGZvbnQtd2VpZ2h0OiBib2xkOyBib3JkZXItcmFkaXVzOiA1cHg7IGN1cnNvcjogcG9pbnRlcjsiPg0KICAgICAgICAgICAgICAgICAgICAgIDguIEFub255bW91cyBNYXRjaCBMaXN0IChUWFQpDQogICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCg0KICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJydW5CYW5rU3RhdGVtZW50RGlyZWN0KCkiDQogICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJ3aWR0aDogMTAwJTsgaGVpZ2h0OiA1MHB4OyBiYWNrZ3JvdW5kOiAjMDA2MDY0OyBjb2xvcjogI0UwRjdGQTsgYm9yZGVyOiAxcHggc29saWQgIzAwODM4RjsgZm9udC13ZWlnaHQ6IGJvbGQ7IGJvcmRlci1yYWRpdXM6IDVweDsgY3Vyc29yOiBwb2ludGVyOyI+DQogICAgICAgICAgICAgICAgICAgICAgOS4gQmFuayBTdGF0ZW1lbnQgKEV4Y2VsKQ0KICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQoNCiAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0icnVuRGV0YWlsZWRNYXRjaFJlcG9ydCgpIg0KICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT0id2lkdGg6IDEwMCU7IGhlaWdodDogNTBweDsgYmFja2dyb3VuZDogIzAxNTc5QjsgY29sb3I6ICNFMUY1RkU7IGJvcmRlcjogMXB4IHNvbGlkICMwMjc3QkQ7IGZvbnQtd2VpZ2h0OiBib2xkOyBib3JkZXItcmFkaXVzOiA1cHg7IGN1cnNvcjogcG9pbnRlcjsiPg0KICAgICAgICAgICAgICAgICAgICAgIDEwLiBEZXRhaWxlZCBCYW5rIE1hdGNoIFJlcG9ydCAoVFhUKQ0KICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQoNCiAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0icnVuRXhwZW5zZXNFeHBvcnQoKSINCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9IndpZHRoOiAxMDAlOyBoZWlnaHQ6IDUwcHg7IGJhY2tncm91bmQ6ICNCNzFDMUM7IGNvbG9yOiAjRkZFQkVFOyBib3JkZXI6IDFweCBzb2xpZCAjQzYyODI4OyBmb250LXdlaWdodDogYm9sZDsgYm9yZGVyLXJhZGl1czogNXB4OyBjdXJzb3I6IHBvaW50ZXI7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAxMS4gRXhwZW5zZXMgUmVwb3J0IChFeGNlbCkNCiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KDQoNCiAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0icnVuTW9udGhseVN0YXRlbWVudHMoKSINCiAgICAgICAgICAgICAgICAgICAgICAgICAgc3R5bGU9IndpZHRoOiAxMDAlOyBoZWlnaHQ6IDUwcHg7IGJhY2tncm91bmQ6ICNCNzFDMUM7IGNvbG9yOiAjRkZFQkVFOyBib3JkZXI6IDFweCBzb2xpZCAjQzYyODI4OyBmb250LXdlaWdodDogYm9sZDsgYm9yZGVyLXJhZGl1czogNXB4OyBjdXJzb3I6IHBvaW50ZXI7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAxMi4gTW9udGhseSBSZXBvcnQgKFBERikNCiAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPg0KDQoNCiAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0iaGlkZVV0aWxpdGllcygpIg0KICAgICAgICAgICAgICAgICAgICAgICAgICBzdHlsZT0id2lkdGg6IDEwMCU7IGhlaWdodDogNDVweDsgYmFja2dyb3VuZDogIzMzMzsgY29sb3I6IHdoaXRlOyBib3JkZXI6IG5vbmU7IG1hcmdpbi10b3A6IDE1cHg7IGJvcmRlci1yYWRpdXM6IDVweDsgY3Vyc29yOiBwb2ludGVyOyI+DQogICAgICAgICAgICAgICAgICAgICAg4oaQIEJBQ0sgVE8gREFTSEJPQVJEDQogICAgICAgICAgICAgICAgICA8L2J1dHRvbj4NCg0KICAgICAgICAgICAgICAgICAgPHAgaWQ9ImRvd25sb2FkQ2VudGVyQm90dG9tIiBzdHlsZT0iZm9udC1zaXplOiAwLjhyZW07IGNvbG9yOiAjNjY2OyBtYXJnaW4tdG9wOiAxMHB4OyI+DQogICAgICAgICAgICAgICAgICAgICAgKiBFbnN1cmUgRlkgRmlsdGVyIGlzIGFwcGxpZWQgYmVmb3JlIGRvd25sb2FkaW5nLg0KICAgICAgICAgICAgICAgICAgPC9wPg0KICAgICAgICAgICAgICA8L2Rpdj4NCiAgICAgICAgICBgOw0KICAgICAgICAgICAgICByZXN1bHRzRGl2LmlubmVySFRNTCA9IGh0bWw7DQogICAgICAgICAgICAgIHdpbmRvdy5zY3JvbGxUbyh7IHRvcDogMCwgYmVoYXZpb3I6ICdzbW9vdGgnIH0pOw0KICAgICAgICAgIH0NCg0KDQogICAgICAgICAgZnVuY3Rpb24gdG9Xb3JkcyhuKSB7DQogICAgICAgICAgICAgIGlmIChuID09IDApIHJldHVybiAnWmVybyc7DQogICAgICAgICAgICAgIGxldCBhID0gWycnLCAnT25lICcsICdUd28gJywgJ1RocmVlICcsICdGb3VyICcsICdGaXZlICcsICdTaXggJywgJ1NldmVuICcsICdFaWdodCAnLCAnTmluZSAnLCAnVGVuICcsICdFbGV2ZW4gJywgJ1R3ZWx2ZSAnLCAnVGhpcnRlZW4gJywgJ0ZvdXJ0ZWVuICcsICdGaWZ0ZWVuICcsICdTaXh0ZWVuICcsICdTZXZlbnRlZW4gJywgJ0VpZ2h0ZWVuICcsICdOaW5ldGVlbiAnXTsNCiAgICAgICAgICAgICAgbGV0IGIgPSBbJycsICcnLCAnVHdlbnR5JywgJ1RoaXJ0eScsICdGb3J0eScsICdGaWZ0eScsICdTaXh0eScsICdTZXZlbnR5JywgJ0VpZ2h0eScsICdOaW5ldHknXTsNCg0KICAgICAgICAgICAgICBsZXQgbnVtID0gKCcwMDAwMDAwMDAnICsgcGFyc2VJbnQobikpLnN1YnN0cigtOSkubWF0Y2goL14oXGR7Mn0pKFxkezJ9KShcZHsyfSkoXGR7MX0pKFxkezJ9KSQvKTsNCiAgICAgICAgICAgICAgaWYgKCFudW0pIHJldHVybiAiIjsNCg0KICAgICAgICAgICAgICBsZXQgc3RyID0gJyc7DQogICAgICAgICAgICAgIHN0ciArPSAobnVtWzFdICE9IDApID8gKGFbTnVtYmVyKG51bVsxXSldIHx8IGJbbnVtWzFdWzBdXSArICcgJyArIGFbbnVtWzFdWzFdXSkgKyAnQ3JvcmUgJyA6ICcnOw0KICAgICAgICAgICAgICBzdHIgKz0gKG51bVsyXSAhPSAwKSA/IChhW051bWJlcihudW1bMl0pXSB8fCBiW251bVsyXVswXV0gKyAnICcgKyBhW251bVsyXVsxXV0pICsgJ0xha2ggJyA6ICcnOw0KICAgICAgICAgICAgICBzdHIgKz0gKG51bVszXSAhPSAwKSA/IChhW051bWJlcihudW1bM10pXSB8fCBiW251bVszXVswXV0gKyAnICcgKyBhW251bVszXVsxXV0pICsgJ1Rob3VzYW5kICcgOiAnJzsNCiAgICAgICAgICAgICAgc3RyICs9IChudW1bNF0gIT0gMCkgPyAoYVtOdW1iZXIobnVtWzRdKV0gfHwgYltudW1bNF1bMF1dICsgJyAnICsgYVtudW1bNF1bMV1dKSArICdIdW5kcmVkICcgOiAnJzsNCiAgICAgICAgICAgICAgc3RyICs9IChudW1bNV0gIT0gMCkgPyAoKHN0ciAhPSAnJykgPyAnYW5kICcgOiAnJykgKyAoYVtOdW1iZXIobnVtWzVdKV0gfHwgYltudW1bNV1bMF1dICsgJyAnICsgYVtudW1bNV1bMV1dKSA6ICcnOw0KDQogICAgICAgICAgICAgIHJldHVybiBzdHIudHJpbSgpOw0KICAgICAgICAgIH0NCg0KDQogICAgICAgICAgYXN5bmMgZnVuY3Rpb24gc2hvd0Rvbm9yTWF0Y2hMaXN0KCkgew0KICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmdNc2cnKTsNCiAgICAgICAgICAgICAgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCiAgICAgICAgICAgICAgY29uc3QgUkVWRVJTQUxTX1VSTCA9ICJodHRwczovL2RsLmRyb3Bib3h1c2VyY29udGVudC5jb20vc2NsL2ZpL2s2Y2x2a2U3aDJxeGhnbjA3dm1iNS9SZXZlcnNhbHMudHh0P3Jsa2V5PTF5OWRucmV2ZDZtbW5zMDAzbHlkdXc5NW0mZGw9MSI7DQogICAgICAgICAgICAgIGNsZWFyV29ya3NwYWNlKCk7DQoNCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHNlbGVjdGVkRlkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdpbnB1dFtuYW1lPSJ5ZWFyRmlsdGVyIl06Y2hlY2tlZCcpLnZhbHVlOw0KICAgICAgICAgICAgICAgICAgY29uc3QgW2JhbmtSZXMsIGRhdGFSZXMsIGV4cFJlcywgcmV2UmVzLCBjYXNoUmVzXSA9IGF3YWl0IFByb21pc2UuYWxsKFsNCiAgICAgICAgICAgICAgICAgICAgICBmZXRjaChCQU5LX05FV19VUkwpLCBmZXRjaChEQVRBX1VSTCksDQogICAgICAgICAgICAgICAgICAgICAgZmV0Y2goRVhQRU5TRVNfVVJMKS50aGVuKHJlcyA9PiByZXMuYXJyYXlCdWZmZXIoKSksDQogICAgICAgICAgICAgICAgICAgICAgZmV0Y2goUkVWRVJTQUxTX1VSTCkudGhlbihyZXMgPT4gcmVzLnRleHQoKSksDQogICAgICAgICAgICAgICAgICAgICAgZmV0Y2goQ0FTSF9MSVNUX1VSTCkudGhlbihyZXMgPT4gcmVzLnRleHQoKSkNCiAgICAgICAgICAgICAgICAgIF0pOw0KDQogICAgICAgICAgICAgICAgICBjb25zdCBiYW5rTGluZXMgPSAoYXdhaXQgYmFua1Jlcy50ZXh0KCkpLnNwbGl0KCdcbicpLmZpbHRlcihsID0+IGwudHJpbSgpLnNwbGl0KCd8JykubGVuZ3RoID49IDUpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgZG9ub3JSZWNzID0gKGF3YWl0IGRhdGFSZXMudGV4dCgpKS5zcGxpdCgnXG4nKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGRiID0gZG9ub3JSZWNzLm1hcChyID0+IHIuc3BsaXQoJ3wnKSkuZmlsdGVyKGYgPT4gZi5sZW5ndGggPj0gMTUgJiYgZlsxM10/LnRvVXBwZXJDYXNlKCkgIT09ICJZRVMiKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJldmVyc2FscyA9IHJldlJlcy5zcGxpdCgnXG4nKS5tYXAobGluZSA9PiBsaW5lLnNwbGl0KCd8JykpLmZpbHRlcihmID0+IGYubGVuZ3RoID49IDcpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgY2FzaExpbmVzID0gY2FzaFJlcy5zcGxpdCgnXG4nKS5maWx0ZXIobCA9PiBsLnRyaW0oKSAhPT0gIiIpOw0KICAgICAgICAgICAgICAgICAgY29uc3Qgd29ya2Jvb2sgPSBYTFNYLnJlYWQoZXhwUmVzLCB7IHR5cGU6ICdhcnJheScgfSk7DQogICAgICAgICAgICAgICAgICBjb25zdCByb3dzID0gWExTWC51dGlscy5zaGVldF90b19qc29uKHdvcmtib29rLlNoZWV0c1t3b3JrYm9vay5TaGVldE5hbWVzWzBdXSwgeyBoZWFkZXI6IDEgfSk7DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGNyZWRpdEV4ZW1wdEtleXdvcmRzID0gWyJDUkVESVQgSU5URVJFU1QiLCAiQ0xPU1VSRSBPRiBGRCIsICJQQVJUIFdJVEhEUkFXTCIsICJGRCAiLCAiRkQ6IiwgIkJZIElOVCBUUkFOU0ZFUiIsICJIQU5ETElOR1JFViIsICJVUElNSSBDUiBBREoiLCAiTE9BTiIsICJSRVRVUk4iLCAiUkVWRVJTQUwiXTsNCg0KICAgICAgICAgICAgICAgICAgbGV0IG1haW5NYXN0ZXJIdG1sID0gIiIsIGV4ZW1wdENyZWRpdHNIdG1sID0gIiIsIGV4ZW1wdERlYml0c0h0bWwgPSAiIiwgcGVuZGluZ1Jvd3NIdG1sID0gIiI7DQogICAgICAgICAgICAgICAgICBsZXQgYmFua1N0YXRlbWVudENvdW50ID0gMDsNCiAgICAgICAgICAgICAgICAgIGxldCBtYXRjaGVkUmVjZWlwdHNTZXQgPSBuZXcgU2V0KCk7DQogICAgICAgICAgICAgICAgICBsZXQgYXVkaXRUb3dhcmRzTWFwID0ge307IGxldCBhdWRpdE1vZGVNYXAgPSB7fTsNCg0KICAgICAgICAgICAgICAgICAgbGV0IG1hdGNoZWRFeHBlbnNlSW5kaWNlcyA9IG5ldyBTZXQoKTsgLy8gVG8gdHJhY2sgd2hpY2ggRXhjZWwgcm93cyBhcmUgYWxyZWFkeSBsaW5rZWQNCg0KICAgICAgICAgICAgICAgICAgYmFua0xpbmVzLmZvckVhY2gobGluZSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgYiA9IGxpbmUuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBiRGF0ZVJhdyA9IGJbMF0udHJpbSgpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJSZWZSYXcgPSAoYlsxXSB8fCAiIikudHJpbSgpOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGJBbXQgPSBwYXJzZUZsb2F0KGJbNF0gfHwgYlszXSB8fCAwKTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBpc0NyZWRpdCA9IGJbNF0gIT09ICIiICYmIGJbNF0gIT09ICIwIiAmJiBiWzRdICE9PSAiMC4wMCIgJiYgYls0XSAhPT0gdW5kZWZpbmVkOw0KICAgICAgICAgICAgICAgICAgICAgIGlmIChzZWxlY3RlZEZZICE9PSAiYWxsIiAmJiAiMjAiICsgZ2V0RlkoYkRhdGVSYXcpLnNwbGl0KCctJylbMF0gIT09IHNlbGVjdGVkRlkpIHJldHVybjsNCiAgICAgICAgICAgICAgICAgICAgICBiYW5rU3RhdGVtZW50Q291bnQrKzsNCg0KICAgICAgICAgICAgICAgICAgICAgIGxldCByb3dTdHlsZSA9ICIiLCBkZXRhaWxDb2xIdG1sID0gIiIsIHJlY0h0bWwgPSAiIiwgaXNNYXRjaGVkID0gZmFsc2UsIG1hdGNoZWREb25vcnMgPSBbXTsNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgaXNFeGVtcHRDcmVkaXQgPSBmYWxzZSwgaXNFeGVtcHREZWJpdCA9IGZhbHNlOw0KICAgICAgICAgICAgICAgICAgICAgIGxldCBhbXRDbGFzcyA9IGlzQ3JlZGl0ID8gImFtdC1jcmVkaXQiIDogImFtdC1kZWJpdCI7DQogICAgICAgICAgICAgICAgICAgICAgbGV0IGFtdFN1YkxhYmVsID0gIiI7DQoNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoaXNDcmVkaXQpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYkRhdGVTdGQgPSBiRGF0ZVJhdy5yZXBsYWNlKC9bXC9cLl0vZywgJy0nKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmV2TWF0Y2ggPSByZXZlcnNhbHMuZmluZChyID0+IHJbMF0udHJpbSgpLnJlcGxhY2UoL1tcL1wuXS9nLCAnLScpID09PSBiRGF0ZVN0ZCAmJiByWzFdLnRyaW0oKS50b1VwcGVyQ2FzZSgpID09PSBiUmVmUmF3LnRvVXBwZXJDYXNlKCkpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmV2TWF0Y2gpIHsgaXNNYXRjaGVkID0gdHJ1ZTsgaXNFeGVtcHRDcmVkaXQgPSB0cnVlOyByb3dTdHlsZSA9ICdzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZTNmMmZkOyInOyBkZXRhaWxDb2xIdG1sID0gJzxiPlJFVkVSU0FMOjwvYj4gJyArIHJldk1hdGNoWzZdOyB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgaWYgKGNyZWRpdEV4ZW1wdEtleXdvcmRzLnNvbWUoayA9PiBiUmVmUmF3LnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoaykpKSB7IGlzTWF0Y2hlZCA9IHRydWU7IGlzRXhlbXB0Q3JlZGl0ID0gdHJ1ZTsgcm93U3R5bGUgPSAnc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I2UzZjJmZDsiJzsgZGV0YWlsQ29sSHRtbCA9ICc8Yj5CQU5LIEVYRU1QVDo8L2I+ICcgKyBiUmVmUmF3OyB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJSZWZSYXcudG9VcHBlckNhc2UoKS5pbmNsdWRlcygiQ0FTSCBERVBPU0lUIikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2xNYXRjaCA9IGNhc2hMaW5lcy5maW5kKGNsID0+IHsgY29uc3QgcGFydHMgPSBjbC5zcGxpdCgnfCcpWzBdLnRyaW0oKS5zcGxpdCgnICcpOyByZXR1cm4gcGFydHNbMF0ucmVwbGFjZSgvW1wvXC5dL2csICctJykgPT09IGJEYXRlU3RkICYmIE1hdGguYWJzKHBhcnNlRmxvYXQocGFydHNbMV0pIC0gYkFtdCkgPCAwLjAxOyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2xNYXRjaCkgeyBpc01hdGNoZWQgPSB0cnVlOyBjb25zdCBwID0gY2xNYXRjaC5zcGxpdCgnfCcpOyBjb25zdCBwcmVmaXggPSBwWzFdLnRyaW0oKSA9PT0gJ00nID8gIk1QUyIgOiAiQ0ciOyBjb25zdCByTGlzdCA9IHBbMl0uc3BsaXQoJywnKS5tYXAociA9PiBwcmVmaXggKyByLnRyaW0oKS5wYWRTdGFydChwWzFdLnRyaW0oKSA9PT0gJ00nID8gNyA6IDYsICcwJykpOyBtYXRjaGVkRG9ub3JzID0gZGIuZmlsdGVyKGQgPT4gckxpc3QuaW5jbHVkZXMoZFswXS50cmltKCkpKTsgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UgeyBtYXRjaGVkRG9ub3JzID0gZGIuZmlsdGVyKGQgPT4gZFsxXS50cmltKCkucmVwbGFjZSgvW1wvXC5dL2csICctJykgPT09IGJEYXRlU3RkICYmIE1hdGguYWJzKHBhcnNlRmxvYXQoZFs5XSkgLSBiQW10KSA8IDAuMDEgJiYgZFsxMV0udG9VcHBlckNhc2UoKSA9PT0gIkNBU0giKTsgaWYgKG1hdGNoZWREb25vcnMubGVuZ3RoID4gMCkgaXNNYXRjaGVkID0gdHJ1ZTsgfQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVkRG9ub3JzID0gZGIuZmlsdGVyKGQgPT4geyBsZXQgZFJlZiA9IChkWzEwXSB8fCAiIikudHJpbSgpLnRvVXBwZXJDYXNlKCkuc3BsaXQoJygnKVswXS5zcGxpdCgnWycpWzBdLnRyaW0oKTsgcmV0dXJuIGRbMV0udHJpbSgpLnJlcGxhY2UoL1tcL1wuXS9nLCAnLScpID09PSBiRGF0ZVN0ZCAmJiBkUmVmICE9PSAiIiAmJiBiUmVmUmF3LnRvVXBwZXJDYXNlKCkuaW5jbHVkZXMoZFJlZik7IH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtYXRjaGVkRG9ub3JzLmxlbmd0aCA+IDApIGlzTWF0Y2hlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFVzZSBmaW5kSW5kZXggc28gd2Uga25vdyBleGFjdGx5IHdoaWNoIHJvdyB3ZSBhcmUgcGlja2luZw0KICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgZXhwTWF0Y2hJZHggPSByb3dzLmZpbmRJbmRleCgociwgaSkgPT4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGkgPiAwICYmDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhbWF0Y2hlZEV4cGVuc2VJbmRpY2VzLmhhcyhpKSAmJiAvLyBPTkxZIHBpY2sgYSByb3cgbm90IGFscmVhZHkgbWF0Y2hlZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgclszXSAmJg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgTWF0aC5hYnMocGFyc2VGbG9hdChyWzNdKSAtIGJBbXQpIDwgMC4wMQ0KICAgICAgICAgICAgICAgICAgICAgICAgICApOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleHBNYXRjaElkeCAhPT0gLTEpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBleHBNYXRjaCA9IHJvd3NbZXhwTWF0Y2hJZHhdOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZEV4cGVuc2VJbmRpY2VzLmFkZChleHBNYXRjaElkeCk7IC8vIE1hcmsgdGhpcyByb3cgYXMgInVzZWQiDQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzTWF0Y2hlZCA9IHRydWU7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbXRTdWJMYWJlbCA9ICc8ZGl2IHN0eWxlPSJmb250LXNpemU6MC42NXJlbTsgY29sb3I6aW5oZXJpdDsgZm9udC13ZWlnaHQ6Ym9sZDsiPkV4cGVuc2U8L2Rpdj4nOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBleHBOb3RlID0gKGV4cE1hdGNoWzRdIHx8ICIiKS50b1N0cmluZygpLnRvVXBwZXJDYXNlKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChleHBOb3RlLmluY2x1ZGVzKCJFWEVNUFQiKSB8fCBleHBOb3RlLmluY2x1ZGVzKCJGUkVTSCBERVBPU0lUIikpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0V4ZW1wdERlYml0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dTdHlsZSA9ICdzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogI2I3MWMxYzsgY29sb3I6ICNmZmZmZmYgIWltcG9ydGFudDsiJzsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm93U3R5bGUgPSAnc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmY2U0ZWM7Iic7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXRhaWxDb2xIdG1sID0gJzxiPicgKyAoZXhwTWF0Y2hbNF0gfHwgYlJlZlJhdykgKyAnPC9iPic7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0NCg0KDQogICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgbGV0IGZpbmFsQW10U3R5bGUgPSBpc0V4ZW1wdERlYml0ID8gJ3N0eWxlPSJjb2xvcjojZmZmZmZmICFpbXBvcnRhbnQ7IGZvbnQtd2VpZ2h0OmJvbGQ7IicgOiAnJzsNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgYW10Q29sSHRtbCA9IGDigrkke2JBbXQudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9JHthbXRTdWJMYWJlbH1gOw0KDQogICAgICAgICAgICAgICAgICAgICAgaWYgKGlzQ3JlZGl0ICYmIGlzTWF0Y2hlZCAmJiBtYXRjaGVkRG9ub3JzLmxlbmd0aCA+IDApIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gSU1QTEVNRU5URUQ6IENsaWNrYWJsZSBSZWNlaXB0IExpbmtzIGZvciBNYXRjaGVkIERvbm9ycw0KICAgICAgICAgICAgICAgICAgICAgICAgICByZWNIdG1sID0gYDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjdyZW07IG1hcmdpbi10b3A6M3B4OyI+JHttYXRjaGVkRG9ub3JzLm1hcChtID0+IGA8c3BhbiBjbGFzcz0icmNwdC1saW5rIiBvbmNsaWNrPSJqdW1wVG9SZWNlaXB0KCcke21bMF0udHJpbSgpfScpIj4ke21bMF0udHJpbSgpfTwvc3Bhbj5gKS5qb2luKCc8YnI+Jyl9PC9kaXY+YDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGNoZWREb25vcnMubGVuZ3RoID09PSAxKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3dTdHlsZSA9ICdzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmZmZGU3OyInOyBjb25zdCBtID0gbWF0Y2hlZERvbm9yc1swXTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFtdENvbEh0bWwgPSBg4oK5JHtiQW10LnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfTxicj48c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuNjVyZW07IGNvbG9yOiM1NTU7Ij5Ub3dhcmRzOiAke21bMTJdfTwvc3Bhbj48YnI+PHNwYW4gc3R5bGU9ImZvbnQtc2l6ZTowLjY1cmVtOyBjb2xvcjojNTU1OyI+TW9kZTogJHttWzExXX08L3NwYW4+YDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbENvbEh0bWwgPSBgPGI+JHttWzJdfTwvYj4gfCAke21bMTldfSB8ICR7bVsxNV19PGJyPlBBTjogJHttWzZdfTxicj5Scy4ke3BhcnNlRmxvYXQobVs5XSkudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9IDogVG93YXJkcyA6ICR7bVsxMl19YDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJvd1N0eWxlID0gJ3N0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiNmZmYxNzY7Iic7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhbXRDb2xIdG1sID0gYDxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjdyZW07IGZvbnQtd2VpZ2h0OmJvbGQ7IGNvbG9yOiMzMzM7Ij5NdWx0aXBsZSBEb25vcnM8L2Rpdj48c3BhbiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmY5ODAwOyBjb2xvcjp3aGl0ZTsgcGFkZGluZzoycHggNHB4OyBib3JkZXItcmFkaXVzOjNweDsgZGlzcGxheTppbmxpbmUtYmxvY2s7IGZvbnQtd2VpZ2h0OmJvbGQ7Ij7igrkke2JBbXQudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC9zcGFuPjxkaXYgc3R5bGU9ImZvbnQtc2l6ZTowLjY1cmVtOyBtYXJnaW4tdG9wOjJweDsgY29sb3I6IzU1NTsiPk1vZGU6ICR7bWF0Y2hlZERvbm9yc1swXVsxMV19PC9kaXY+YDsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRldGFpbENvbEh0bWwgPSBgPGRpdiBzdHlsZT0iZm9udC13ZWlnaHQ6Ym9sZDsgdGV4dC1kZWNvcmF0aW9uOnVuZGVybGluZTsgY29sb3I6IzBkNDdhMTsgbWFyZ2luLWJvdHRvbTo1cHg7Ij5Eb25vciBEZXRhaWxzPC9kaXY+YCArIG1hdGNoZWREb25vcnMubWFwKG0gPT4gYDxiPiR7bVsyXX08L2I+IHwgJHttWzE5XX0gfCAke21bMTVdfTxicj5QQU46ICR7bVs2XX08YnI+UnMuJHtwYXJzZUZsb2F0KG1bOV0pLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpfSA6IFRvd2FyZHMgOiAke21bMTJdfWApLmpvaW4oJzxociBzdHlsZT0iYm9yZGVyOm5vbmU7IGJvcmRlci10b3A6MXB4IHNvbGlkICNjY2M7IG1hcmdpbjo4cHggMDsiPicpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZWREb25vcnMuZm9yRWFjaChtID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbCA9IHBhcnNlRmxvYXQobVs5XSkgfHwgMDsgbWF0Y2hlZFJlY2VpcHRzU2V0LmFkZChtWzBdLnRyaW0oKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWF1ZGl0VG93YXJkc01hcFttWzEyXV0pIGF1ZGl0VG93YXJkc01hcFttWzEyXV0gPSB7IGFtdDogMCwgclNldDogbmV3IFNldCgpIH07IGF1ZGl0VG93YXJkc01hcFttWzEyXV0uYW10ICs9IHZhbDsgYXVkaXRUb3dhcmRzTWFwW21bMTJdXS5yU2V0LmFkZChtWzBdLnRyaW0oKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIWF1ZGl0TW9kZU1hcFttWzExXV0pIGF1ZGl0TW9kZU1hcFttWzExXV0gPSB7IGFtdDogMCwgclNldDogbmV3IFNldCgpIH07IGF1ZGl0TW9kZU1hcFttWzExXV0uYW10ICs9IHZhbDsgYXVkaXRNb2RlTWFwW21bMTFdXS5yU2V0LmFkZChtWzBdLnRyaW0oKSk7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0pOw0KICAgICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWlzTWF0Y2hlZCkgeyByb3dTdHlsZSA9IGlzQ3JlZGl0ID8gJ3N0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiB3aGl0ZTsiJyA6ICdzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogI2U4ZjVlOTsiJzsgZGV0YWlsQ29sSHRtbCA9IGA8aSBzdHlsZT0iY29sb3I6IzY2NjsiPkJhbmsgUmVmOiAke2JSZWZSYXd9PC9pPmA7IH0NCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCByb3dTdHIgPSBgPHRyICR7aXNFeGVtcHREZWJpdCA/ICdzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojYjcxYzFjOyBjb2xvcjojZmZmZmZmICFpbXBvcnRhbnQ7IicgOiByb3dTdHlsZX0+PHRkIHN0eWxlPSJ3aWR0aDoxMCUiPjxiPiR7YkRhdGVSYXd9PC9iPiR7cmVjSHRtbH08L3RkPjx0ZCBzdHlsZT0id2lkdGg6MTAlIiBjbGFzcz0iJHtpc0V4ZW1wdERlYml0ID8gJycgOiBhbXRDbGFzc30iICR7ZmluYWxBbXRTdHlsZX0+JHthbXRDb2xIdG1sfTwvdGQ+PHRkIHN0eWxlPSJ3aWR0aDo4MCUiPiR7ZGV0YWlsQ29sSHRtbH08L3RkPjwvdHI+YDsNCiAgICAgICAgICAgICAgICAgICAgICBtYWluTWFzdGVySHRtbCArPSByb3dTdHI7IGlmIChpc0V4ZW1wdENyZWRpdCkgZXhlbXB0Q3JlZGl0c0h0bWwgKz0gcm93U3RyOyBpZiAoaXNFeGVtcHREZWJpdCkgZXhlbXB0RGViaXRzSHRtbCArPSByb3dTdHI7IGlmICghaXNNYXRjaGVkKSBwZW5kaW5nUm93c0h0bWwgKz0gcm93U3RyOw0KICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgIGxldCB1bm1hdGNoZWRIdG1sID0gIiIsIHVubWF0Y2hlZFRvdGFsQW10ID0gMCwgdW5tYXRjaGVkQ291bnQgPSAwOw0KICAgICAgICAgICAgICAgICAgZGIuZmlsdGVyKG0gPT4geyBjb25zdCBtRlkgPSAiMjAiICsgZ2V0RlkobVsxXS50cmltKCkpLnNwbGl0KCctJylbMF07IHJldHVybiAhbWF0Y2hlZFJlY2VpcHRzU2V0LmhhcyhtWzBdLnRyaW0oKSkgJiYgKHNlbGVjdGVkRlkgPT09ICJhbGwiIHx8IG1GWSA9PT0gc2VsZWN0ZWRGWSk7IH0pDQogICAgICAgICAgICAgICAgICAgICAgLmZvckVhY2gobSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRBbXQgPSBwYXJzZUZsb2F0KG1bOV0gfHwgMCk7IHVubWF0Y2hlZFRvdGFsQW10ICs9IGRBbXQ7IHVubWF0Y2hlZENvdW50Kys7DQogICAgICAgICAgICAgICAgICAgICAgICAgIC8vIElNUExFTUVOVEVEOiBDbGlja2FibGUgUmVjZWlwdCBMaW5rcyBmb3IgVW5tYXRjaGVkIFRhYmxlDQogICAgICAgICAgICAgICAgICAgICAgICAgIHVubWF0Y2hlZEh0bWwgKz0gYDx0ciBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojZmFmYWZhOyI+PHRkIHN0eWxlPSJ3aWR0aDoxMCUiPjxiPiR7bVsxXX08L2I+PGJyPjxkaXYgY2xhc3M9InJjcHQtbGluayIgc3R5bGU9ImZvbnQtc2l6ZTowLjdyZW07IiBvbmNsaWNrPSJqdW1wVG9SZWNlaXB0KCcke21bMF0udHJpbSgpfScpIj4ke21bMF0udHJpbSgpfTwvZGl2PjwvdGQ+PHRkIHN0eWxlPSJ3aWR0aDoxMCUiIGNsYXNzPSJhbXQtY3JlZGl0Ij7igrkke2RBbXQudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PGJyPjxzcGFuIHN0eWxlPSJmb250LXNpemU6MC42NXJlbTsgY29sb3I6IzU1NTsiPlRvd2FyZHM6ICR7bVsxMl19PC9zcGFuPjxicj48c3BhbiBzdHlsZT0iZm9udC1zaXplOjAuNjVyZW07IGNvbG9yOiM1NTU7Ij5Nb2RlOiAke21bMTFdfTwvc3Bhbj48L3RkPjx0ZCBzdHlsZT0id2lkdGg6ODAlIj48Yj4ke21bMl19PC9iPiB8ICR7bVsxOV19IHwgJHttWzE1XX08YnI+UEFOOiAke21bNl19PGJyPlJzLiR7ZEFtdC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX0gOiBUb3dhcmRzIDogJHttWzEyXX08L3RkPjwvdHI+YDsNCiAgICAgICAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICAgIHVubWF0Y2hlZEh0bWwgKz0gYDx0ciBzdHlsZT0iYmFja2dyb3VuZDojNDQ0OyBjb2xvcjp3aGl0ZTsgZm9udC13ZWlnaHQ6Ym9sZDsiPjx0ZCBzdHlsZT0id2lkdGg6MTAlIj5UT1RBTDwvdGQ+PHRkIHN0eWxlPSJ3aWR0aDoxMCUiPuKCuSR7dW5tYXRjaGVkVG90YWxBbXQudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyl9PC90ZD48dGQgc3R5bGU9IndpZHRoOjgwJSI+Q291bnQ6ICR7dW5tYXRjaGVkQ291bnR9IFJlY2VpcHRzIE5vdCBGb3VuZCBpbiBCYW5rIFN0YXRlbWVudHM8L3RkPjwvdHI+YDsNCg0KICAgICAgICAgICAgICAgICAgbGV0IGF1ZGl0VG90YWxBbXQgPSAwOyBPYmplY3QudmFsdWVzKGF1ZGl0VG93YXJkc01hcCkuZm9yRWFjaCh2ID0+IGF1ZGl0VG90YWxBbXQgKz0gdi5hbXQpOw0KICAgICAgICAgICAgICAgICAgbGV0IGF1ZGl0Um93cyA9IGA8dHI+PHRkIHN0eWxlPSJ3aWR0aDoxMCUiPjxiPlRPVEFMPC9iPjwvdGQ+PHRkIHN0eWxlPSJ3aWR0aDoxMCU7IHRleHQtYWxpZ246Y2VudGVyOyI+PGI+JHttYXRjaGVkUmVjZWlwdHNTZXQuc2l6ZX08L2I+PC90ZD48dGQgc3R5bGU9IndpZHRoOjgwJTsgdGV4dC1hbGlnbjpyaWdodDsiPjxiPuKCuSR7YXVkaXRUb3RhbEFtdC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L2I+PC90ZD48L3RyPmA7DQogICAgICAgICAgICAgICAgICBPYmplY3Qua2V5cyhhdWRpdFRvd2FyZHNNYXApLnNvcnQoKS5mb3JFYWNoKHR3ID0+IHsgYXVkaXRSb3dzICs9IGA8dHI+PHRkPlRvd2FyZHMgJHt0d308L3RkPjx0ZCBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7Ij4ke2F1ZGl0VG93YXJkc01hcFt0d10uclNldC5zaXplfTwvdGQ+PHRkIHN0eWxlPSJ0ZXh0LWFsaWduOnJpZ2h0OyI+4oK5JHthdWRpdFRvd2FyZHNNYXBbdHddLmFtdC50b0xvY2FsZVN0cmluZygnZW4tSU4nKX08L3RkPjwvdHI+YDsgfSk7DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHRhYmxlSGVhZGVyID0gJzx0aGVhZD48dHI+PHRoIHN0eWxlPSJ3aWR0aDoxMCUiPkRhdGU8L3RoPjx0aCBzdHlsZT0id2lkdGg6MTAlIj5BbW91bnQ8L3RoPjx0aCBzdHlsZT0id2lkdGg6ODAlIj5Eb25vciAvIFJlY29yZCBEZXRhaWxzPC90aD48L3RyPjwvdGhlYWQ+JzsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGF1ZGl0SGVhZGVyID0gJzx0aGVhZCBzdHlsZT0iYmFja2dyb3VuZDojMGQ0N2ExOyBjb2xvcjp3aGl0ZTsiPjx0cj48dGggc3R5bGU9IndpZHRoOjEwJSI+SXRlbTwvdGg+PHRoIHN0eWxlPSJ3aWR0aDoxMCUiPkRvbm9yczwvdGg+PHRoIHN0eWxlPSJ3aWR0aDo4MCUiPkFtb3VudDwvdGg+PC90cj48L3RoZWFkPic7DQoNCiAgICAgICAgICAgICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkZXRhaWxlZFJlc3VsdHMnKS5pbm5lckhUTUwgPSBgDQogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6ZmxleDsganVzdGlmeS1jb250ZW50OmNlbnRlcjsgZ2FwOjEwcHg7IG1hcmdpbi1ib3R0b206MjBweDsgZm9udC1zaXplOjAuNzVyZW07Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJiYWNrZ3JvdW5kOiNmZmZkZTc7IHBhZGRpbmc6NHB4IDhweDsgYm9yZGVyOjFweCBzb2xpZCAjZGRkOyI+U2luZ2xlIE1hdGNoPC9zcGFuPg0KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gc3R5bGU9ImJhY2tncm91bmQ6I2ZmZjE3NjsgcGFkZGluZzo0cHggOHB4OyBib3JkZXI6MXB4IHNvbGlkICNkZGQ7Ij5NdWx0aS1Eb25vcjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJiYWNrZ3JvdW5kOiNlM2YyZmQ7IHBhZGRpbmc6NHB4IDhweDsgYm9yZGVyOjFweCBzb2xpZCAjZGRkOyI+RXhlbXB0L1Jldjwvc3Bhbj4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIHN0eWxlPSJiYWNrZ3JvdW5kOiNiNzFjMWM7IGNvbG9yOndoaXRlOyBwYWRkaW5nOjRweCA4cHg7Ij5FeGVtcHQgRGViaXQ8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBzdHlsZT0iYmFja2dyb3VuZDojZThmNWU5OyBwYWRkaW5nOjRweCA4cHg7IGJvcmRlcjoxcHggc29saWQgI2RkZDsiPkV4cGVuc2U8L3NwYW4+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9ImJhbmstdGl0bGUiPk1hc3RlciBNYXRjaDwvaDI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRhYmxlLXdyYXAiPjx0YWJsZSBjbGFzcz0ibWF0Y2hUYWJsZSI+JHt0YWJsZUhlYWRlcn08dGJvZHk+JHttYWluTWFzdGVySHRtbH08L3Rib2R5PjwvdGFibGU+PC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyOyBwYWRkaW5nOjEwcHg7IGJhY2tncm91bmQ6I2VlZTsgZm9udC13ZWlnaHQ6Ym9sZDsgbWFyZ2luOjEwcHggMDsiPltUb3RhbCAzNjMxIHJlY29yZHMgfCBQcm9jZXNzZWQgJHtiYW5rU3RhdGVtZW50Q291bnR9IGJhbmsgcm93c108L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJiYW5rLXRpdGxlIiBzdHlsZT0iY29sb3I6IzE1NjVjMDsiPkV4ZW1wdGVkIENyZWRpdHM8L2gyPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWJsZS13cmFwIj48dGFibGUgY2xhc3M9Im1hdGNoVGFibGUiPiR7dGFibGVIZWFkZXJ9PHRib2R5PiR7ZXhlbXB0Q3JlZGl0c0h0bWx9PC90Ym9keT48L3RhYmxlPjwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9ImJhbmstdGl0bGUiIHN0eWxlPSJjb2xvcjojYjcxYzFjOyI+RXhlbXB0ZWQgRGViaXRzPC9oMj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGFibGUtd3JhcCI+PHRhYmxlIGNsYXNzPSJtYXRjaFRhYmxlIj4ke3RhYmxlSGVhZGVyfTx0Ym9keT4ke2V4ZW1wdERlYml0c0h0bWx9PC90Ym9keT48L3RhYmxlPjwvZGl2Pg0KICAgICAgICAgICAgICAgICAgICA8aDIgY2xhc3M9ImJhbmstdGl0bGUiIHN0eWxlPSJjb2xvcjojMWI1ZTIwOyI+UGVuZGluZyBFbnRyaWVzPC9oMj4NCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGFibGUtd3JhcCI+PHRhYmxlIGNsYXNzPSJtYXRjaFRhYmxlIj4ke3RhYmxlSGVhZGVyfTx0Ym9keT4ke3BlbmRpbmdSb3dzSHRtbH08L3Rib2R5PjwvdGFibGU+PC9kaXY+DQogICAgICAgICAgICAgICAgICAgIDxoMiBjbGFzcz0iYmFuay10aXRsZSI+RmluYWwgQXVkaXQ8L2gyPg0KICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0YWJsZS13cmFwIj48dGFibGUgY2xhc3M9Im1hdGNoVGFibGUiPiR7YXVkaXRIZWFkZXJ9PHRib2R5PiR7YXVkaXRSb3dzfTwvdGJvZHk+PC90YWJsZT48L2Rpdj4NCiAgICAgICAgICAgICAgICAgICAgPGgyIGNsYXNzPSJiYW5rLXRpdGxlIiBzdHlsZT0iY29sb3I6I2U2NTEwMDsiPlJlY2VpcHRzIG5vdCBNYXRjaGVkIGluIEJhbmsgU3RhdGVtZW50czwvaDI+DQogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRhYmxlLXdyYXAiPjx0YWJsZSBjbGFzcz0ibWF0Y2hUYWJsZSI+JHt0YWJsZUhlYWRlcn08dGJvZHk+JHt1bm1hdGNoZWRIdG1sfTwvdGJvZHk+PC90YWJsZT48L2Rpdj5gOw0KDQoNCg0KICAgICAgICAgICAgICAgICAgLy8gLS0tIEFEREVEOiBET1dOTE9BRCBCVVRUT04gSU5KRUNUSU9OIC0tLQ0KICAgICAgICAgICAgICAgICAgY29uc3QgZG93bmxvYWRCdG5IdG1sID0gYA0KICAgICAgICAgICAgICAgICAgICA8ZGl2IHN0eWxlPSJ0ZXh0LWFsaWduOmNlbnRlcjsgbWFyZ2luOiA0MHB4IDA7Ij4NCiAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImJ0bkRvd25sb2FkTWF0Y2giIGNsYXNzPSJuYXYtc2Nyb2xsLWJ0biIgDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPSJwb3NpdGlvbjpzdGF0aWM7IHdpZHRoOmF1dG87IGhlaWdodDphdXRvOyBwYWRkaW5nOjEycHggMjRweDsgYm9yZGVyLXJhZGl1czo4cHg7IGJhY2tncm91bmQ6IzFiNWUyMDsgZm9udC1zaXplOjFyZW07Ig0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbmNsaWNrPSJkb3dubG9hZE1hdGNoTGlzdCgpIj4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEb3dubG9hZCBCYW5rLURvbm9yLUV4cGVuc2UtTWF0Y2ggTGlzdA0KICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAgIDwvZGl2PmA7DQogICAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZGV0YWlsZWRSZXN1bHRzJykuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBkb3dubG9hZEJ0bkh0bWwpOw0KDQogICAgICAgICAgICAgICAgICAvLyAtLS0gVEhFIERPV05MT0FEIEhBTkRMRVIgLS0tDQogICAgICAgICAgICAgICAgICB3aW5kb3cuZG93bmxvYWRNYXRjaExpc3QgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2VsZWN0ZWRGWSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2lucHV0W25hbWU9InllYXJGaWx0ZXIiXTpjaGVja2VkJykudmFsdWU7DQogICAgICAgICAgICAgICAgICAgICAgY29uc3Qgcm93cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5tYXRjaFRhYmxlOmZpcnN0LW9mLXR5cGUgdHInKTsNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgY29udGVudCA9IGBCQU5LLURPTk9SLUVYUEVOU0UtTUFUQ0ggTElTVCB8IEZZOiAke3NlbGVjdGVkRll9XG5gOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgKz0gYEdlbmVyYXRlZCBvbjogJHtuZXcgRGF0ZSgpLnRvTG9jYWxlU3RyaW5nKCl9XG5gOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQgKz0gYD0iYC5yZXBlYXQoNTApICsgYFxuXG5gOw0KDQogICAgICAgICAgICAgICAgICAgICAgcm93cy5mb3JFYWNoKChyb3csIGluZGV4KSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbHMgPSByb3cucXVlcnlTZWxlY3RvckFsbCgndGgsIHRkJyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCArPSBgREFURWAucGFkRW5kKDE1KSArIGAgfCBgICsgYEFNT1VOVGAucGFkRW5kKDIwKSArIGAgfCBgICsgYERFVEFJTFNcbmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ICs9IGAtYC5yZXBlYXQoMTAwKSArIGBcbmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBkYXRlID0gY29sc1swXS5pbm5lclRleHQucmVwbGFjZSgvXG4vZywgJyAnKS50cmltKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBhbXQgPSBjb2xzWzFdLmlubmVyVGV4dC5yZXBsYWNlKC9cbi9nLCAnICcpLnRyaW0oKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGRldGFpbHMgPSBjb2xzWzJdLmlubmVyVGV4dC5yZXBsYWNlKC9cbi9nLCAnIHwgJykudHJpbSgpOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZW50ICs9IGRhdGUucGFkRW5kKDE1KSArIGAgfCBgICsgYW10LnBhZEVuZCgyMCkgKyBgIHwgYCArIGRldGFpbHMgKyBgXG5gOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29udGVudCArPSBgLWAucmVwZWF0KDEwMCkgKyBgXG5gOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW2NvbnRlbnRdLCB7IHR5cGU6ICd0ZXh0L3BsYWluJyB9KTsNCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOw0KICAgICAgICAgICAgICAgICAgICAgIGxpbmsuaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7DQogICAgICAgICAgICAgICAgICAgICAgbGluay5kb3dubG9hZCA9IGBCYW5rLURvbm9yLUV4cGVuc2UtTWF0Y2ggTGlzdF8ke3NlbGVjdGVkRll9LnR4dGA7DQogICAgICAgICAgICAgICAgICAgICAgbGluay5jbGljaygpOw0KICAgICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgICAgLy8gLS0tIEZPUkNFRCBOQVZJR0FUSU9OIEJVVFRPTlMgSU5KRUNUSU9OIChSZW1haW4gYXQgYm90dG9tKSAtLS0NCg0KDQogICAgICAgICAgICAgICAgICAvL2NvbnN0IG5hdkh0bWwgPSBgPGJ1dHRvbiBpZD0iZlVwIiBzdHlsZT0icG9zaXRpb246Zml4ZWQ7IGJvdHRvbTo4MHB4OyByaWdodDoyMHB4OyB6LWluZGV4Ojk5OTk5OyB3aWR0aDo0NXB4OyBoZWlnaHQ6NDVweDsgYm9yZGVyLXJhZGl1czo1MCU7IGJhY2tncm91bmQ6IzMzMzsgY29sb3I6I2ZmZjsgYm9yZGVyOm5vbmU7IGN1cnNvcjpwb2ludGVyOyBmb250LXNpemU6MjBweDsgYm94LXNoYWRvdzowIDJweCA1cHggcmdiYSgwLDAsMCwwLjMpOyIgb25jbGljaz0id2luZG93LnNjcm9sbFRvKHt0b3A6MCwgYmVoYXZpb3I6J3Ntb290aCd9KSI+4oaRPC9idXR0b24+DQogICAgICAgICAgICAgICAgICAvLyAgICAgICAgICAgICAgIDxidXR0b24gaWQ9ImZEb3duIiBzdHlsZT0icG9zaXRpb246Zml4ZWQ7IGJvdHRvbToyMHB4OyByaWdodDoyMHB4OyB6LWluZGV4Ojk5OTk5OyB3aWR0aDo0NXB4OyBoZWlnaHQ6NDVweDsgYm9yZGVyLXJhZGl1czo1MCU7IGJhY2tncm91bmQ6IzMzMzsgY29sb3I6I2ZmZjsgYm9yZGVyOm5vbmU7IGN1cnNvcjpwb2ludGVyOyBmb250LXNpemU6MjBweDsgYm94LXNoYWRvdzowIDJweCA1cHggcmdiYSgwLDAsMCwwLjMpOyIgb25jbGljaz0id2luZG93LnNjcm9sbFRvKHt0b3A6ZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQsIGJlaGF2aW9yOidzbW9vdGgnfSkiPuKGkzwvYnV0dG9uPmA7DQogICAgICAgICAgICAgICAgICAvL2RvY3VtZW50LmJvZHkuaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVlbmQnLCBuYXZIdG1sKTsNCg0KICAgICAgICAgICAgICB9IGNhdGNoIChlKSB7IGNvbnNvbGUuZXJyb3IoZSk7IGFsZXJ0KCJFcnJvcjogIiArIGUubWVzc2FnZSk7IH0gZmluYWxseSB7IGxvYWRpbmcuc3R5bGUuZGlzcGxheSA9ICdub25lJzsgfQ0KICAgICAgICAgIH0NCg0KDQoNCiAgICAgIDwvc2NyaXB0Pg0KDQogICAgICA8YnV0dG9uIGlkPSJidG5Hb0JvdHRvbSINCiAgICAgICAgICAgICAgY2xhc3M9Im5hdi1zY3JvbGwtYnRuIg0KICAgICAgICAgICAgICBvbmNsaWNrPSJ3aW5kb3cuc2Nyb2xsVG8oe3RvcDogZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQsIGJlaGF2aW9yOiAnc21vb3RoJ30pIg0KICAgICAgICAgICAgICB0aXRsZT0iR28gdG8gQm90dG9tIj4NCiAgICAgICAgICDihpMNCiAgICAgIDwvYnV0dG9uPg0KICAgICAgPGJ1dHRvbiBpZD0iYnRuR29Ub3AiDQogICAgICAgICAgICAgIGNsYXNzPSJuYXYtc2Nyb2xsLWJ0biINCiAgICAgICAgICAgICAgb25jbGljaz0id2luZG93LnNjcm9sbFRvKHt0b3A6IDAsIGJlaGF2aW9yOiAnc21vb3RoJ30pIg0KICAgICAgICAgICAgICB0aXRsZT0iR28gdG8gVG9wIj4NCiAgICAgICAgICDihpENCiAgICAgIDwvYnV0dG9uPg0KDQogICAgICA8c2NyaXB0Pg0KDQoNCiAgICAgICAgICBhc3luYyBmdW5jdGlvbiBydW5Nb250aGx5U3RhdGVtZW50cygpIHsNCiAgICAgICAgICAgICAgdHJ5IHsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHJhZGlvID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignaW5wdXRbbmFtZT0ieWVhckZpbHRlciJdOmNoZWNrZWQnKTsNCiAgICAgICAgICAgICAgICAgIGlmICghcmFkaW8gfHwgcmFkaW8udmFsdWUgPT09ICJhbGwiKSB7DQogICAgICAgICAgICAgICAgICAgICAgYWxlcnQoIlBsZWFzZSBzZWxlY3QgYSBzcGVjaWZpYyBGaW5hbmNpYWwgWWVhciBmaXJzdC4iKTsNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm47DQogICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgIGNvbnN0IHN0YXJ0WWVhciA9IHBhcnNlSW50KHJhZGlvLnZhbHVlKTsNCiAgICAgICAgICAgICAgICAgIGNvbnN0IGZ5TGFiZWwgPSBgJHtzdGFydFllYXJ9LSR7KHN0YXJ0WWVhciArIDEpLnRvU3RyaW5nKCkuc2xpY2UoLTIpfWA7DQoNCiAgICAgICAgICAgICAgICAgIC8vIFNob3cgbG9hZGluZyBvdmVybGF5DQogICAgICAgICAgICAgICAgICBjb25zdCBsb2FkaW5nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2xvYWRpbmcnKSB8fCB7IHN0eWxlOiB7fSB9Ow0KICAgICAgICAgICAgICAgICAgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsNCg0KICAgICAgICAgICAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goREFUQV9VUkwpOw0KICAgICAgICAgICAgICAgICAgY29uc3QgdGV4dCA9IGF3YWl0IHJlcy50ZXh0KCk7DQogICAgICAgICAgICAgICAgICBjb25zdCBhbGxSZWNvcmRzID0gdGV4dC5zcGxpdCgnXG4nKS5maWx0ZXIociA9PiByLmxlbmd0aCA+IDIwKTsNCg0KICAgICAgICAgICAgICAgICAgY29uc3QgeyBqc1BERiB9ID0gd2luZG93LmpzcGRmOw0KICAgICAgICAgICAgICAgICAgY29uc3QgZG9jID0gbmV3IGpzUERGKCk7DQoNCiAgICAgICAgICAgICAgICAgIGxldCBvdGhlck1vZGVSZWNlaXB0cyA9IFtdOw0KDQogICAgICAgICAgICAgICAgICBjb25zdCBpbnRlcm5hbFBhcnNlRGF0ZSA9IChzdHIpID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICBpZiAoIXN0cikgcmV0dXJuIG5ldyBEYXRlKDApOw0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHAgPSBzdHIuc3BsaXQoL1stL10vKTsNCiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUocFsyXSwgcFsxXSAtIDEsIHBbMF0pOw0KICAgICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgICAgY29uc3QgYXBwbHlQYWdlU3R5bGUgPSAoKSA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgZG9jLnNldEZpbGxDb2xvcigyNTUsIDI0NCwgMjI5KTsgLy8gTGlnaHQgU2FmZnJvbg0KICAgICAgICAgICAgICAgICAgICAgIGRvYy5yZWN0KDAsIDAsIDIxMCwgMjk3LCAnRicpOw0KICAgICAgICAgICAgICAgICAgfTsNCg0KICAgICAgICAgICAgICAgICAgY29uc3QgbW9udGhzID0gWw0KICAgICAgICAgICAgICAgICAgICAgIHsgbTogNCwgeTogc3RhcnRZZWFyLCBuYW1lOiAiQXByaWwiIH0sIHsgbTogNSwgeTogc3RhcnRZZWFyLCBuYW1lOiAiTWF5IiB9LA0KICAgICAgICAgICAgICAgICAgICAgIHsgbTogNiwgeTogc3RhcnRZZWFyLCBuYW1lOiAiSnVuZSIgfSwgeyBtOiA3LCB5OiBzdGFydFllYXIsIG5hbWU6ICJKdWx5IiB9LA0KICAgICAgICAgICAgICAgICAgICAgIHsgbTogOCwgeTogc3RhcnRZZWFyLCBuYW1lOiAiQXVndXN0IiB9LCB7IG06IDksIHk6IHN0YXJ0WWVhciwgbmFtZTogIlNlcHRlbWJlciIgfSwNCiAgICAgICAgICAgICAgICAgICAgICB7IG06IDEwLCB5OiBzdGFydFllYXIsIG5hbWU6ICJPY3RvYmVyIiB9LCB7IG06IDExLCB5OiBzdGFydFllYXIsIG5hbWU6ICJOb3ZlbWJlciIgfSwNCiAgICAgICAgICAgICAgICAgICAgICB7IG06IDEyLCB5OiBzdGFydFllYXIsIG5hbWU6ICJEZWNlbWJlciIgfSwgeyBtOiAxLCB5OiBzdGFydFllYXIgKyAxLCBuYW1lOiAiSmFudWFyeSIgfSwNCiAgICAgICAgICAgICAgICAgICAgICB7IG06IDIsIHk6IHN0YXJ0WWVhciArIDEsIG5hbWU6ICJGZWJydWFyeSIgfSwgeyBtOiAzLCB5OiBzdGFydFllYXIgKyAxLCBuYW1lOiAiTWFyY2giIH0NCiAgICAgICAgICAgICAgICAgIF07DQoNCiAgICAgICAgICAgICAgICAgIGxldCBmeUdyYW5kVG90YWwgPSAwOw0KICAgICAgICAgICAgICAgICAgbGV0IHN1bW1hcnlEYXRhID0gW107DQogICAgICAgICAgICAgICAgICBsZXQgcGFnZUNvdW50ID0gMDsNCg0KICAgICAgICAgICAgICAgICAgbW9udGhzLmZvckVhY2goKG1vbikgPT4gew0KICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IG1vbnRobHlSZWNzID0gYWxsUmVjb3Jkcy5maWx0ZXIociA9PiB7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGYgPSByLnNwbGl0KCd8Jyk7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGQgPSBpbnRlcm5hbFBhcnNlRGF0ZShmWzFdKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNDYW5jZWxsZWQgPSBmWzEzXSAmJiBmWzEzXS50b1VwcGVyQ2FzZSgpID09PSAiWUVTIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChkLmdldE1vbnRoKCkgKyAxID09PSBtb24ubSkgJiYgKGQuZ2V0RnVsbFllYXIoKSA9PT0gbW9uLnkpICYmICFpc0NhbmNlbGxlZDsNCiAgICAgICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgICAgIGlmIChtb250aGx5UmVjcy5sZW5ndGggPT09IDApIHJldHVybjsNCg0KICAgICAgICAgICAgICAgICAgICAgIGRvYy5hZGRQYWdlKCk7DQogICAgICAgICAgICAgICAgICAgICAgcGFnZUNvdW50Kys7DQogICAgICAgICAgICAgICAgICAgICAgYXBwbHlQYWdlU3R5bGUoKTsNCg0KICAgICAgICAgICAgICAgICAgICAgIC8vIEhlYWRlcg0KICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgxNik7IGRvYy5zZXRUZXh0Q29sb3IoMTI4LCAwLCAwKTsNCiAgICAgICAgICAgICAgICAgICAgICBkb2MudGV4dChgTW9udGhseSBEb25hdGlvbiBSZXBvcnQ6IEZZICR7ZnlMYWJlbH1gLCAxMDUsIDE1LCB7IGFsaWduOiAiY2VudGVyIiB9KTsNCiAgICAgICAgICAgICAgICAgICAgICBkb2Muc2V0Rm9udFNpemUoMTQpOw0KICAgICAgICAgICAgICAgICAgICAgIGRvYy50ZXh0KGAke21vbi5uYW1lfSAtICR7bW9uLnl9YCwgMTA1LCAyMywgeyBhbGlnbjogImNlbnRlciIgfSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICBsZXQgbW9kZVRvdGFscyA9IHt9Ow0KICAgICAgICAgICAgICAgICAgICAgIGxldCB0b3dhcmRzVG90YWxzID0ge307DQogICAgICAgICAgICAgICAgICAgICAgbGV0IG1vbnRoVG90YWwgPSAwOw0KDQogICAgICAgICAgICAgICAgICAgICAgbW9udGhseVJlY3MuZm9yRWFjaChyID0+IHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgZiA9IHIuc3BsaXQoJ3wnKTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVjZWlwdE5vID0gZlswXSB8fCAiTi9BIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc3QgYW10ID0gTWF0aC5yb3VuZChwYXJzZUZsb2F0KGZbOV0pIHx8IDApOw0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtb2RlID0gKGZbMTFdIHx8ICIiKS50cmltKCk7DQogICAgICAgICAgICAgICAgICAgICAgICAgIGxldCB0b3dhcmRzID0gKGZbMTJdIHx8ICIiKS50cmltKCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5lZWRzQXVkaXQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGF1ZGl0UmVhc29uID0gW107DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgTW9kZQ0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW1vZGUgfHwgbW9kZS50b1VwcGVyQ2FzZSgpID09PSAiT1RIRVIiKSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZWVkc0F1ZGl0ID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGF1ZGl0UmVhc29uLnB1c2goIk1pc3NpbmcvT3RoZXIgTW9kZSIpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZSA9ICJPdGhlciAoUmV2aWV3IFJlcSkiOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2hlY2sgVG93YXJkcw0KICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoIXRvd2FyZHMpIHsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5lZWRzQXVkaXQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXVkaXRSZWFzb24ucHVzaCgiTWlzc2luZyBUb3dhcmRzIik7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0b3dhcmRzID0gIkdlbmVyYWwgKFJldmlldyBSZXEpIjsNCiAgICAgICAgICAgICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZWVkc0F1ZGl0KSB7DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvdGhlck1vZGVSZWNlaXB0cy5wdXNoKGAke3JlY2VpcHROb30gfCAke21vbi5uYW1lfSB8IEFtdDogJHthbXR9IHwgSXNzdWVzOiAke2F1ZGl0UmVhc29uLmpvaW4oIiAmICIpfWApOw0KICAgICAgICAgICAgICAgICAgICAgICAgICB9DQoNCiAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZVRvdGFsc1ttb2RlXSA9IChtb2RlVG90YWxzW21vZGVdIHx8IDApICsgYW10Ow0KICAgICAgICAgICAgICAgICAgICAgICAgICB0b3dhcmRzVG90YWxzW3Rvd2FyZHNdID0gKHRvd2FyZHNUb3RhbHNbdG93YXJkc10gfHwgMCkgKyBhbXQ7DQogICAgICAgICAgICAgICAgICAgICAgICAgIG1vbnRoVG90YWwgKz0gYW10Ow0KICAgICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICAgICAgZnlHcmFuZFRvdGFsICs9IG1vbnRoVG90YWw7DQogICAgICAgICAgICAgICAgICAgICAgc3VtbWFyeURhdGEucHVzaCh7IG1vbnRoOiBtb24ubmFtZSwgdG90YWw6IG1vbnRoVG90YWwgfSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAvLyBUYWJsZSAxOiBNb2Rlcw0KICAgICAgICAgICAgICAgICAgICAgIGRvYy5hdXRvVGFibGUoew0KICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFk6IDMwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBbWydNb2RlIG9mIFBheW1lbnQnLCAnQW1vdW50IChScy4pJ11dLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBib2R5OiBPYmplY3QuZW50cmllcyhtb2RlVG90YWxzKS5tYXAoKFtrLCB2XSkgPT4gW2ssIHYudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyldKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9vdDogW1snTW9udGhseSBUb3RhbCcsIG1vbnRoVG90YWwudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyldXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlbWU6ICdzdHJpcGVkJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZFN0eWxlczogeyBmaWxsQ29sb3I6IFswLCA1MSwgMTAyXSB9LCAvLyBOYXZ5IEJsdWUNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9vdFN0eWxlczogeyBmaWxsQ29sb3I6IFsxMjgsIDAsIDBdIH0gIC8vIE1hcm9vbg0KICAgICAgICAgICAgICAgICAgICAgIH0pOw0KDQogICAgICAgICAgICAgICAgICAgICAgLy8gVGFibGUgMjogVG93YXJkcw0KICAgICAgICAgICAgICAgICAgICAgIGRvYy5hdXRvVGFibGUoew0KICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFk6IGRvYy5sYXN0QXV0b1RhYmxlLmZpbmFsWSArIDEwLA0KICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBbWydUb3dhcmRzIENhdGVnb3J5JywgJ0Ftb3VudCAoUnMuKSddXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogT2JqZWN0LmVudHJpZXModG93YXJkc1RvdGFscykubWFwKChbaywgdl0pID0+IFtrLCB2LnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpXSksDQogICAgICAgICAgICAgICAgICAgICAgICAgIGZvb3Q6IFtbJ01vbnRobHkgVG90YWwnLCBtb250aFRvdGFsLnRvTG9jYWxlU3RyaW5nKCdlbi1JTicpXV0sDQogICAgICAgICAgICAgICAgICAgICAgICAgIHRoZW1lOiAnc3RyaXBlZCcsDQogICAgICAgICAgICAgICAgICAgICAgICAgIGhlYWRTdHlsZXM6IHsgZmlsbENvbG9yOiBbNDYsIDEyNSwgNTBdIH0sIC8vIEdyZWVuDQogICAgICAgICAgICAgICAgICAgICAgICAgIGZvb3RTdHlsZXM6IHsgZmlsbENvbG9yOiBbMTI4LCAwLCAwXSB9DQogICAgICAgICAgICAgICAgICAgICAgfSk7DQogICAgICAgICAgICAgICAgICB9KTsNCg0KICAgICAgICAgICAgICAgICAgaWYgKHBhZ2VDb3VudCA9PT0gMCkgew0KICAgICAgICAgICAgICAgICAgICAgIGFsZXJ0KCJObyBkYXRhIGZvdW5kIGZvciB0aGUgc2VsZWN0ZWQgRmluYW5jaWFsIFllYXIuIik7DQogICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgIC8vIC0tLSBTVU1NQVJZIFBBR0UgLS0tDQogICAgICAgICAgICAgICAgICAgICAgZG9jLmFkZFBhZ2UoKTsNCiAgICAgICAgICAgICAgICAgICAgICBhcHBseVBhZ2VTdHlsZSgpOw0KICAgICAgICAgICAgICAgICAgICAgIGRvYy5zZXRGb250U2l6ZSgyMCk7IGRvYy5zZXRUZXh0Q29sb3IoMTI4LCAwLCAwKTsNCiAgICAgICAgICAgICAgICAgICAgICBkb2MudGV4dCgiQU5OVUFMIFNVTU1BUlkiLCAxMDUsIDI1LCB7IGFsaWduOiAiY2VudGVyIiB9KTsNCg0KICAgICAgICAgICAgICAgICAgICAgIGRvYy5hdXRvVGFibGUoew0KICAgICAgICAgICAgICAgICAgICAgICAgICBzdGFydFk6IDM1LA0KICAgICAgICAgICAgICAgICAgICAgICAgICBoZWFkOiBbWydNb250aCcsICdUb3RhbCAoUnMuKSddXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogc3VtbWFyeURhdGEubWFwKHMgPT4gW3MubW9udGgsIHMudG90YWwudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyldKSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgZm9vdDogW1snR1JBTkQgVE9UQUwnLCBmeUdyYW5kVG90YWwudG9Mb2NhbGVTdHJpbmcoJ2VuLUlOJyldXSwNCiAgICAgICAgICAgICAgICAgICAgICAgICAgdGhlbWU6ICdncmlkJywNCiAgICAgICAgICAgICAgICAgICAgICAgICAgaGVhZFN0eWxlczogeyBmaWxsQ29sb3I6IFswLCAwLCAwXSB9LA0KICAgICAgICAgICAgICAgICAgICAgICAgICBmb290U3R5bGVzOiB7IGZpbGxDb2xvcjogWzEyOCwgMCwgMF0sIGZvbnRTaXplOiAxMyB9DQogICAgICAgICAgICAgICAgICAgICAgfSk7DQoNCiAgICAgICAgICAgICAgICAgICAgICBkb2MuZGVsZXRlUGFnZSgxKTsgLy8gUmVtb3ZlIGluaXRpYWwgYmxhbmsgcGFnZQ0KICAgICAgICAgICAgICAgICAgICAgIGRvYy5zYXZlKGBNTVBUX01vbnRobHlfUmVwb3J0XyR7ZnlMYWJlbH0ucGRmYCk7DQoNCiAgICAgICAgICAgICAgICAgICAgICAvLyAtLS0gQVVESVQgRklMRSAtLS0NCiAgICAgICAgICAgICAgICAgICAgICBpZiAob3RoZXJNb2RlUmVjZWlwdHMubGVuZ3RoID4gMCkgew0KICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgdHh0ID0gYE1NUFQgQVVESVQgUkVRVUlSRUQgLSBGWSAke2Z5TGFiZWx9XG49PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHR4dCArPSBgUkVDRUlQVCBOTyB8IE1PTlRIIHwgQU1PVU5UIHwgQVVESVQgUkVBU09OXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbmA7DQogICAgICAgICAgICAgICAgICAgICAgICAgIHR4dCArPSBvdGhlck1vZGVSZWNlaXB0cy5qb2luKCdcbicpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBibG9iID0gbmV3IEJsb2IoW3R4dF0sIHsgdHlwZTogJ3RleHQvcGxhaW4nIH0pOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBsaW5rID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rLmhyZWYgPSBVUkwuY3JlYXRlT2JqZWN0VVJMKGJsb2IpOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rLmRvd25sb2FkID0gYE1NUFRfQXVkaXRfUmVxdWlyZWRfJHtmeUxhYmVsfS50eHRgOw0KICAgICAgICAgICAgICAgICAgICAgICAgICBsaW5rLmNsaWNrKCk7DQogICAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgbG9hZGluZy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOw0KICAgICAgICAgICAgICB9IGNhdGNoIChlcnIpIHsNCiAgICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTsNCiAgICAgICAgICAgICAgICAgIGFsZXJ0KCJFcnJvcjogIiArIGVyci5tZXNzYWdlKTsNCiAgICAgICAgICAgICAgICAgIGlmIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZycpKSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZGluZycpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7DQogICAgICAgICAgICAgIH0NCiAgICAgICAgICB9DQogICAgICA8L3NjcmlwdD4NCiAgPC9ib2R5Pg0KPC9odG1sPg0K"))));</script>